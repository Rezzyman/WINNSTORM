{"file_contents":{"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1128,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { useLocation, Link } from 'wouter';\nimport { motion, useScroll, useTransform, useInView } from 'framer-motion';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { \n  Shield, \n  Zap, \n  Eye, \n  Target, \n  Users, \n  Award, \n  CheckCircle, \n  ArrowRight,\n  Star,\n  Quote,\n  TrendingUp,\n  Clock,\n  MapPin,\n  FileText,\n  Camera,\n  Thermometer,\n  Cloud,\n  Building,\n  Phone,\n  Mail,\n  Globe,\n  Play,\n  ChevronDown,\n  Menu,\n  X\n} from 'lucide-react';\nimport { StormyAvatar } from '@/components/stormy-avatar';\nimport { \n  SEO, \n  organizationSchema, \n  softwareApplicationSchema, \n  websiteSchema,\n  faqSchema,\n  professionalServiceSchema \n} from '@/components/seo';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\nimport winnstormLogoLight from '@assets/logo-light_1765042579233.png';\nimport winnstormVideo from '@assets/WINNSTORM™ (1)_1756326492392.mp4';\n\nconst Landing = () => {\n  const [, navigate] = useLocation();\n  const [isScrolled, setIsScrolled] = useState(false);\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const [scrollY, setScrollY] = useState(0);\n  const heroRef = useRef<HTMLElement>(null);\n  const featuresRef = useRef<HTMLElement>(null);\n  const pricingRef = useRef<HTMLElement>(null);\n  const testimonialsRef = useRef<HTMLElement>(null);\n  const ctaRef = useRef<HTMLElement>(null);\n\n  // Framer Motion scroll tracking\n  const { scrollYProgress } = useScroll();\n  const backgroundY = useTransform(scrollYProgress, [0, 1], ['0%', '100%']);\n  const textY = useTransform(scrollYProgress, [0, 1], ['0%', '50%']);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      const currentScrollY = window.scrollY;\n      setIsScrolled(currentScrollY > 50);\n      setScrollY(currentScrollY);\n    };\n    \n    window.addEventListener('scroll', handleScroll, { passive: true });\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, []);\n\n  const features = [\n    {\n      icon: Thermometer,\n      title: \"AI-Powered Thermal Analysis\",\n      description: \"Advanced thermal imaging analysis with Stormy AI assistant providing real-time guidance based on Eric Winn's proven methodology.\"\n    },\n    {\n      icon: FileText,\n      title: \"Comprehensive Winn Reports\",\n      description: \"Generate detailed damage assessment reports following the industry-leading Winn Methodology with automated evidence compilation.\"\n    },\n    {\n      icon: Award,\n      title: \"Certification Training Portal\",\n      description: \"Complete training system with courses, progress tracking, and multi-level certification from Junior to Senior Consultant.\"\n    },\n    {\n      icon: MapPin,\n      title: \"Google Maps Integration\",\n      description: \"Satellite view property analysis with drawing tools for precise roof section marking and geospatial damage assessment.\"\n    },\n    {\n      icon: Users,\n      title: \"Client & Project Management\",\n      description: \"Full CRM functionality for managing projects, clients, and tracking assessment progress with automated workflows.\"\n    },\n    {\n      icon: Cloud,\n      title: \"Weather Verification\",\n      description: \"Integration with meteorological data sources for hail and storm verification to support insurance claims.\"\n    }\n  ];\n\n  const pricingPlans = [\n    {\n      name: \"Starter\",\n      price: \"$299\",\n      period: \"per month\",\n      description: \"Perfect for independent consultants starting their damage assessment practice\",\n      features: [\n        \"Up to 25 assessments per month\",\n        \"Basic Winn Report generation\",\n        \"Thermal analysis with Stormy AI\",\n        \"Junior certification training\",\n        \"Email support\",\n        \"Basic project management\"\n      ],\n      badge: null,\n      buttonText: \"Start Free Trial\",\n      buttonVariant: \"outline\" as const\n    },\n    {\n      name: \"Professional\",\n      price: \"$599\",\n      period: \"per month\",\n      description: \"Complete solution for established consulting firms and senior practitioners\",\n      features: [\n        \"Unlimited assessments\",\n        \"Advanced Winn Reports with customization\",\n        \"Full Stormy AI assistant capabilities\",\n        \"Complete certification program (Junior + Senior)\",\n        \"Google Maps integration with drawing tools\",\n        \"Advanced CRM and client management\",\n        \"Weather verification API access\",\n        \"Priority phone & email support\",\n        \"Team collaboration features\"\n      ],\n      badge: \"Most Popular\",\n      buttonText: \"Get Started\",\n      buttonVariant: \"default\" as const\n    },\n    {\n      name: \"Enterprise\",\n      price: \"Custom\",\n      period: \"contact us\",\n      description: \"Tailored solutions for large organizations and insurance companies\",\n      features: [\n        \"Everything in Professional\",\n        \"Custom integrations\",\n        \"White-label options\",\n        \"Dedicated account manager\",\n        \"Custom training programs\",\n        \"Advanced analytics & reporting\",\n        \"API access for third-party tools\",\n        \"24/7 phone support\",\n        \"On-site training available\"\n      ],\n      badge: \"Enterprise\",\n      buttonText: \"Contact Sales\",\n      buttonVariant: \"outline\" as const\n    }\n  ];\n\n  const testimonials = [\n    {\n      name: \"Michael Rodriguez\",\n      role: \"Senior Insurance Adjuster\",\n      company: \"State Farm Insurance\",\n      content: \"WinnStorm has revolutionized our damage assessment process. The Winn Methodology implementation is spot-on, and the thermal analysis is incredibly accurate.\",\n      rating: 5\n    },\n    {\n      name: \"Sarah Chen\",\n      role: \"Roofing Consultant\",\n      company: \"Elite Roofing Solutions\",\n      content: \"The training portal helped me achieve senior certification in record time. Stormy's AI guidance during inspections is like having Eric Winn himself on every job.\",\n      rating: 5\n    },\n    {\n      name: \"David Thompson\",\n      role: \"Claims Manager\",\n      company: \"Liberty Mutual\",\n      content: \"The comprehensive reports generated by WinnStorm provide the detailed evidence we need for complex claims. It's become an essential tool for our team.\",\n      rating: 5\n    }\n  ];\n\n  const landingFaqs = [\n    {\n      question: \"What is the Winn Methodology?\",\n      answer: \"The Winn Methodology is an industry-leading approach to property damage assessment developed by Eric Winn. It provides a systematic 8-step process for comprehensive storm and hail damage evaluation, ensuring accurate and defensible reports for insurance claims.\"\n    },\n    {\n      question: \"How does Stormy AI help with inspections?\",\n      answer: \"Stormy is our AI-powered assistant that provides real-time guidance during property inspections. It analyzes thermal images, identifies damage patterns, suggests next steps based on the Winn Methodology, and helps consultants produce comprehensive assessment reports.\"\n    },\n    {\n      question: \"What certifications can I earn through WinnStorm?\",\n      answer: \"WinnStorm offers a multi-level certification program including Junior Consultant and Senior Consultant certifications. Our training portal includes courses, quizzes, and progress tracking to help you master the Winn Methodology and advance your career.\"\n    },\n    {\n      question: \"Is WinnStorm available on mobile devices?\",\n      answer: \"Yes! WinnStorm is a mobile-first platform available as a progressive web app and native applications for iOS and Android. It's designed for field use with features like offline capability, native camera integration, and one-handed operation.\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"Professional Damage Assessment Platform\"\n        description=\"AI-powered property damage assessment platform using the proven Winn Methodology. Thermal analysis, comprehensive reporting, consultant certification, and mobile-first field inspector tools.\"\n        canonical=\"/\"\n        keywords={['hail damage assessment', 'storm damage inspection', 'property damage consultant', 'thermal imaging analysis', 'insurance claim documentation', 'roof inspection software', 'damage assessment certification']}\n        structuredData={[\n          organizationSchema,\n          softwareApplicationSchema,\n          websiteSchema,\n          professionalServiceSchema,\n          faqSchema(landingFaqs)\n        ]}\n      />\n      \n      {/* Navigation */}\n      <nav className={`fixed top-0 w-full z-50 transition-all duration-300 ${\n        isScrolled ? 'bg-[#1A1A1A] backdrop-blur-md border-b border-white/10 shadow-xl' : 'bg-transparent'\n      }`}>\n        <div className=\"container mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center\">\n              <img \n                src={winnstormLogo} \n                alt=\"WinnStorm Logo\" \n                className=\"h-10 w-auto\"\n              />\n            </div>\n\n            {/* Desktop Navigation */}\n            <div className=\"hidden md:flex items-center space-x-8\">\n              <a href=\"#features\" className=\"text-white/80 hover:text-white font-heading uppercase text-sm tracking-wide transition-colors\">Features</a>\n              <div className=\"relative group\">\n                <span className=\"text-white/80 hover:text-white font-heading uppercase text-sm tracking-wide transition-colors cursor-pointer\">Services</span>\n                <div className=\"absolute top-full left-0 mt-2 w-64 bg-[#1A1A1A] border border-white/20 rounded-none shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50\">\n                  <Link href=\"/services/thermal-inspection\" className=\"block px-4 py-3 text-white/80 hover:text-white hover:bg-white/10 text-sm\">Thermal Inspection</Link>\n                  <Link href=\"/services/hail-damage-assessment\" className=\"block px-4 py-3 text-white/80 hover:text-white hover:bg-white/10 text-sm\">Hail Damage Assessment</Link>\n                  <Link href=\"/services/storm-damage-consulting\" className=\"block px-4 py-3 text-white/80 hover:text-white hover:bg-white/10 text-sm\">Storm Damage Consulting</Link>\n                </div>\n              </div>\n              <a href=\"#pricing\" className=\"text-white/80 hover:text-white font-heading uppercase text-sm tracking-wide transition-colors\">Pricing</a>\n              <Link href=\"/blog\" className=\"text-white/80 hover:text-white font-heading uppercase text-sm tracking-wide transition-colors\">Blog</Link>\n              <a href=\"#contact\" className=\"text-white/80 hover:text-white font-heading uppercase text-sm tracking-wide transition-colors\">Contact</a>\n              <Button variant=\"outline\" onClick={() => navigate('/auth')} className=\"rounded-none border-white/40 text-white hover:bg-white hover:text-[#1A1A1A] font-heading uppercase tracking-wide\">Sign In</Button>\n              <Button className=\"btn-primary\" onClick={() => navigate('/subscribe/professional')}>\n                Start Free Trial\n              </Button>\n            </div>\n\n            {/* Mobile Menu Button */}\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"md:hidden text-white\"\n              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n            >\n              {mobileMenuOpen ? <X className=\"h-5 w-5\" /> : <Menu className=\"h-5 w-5\" />}\n            </Button>\n          </div>\n\n          {/* Mobile Navigation */}\n          {mobileMenuOpen && (\n            <div className=\"md:hidden mt-4 pb-4 border-t border-white/20\">\n              <div className=\"flex flex-col space-y-4 pt-4\">\n                <a href=\"#features\" className=\"text-white/80 hover:text-white font-heading uppercase text-sm tracking-wide transition-colors\">Features</a>\n                <Link href=\"/services/thermal-inspection\" className=\"text-white/80 hover:text-white text-sm pl-4\">→ Thermal Inspection</Link>\n                <Link href=\"/services/hail-damage-assessment\" className=\"text-white/80 hover:text-white text-sm pl-4\">→ Hail Damage Assessment</Link>\n                <Link href=\"/services/storm-damage-consulting\" className=\"text-white/80 hover:text-white text-sm pl-4\">→ Storm Damage Consulting</Link>\n                <a href=\"#pricing\" className=\"text-white/80 hover:text-white font-heading uppercase text-sm tracking-wide transition-colors\">Pricing</a>\n                <Link href=\"/blog\" className=\"text-white/80 hover:text-white font-heading uppercase text-sm tracking-wide transition-colors\">Blog</Link>\n                <a href=\"#contact\" className=\"text-white/80 hover:text-white font-heading uppercase text-sm tracking-wide transition-colors\">Contact</a>\n                <div className=\"flex flex-col space-y-2 pt-4\">\n                  <Button variant=\"outline\" onClick={() => navigate('/auth')} className=\"rounded-none border-white/40 text-white hover:bg-white hover:text-[#1A1A1A] font-heading uppercase tracking-wide\">Sign In</Button>\n                  <Button className=\"btn-primary\" onClick={() => navigate('/subscribe/professional')}>\n                    Start Free Trial\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <section ref={heroRef} className=\"relative min-h-screen flex items-center justify-center overflow-hidden section-dark\">\n        {/* Grayscale Video Background */}\n        <div className=\"absolute inset-0 w-full h-full\">\n          <video \n            autoPlay \n            loop \n            muted \n            playsInline\n            className=\"absolute inset-0 w-full h-full object-cover opacity-60\"\n            style={{ filter: 'grayscale(100%) brightness(0.75) contrast(1.2)' }}\n          >\n            <source src={winnstormVideo} type=\"video/mp4\" />\n            <source src=\"https://assets.mixkit.co/videos/preview/mixkit-lightning-in-the-dark-sky-4164-large.mp4\" type=\"video/mp4\" />\n          </video>\n          {/* Dark overlay */}\n          <div className=\"absolute inset-0 bg-gradient-to-b from-[#1A1A1A]/50 via-[#1A1A1A]/30 to-[#1A1A1A]/70\"></div>\n        </div>\n\n        <div \n          className=\"container mx-auto px-6 text-center relative z-20 pt-20\"\n          style={{\n            transform: `translateY(${scrollY * -0.1}px)`,\n          }}\n        >\n          <div className=\"max-w-5xl mx-auto\">\n            {/* Logo */}\n            <div className=\"mb-12 relative\">\n              <div className=\"relative z-10\" style={{ animation: 'fadeInScale 2s ease-out both' }}>\n                <img \n                  src={winnstormLogo} \n                  alt=\"WinnStorm Logo\" \n                  className=\"h-56 md:h-72 lg:h-96 w-auto mx-auto filter drop-shadow-2xl\"\n                />\n              </div>\n            </div>\n            \n            {/* Orange Accent Bar */}\n            <div className=\"flex justify-center mb-6\" style={{ animation: 'fadeInUp 1s ease-out 0.3s both' }}>\n              <div className=\"accent-bar-lg\"></div>\n            </div>\n            \n            {/* Headline - Bold Uppercase Montserrat */}\n            <h1 className=\"headline-xl text-white mb-8 leading-tight animate-fade-in\" style={{ animation: 'fadeInUp 1s ease-out 0.5s both' }}>\n              Master Roof Damage Assessment\n            </h1>\n            \n            <p className=\"text-lg md:text-xl text-white/70 mb-10 leading-relaxed max-w-3xl mx-auto font-sans animate-fade-in\" style={{ animation: 'fadeInUp 1s ease-out 0.8s both' }}>\n              AI-powered thermal analysis, comprehensive reporting, and professional certification training—all built on Eric Winn's proven methodology.\n            </p>\n\n            {/* CTA Buttons - Sharp Orange */}\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center mb-16 animate-fade-in\" style={{ animation: 'fadeInUp 1s ease-out 1s both' }}>\n              <Button \n                size=\"lg\"\n                className=\"btn-primary text-lg\"\n                onClick={() => navigate('/auth')}\n              >\n                Begin Your Assessment Journey\n                <ArrowRight className=\"ml-3 h-5 w-5\" />\n              </Button>\n              <Button \n                size=\"lg\" \n                variant=\"outline\"\n                className=\"btn-secondary text-lg\"\n                onClick={() => window.location.href = 'mailto:hello@winnstorm.com?subject=Video%20Demo%20Request'}\n                data-testid=\"button-see-action\"\n              >\n                <Play className=\"mr-3 h-5 w-5\" />\n                See It In Action\n              </Button>\n            </div>\n\n            {/* Event Details Strip */}\n            <div className=\"bg-white/5 backdrop-blur-sm border border-white/10 p-6 animate-fade-in\" style={{ animation: 'fadeInUp 1s ease-out 1.2s both' }}>\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8\">\n                <div className=\"text-center\">\n                  <div className=\"text-3xl md:text-4xl font-heading font-bold text-primary mb-1\">10,000+</div>\n                  <div className=\"text-xs md:text-sm text-white/60 uppercase tracking-wider font-heading\">Properties Assessed</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-3xl md:text-4xl font-heading font-bold text-primary mb-1\">98.7%</div>\n                  <div className=\"text-xs md:text-sm text-white/60 uppercase tracking-wider font-heading\">Precision Rate</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-3xl md:text-4xl font-heading font-bold text-primary mb-1\">750+</div>\n                  <div className=\"text-xs md:text-sm text-white/60 uppercase tracking-wider font-heading\">Certified Pros</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-3xl md:text-4xl font-heading font-bold text-primary mb-1\">24/7</div>\n                  <div className=\"text-xs md:text-sm text-white/60 uppercase tracking-wider font-heading\">AI Guidance</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Scroll Indicator */}\n        <div className=\"absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce\">\n          <ChevronDown className=\"h-6 w-6 text-white/50\" />\n        </div>\n      </section>\n\n      {/* Features Section */}\n      <section \n        ref={featuresRef} \n        id=\"features\" \n        className=\"py-24 section-light relative overflow-hidden\"\n      >\n        <div className=\"container mx-auto px-6 relative z-10\">\n          <motion.div \n            initial={{ opacity: 0, y: 60 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8 }}\n            viewport={{ once: true }}\n            className=\"text-center mb-20\"\n          >\n            <div className=\"flex justify-center mb-6\">\n              <div className=\"accent-bar\"></div>\n            </div>\n            <motion.div\n              initial={{ opacity: 0, scale: 0.8 }}\n              whileInView={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.6, delay: 0.2 }}\n              viewport={{ once: true }}\n            >\n              <Badge className=\"mb-6 bg-primary/10 text-primary border-primary/30 rounded-none font-heading uppercase tracking-wide\">Core Capabilities</Badge>\n            </motion.div>\n            <motion.h2 \n              initial={{ opacity: 0, y: 30 }}\n              whileInView={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.8, delay: 0.3 }}\n              viewport={{ once: true }}\n              className=\"headline-lg text-[#1A1A1A] mb-8\"\n            >\n              Professional-Grade Assessment Tools\n            </motion.h2>\n            <motion.p \n              initial={{ opacity: 0, y: 20 }}\n              whileInView={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.8, delay: 0.5 }}\n              viewport={{ once: true }}\n              className=\"text-lg text-[#1A1A1A]/70 max-w-4xl mx-auto leading-relaxed\"\n            >\n              Experience the intersection of decades of field expertise and modern technology. Our platform transforms \n              complex damage assessment into streamlined, accurate, and defensible reports that stand up to scrutiny.\n            </motion.p>\n          </motion.div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-20\">\n            {features.map((feature, index) => {\n              const Icon = feature.icon;\n              return (\n                <motion.div\n                  key={index}\n                  initial={{ opacity: 0, y: 60, rotateX: -10 }}\n                  whileInView={{ opacity: 1, y: 0, rotateX: 0 }}\n                  transition={{ \n                    duration: 0.8, \n                    delay: index * 0.1,\n                    ease: [0.25, 0.46, 0.45, 0.94]\n                  }}\n                  viewport={{ once: true }}\n                  whileHover={{ \n                    y: -8, \n                    scale: 1.02,\n                    transition: { duration: 0.3 }\n                  }}\n                >\n                  <Card className=\"group hover:shadow-xl transition-all duration-500 bg-white border border-[#1A1A1A]/10 hover:border-primary/50 relative overflow-hidden h-full rounded-none\">\n                    <CardContent className=\"p-8 relative z-10\">\n                      <motion.div \n                        whileHover={{ scale: 1.1 }}\n                        transition={{ duration: 0.3 }}\n                        className=\"bg-primary/10 w-14 h-14 flex items-center justify-center mb-6\"\n                      >\n                        <Icon className=\"h-7 w-7 text-primary\" />\n                      </motion.div>\n                      <h3 className=\"text-xl font-heading font-semibold mb-4 text-[#1A1A1A] group-hover:text-primary transition-colors uppercase tracking-wide\">{feature.title}</h3>\n                      <p className=\"text-[#1A1A1A]/70 leading-relaxed\">{feature.description}</p>\n                    </CardContent>\n                  </Card>\n                </motion.div>\n              );\n            })}\n          </div>\n\n          {/* Stormy AI Showcase */}\n          <Card className=\"bg-[#1A1A1A] border-primary/30 overflow-hidden rounded-none\">\n            \n            <CardContent className=\"p-10 relative z-10\">\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center\">\n                <div>\n                  <div className=\"flex items-center mb-6\">\n                    <div className=\"relative\">\n                      <StormyAvatar size={56} className=\"relative z-10\" />\n                    </div>\n                    <div className=\"ml-6\">\n                      <h3 className=\"text-3xl font-heading font-bold text-primary uppercase tracking-wide\">Meet Stormy</h3>\n                      <p className=\"text-white/70 text-lg\">Your Expert AI Assessment Partner</p>\n                    </div>\n                  </div>\n                  <p className=\"text-lg mb-8 text-white/70 leading-relaxed\">\n                    Powered by decades of field expertise, Stormy provides intelligent guidance throughout your inspection process. \n                    From thermal analysis to methodology recommendations, it's like having Eric Winn's expertise available 24/7 \n                    for every assessment.\n                  </p>\n                  <div className=\"grid grid-cols-2 gap-6\">\n                    <div className=\"flex items-center group\">\n                      <div className=\"bg-primary/20 p-2 mr-3\">\n                        <CheckCircle className=\"h-4 w-4 text-primary\" />\n                      </div>\n                      <span className=\"font-medium text-white\">Contextual Guidance</span>\n                    </div>\n                    <div className=\"flex items-center group\">\n                      <div className=\"bg-primary/20 p-2 mr-3\">\n                        <CheckCircle className=\"h-4 w-4 text-primary\" />\n                      </div>\n                      <span className=\"font-medium text-white\">Thermal Insights</span>\n                    </div>\n                    <div className=\"flex items-center group\">\n                      <div className=\"bg-primary/20 p-2 mr-3\">\n                        <CheckCircle className=\"h-4 w-4 text-primary\" />\n                      </div>\n                      <span className=\"font-medium text-white\">Methodology Training</span>\n                    </div>\n                    <div className=\"flex items-center group\">\n                      <div className=\"bg-primary/20 p-2 mr-3\">\n                        <CheckCircle className=\"h-4 w-4 text-primary\" />\n                      </div>\n                      <span className=\"font-medium text-white\">Always Available</span>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"bg-white/5 p-8 border border-white/10 relative overflow-hidden\">\n                  {/* Chat simulation */}\n                  <div className=\"bg-white/5 p-6 mb-6 relative\">\n                    <div className=\"flex items-start space-x-4\">\n                      <StormyAvatar size={40} className=\"flex-shrink-0\" />\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center mb-3\">\n                          <p className=\"font-semibold text-white\">Stormy</p>\n                          <div className=\"w-2 h-2 bg-primary rounded-full ml-3 animate-pulse\"></div>\n                          <span className=\"text-xs text-white/60 ml-2\">Active</span>\n                        </div>\n                        <p className=\"text-sm text-white/70 leading-relaxed\">\n                          \"Thermal signature analysis complete. Northwest section shows 8°F differential indicating moisture intrusion. \n                          Core sample recommended at grid N-3, W-2 following Winn protocols. Shall I generate the preliminary damage assessment?\"\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  {/* Status indicator */}\n                  <div className=\"flex items-center text-xs text-white/50\">\n                    <span>Powered by advanced AI trained on expert methodology</span>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </section>\n\n      {/* Pricing Section */}\n      <section \n        ref={pricingRef}\n        id=\"pricing\" \n        className=\"py-24 section-dark relative overflow-hidden\"\n      >\n        <div className=\"container mx-auto px-6 relative z-10\">\n          <motion.div \n            initial={{ opacity: 0, y: 50 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8 }}\n            viewport={{ once: true }}\n            className=\"text-center mb-16\"\n          >\n            <div className=\"flex justify-center mb-6\">\n              <div className=\"accent-bar\"></div>\n            </div>\n            <motion.div\n              initial={{ opacity: 0, scale: 0.8 }}\n              whileInView={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.6, delay: 0.2 }}\n              viewport={{ once: true }}\n            >\n              <Badge className=\"mb-4 bg-primary/10 text-primary border-primary/30 rounded-none font-heading uppercase tracking-wide\">Investment</Badge>\n            </motion.div>\n            <motion.h2 \n              initial={{ opacity: 0, y: 30 }}\n              whileInView={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.8, delay: 0.3 }}\n              viewport={{ once: true }}\n              className=\"headline-lg text-white mb-6\"\n            >\n              Choose Your Plan\n            </motion.h2>\n            <motion.p \n              initial={{ opacity: 0, y: 20 }}\n              whileInView={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.8, delay: 0.5 }}\n              viewport={{ once: true }}\n              className=\"text-lg text-white/70 max-w-3xl mx-auto\"\n            >\n              Transparent pricing that scales with your business. All plans include core features with no hidden fees.\n            </motion.p>\n          </motion.div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto\">\n            {pricingPlans.map((plan, index) => (\n              <motion.div\n                key={index}\n                initial={{ opacity: 0, y: 80, scale: 0.9 }}\n                whileInView={{ opacity: 1, y: 0, scale: 1 }}\n                transition={{ \n                  duration: 0.8, \n                  delay: index * 0.15,\n                  ease: [0.25, 0.46, 0.45, 0.94]\n                }}\n                viewport={{ once: true }}\n                whileHover={{ \n                  y: -10, \n                  scale: 1.03,\n                  transition: { duration: 0.3 }\n                }}\n              >\n                <Card className={`relative overflow-hidden h-full rounded-none ${\n                  plan.badge === \"Most Popular\" \n                    ? \"border-2 border-primary bg-white\" \n                    : \"border border-white/20 bg-white/5 hover:border-white/40 transition-all\"\n                }`}>\n                {plan.badge && (\n                  <div className=\"absolute top-0 right-0 bg-primary text-white px-4 py-1 text-sm font-heading uppercase tracking-wide\">\n                    {plan.badge}\n                  </div>\n                )}\n                <CardHeader className=\"text-center pb-2\">\n                  <CardTitle className={`text-xl font-heading font-bold mb-2 uppercase tracking-wide ${plan.badge === \"Most Popular\" ? \"text-[#1A1A1A]\" : \"text-white\"}`}>{plan.name}</CardTitle>\n                  <div className=\"mb-4\">\n                    <span className={`text-4xl font-heading font-bold ${plan.badge === \"Most Popular\" ? \"text-primary\" : \"text-primary\"}`}>{plan.price}</span>\n                    <span className={plan.badge === \"Most Popular\" ? \"text-[#1A1A1A]/60\" : \"text-white/60\"}>/{plan.period}</span>\n                  </div>\n                  <p className={`text-sm ${plan.badge === \"Most Popular\" ? \"text-[#1A1A1A]/70\" : \"text-white/70\"}`}>{plan.description}</p>\n                </CardHeader>\n                <CardContent>\n                  <ul className=\"space-y-3 mb-6\">\n                    {plan.features.map((feature, featureIndex) => (\n                      <li key={featureIndex} className=\"flex items-start\">\n                        <CheckCircle className={`h-5 w-5 mr-3 mt-0.5 flex-shrink-0 ${plan.badge === \"Most Popular\" ? \"text-primary\" : \"text-primary\"}`} />\n                        <span className={`text-sm ${plan.badge === \"Most Popular\" ? \"text-[#1A1A1A]/80\" : \"text-white/80\"}`}>{feature}</span>\n                      </li>\n                    ))}\n                  </ul>\n                  <Button \n                    className={`w-full rounded-none font-heading uppercase tracking-wide ${\n                      plan.buttonVariant === \"default\" \n                        ? \"btn-primary\" \n                        : plan.badge === \"Most Popular\" ? \"border-[#1A1A1A] text-[#1A1A1A] hover:bg-[#1A1A1A] hover:text-white\" : \"border-white text-white hover:bg-white hover:text-[#1A1A1A]\"\n                    }`}\n                    variant={plan.buttonVariant}\n                    size=\"lg\"\n                    onClick={() => {\n                      if (plan.name === \"Enterprise\") {\n                        window.location.hash = 'contact';\n                      } else {\n                        navigate(`/subscribe/${plan.name.toLowerCase()}`);\n                      }\n                    }}\n                    data-testid={`button-subscribe-${plan.name.toLowerCase()}`}\n                  >\n                    {plan.buttonText}\n                  </Button>\n                </CardContent>\n                </Card>\n              </motion.div>\n            ))}\n          </div>\n\n          <div className=\"text-center mt-12\">\n            <p className=\"text-white/60 mb-4 font-heading uppercase tracking-wide text-sm\">\n              All plans include 14-day free trial - No setup fees - Cancel anytime\n            </p>\n            <div className=\"flex justify-center space-x-8 text-sm text-white/50\">\n              <div className=\"flex items-center\">\n                <Shield className=\"h-4 w-4 mr-2 text-primary\" />\n                Enterprise Security\n              </div>\n              <div className=\"flex items-center\">\n                <Clock className=\"h-4 w-4 mr-2 text-primary\" />\n                24/7 Support\n              </div>\n              <div className=\"flex items-center\">\n                <Award className=\"h-4 w-4 mr-2 text-primary\" />\n                99.9% Uptime SLA\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Testimonials Section */}\n      <section \n        ref={testimonialsRef}\n        id=\"testimonials\" \n        className=\"py-20 section-light relative overflow-hidden\"\n      >\n        <div className=\"container mx-auto px-6 relative z-10\">\n          <motion.div \n            initial={{ opacity: 0, y: 50 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8 }}\n            viewport={{ once: true }}\n            className=\"text-center mb-16\"\n          >\n            <div className=\"flex justify-center mb-6\">\n              <div className=\"accent-bar\"></div>\n            </div>\n            <motion.div\n              initial={{ opacity: 0, scale: 0.8 }}\n              whileInView={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.6, delay: 0.2 }}\n              viewport={{ once: true }}\n            >\n              <Badge className=\"mb-4 bg-primary/10 text-primary border-primary/30 rounded-none font-heading uppercase tracking-wide\">Testimonials</Badge>\n            </motion.div>\n            <motion.h2 \n              initial={{ opacity: 0, y: 30 }}\n              whileInView={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.8, delay: 0.3 }}\n              viewport={{ once: true }}\n              className=\"headline-lg text-[#1A1A1A] mb-6\"\n            >\n              Trusted by Industry Leaders\n            </motion.h2>\n            <motion.p \n              initial={{ opacity: 0, y: 20 }}\n              whileInView={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.8, delay: 0.5 }}\n              viewport={{ once: true }}\n              className=\"text-lg text-[#1A1A1A]/70 max-w-3xl mx-auto\"\n            >\n              See how WinnStorm is transforming damage assessment for consultants, adjusters, and insurance professionals worldwide.\n            </motion.p>\n          </motion.div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n            {testimonials.map((testimonial, index) => (\n              <motion.div\n                key={index}\n                initial={{ opacity: 0, y: 60, rotateY: -15 }}\n                whileInView={{ opacity: 1, y: 0, rotateY: 0 }}\n                transition={{ \n                  duration: 0.8, \n                  delay: index * 0.2,\n                  ease: [0.25, 0.46, 0.45, 0.94]\n                }}\n                viewport={{ once: true }}\n                whileHover={{ \n                  y: -8, \n                  scale: 1.02,\n                  transition: { duration: 0.3 }\n                }}\n              >\n                <Card className=\"bg-white border border-[#1A1A1A]/10 hover:border-primary/30 hover:shadow-lg transition-all h-full rounded-none\">\n                  <CardContent className=\"p-6\">\n                  <div className=\"flex items-center mb-4\">\n                    {[...Array(testimonial.rating)].map((_, i) => (\n                      <Star key={i} className=\"h-5 w-5 fill-primary text-primary\" />\n                    ))}\n                  </div>\n                  <Quote className=\"h-8 w-8 text-primary/40 mb-4\" />\n                  <p className=\"text-[#1A1A1A]/70 mb-6 italic\">\"{testimonial.content}\"</p>\n                  <div>\n                    <div className=\"font-heading font-semibold text-[#1A1A1A]\">{testimonial.name}</div>\n                    <div className=\"text-sm text-[#1A1A1A]/60\">{testimonial.role}</div>\n                    <div className=\"text-sm text-primary font-medium\">{testimonial.company}</div>\n                  </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section \n        ref={ctaRef}\n        className=\"py-20 bg-primary text-white relative overflow-hidden\"\n      >\n        <div className=\"container mx-auto px-6 text-center relative z-10\">\n          <div className=\"flex justify-center mb-6\">\n            <div className=\"w-24 h-1.5 bg-white/30 mb-6\"></div>\n          </div>\n          <motion.h2 \n            initial={{ opacity: 0, y: 40 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8 }}\n            viewport={{ once: true }}\n            className=\"headline-lg text-white mb-6\"\n          >\n            Ready to Transform Your Damage Assessments?\n          </motion.h2>\n          <motion.p \n            initial={{ opacity: 0, y: 30 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8, delay: 0.2 }}\n            viewport={{ once: true }}\n            className=\"text-xl mb-8 opacity-90 max-w-3xl mx-auto\"\n          >\n            Join hundreds of certified consultants who trust WinnStorm for accurate, comprehensive damage assessment. \n            Start your free trial today and experience the future of professional inspections.\n          </motion.p>\n          <motion.div \n            initial={{ opacity: 0, y: 30 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8, delay: 0.4 }}\n            viewport={{ once: true }}\n            className=\"flex flex-col sm:flex-row gap-4 justify-center\"\n          >\n            <motion.div\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n            >\n              <Button \n                size=\"lg\" \n                variant=\"secondary\"\n                className=\"bg-white text-[#1A1A1A] hover:bg-white/90 text-lg px-8 py-6 rounded-none font-heading uppercase tracking-wide\"\n                onClick={() => navigate('/auth')}\n              >\n                Start Free Trial\n                <ArrowRight className=\"ml-2 h-5 w-5\" />\n              </Button>\n            </motion.div>\n            <motion.div\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n            >\n              <Button \n                size=\"lg\" \n                variant=\"outline\"\n                className=\"border-2 border-white text-white hover:bg-white hover:text-[#1A1A1A] text-lg px-8 py-6 rounded-none font-heading uppercase tracking-wide\"\n                onClick={() => window.location.href = 'mailto:hello@winnstorm.com?subject=Schedule%20a%20Demo'}\n              >\n                Schedule Demo\n              </Button>\n            </motion.div>\n          </motion.div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer id=\"contact\" className=\"section-dark border-t border-white/10\">\n        <div className=\"container mx-auto px-6 py-16\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n            <div>\n              <div className=\"flex items-center mb-4\">\n                <img \n                  src={winnstormLogo} \n                  alt=\"WinnStorm Logo\" \n                  className=\"h-12 w-auto\"\n                />\n              </div>\n              <p className=\"text-white/60 mb-4\">\n                The professional damage assessment platform powered by Eric Winn's proven methodology.\n              </p>\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center text-sm text-white/60\">\n                  <Phone className=\"h-4 w-4 mr-2 text-primary\" />\n                  +1 (555) 123-WINN\n                </div>\n                <div className=\"flex items-center text-sm text-white/60\">\n                  <Mail className=\"h-4 w-4 mr-2 text-primary\" />\n                  hello@winnstorm.com\n                </div>\n                <div className=\"flex items-center text-sm text-white/60\">\n                  <Globe className=\"h-4 w-4 mr-2 text-primary\" />\n                  www.winnstorm.com\n                </div>\n              </div>\n            </div>\n\n            <div>\n              <h3 className=\"font-heading font-semibold mb-4 text-white uppercase tracking-wide text-sm\">Platform</h3>\n              <ul className=\"space-y-2 text-sm text-white/60\">\n                <li><a href=\"#features\" className=\"hover:text-primary transition-colors\">Features</a></li>\n                <li><a href=\"#pricing\" className=\"hover:text-primary transition-colors\">Pricing</a></li>\n                <li><a href=\"/auth\" className=\"hover:text-primary transition-colors\">Sign In</a></li>\n                <li><a href=\"/training\" className=\"hover:text-primary transition-colors\">Training Portal</a></li>\n              </ul>\n            </div>\n\n            <div>\n              <h3 className=\"font-heading font-semibold mb-4 text-white uppercase tracking-wide text-sm\">Resources</h3>\n              <ul className=\"space-y-2 text-sm text-white/60\">\n                <li><a href=\"/docs\" className=\"hover:text-primary transition-colors\">Documentation</a></li>\n                <li><a href=\"/api-docs\" className=\"hover:text-primary transition-colors\">API Reference</a></li>\n                <li><a href=\"/support\" className=\"hover:text-primary transition-colors\">Support Center</a></li>\n                <li><a href=\"/methodology\" className=\"hover:text-primary transition-colors\">Winn Methodology Guide</a></li>\n              </ul>\n            </div>\n\n            <div>\n              <h3 className=\"font-heading font-semibold mb-4 text-white uppercase tracking-wide text-sm\">Company</h3>\n              <ul className=\"space-y-2 text-sm text-white/60\">\n                <li><a href=\"/about\" className=\"hover:text-primary transition-colors\">About Us</a></li>\n                <li><a href=\"/careers\" className=\"hover:text-primary transition-colors\">Careers</a></li>\n                <li><a href=\"/privacy\" className=\"hover:text-primary transition-colors\">Privacy Policy</a></li>\n                <li><a href=\"/terms\" className=\"hover:text-primary transition-colors\">Terms of Service</a></li>\n              </ul>\n            </div>\n          </div>\n\n          <Separator className=\"my-8 bg-white/10\" />\n          \n          <div className=\"flex flex-col md:flex-row justify-between items-center\">\n            <p className=\"text-sm text-white/50\">\n              © 2025 WinnStorm™. All rights reserved. Built with the proven Winn Methodology.\n            </p>\n            <div className=\"flex items-center space-x-4 mt-4 md:mt-0\">\n              <Badge variant=\"outline\" className=\"text-xs border-white/20 text-white/60 rounded-none\">\n                <Shield className=\"h-3 w-3 mr-1 text-primary\" />\n                256-bit Encryption\n              </Badge>\n              <Badge variant=\"outline\" className=\"text-xs border-white/20 text-white/60 rounded-none\">\n                <Award className=\"h-3 w-3 mr-1 text-primary\" />\n                Enterprise Security\n              </Badge>\n            </div>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport default Landing;","path":null,"size_bytes":43831,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n});\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      fontFamily: {\n        sans: [\"Inter\", \"system-ui\", \"sans-serif\"],\n        heading: [\"Montserrat\", \"system-ui\", \"sans-serif\"],\n      },\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":2928,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { HelmetProvider } from \"react-helmet-async\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport NotFound from \"@/pages/not-found\";\nimport Auth from \"@/pages/auth\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Upload from \"@/pages/upload\";\nimport Analysis from \"@/pages/analysis\";\nimport PropertyDetail from \"@/pages/property-detail\";\nimport Report from \"@/pages/report\";\nimport Reports from \"@/pages/reports\";\nimport WinnReport from \"@/pages/winn-report\";\nimport CrmIntegrations from \"@/pages/crm-integrations\";\nimport Training from \"@/pages/training\";\nimport Projects from \"@/pages/projects\";\nimport Landing from \"@/pages/landing\";\nimport Subscribe from \"@/pages/subscribe\";\nimport SubscriptionSuccess from \"@/pages/subscription-success\";\nimport InspectionWizard from \"@/pages/inspection-wizard\";\nimport Transcripts from \"@/pages/transcripts\";\nimport Docs from \"@/pages/docs\";\nimport ApiDocs from \"@/pages/api-docs\";\nimport Support from \"@/pages/support\";\nimport Methodology from \"@/pages/methodology\";\nimport About from \"@/pages/about\";\nimport Careers from \"@/pages/careers\";\nimport Privacy from \"@/pages/privacy\";\nimport Terms from \"@/pages/terms\";\nimport Pricing from \"@/pages/pricing\";\nimport { DallasPage, HoustonPage, KansasCityPage } from \"@/pages/city-landing\";\nimport { ThermalInspectionPage, HailDamageAssessmentPage, StormDamageConsultingPage } from \"@/pages/service-landing\";\nimport { BlogIndex, BlogPost } from \"@/pages/blog\";\nimport Schedule from \"@/pages/schedule\";\nimport TeamManagement from \"@/pages/team-management\";\nimport Clients from \"@/pages/clients\";\nimport InnovationHub from \"@/pages/innovation-hub\";\nimport { AuthProvider } from \"@/hooks/use-auth\";\nimport { LoadingOverlay } from \"@/components/loading-overlay\";\nimport { useEffect } from \"react\";\n\n// Clean up old test user data from localStorage\nfunction useCleanupTestData() {\n  useEffect(() => {\n    const testUser = localStorage.getItem('test_user');\n    const userRole = localStorage.getItem('userRole');\n    \n    if (testUser || userRole) {\n      localStorage.removeItem('test_user');\n      localStorage.removeItem('userRole');\n    }\n  }, []);\n}\n\nfunction Router() {\n  useCleanupTestData();\n  \n  return (\n    <Switch>\n      <Route path=\"/auth\" component={Auth} />\n      <Route path=\"/\" component={Landing} />\n      <Route path=\"/pricing\" component={Pricing} />\n      <Route path=\"/subscribe/:plan\" component={Subscribe} />\n      <Route path=\"/subscription-success\" component={SubscriptionSuccess} />\n      <Route path=\"/dashboard\" component={Dashboard} />\n      <Route path=\"/upload\" component={Upload} />\n      <Route path=\"/analysis/:id\" component={Analysis} />\n      <Route path=\"/property/:id\" component={PropertyDetail} />\n      <Route path=\"/report/:id\" component={Report} />\n      <Route path=\"/reports\" component={Reports} />\n      <Route path=\"/winn-report/:propertyId\" component={WinnReport} />\n      <Route path=\"/crm-integrations\" component={CrmIntegrations} />\n      <Route path=\"/training\" component={Training} />\n      <Route path=\"/projects\" component={Projects} />\n      <Route path=\"/schedule\" component={Schedule} />\n      <Route path=\"/team\" component={TeamManagement} />\n      <Route path=\"/clients\" component={Clients} />\n      <Route path=\"/innovation\" component={InnovationHub} />\n      <Route path=\"/inspection/:propertyId\" component={InspectionWizard} />\n      <Route path=\"/transcripts\" component={Transcripts} />\n      <Route path=\"/docs\" component={Docs} />\n      <Route path=\"/api-docs\" component={ApiDocs} />\n      <Route path=\"/support\" component={Support} />\n      <Route path=\"/methodology\" component={Methodology} />\n      <Route path=\"/about\" component={About} />\n      <Route path=\"/careers\" component={Careers} />\n      <Route path=\"/privacy\" component={Privacy} />\n      <Route path=\"/terms\" component={Terms} />\n      <Route path=\"/dallas\" component={DallasPage} />\n      <Route path=\"/houston\" component={HoustonPage} />\n      <Route path=\"/kansas-city\" component={KansasCityPage} />\n      <Route path=\"/services/thermal-inspection\" component={ThermalInspectionPage} />\n      <Route path=\"/services/hail-damage-assessment\" component={HailDamageAssessmentPage} />\n      <Route path=\"/services/storm-damage-consulting\" component={StormDamageConsultingPage} />\n      <Route path=\"/blog\" component={BlogIndex} />\n      <Route path=\"/blog/:slug\">{(params) => <BlogPost slug={params.slug} />}</Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <HelmetProvider>\n      <AuthProvider>\n        <TooltipProvider>\n          <div className=\"min-h-screen flex flex-col relative\">\n            <LoadingOverlay />\n            <Router />\n          </div>\n        </TooltipProvider>\n      </AuthProvider>\n    </HelmetProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":4927,"size_tokens":null},"client/src/components/crm-config.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/hooks/use-toast';\nimport { Trash2, Plus, Settings, ExternalLink, Database, CheckCircle, AlertCircle } from 'lucide-react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface CrmConfig {\n  id: number;\n  name: string;\n  type: string;\n  apiKey: string;\n  baseUrl: string;\n  webhookUrl?: string;\n  customFields?: Record<string, string>;\n  isActive: boolean;\n  createdAt: Date;\n}\n\ninterface CrmSyncLog {\n  id: number;\n  crmConfigId: number;\n  propertyId?: number;\n  scanId?: number;\n  syncType: string;\n  externalId?: string;\n  status: string;\n  errorMessage?: string;\n  syncedAt: Date;\n}\n\nconst CRM_TYPES = [\n  { value: 'jobnimbus', label: 'JobNimbus', description: 'Construction job management' },\n  { value: 'gohighlevel', label: 'GoHighLevel', description: 'All-in-one CRM & marketing' },\n  { value: 'salesforce', label: 'Salesforce', description: 'Enterprise CRM platform' },\n  { value: 'hubspot', label: 'HubSpot', description: 'Inbound marketing & sales' },\n  { value: 'pipedrive', label: 'Pipedrive', description: 'Sales-focused CRM' },\n];\n\nexport const CrmConfigManager: React.FC = () => {\n  const [selectedConfig, setSelectedConfig] = useState<CrmConfig | null>(null);\n  const [isCreating, setIsCreating] = useState(false);\n  const [formData, setFormData] = useState({\n    name: '',\n    type: '',\n    apiKey: '',\n    baseUrl: '',\n    webhookUrl: '',\n    customFields: '{}',\n    isActive: true\n  });\n  const [syncLogs, setSyncLogs] = useState<CrmSyncLog[]>([]);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch CRM configurations\n  const { data: configs = [], isLoading, error } = useQuery<CrmConfig[]>({\n    queryKey: ['/api/crm/configs'],\n    queryFn: () => apiRequest('/api/crm/configs'),\n  });\n\n  // Create configuration mutation\n  const createConfigMutation = useMutation({\n    mutationFn: (data: any) => apiRequest('/api/crm/configs', {\n      method: 'POST',\n      body: JSON.stringify(data)\n    }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/crm/configs'] });\n      setIsCreating(false);\n      resetForm();\n      toast({\n        title: \"CRM Configuration Created\",\n        description: \"Your CRM integration has been set up successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Create Configuration\",\n        description: error.message || \"Please check your settings and try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Update configuration mutation\n  const updateConfigMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => \n      apiRequest(`/api/crm/configs/${id}`, {\n        method: 'PUT',\n        body: JSON.stringify(data)\n      }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/crm/configs'] });\n      setSelectedConfig(null);\n      toast({\n        title: \"Configuration Updated\",\n        description: \"Your CRM settings have been updated successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Update Configuration\",\n        description: error.message || \"Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Delete configuration mutation\n  const deleteConfigMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(`/api/crm/configs/${id}`, {\n      method: 'DELETE'\n    }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/crm/configs'] });\n      toast({\n        title: \"Configuration Deleted\",\n        description: \"The CRM configuration has been removed.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Delete Configuration\",\n        description: error.message || \"Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Fetch sync logs for selected config\n  const fetchSyncLogs = async (configId: number) => {\n    try {\n      const logs = await apiRequest(`/api/crm/sync/logs/${configId}`);\n      setSyncLogs(logs);\n    } catch (error) {\n      console.error('Failed to fetch sync logs:', error);\n    }\n  };\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      type: '',\n      apiKey: '',\n      baseUrl: '',\n      webhookUrl: '',\n      customFields: '{}',\n      isActive: true\n    });\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    try {\n      const customFields = formData.customFields ? JSON.parse(formData.customFields) : {};\n      \n      const submitData = {\n        ...formData,\n        customFields: Object.keys(customFields).length > 0 ? customFields : null\n      };\n\n      if (selectedConfig) {\n        updateConfigMutation.mutate({ id: selectedConfig.id, data: submitData });\n      } else {\n        createConfigMutation.mutate(submitData);\n      }\n    } catch (error) {\n      toast({\n        title: \"Invalid Custom Fields\",\n        description: \"Please ensure custom fields are valid JSON format.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleEdit = (config: CrmConfig) => {\n    setSelectedConfig(config);\n    setFormData({\n      name: config.name,\n      type: config.type,\n      apiKey: config.apiKey,\n      baseUrl: config.baseUrl,\n      webhookUrl: config.webhookUrl || '',\n      customFields: JSON.stringify(config.customFields || {}, null, 2),\n      isActive: config.isActive\n    });\n    setIsCreating(true);\n    fetchSyncLogs(config.id);\n  };\n\n  const getDefaultBaseUrl = (type: string) => {\n    const defaults: Record<string, string> = {\n      'jobnimbus': 'https://api.jobnimbus.com/api1',\n      'gohighlevel': 'https://rest.gohighlevel.com/v1',\n      'salesforce': 'https://your-domain.my.salesforce.com',\n      'hubspot': 'https://api.hubapi.com',\n      'pipedrive': 'https://api.pipedrive.com/v1'\n    };\n    return defaults[type] || '';\n  };\n\n  const handleTypeChange = (type: string) => {\n    setFormData(prev => ({\n      ...prev,\n      type,\n      baseUrl: getDefaultBaseUrl(type)\n    }));\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-foreground\">CRM Integrations</h2>\n          <p className=\"text-muted-foreground mt-1\">\n            Connect your roofing CRM to automatically sync property data and reports\n          </p>\n        </div>\n        <Button\n          onClick={() => {\n            setIsCreating(true);\n            resetForm();\n            setSelectedConfig(null);\n          }}\n          className=\"bg-gradient-to-r from-primary to-cyan-500 hover:from-primary/90 hover:to-cyan-500/90\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Add Integration\n        </Button>\n      </div>\n\n      {/* Configuration List */}\n      <div className=\"grid gap-4\">\n        {configs.map((config) => (\n          <Card key={config.id} className=\"bg-card border-border\">\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex justify-between items-start\">\n                <div>\n                  <CardTitle className=\"text-foreground flex items-center gap-2\">\n                    <Database className=\"w-5 h-5\" />\n                    {config.name}\n                  </CardTitle>\n                  <CardDescription className=\"text-muted-foreground\">\n                    {CRM_TYPES.find(t => t.value === config.type)?.label || config.type}\n                  </CardDescription>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Badge variant={config.isActive ? \"default\" : \"secondary\"}>\n                    {config.isActive ? \"Active\" : \"Inactive\"}\n                  </Badge>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => handleEdit(config)}\n                    className=\"text-muted-foreground hover:text-foreground\"\n                  >\n                    <Settings className=\"w-4 h-4\" />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => deleteConfigMutation.mutate(config.id)}\n                    className=\"text-red-400 hover:text-red-300\"\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                <div>\n                  <span className=\"text-muted-foreground\">API Endpoint:</span>\n                  <p className=\"text-foreground font-mono text-xs truncate\">{config.baseUrl}</p>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Created:</span>\n                  <p className=\"text-foreground\">{new Date(config.createdAt).toLocaleDateString()}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Create/Edit Form */}\n      {isCreating && (\n        <Card className=\"bg-card border-border\">\n          <CardHeader>\n            <CardTitle className=\"text-foreground\">\n              {selectedConfig ? 'Edit Integration' : 'New CRM Integration'}\n            </CardTitle>\n            <CardDescription className=\"text-muted-foreground\">\n              Configure your CRM connection settings\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"name\" className=\"text-foreground\">Integration Name</Label>\n                  <Input\n                    id=\"name\"\n                    value={formData.name}\n                    onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                    placeholder=\"e.g., Main JobNimbus\"\n                    className=\"bg-muted border-input text-foreground\"\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"type\" className=\"text-foreground\">CRM Type</Label>\n                  <Select value={formData.type} onValueChange={handleTypeChange}>\n                    <SelectTrigger className=\"bg-muted border-input text-foreground\">\n                      <SelectValue placeholder=\"Select CRM type\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-muted border-input\">\n                      {CRM_TYPES.map((type) => (\n                        <SelectItem key={type.value} value={type.value}>\n                          <div>\n                            <div className=\"font-medium\">{type.label}</div>\n                            <div className=\"text-xs text-muted-foreground\">{type.description}</div>\n                          </div>\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"apiKey\" className=\"text-foreground\">API Key</Label>\n                <Input\n                  id=\"apiKey\"\n                  type=\"password\"\n                  value={formData.apiKey}\n                  onChange={(e) => setFormData(prev => ({ ...prev, apiKey: e.target.value }))}\n                  placeholder=\"Enter your API key\"\n                  className=\"bg-muted border-input text-foreground\"\n                  required\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"baseUrl\" className=\"text-foreground\">API Base URL</Label>\n                <Input\n                  id=\"baseUrl\"\n                  value={formData.baseUrl}\n                  onChange={(e) => setFormData(prev => ({ ...prev, baseUrl: e.target.value }))}\n                  placeholder=\"https://api.example.com/v1\"\n                  className=\"bg-muted border-input text-foreground\"\n                  required\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"webhookUrl\" className=\"text-foreground\">Webhook URL (Optional)</Label>\n                <Input\n                  id=\"webhookUrl\"\n                  value={formData.webhookUrl}\n                  onChange={(e) => setFormData(prev => ({ ...prev, webhookUrl: e.target.value }))}\n                  placeholder=\"https://your-webhook-endpoint.com\"\n                  className=\"bg-muted border-input text-foreground\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"customFields\" className=\"text-foreground\">Custom Fields (JSON)</Label>\n                <Textarea\n                  id=\"customFields\"\n                  value={formData.customFields}\n                  onChange={(e) => setFormData(prev => ({ ...prev, customFields: e.target.value }))}\n                  placeholder='{\"field1\": \"value1\", \"field2\": \"value2\"}'\n                  className=\"bg-muted border-input text-foreground font-mono\"\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"flex items-center space-x-2\">\n                <Switch\n                  id=\"isActive\"\n                  checked={formData.isActive}\n                  onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isActive: checked }))}\n                />\n                <Label htmlFor=\"isActive\" className=\"text-foreground\">Active</Label>\n              </div>\n\n              <div className=\"flex justify-end space-x-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setIsCreating(false);\n                    setSelectedConfig(null);\n                    resetForm();\n                  }}\n                  className=\"border-border text-foreground\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  className=\"bg-gradient-to-r from-primary to-cyan-500 hover:from-primary/90 hover:to-cyan-500/90\"\n                  disabled={createConfigMutation.isPending || updateConfigMutation.isPending}\n                >\n                  {createConfigMutation.isPending || updateConfigMutation.isPending ? 'Saving...' : 'Save Integration'}\n                </Button>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Sync Logs */}\n      {selectedConfig && syncLogs.length > 0 && (\n        <Card className=\"bg-card border-border\">\n          <CardHeader>\n            <CardTitle className=\"text-foreground\">Sync History</CardTitle>\n            <CardDescription className=\"text-muted-foreground\">\n              Recent synchronization activity for {selectedConfig.name}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {syncLogs.slice(0, 10).map((log) => (\n                <div key={log.id} className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                  <div className=\"flex items-center gap-3\">\n                    {log.status === 'success' ? (\n                      <CheckCircle className=\"w-5 h-5 text-green-400\" />\n                    ) : (\n                      <AlertCircle className=\"w-5 h-5 text-red-400\" />\n                    )}\n                    <div>\n                      <p className=\"text-foreground font-medium\">{log.syncType} sync</p>\n                      <p className=\"text-muted-foreground text-sm\">\n                        {new Date(log.syncedAt).toLocaleString()}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <Badge variant={log.status === 'success' ? \"default\" : \"destructive\"}>\n                      {log.status}\n                    </Badge>\n                    {log.externalId && (\n                      <p className=\"text-muted-foreground text-xs mt-1\">ID: {log.externalId}</p>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n};\n\nexport default CrmConfigManager;","path":null,"size_bytes":17264,"size_tokens":null},"client/src/components/loading-overlay.tsx":{"content":"import { useState, useEffect, createContext, useContext, ReactNode } from 'react';\nimport { Loader2 } from 'lucide-react';\n\ninterface LoadingContextType {\n  showLoading: (message?: string, submessage?: string) => void;\n  hideLoading: () => void;\n}\n\nconst LoadingContext = createContext<LoadingContextType>({\n  showLoading: () => {},\n  hideLoading: () => {},\n});\n\nexport const useLoading = () => useContext(LoadingContext);\n\ninterface LoadingProviderProps {\n  children: ReactNode;\n}\n\nexport const LoadingProvider = ({ children }: LoadingProviderProps) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [message, setMessage] = useState('Analyzing thermal data...');\n  const [submessage, setSubmessage] = useState('Identifying hotspots and moisture infiltration');\n\n  const showLoading = (newMessage?: string, newSubmessage?: string) => {\n    setMessage(newMessage || 'Analyzing thermal data...');\n    setSubmessage(newSubmessage || 'Identifying hotspots and moisture infiltration');\n    setIsVisible(true);\n  };\n\n  const hideLoading = () => {\n    setIsVisible(false);\n  };\n\n  const value = {\n    showLoading,\n    hideLoading,\n  };\n\n  return (\n    <LoadingContext.Provider value={value}>\n      <LoadingOverlayComponent \n        isVisible={isVisible} \n        message={message}\n        submessage={submessage}\n      />\n      {children}\n    </LoadingContext.Provider>\n  );\n};\n\ninterface LoadingOverlayComponentProps {\n  isVisible: boolean;\n  message: string;\n  submessage: string;\n}\n\nconst LoadingOverlayComponent = ({ isVisible, message, submessage }: LoadingOverlayComponentProps) => {\n  return (\n    <div className={`fixed inset-0 bg-neutral-darker bg-opacity-80 z-50 flex items-center justify-center ${isVisible ? '' : 'hidden'}`}>\n      <div className=\"bg-white p-6 rounded-lg shadow-lg flex flex-col items-center\">\n        <Loader2 className=\"h-12 w-12 animate-spin text-primary\" />\n        <p className=\"mt-4 text-neutral-darker font-medium\">{message}</p>\n        <p className=\"text-sm text-neutral-dark mt-2\">{submessage}</p>\n      </div>\n    </div>\n  );\n};\n\n// Default exported component that doesn't require the Provider pattern\nexport const LoadingOverlay = () => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [message, setMessage] = useState('Analyzing thermal data...');\n  const [submessage, setSubmessage] = useState('Identifying hotspots and moisture infiltration');\n\n  // This creates a global access to the loading overlay\n  useEffect(() => {\n    window.showLoading = (msg?: string, subMsg?: string) => {\n      setMessage(msg || 'Analyzing thermal data...');\n      setSubmessage(subMsg || 'Identifying hotspots and moisture infiltration');\n      setIsVisible(true);\n    };\n    \n    window.hideLoading = () => {\n      setIsVisible(false);\n    };\n\n    return () => {\n      delete window.showLoading;\n      delete window.hideLoading;\n    };\n  }, []);\n\n  return (\n    <div className={`fixed inset-0 bg-neutral-darker bg-opacity-80 z-50 flex items-center justify-center ${isVisible ? '' : 'hidden'}`}>\n      <div className=\"bg-white p-6 rounded-lg shadow-lg flex flex-col items-center\">\n        <Loader2 className=\"h-12 w-12 animate-spin text-primary\" />\n        <p className=\"mt-4 text-neutral-darker font-medium\">{message}</p>\n        <p className=\"text-sm text-neutral-dark mt-2\">{submessage}</p>\n      </div>\n    </div>\n  );\n};\n\n// Extend Window interface\ndeclare global {\n  interface Window {\n    showLoading: (message?: string, submessage?: string) => void;\n    hideLoading: () => void;\n  }\n}\n","path":null,"size_bytes":3539,"size_tokens":null},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700;800;900&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* Custom styles for WinnStorm™ brand - Industrial Safety Orange Theme */\n@layer base {\n  body {\n    @apply bg-background text-foreground font-sans;\n  }\n  \n  h1, h2, h3, h4, h5, h6 {\n    @apply font-heading;\n  }\n}\n\n@layer components {\n  .menu-active {\n    @apply text-primary font-medium;\n  }\n  \n  .shadow-glow {\n    box-shadow: 0 0 15px rgba(255, 102, 0, 0.4);\n  }\n  \n  /* Mobile-First Field App Optimizations */\n  .touch-target {\n    @apply min-h-[44px] min-w-[44px];\n  }\n  \n  .field-input {\n    @apply text-base h-12 px-4;\n  }\n  \n  .outdoor-readable {\n    @apply text-lg font-medium;\n  }\n  \n  .mobile-nav-btn {\n    @apply h-14 text-base font-semibold;\n  }\n  \n  /* New Design System Classes */\n  .headline-xl {\n    @apply font-heading text-4xl md:text-5xl lg:text-6xl font-bold uppercase tracking-tight;\n  }\n  \n  .headline-lg {\n    @apply font-heading text-3xl md:text-4xl font-bold uppercase tracking-tight;\n  }\n  \n  .headline-md {\n    @apply font-heading text-2xl md:text-3xl font-semibold uppercase tracking-tight;\n  }\n  \n  .accent-bar {\n    @apply w-16 h-1 bg-primary mb-4;\n  }\n  \n  .accent-bar-lg {\n    @apply w-24 h-1.5 bg-primary mb-6;\n  }\n  \n  .section-dark {\n    @apply bg-[#1A1A1A] text-white;\n  }\n  \n  .section-light {\n    @apply bg-white text-[#1A1A1A];\n  }\n  \n  .btn-primary {\n    @apply bg-primary text-white font-heading font-semibold uppercase tracking-wide px-8 py-4 rounded-none hover:bg-primary/90 transition-colors;\n  }\n  \n  .btn-secondary {\n    @apply bg-transparent border-2 border-white text-white font-heading font-semibold uppercase tracking-wide px-8 py-4 rounded-none hover:bg-white hover:text-[#1A1A1A] transition-colors;\n  }\n  \n  .card-sharp {\n    @apply bg-card border border-border rounded-none;\n  }\n  \n  /* Safe area padding for devices with notches/home indicators */\n  .safe-area-bottom {\n    padding-bottom: env(safe-area-inset-bottom, 0);\n  }\n  \n  .safe-area-top {\n    padding-top: env(safe-area-inset-top, 0);\n  }\n}\n\n:root {\n  /* Light mode theme for WinnStorm™ - Clean white with Safety Orange accents */\n  --background: 0 0% 100%; /* Pure white background */\n  --foreground: 0 0% 10%; /* Charcoal text */\n  --muted: 0 0% 96%; /* Light gray */\n  --muted-foreground: 0 0% 45%; /* Medium gray text */\n  --popover: 0 0% 100%; /* White popover */\n  --popover-foreground: 0 0% 10%; /* Charcoal text */\n  --card: 0 0% 100%; /* White cards */\n  --card-foreground: 0 0% 10%; /* Charcoal text */\n  --border: 0 0% 90%; /* Light gray border */\n  --input: 0 0% 95%;\n  --primary: 16 100% 50%; /* Safety Orange */\n  --primary-foreground: 0 0% 100%; /* White on orange */\n  --secondary: 0 0% 96%; /* Light gray accent */\n  --secondary-foreground: 0 0% 10%;\n  --accent: 16 100% 95%; /* Light orange accent */\n  --accent-foreground: 16 100% 40%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  --ring: 16 100% 50%;\n  --radius: 0px; /* Sharp edges */\n  \n  --chart-1: 16 100% 50%; /* Safety Orange */\n  --chart-2: 16 100% 60%; /* Light orange */\n  --chart-3: 0 0% 40%; /* Gray */\n  --chart-4: 0 0% 60%; /* Light gray */\n  --chart-5: 0 0% 20%; /* Dark gray */\n  \n  --sidebar-background: 0 0% 10%; /* Charcoal sidebar */\n  --sidebar-foreground: 0 0% 100%; /* White text */\n  --sidebar-primary: 16 100% 50%; /* Safety Orange */\n  --sidebar-primary-foreground: 0 0% 100%; /* White */\n  --sidebar-accent: 0 0% 20%; /* Dark gray accent */\n  --sidebar-accent-foreground: 0 0% 100%; /* White */\n  --sidebar-border: 0 0% 20%; /* Dark border */\n  --sidebar-ring: 16 100% 50%; /* Orange ring */\n}\n\n.dark {\n  /* Dark mode theme for WinnStorm™ - Charcoal with Safety Orange accents */\n  --background: 0 0% 10%; /* Charcoal #1A1A1A */\n  --foreground: 0 0% 98%; /* Near white text */\n  --muted: 0 0% 15%; /* Dark gray */\n  --muted-foreground: 0 0% 65%; /* Light gray text */\n  --popover: 0 0% 12%; /* Dark popover */\n  --popover-foreground: 0 0% 98%; /* Near white text */\n  --card: 0 0% 12%; /* Dark cards */\n  --card-foreground: 0 0% 98%; /* Near white text */\n  --border: 0 0% 20%; /* Medium dark border */\n  --input: 0 0% 18%;\n  --primary: 16 100% 50%; /* Safety Orange */\n  --primary-foreground: 0 0% 100%; /* White on orange */\n  --secondary: 0 0% 20%; /* Dark gray accent */\n  --secondary-foreground: 0 0% 98%;\n  --accent: 0 0% 18%; /* Dark accent */\n  --accent-foreground: 0 0% 98%;\n  --destructive: 0 62% 50%;\n  --destructive-foreground: 0 0% 98%;\n  --ring: 16 100% 50%;\n  \n  --chart-1: 16 100% 50%; /* Safety Orange */\n  --chart-2: 16 100% 60%; /* Light orange */\n  --chart-3: 0 0% 50%; /* Gray */\n  --chart-4: 0 0% 70%; /* Light gray */\n  --chart-5: 0 0% 30%; /* Dark gray */\n  \n  --sidebar-background: 0 0% 8%; /* Darker sidebar */\n  --sidebar-foreground: 0 0% 98%; /* Near white text */\n  --sidebar-primary: 16 100% 50%; /* Safety Orange */\n  --sidebar-primary-foreground: 0 0% 100%; /* White */\n  --sidebar-accent: 0 0% 15%; /* Dark gray accent */\n  --sidebar-accent-foreground: 0 0% 98%; /* Near white */\n  --sidebar-border: 0 0% 20%; /* Dark border */\n  --sidebar-ring: 16 100% 50%; /* Orange ring */\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply bg-background text-foreground font-sans antialiased;\n  }\n  \n  .thermal-gradient {\n    background: linear-gradient(90deg, #000033, #0000FF, #00FFFF, #FFFF00, #FF0000);\n  }\n}\n\n@layer components {\n  .menu-active {\n    @apply text-primary border-t-2 border-primary;\n  }\n  \n  .slide-track {\n    -webkit-appearance: none;\n    @apply h-2 rounded-full bg-muted outline-none;\n  }\n  \n  .slide-track::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    @apply w-5 h-5 rounded-full bg-primary cursor-pointer;\n  }\n}\n\n/* Custom animations for landing page */\n@keyframes fadeInScale {\n  0% {\n    opacity: 0;\n    transform: scale(0.6) rotateY(20deg);\n    filter: blur(8px);\n  }\n  50% {\n    opacity: 0.7;\n    transform: scale(1.05) rotateY(0deg);\n    filter: blur(2px);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1) rotateY(0deg);\n    filter: blur(0px);\n  }\n}\n\n@keyframes fadeInUp {\n  0% {\n    opacity: 0;\n    transform: translateY(40px);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes lightningFlash {\n  0%, 90%, 100% {\n    opacity: 0;\n  }\n  5%, 10% {\n    opacity: 1;\n    filter: brightness(1.5);\n  }\n}\n\n.animate-fade-in {\n  animation-fill-mode: both;\n}\n\n.lightning-flash {\n  animation: lightningFlash 3s infinite;\n}\n","path":null,"size_bytes":6576,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/hooks/use-theme.ts":{"content":"import React, { createContext, useContext, useEffect, useState } from 'react';\n\ntype Theme = 'dark' | 'light' | 'system';\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: 'system',\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = 'system',\n  storageKey = 'winnstorm-ui-theme',\n}: ThemeProviderProps): React.ReactElement {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    root.classList.remove('light', 'dark');\n\n    if (theme === 'system') {\n      const systemTheme = window.matchMedia('(prefers-color-scheme: dark)')\n        .matches\n        ? 'dark'\n        : 'light';\n\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return React.createElement(\n    ThemeProviderContext.Provider,\n    { value },\n    children\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error('useTheme must be used within a ThemeProvider');\n\n  return context;\n};","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { ThemeProvider } from \"@/hooks/use-theme\";\n\ncreateRoot(document.getElementById(\"root\")!).render(\n  <QueryClientProvider client={queryClient}>\n    <ThemeProvider defaultTheme=\"dark\" storageKey=\"winnstorm-ui-theme\">\n      <App />\n      <Toaster />\n    </ThemeProvider>\n  </QueryClientProvider>\n);\n","path":null,"size_bytes":558,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/pages/analysis.tsx":{"content":"import { useEffect } from 'react';\nimport { useParams, useLocation } from 'wouter';\nimport { useQuery } from '@tanstack/react-query';\nimport { Header, Footer } from '@/components/navbar';\nimport { ThermalSlider } from '@/components/thermal-slider';\nimport { \n  Card, \n  CardContent \n} from '@/components/ui/card';\nimport { \n  Button \n} from '@/components/ui/button';\nimport {\n  ArrowLeft,\n  FileText,\n  Share,\n  AlertTriangle,\n  Info,\n  Lightbulb\n} from 'lucide-react';\nimport { Property, Scan } from '@shared/schema';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nconst Analysis = () => {\n  const params = useParams();\n  const [, navigate] = useLocation();\n  const scanId = params.id;\n\n  const { data: scan, isLoading: isScanLoading } = useQuery<Scan>({\n    queryKey: [`/api/scans/${scanId}`],\n  });\n\n  const { data: property, isLoading: isPropertyLoading } = useQuery<Property>({\n    queryKey: [`/api/properties/${scan?.propertyId}`],\n    enabled: !!scan?.propertyId,\n  });\n\n  const isLoading = isScanLoading || isPropertyLoading;\n\n  const getScoreColor = (score: number) => {\n    if (score >= 80) return \"border-success bg-success bg-opacity-5\";\n    if (score >= 60) return \"border-warning bg-warning bg-opacity-5\";\n    return \"border-destructive bg-destructive bg-opacity-5\";\n  };\n\n  const getScoreBadgeColor = (score: number) => {\n    if (score >= 80) return \"border-4 border-success text-success\";\n    if (score >= 60) return \"border-4 border-warning text-warning\";\n    return \"border-4 border-destructive text-destructive\";\n  };\n\n  const getScoreStatusText = (score: number) => {\n    if (score >= 80) return \"Good\";\n    if (score >= 60) return \"Warning\";\n    return \"Critical\";\n  };\n\n  const getScoreProgressColor = (score: number) => {\n    if (score >= 80) return \"bg-success\";\n    if (score >= 60) return \"bg-warning\";\n    return \"bg-destructive\";\n  };\n\n  const getIssueIcon = (severity: string) => {\n    switch (severity) {\n      case 'critical':\n        return <AlertTriangle className=\"text-destructive mr-2\" />;\n      case 'warning':\n        return <Info className=\"text-warning mr-2\" />;\n      default:\n        return <Lightbulb className=\"text-neutral-dark mr-2\" />;\n    }\n  };\n\n  const getIssueBorderColor = (severity: string) => {\n    switch (severity) {\n      case 'critical':\n        return \"border-l-4 border-destructive\";\n      case 'warning':\n        return \"border-l-4 border-warning\";\n      default:\n        return \"border-l-4 border-neutral-dark\";\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative\">\n      <Header />\n      \n      <main className=\"flex-grow pb-20\">\n        <div className=\"p-4\">\n          <div className=\"flex items-center mb-4\">\n            <button className=\"mr-2\" onClick={() => navigate('/dashboard')}>\n              <ArrowLeft className=\"text-neutral-dark\" />\n            </button>\n            <div>\n              <h2 className=\"text-xl font-semibold text-neutral-darker\">Thermal Analysis</h2>\n              {isLoading ? (\n                <Skeleton className=\"h-5 w-48\" />\n              ) : (\n                <p className=\"text-neutral-dark text-sm\">\n                  {property?.name} - {property?.address}\n                </p>\n              )}\n            </div>\n          </div>\n\n          {/* Score Card */}\n          <Card className=\"mb-6\">\n            <CardContent className=\"p-4\">\n              {isLoading ? (\n                <>\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <Skeleton className=\"h-6 w-48\" />\n                    <Skeleton className=\"h-12 w-12 rounded-full\" />\n                  </div>\n                  <div className=\"space-y-4\">\n                    {[1, 2, 3].map((i) => (\n                      <div key={i}>\n                        <div className=\"flex justify-between mb-1\">\n                          <Skeleton className=\"h-5 w-36\" />\n                          <Skeleton className=\"h-5 w-12\" />\n                        </div>\n                        <Skeleton className=\"h-2 w-full rounded-full\" />\n                      </div>\n                    ))}\n                  </div>\n                </>\n              ) : (\n                <>\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <h3 className=\"font-semibold text-neutral-darker\">Roof Health Score</h3>\n                    {/* Health Score Indicator */}\n                    <div className=\"flex items-center\">\n                      <div className={`w-12 h-12 rounded-full flex items-center justify-center ${getScoreBadgeColor(scan?.healthScore || 0)}`}>\n                        <span className=\"text-lg font-bold\">{scan?.healthScore}</span>\n                      </div>\n                      <span className={`ml-2 px-2 py-1 ${\n                        scan?.healthScore && scan.healthScore >= 80 \n                          ? \"bg-success bg-opacity-10 text-success\" \n                          : scan?.healthScore && scan.healthScore >= 60\n                            ? \"bg-warning bg-opacity-10 text-warning\"\n                            : \"bg-destructive bg-opacity-10 text-destructive\"\n                      } text-xs font-medium rounded-full`}>\n                        {getScoreStatusText(scan?.healthScore || 0)}\n                      </span>\n                    </div>\n                  </div>\n\n                  {/* Score Breakdown */}\n                  <div className=\"space-y-3\">\n                    {scan?.metrics?.map((metric, index) => (\n                      <div key={index}>\n                        <div className=\"flex justify-between mb-1\">\n                          <span className=\"text-sm font-medium text-neutral-darker\">{metric.name}</span>\n                          <span className={`text-sm font-medium ${\n                            metric.value >= 80 ? \"text-success\" : \n                            metric.value >= 60 ? \"text-warning\" : \n                            \"text-destructive\"\n                          }`}>\n                            {metric.value}%\n                          </span>\n                        </div>\n                        <div className=\"w-full bg-neutral-medium rounded-full h-2\">\n                          <div className={`${getScoreProgressColor(metric.value)} h-2 rounded-full`} style={{ width: `${metric.value}%` }}></div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Thermal Imaging Analysis */}\n          <Card className=\"mb-6\">\n            <CardContent className=\"p-4\">\n              <h3 className=\"font-semibold text-neutral-darker mb-3\">Thermal Analysis</h3>\n              \n              {isLoading ? (\n                <>\n                  <Skeleton className=\"w-full h-64 rounded-lg mb-4\" />\n                  <div className=\"flex justify-between mb-2\">\n                    <Skeleton className=\"h-5 w-24\" />\n                    <Skeleton className=\"h-5 w-24\" />\n                  </div>\n                  <Skeleton className=\"w-full h-8 rounded-lg\" />\n                </>\n              ) : (\n                scan && (\n                  <ThermalSlider \n                    standardImage={scan.standardImageUrl} \n                    thermalImage={scan.thermalImageUrl}\n                    alt={`Thermal scan of ${property?.name}`}\n                  />\n                )\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Detected Issues */}\n          <Card className=\"mb-6\">\n            <CardContent className=\"p-4\">\n              <h3 className=\"font-semibold text-neutral-darker mb-3\">Detected Issues</h3>\n              \n              {isLoading ? (\n                <div className=\"space-y-3\">\n                  {[1, 2, 3].map((i) => (\n                    <Skeleton key={i} className=\"w-full h-24 rounded-lg\" />\n                  ))}\n                </div>\n              ) : scan?.issues?.length ? (\n                <div className=\"space-y-3\">\n                  {scan.issues.map((issue, index) => (\n                    <div \n                      key={index} \n                      className={`${getIssueBorderColor(issue.severity)} p-3 ${\n                        issue.severity === 'critical' \n                          ? 'bg-destructive bg-opacity-5' \n                          : issue.severity === 'warning'\n                            ? 'bg-warning bg-opacity-5'\n                            : 'bg-neutral-light'\n                      } rounded-r-lg`}\n                    >\n                      <div className=\"flex items-start\">\n                        {getIssueIcon(issue.severity)}\n                        <div>\n                          <h4 className=\"font-medium text-neutral-darker\">{issue.title}</h4>\n                          <p className=\"text-sm text-neutral-dark\">{issue.description}</p>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center p-4 text-neutral-dark\">\n                  No issues detected in this scan.\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Actions */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <Button\n              className=\"bg-primary hover:bg-primary-light text-white font-medium py-3 px-4 rounded-lg transition flex items-center justify-center\"\n              onClick={() => navigate(`/report/${scanId}`)}\n            >\n              <FileText className=\"mr-2 h-5 w-5\" />\n              Generate Report\n            </Button>\n            <Button\n              variant=\"outline\"\n              className=\"bg-white border border-neutral-medium hover:bg-neutral-light text-neutral-darker font-medium py-3 px-4 rounded-lg transition flex items-center justify-center\"\n            >\n              <Share className=\"mr-2 h-5 w-5\" />\n              Share Analysis\n            </Button>\n          </div>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n};\n\nexport default Analysis;\n","path":null,"size_bytes":10156,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\nimport { SEO } from \"@/components/seo\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <SEO\n        title=\"Page Not Found\"\n        description=\"The page you're looking for doesn't exist. Return to WinnStorm™ to access damage assessment tools.\"\n        noindex={true}\n      />\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":948,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":1901,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"replit.md":{"content":"# WinnStorm™ - Comprehensive Damage Assessment Platform\n\n## Overview\nWinnStorm™ is a comprehensive online application for Damage Assessment Consultants. It provides tools for efficient inspections, generation of data-rich reports based on the \"Winn Methodology,\" client and project management, and professional certification. The platform aims to encapsulate Eric Winn's expertise, offering features like Winn Report Generation, Consultant Certification, Client & Project Management, Weather Verification, and extensive Data Collection workflows. The business vision is to deliver enterprise-grade tools that enhance accuracy and efficiency in damage assessment.\n\n## User Preferences\n- Professional enterprise-grade interface design suitable for damage assessment consultants\n- WinnStorm™ branding with clean, modern aesthetics\n- Dark theme for reduced eye strain during long inspection sessions\n- Focus on data-rich collection workflows and comprehensive reporting capabilities\n- Intuitive UI optimized for both desktop and mobile field use\n- AI assistant named \"Stormy\" for personalized inspection guidance\n\n## System Architecture\nThe platform utilizes a **React, TypeScript, and Tailwind CSS** frontend, featuring a professional dark theme and WinnStorm branding. The backend is built with **Express.js** and leverages **PostgreSQL** with **Drizzle ORM**. **Firebase** provides authentication with role-based access control. AI integration is powered by **Replit AI Integrations with GPT-5.1** for the \"Stormy\" AI assistant.\n\n**UI/UX Design Decisions:**\n- **Theme**: Lovable-inspired design using Charcoal, Safety Orange, and white.\n- **Typography**: Montserrat for headings and Inter for body text.\n- **Aesthetics**: Sharp edges (0px border radius) and an industrial, high-contrast look.\n- **Mobile-First UX**: Prioritizes large touch targets, readable fonts for outdoor use, bottom navigation, and one-handed operation.\n- **Branding**: Consistent WinnStorm™ branding with a blue gradient shield logo.\n\n**Key Technical Implementations:**\n- **User Management**: Role-based access control.\n- **Certification Portal**: Courses, quizzes, and progress tracking.\n- **Client & Project Management**: CRM functionality.\n- **Data Collection**: Guided workflows for various data types.\n- **Report Generation**: Dynamic PDF assembly with evidence and Winn Methodology integration.\n- **File Management**: Support for various media and document storage.\n- **Mobile-First Transformation**: Uses **Capacitor** for native iOS and Android applications, integrating native device features.\n- **AI Features**: Context-aware Stormy AI for inspection coaching, thermal image analysis, automated metric generation, and executive summary generation.\n- **Offline-First Architecture**: Local persistence (SQLite/IndexedDB) and a bidirectional sync service with conflict resolution.\n- **Evidence Capture**: High-resolution photo capture with GPS, voice memos with transcription, and integration with Limitless Pendant for recordings.\n- **Step Validation System**: Enforces methodology requirements, provides AI feedback, and guidance.\n- **Multi-Property Scheduling**: Calendar management, route optimization, and schedule generation.\n- **AI Quality Services**: AI-powered thermal analysis, evidence quality checking, and inspection completeness tracking.\n- **CRM Integration**: Unified interface for various CRM platforms (JobNimbus, GoHighLevel, Salesforce, HubSpot, Pipedrive) for contact/job sync and report uploads.\n- **Bulk Property Import**: CSV/Excel parsing, column mapping, data validation, and batch creation.\n- **Team Assignment & Workload Management**: Assigning inspectors, tracking capacity, and workload visualization.\n- **Pre-built Damage Templates**: Categorized damage templates with severity ratings, affected components, recommended actions, and required evidence checklists.\n\n## Recent Changes (December 2025)\n- **Innovation Hub**: Unified dashboard at /innovation for managing all enterprise features\n- **Voice Chat System**: Full voice interaction with Stormy AI using OpenAI Whisper (STT) and TTS\n- **Camera Integration**: Live camera preview with \"What am I looking at?\" visual queries\n- **Clients Page**: Dedicated client management page at /clients\n- **Mobile App Deployment**: Comprehensive documentation at docs/MOBILE_APP_DEPLOYMENT.md\n- **iOS Permissions**: Camera, Photo Library, Microphone, Speech Recognition, Location (When In Use)\n- **Android Permissions**: Camera, Storage, Audio Recording, Location\n\n## Innovation Frameworks (Enterprise Features)\n\nWinnStorm includes 7 cutting-edge innovation frameworks accessible via `/innovation`:\n\n### 1. Predictive Claim Outcome Engine\nAI-powered claim success prediction using historical data and insurer patterns.\n- **Tables**: `claim_outcomes`, `claim_predictions`, `insurer_patterns`\n- **API Routes**: `/api/innovation/claims/*`\n- **Features**: GPT-powered predictions, confidence scoring, insurer behavior analysis\n- **Status**: Preview (Enterprise tier)\n\n### 2. Stormy Field Co-Pilot\nReal-time AI guidance during inspections with wearable integration.\n- **Tables**: `field_copilot_sessions`, `copilot_guidance_events`, `wearable_devices`\n- **API Routes**: `/api/innovation/copilot/*`\n- **Features**: Hands-free guidance, Limitless Pendant support, smart glasses integration\n- **Status**: Preview (Professional tier)\n\n### 3. Smart Sensor Network (IoT)\nProperty monitoring sensors for moisture, impact, and environmental tracking.\n- **Tables**: `iot_devices`, `sensor_readings`, `sensor_alerts`\n- **API Routes**: `/api/innovation/iot/*`\n- **Features**: Alert thresholds, automatic claim triggers, real-time monitoring\n- **Status**: Coming Soon (Enterprise tier)\n\n### 4. Drone Integration\nAutonomous drone flights with thermal mapping and 3D modeling.\n- **Tables**: `drone_pilots`, `drone_assets`, `flight_sessions`\n- **API Routes**: `/api/innovation/drones/*`\n- **Features**: Flight planning, thermal map storage, 3D model references, DJI/Skydio SDK stubs\n- **Status**: Preview (Professional tier)\n\n### 5. Insurance Carrier Console\nWhite-label portal for insurance companies to receive structured claims.\n- **Tables**: `carrier_accounts`, `carrier_users`, `carrier_claim_submissions`\n- **API Routes**: `/api/innovation/carriers/*`\n- **Features**: API key management, adjudication workflows, AI-generated summaries\n- **Status**: Preview (Enterprise tier)\n\n### 6. Contractor Marketplace\nMatching verified contractors with property owners for repairs.\n- **Tables**: `contractor_profiles`, `repair_jobs`, `contractor_bids`, `referral_fees`\n- **API Routes**: `/api/innovation/contractors/*`\n- **Features**: Bidding system, job matching, credential verification, referral tracking\n- **Status**: Coming Soon (Professional tier)\n\n### 7. Regional Risk Intelligence\nAnonymized data product for insurers and reinsurers.\n- **Tables**: `risk_regions`, `risk_assessments`, `risk_data_exports`\n- **API Routes**: `/api/innovation/risk/*`\n- **Features**: Geographic risk scoring, trend analysis, data export for carriers\n- **Status**: Coming Soon (Enterprise tier)\n\n### Module Management\n- **Tables**: `innovation_modules`, `organization_modules`\n- **API Routes**: `/api/innovation/modules/*`\n- **Features**: Enable/disable modules per organization, usage tracking\n\n## Mobile App Deployment\nSee `docs/MOBILE_APP_DEPLOYMENT.md` for complete instructions on:\n- Building for iOS App Store (Xcode, TestFlight, App Store Connect)\n- Building for Google Play Store (Android Studio, signing, Play Console)\n- Required screenshots, descriptions, and privacy policy requirements\n- Version management and update procedures\n\n## Key API Endpoints\n\n### Core APIs\n- `/api/user` - User management\n- `/api/properties` - Property CRUD\n- `/api/projects` - Project management\n- `/api/clients` - Client management\n- `/api/stormy/*` - Stormy AI chat and voice\n\n### Innovation APIs\n- `/api/innovation/modules` - Module management\n- `/api/innovation/claims/*` - Predictive claims\n- `/api/innovation/copilot/*` - Field co-pilot\n- `/api/innovation/iot/*` - IoT sensors\n- `/api/innovation/drones/*` - Drone integration\n- `/api/innovation/carriers/*` - Carrier console\n- `/api/innovation/contractors/*` - Marketplace\n- `/api/innovation/risk/*` - Risk intelligence\n\n## External Dependencies\n- **PostgreSQL**: Primary database.\n- **Firebase**: Authentication service (project: winnstorm-43a69).\n- **OpenAI GPT-5**: AI assistant (Stormy) for inspection guidance and analysis.\n- **OpenAI Whisper/TTS**: Voice transcription and speech synthesis.\n- **Capacitor**: Native mobile application development.\n- **Capacitor Plugins**: Camera, Filesystem, Geolocation, Preferences, SQLite.\n- **Stripe**: Subscription payment processing.\n- **Google Maps**: Mapping and location services.\n\n## File Structure\n\n```\n├── client/src/\n│   ├── pages/\n│   │   ├── innovation-hub.tsx    # Innovation features dashboard\n│   │   ├── dashboard.tsx         # Main dashboard\n│   │   ├── clients.tsx           # Client management\n│   │   └── ...\n│   ├── components/\n│   │   ├── stormy-chat.tsx       # AI chat with voice\n│   │   └── ...\n│   └── hooks/\n│       ├── use-voice-chat.ts     # Voice interaction hook\n│       └── ...\n├── server/\n│   ├── routes.ts                 # Main API routes\n│   ├── innovation-routes.ts      # Innovation framework APIs\n│   ├── innovation-services.ts    # Service layer for all frameworks\n│   ├── stormy-ai-service.ts      # Stormy AI backend\n│   ├── voice-service.ts          # Voice processing\n│   └── ...\n├── shared/\n│   └── schema.ts                 # Database schema (all tables)\n├── ios/                          # iOS Capacitor project\n├── android/                      # Android Capacitor project\n└── docs/\n    └── MOBILE_APP_DEPLOYMENT.md  # Mobile deployment guide\n```\n\n## Development Notes\n- Demo login: demo@winnstorm.com / DemoTest123!\n- Production domain: https://winnstorm.com\n- Voice endpoints: /api/stormy/voice/chat, /api/stormy/voice/speak, /api/stormy/voice/transcribe\n- Initialize innovation modules: POST /api/innovation/modules/seed\n","path":null,"size_bytes":10275,"size_tokens":null},"client/src/components/google-maps-drawing.tsx":{"content":"import { useEffect, useRef, useState, useCallback, memo } from 'react';\nimport { Loader } from '@googlemaps/js-api-loader';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  MapPin, \n  Edit3, \n  Trash2, \n  Square, \n  Circle, \n  Type,\n  RotateCcw \n} from 'lucide-react';\n\ninterface RoofSection {\n  id: string;\n  number: number;\n  type: 'polygon' | 'rectangle' | 'circle';\n  coordinates: any[];\n  area?: number;\n  label: string;\n  notes: string;\n}\n\ninterface GoogleMapsDrawingProps {\n  address: string;\n  onAddressChange: (address: string) => void;\n  roofSections: RoofSection[];\n  onSectionsChange: (sections: RoofSection[]) => void;\n}\n\n// Store map instances outside React to prevent DOM conflicts\nlet globalMapInstance: any = null;\nlet globalDrawingManager: any = null;\nlet globalGeocoder: any = null;\nlet globalOverlays: any[] = [];\n\nexport const GoogleMapsDrawing = memo(function GoogleMapsDrawing({\n  address,\n  onAddressChange,\n  roofSections,\n  onSectionsChange\n}: GoogleMapsDrawingProps) {\n  const mapContainerRef = useRef<HTMLDivElement>(null);\n  const initializingRef = useRef(false);\n  const mountedRef = useRef(true);\n  const sectionCounterRef = useRef(1);\n  const roofSectionsRef = useRef<RoofSection[]>(roofSections);\n  const onSectionsChangeRef = useRef(onSectionsChange);\n  const [isLoading, setIsLoading] = useState(true);\n  const [selectedTool, setSelectedTool] = useState<string>('');\n  const [mapReady, setMapReady] = useState(false);\n\n  // Keep refs in sync with props\n  useEffect(() => {\n    sectionCounterRef.current = roofSections.length + 1;\n    roofSectionsRef.current = roofSections;\n  }, [roofSections]);\n  \n  useEffect(() => {\n    onSectionsChangeRef.current = onSectionsChange;\n  }, [onSectionsChange]);\n\n  useEffect(() => {\n    mountedRef.current = true;\n    \n    const initMap = async () => {\n      // Guard against double initialization\n      if (globalMapInstance || initializingRef.current) {\n        if (globalMapInstance) {\n          setIsLoading(false);\n          setMapReady(true);\n        }\n        return;\n      }\n      \n      initializingRef.current = true;\n      \n      const loader = new Loader({\n        apiKey: import.meta.env.VITE_GOOGLE_MAPS_API_KEY || '',\n        version: 'weekly',\n        libraries: ['drawing', 'places', 'geometry']\n      });\n\n      try {\n        await loader.load();\n        \n        if (!mountedRef.current) return;\n        \n        const container = mapContainerRef.current;\n        if (!container) {\n          setIsLoading(false);\n          initializingRef.current = false;\n          return;\n        }\n\n        const mapInstance = new (window as any).google.maps.Map(container, {\n          center: { lat: 39.8283, lng: -98.5795 },\n          zoom: 4,\n          mapTypeId: 'satellite',\n          tilt: 0,\n          mapTypeControl: true,\n          mapTypeControlOptions: {\n            style: (window as any).google.maps.MapTypeControlStyle.HORIZONTAL_BAR,\n            position: (window as any).google.maps.ControlPosition.TOP_CENTER,\n            mapTypeIds: ['roadmap', 'satellite', 'hybrid', 'terrain']\n          }\n        });\n\n        const drawingManagerInstance = new (window as any).google.maps.drawing.DrawingManager({\n          drawingMode: null,\n          drawingControl: false,\n          polygonOptions: {\n            fillColor: '#00BFFF',\n            fillOpacity: 0.3,\n            strokeWeight: 2,\n            strokeColor: '#0080FF',\n            clickable: false,\n            editable: true,\n            zIndex: 1\n          },\n          rectangleOptions: {\n            fillColor: '#32CD32',\n            fillOpacity: 0.3,\n            strokeWeight: 2,\n            strokeColor: '#228B22',\n            clickable: false,\n            editable: true,\n            zIndex: 1\n          },\n          circleOptions: {\n            fillColor: '#FFD700',\n            fillOpacity: 0.3,\n            strokeWeight: 2,\n            strokeColor: '#FFA500',\n            clickable: false,\n            editable: true,\n            zIndex: 1\n          }\n        });\n\n        drawingManagerInstance.setMap(mapInstance);\n\n        // Handle drawing completion\n        (window as any).google.maps.event.addListener(drawingManagerInstance, 'overlaycomplete', (event: any) => {\n          const overlay = event.overlay;\n          const type = event.type;\n          \n          const currentCounter = sectionCounterRef.current;\n          \n          const newSection: RoofSection = {\n            id: `section-${Date.now()}`,\n            number: currentCounter,\n            type: type as 'polygon' | 'rectangle' | 'circle',\n            coordinates: [],\n            label: `Section ${currentCounter}`,\n            notes: ''\n          };\n\n          if (type === 'polygon') {\n            const path = overlay.getPath();\n            const coords: any[] = [];\n            for (let i = 0; i < path.getLength(); i++) {\n              coords.push(path.getAt(i));\n            }\n            newSection.coordinates = coords;\n            newSection.area = (window as any).google.maps.geometry.spherical.computeArea(path);\n          } else if (type === 'rectangle') {\n            const bounds = overlay.getBounds();\n            const ne = bounds.getNorthEast();\n            const sw = bounds.getSouthWest();\n            newSection.coordinates = [\n              sw,\n              new (window as any).google.maps.LatLng(sw.lat(), ne.lng()),\n              ne,\n              new (window as any).google.maps.LatLng(ne.lat(), sw.lng())\n            ];\n            newSection.area = (window as any).google.maps.geometry.spherical.computeArea([\n              sw,\n              new (window as any).google.maps.LatLng(sw.lat(), ne.lng()),\n              ne,\n              new (window as any).google.maps.LatLng(ne.lat(), sw.lng())\n            ]);\n          } else if (type === 'circle') {\n            const center = overlay.getCenter();\n            const radius = overlay.getRadius();\n            newSection.coordinates = [center];\n            newSection.area = Math.PI * radius * radius;\n          }\n\n          const sectionLabel = new (window as any).google.maps.Marker({\n            position: newSection.coordinates[0] || overlay.getCenter(),\n            map: mapInstance,\n            label: {\n              text: newSection.number.toString(),\n              color: '#FFFFFF',\n              fontWeight: 'bold',\n              fontSize: '16px'\n            },\n            icon: {\n              path: (window as any).google.maps.SymbolPath.CIRCLE,\n              fillColor: '#FF0000',\n              fillOpacity: 1,\n              strokeColor: '#FFFFFF',\n              strokeWeight: 2,\n              scale: 15\n            }\n          });\n\n          globalOverlays.push(overlay, sectionLabel);\n          \n          // Use refs to get current values (avoids stale closure)\n          const currentSections = roofSectionsRef.current;\n          onSectionsChangeRef.current([...currentSections, newSection]);\n          \n          drawingManagerInstance.setDrawingMode(null);\n        });\n\n        globalMapInstance = mapInstance;\n        globalDrawingManager = drawingManagerInstance;\n        globalGeocoder = new (window as any).google.maps.Geocoder();\n        \n        if (mountedRef.current) {\n          setIsLoading(false);\n          setMapReady(true);\n        }\n      } catch (error) {\n        console.error('Error loading Google Maps:', error);\n        if (mountedRef.current) {\n          setIsLoading(false);\n        }\n        initializingRef.current = false;\n      }\n    };\n\n    initMap();\n    \n    return () => {\n      mountedRef.current = false;\n    };\n  }, [onSectionsChange]);\n\n  const handleAddressSearch = useCallback(() => {\n    if (!globalGeocoder || !globalMapInstance || !address) return;\n\n    globalGeocoder.geocode({ address }, (results: any, status: any) => {\n      if (status === 'OK' && results && results[0]) {\n        const location = results[0].geometry.location;\n        globalMapInstance.setCenter(location);\n        globalMapInstance.setZoom(20);\n        \n        new (window as any).google.maps.Marker({\n          position: location,\n          map: globalMapInstance,\n          title: address,\n          icon: {\n            path: (window as any).google.maps.SymbolPath.FORWARD_CLOSED_ARROW,\n            fillColor: '#FF0000',\n            fillOpacity: 1,\n            strokeColor: '#FFFFFF',\n            strokeWeight: 2,\n            scale: 8,\n            rotation: 180\n          }\n        });\n      }\n    });\n  }, [address]);\n\n  const setDrawingMode = useCallback((mode: any) => {\n    if (!globalDrawingManager) return;\n    globalDrawingManager.setDrawingMode(mode);\n    setSelectedTool(mode || '');\n  }, []);\n\n  const clearAllDrawings = useCallback(() => {\n    globalOverlays.forEach(overlay => {\n      if (overlay && typeof overlay.setMap === 'function') {\n        overlay.setMap(null);\n      }\n    });\n    globalOverlays = [];\n    onSectionsChange([]);\n  }, [onSectionsChange]);\n\n  const deleteSection = useCallback((sectionId: string) => {\n    const updatedSections = roofSections.filter(section => section.id !== sectionId);\n    onSectionsChange(updatedSections);\n  }, [roofSections, onSectionsChange]);\n\n  const formatArea = (area: number): string => {\n    if (area < 1000) {\n      return `${area.toFixed(1)} sq ft`;\n    } else {\n      return `${(area / 10.764).toFixed(1)} sq m`;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <MapPin className=\"h-5 w-5 text-primary\" />\n            Property Location\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex gap-2\">\n            <div className=\"flex-1\">\n              <Label htmlFor=\"address\">Property Address</Label>\n              <Input\n                id=\"address\"\n                value={address}\n                onChange={(e) => onAddressChange(e.target.value)}\n                placeholder=\"Enter property address...\"\n                className=\"mt-1\"\n              />\n            </div>\n            <Button onClick={handleAddressSearch} className=\"mt-6\">Search</Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Edit3 className=\"h-5 w-5 text-primary\" />\n            Roof Section Drawing Tools\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-wrap gap-2 mb-4\">\n            <Button\n              variant={selectedTool === 'polygon' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setDrawingMode((window as any).google?.maps?.drawing?.OverlayType?.POLYGON)}\n              disabled={!mapReady}\n            >\n              <Edit3 className=\"h-4 w-4 mr-1\" />\n              Polygon\n            </Button>\n            <Button\n              variant={selectedTool === 'rectangle' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setDrawingMode((window as any).google?.maps?.drawing?.OverlayType?.RECTANGLE)}\n              disabled={!mapReady}\n            >\n              <Square className=\"h-4 w-4 mr-1\" />\n              Rectangle\n            </Button>\n            <Button\n              variant={selectedTool === 'circle' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setDrawingMode((window as any).google?.maps?.drawing?.OverlayType?.CIRCLE)}\n              disabled={!mapReady}\n            >\n              <Circle className=\"h-4 w-4 mr-1\" />\n              Circle\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setDrawingMode(null)}\n              disabled={!mapReady}\n            >\n              <Type className=\"h-4 w-4 mr-1\" />\n              Select\n            </Button>\n            <Button\n              variant=\"destructive\"\n              size=\"sm\"\n              onClick={clearAllDrawings}\n              disabled={!mapReady}\n            >\n              <RotateCcw className=\"h-4 w-4 mr-1\" />\n              Clear All\n            </Button>\n          </div>\n          \n          <div \n            ref={mapContainerRef}\n            className=\"w-full h-96 rounded-lg border border-border relative\"\n            style={{ minHeight: '400px' }}\n          >\n            {isLoading && (\n              <div className=\"absolute inset-0 bg-background/80 flex items-center justify-center z-10\">\n                <div className=\"text-center\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n                  <p className=\"text-muted-foreground\">Loading Google Maps...</p>\n                </div>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {roofSections.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Type className=\"h-5 w-5 text-primary\" />\n              Drawn Roof Sections ({roofSections.length})\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {roofSections.map((section) => (\n                <div key={section.id} className=\"flex items-center justify-between p-3 border border-border rounded-lg\">\n                  <div className=\"flex items-center gap-3\">\n                    <Badge variant=\"secondary\" className=\"min-w-[60px]\">\n                      #{section.number}\n                    </Badge>\n                    <div>\n                      <p className=\"font-medium\">{section.label}</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {section.type.charAt(0).toUpperCase() + section.type.slice(1)}\n                        {section.area && ` • ${formatArea(section.area)}`}\n                      </p>\n                    </div>\n                  </div>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => deleteSection(section.id)}\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n});\n","path":null,"size_bytes":14593,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\nimport { auth } from \"./firebase\";\n\nasync function getAuthHeaders(): Promise<HeadersInit> {\n  const currentUser = auth.currentUser;\n  if (currentUser) {\n    try {\n      const idToken = await currentUser.getIdToken();\n      return {\n        'Authorization': `Bearer ${idToken}`,\n      };\n    } catch (error) {\n      console.warn('Failed to get auth token:', error);\n    }\n  }\n  return {};\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(url: string, options?: RequestInit): Promise<any> {\n  const authHeaders = await getAuthHeaders();\n  \n  const res = await fetch(url, {\n    credentials: \"include\",\n    ...options,\n    headers: {\n      ...authHeaders,\n      ...options?.headers,\n    },\n  });\n\n  await throwIfResNotOk(res);\n  return await res.json();\n}\n\nexport async function apiRequestRaw(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const authHeaders = await getAuthHeaders();\n  \n  const res = await fetch(url, {\n    method,\n    headers: {\n      ...authHeaders,\n      ...(data ? { \"Content-Type\": \"application/json\" } : {}),\n    },\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const authHeaders = await getAuthHeaders();\n    \n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n      headers: authHeaders,\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":2290,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ai-inspection-assistant.tsx":{"content":"import React, { useState, useRef, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Badge } from '@/components/ui/badge';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Separator } from '@/components/ui/separator';\nimport { Bot, User, Send, Image, MapPin, Thermometer, Camera, FileText, AlertTriangle, GraduationCap } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { StormyAvatar } from './stormy-avatar';\nimport { getStormySystemPrompt, getQuickActionsForStep, getStepWelcomeMessage, UserExperienceLevel } from '@/lib/stormy-guidance';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\n\ninterface AIMessage {\n  id: string;\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: Date;\n  context?: string;\n  attachments?: string[];\n}\n\ninterface AIInspectionAssistantProps {\n  currentStep?: string;\n  propertyData?: any;\n  thermalData?: any;\n  roofSections?: any[];\n  weatherData?: any[];\n  issues?: any[];\n  components?: any[];\n  onGuidanceReceived?: (guidance: string) => void;\n}\n\nexport function AIInspectionAssistant({\n  currentStep,\n  propertyData,\n  thermalData,\n  roofSections,\n  weatherData,\n  issues,\n  components,\n  onGuidanceReceived\n}: AIInspectionAssistantProps) {\n  const [userLevel, setUserLevel] = useState<UserExperienceLevel>('beginner');\n  const [messages, setMessages] = useState<AIMessage[]>([\n    {\n      id: '1',\n      role: 'assistant',\n      content: \"Hello! I'm Stormy, your WinnStorm™ AI Inspection Coach, trained on Eric Winn's proven methodology. I'll adapt my guidance to your experience level and the current workflow step. How can I help make this inspection successful?\",\n      timestamp: new Date(),\n      context: 'welcome'\n    }\n  ]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [previousStep, setPreviousStep] = useState<string | undefined>();\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  // Send welcome message when step changes\n  useEffect(() => {\n    if (currentStep && currentStep !== previousStep) {\n      setPreviousStep(currentStep);\n      \n      // Add step welcome message for beginners and intermediates\n      if (userLevel !== 'expert') {\n        const welcomeMsg = getStepWelcomeMessage(currentStep, userLevel);\n        if (welcomeMsg) {\n          const stepMessage: AIMessage = {\n            id: `step-${Date.now()}`,\n            role: 'assistant',\n            content: welcomeMsg,\n            timestamp: new Date(),\n            context: currentStep\n          };\n          setMessages(prev => [...prev, stepMessage]);\n        }\n      }\n    }\n  }, [currentStep, userLevel, previousStep]);\n\n  const getContextualPrompt = () => {\n    return getStormySystemPrompt({\n      currentStep: currentStep || 'building-info',\n      userLevel,\n      propertyData,\n      thermalData,\n      roofSections,\n      weatherData,\n      issues,\n      components\n    });\n  };\n\n  const sendMessage = async () => {\n    if (!inputMessage.trim()) return;\n\n    const userMessage: AIMessage = {\n      id: Date.now().toString(),\n      role: 'user',\n      content: inputMessage.trim(),\n      timestamp: new Date()\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setInputMessage('');\n    setIsLoading(true);\n\n    try {\n      const response = await fetch('/api/ai-assistant', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          message: inputMessage.trim(),\n          context: getContextualPrompt(),\n          conversationHistory: messages.slice(-5) // Last 5 messages for context\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to get AI response');\n      }\n\n      const data = await response.json();\n\n      const assistantMessage: AIMessage = {\n        id: (Date.now() + 1).toString(),\n        role: 'assistant',\n        content: data.response,\n        timestamp: new Date(),\n        context: currentStep\n      };\n\n      setMessages(prev => [...prev, assistantMessage]);\n      \n      if (onGuidanceReceived) {\n        onGuidanceReceived(data.response);\n      }\n\n    } catch (error) {\n      console.error('AI Assistant error:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to get AI response. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    }\n  };\n\n  const getQuickActions = () => {\n    const stepActions = getQuickActionsForStep(currentStep || 'building-info', userLevel);\n    return stepActions.map(action => ({\n      ...action,\n      icon: Camera // Default icon, can be made more specific later\n    }));\n  };\n\n  const sendQuickAction = (message: string) => {\n    setInputMessage(message);\n    setTimeout(() => sendMessage(), 100);\n  };\n\n  return (\n    <Card className=\"h-full flex flex-col\">\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"flex items-center gap-2 flex-wrap\">\n          <div className=\"flex items-center gap-2\">\n            <StormyAvatar size={20} />\n            Stormy - AI Coach\n          </div>\n          <div className=\"flex items-center gap-2 ml-auto\">\n            <GraduationCap className=\"h-4 w-4 text-muted-foreground\" />\n            <Select value={userLevel} onValueChange={(value) => setUserLevel(value as UserExperienceLevel)}>\n              <SelectTrigger className=\"h-7 w-[120px] text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"beginner\">Beginner</SelectItem>\n                <SelectItem value=\"intermediate\">Intermediate</SelectItem>\n                <SelectItem value=\"expert\">Expert</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </CardTitle>\n        {currentStep && (\n          <Badge variant=\"outline\" className=\"text-primary border-primary mt-2 w-fit\">\n            {currentStep.replace('-', ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\n          </Badge>\n        )}\n      </CardHeader>\n\n      <CardContent className=\"flex-1 flex flex-col gap-4 p-4\">\n        {/* Messages */}\n        <ScrollArea className=\"flex-1 h-96 pr-4\">\n          <div className=\"space-y-4\">\n            {messages.map((message) => (\n              <div\n                key={message.id}\n                className={`flex gap-3 ${\n                  message.role === 'user' ? 'justify-end' : 'justify-start'\n                }`}\n              >\n                <div\n                  className={`flex gap-3 max-w-[80%] ${\n                    message.role === 'user' ? 'flex-row-reverse' : 'flex-row'\n                  }`}\n                >\n                  <div className=\"flex-shrink-0\">\n                    {message.role === 'user' ? (\n                      <div className=\"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center\">\n                        <User className=\"h-4 w-4 text-white\" />\n                      </div>\n                    ) : (\n                      <StormyAvatar size={32} />\n                    )}\n                  </div>\n                  <div\n                    className={`rounded-lg p-3 ${\n                      message.role === 'user'\n                        ? 'bg-blue-500 text-white'\n                        : 'bg-gray-100 dark:bg-gray-800'\n                    }`}\n                  >\n                    <div className=\"whitespace-pre-wrap text-sm\">\n                      {message.content}\n                    </div>\n                    <div className=\"text-xs opacity-70 mt-2\">\n                      {message.timestamp.toLocaleTimeString()}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ))}\n            {isLoading && (\n              <div className=\"flex gap-3 justify-start\">\n                <StormyAvatar size={32} />\n                <div className=\"bg-gray-100 dark:bg-gray-800 rounded-lg p-3\">\n                  <div className=\"flex gap-1\">\n                    <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></div>\n                    <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                    <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                  </div>\n                </div>\n              </div>\n            )}\n            <div ref={messagesEndRef} />\n          </div>\n        </ScrollArea>\n\n        {/* Quick Actions */}\n        <div className=\"space-y-2\">\n          <Separator />\n          <div className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\n            Quick Actions\n          </div>\n          <div className=\"flex flex-wrap gap-2\">\n            {getQuickActions().slice(0, 3).map((action) => (\n              <Button\n                key={action.label}\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => sendQuickAction(action.message)}\n                className=\"text-xs\"\n                disabled={isLoading}\n              >\n                <action.icon className=\"h-3 w-3 mr-1\" />\n                {action.label}\n              </Button>\n            ))}\n          </div>\n        </div>\n\n        {/* Message Input */}\n        <div className=\"flex gap-2\">\n          <Textarea\n            value={inputMessage}\n            onChange={(e) => setInputMessage(e.target.value)}\n            onKeyPress={handleKeyPress}\n            placeholder=\"Ask about inspection procedures, damage assessment, or methodology...\"\n            className=\"flex-1 min-h-[80px] resize-none\"\n            disabled={isLoading}\n          />\n          <Button\n            onClick={sendMessage}\n            disabled={isLoading || !inputMessage.trim()}\n            size=\"sm\"\n            className=\"self-end\"\n          >\n            <Send className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","path":null,"size_bytes":10600,"size_tokens":null},"client/src/hooks/use-auth.ts":{"content":"import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { User } from 'firebase/auth';\nimport { \n  loginWithEmail, \n  registerWithEmail, \n  logoutUser, \n  loginWithGoogle as googleLogin, \n  onAuthChange \n} from '@/lib/firebase';\n\nexport type UserRole = 'junior_consultant' | 'senior_consultant' | 'admin' | 'client' | null;\n\ninterface AuthContextType {\n  user: User | null;\n  role: UserRole;\n  loading: boolean;\n  login: (email: string, password: string) => Promise<User>;\n  loginWithGoogle: () => Promise<User>;\n  register: (email: string, password: string) => Promise<User>;\n  logout: () => Promise<void>;\n  setUserRole: (role: UserRole) => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const useAuth = () => useContext(AuthContext) as AuthContextType;\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\nexport const AuthProvider = ({ children }: AuthProviderProps) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [role, setRole] = useState<UserRole>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const unsubscribe = onAuthChange((authUser) => {\n      setUser(authUser);\n      setLoading(false);\n      \n      // Check for saved role in localStorage\n      if (authUser) {\n        const savedRole = localStorage.getItem(`role_${authUser.uid}`);\n        if (savedRole) {\n          setRole(savedRole as UserRole);\n        }\n      } else {\n        setRole(null);\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, []);\n\n  const login = async (email: string, password: string): Promise<User> => {\n    try {\n      setLoading(true);\n      const loggedInUser = await loginWithEmail(email, password);\n      setUser(loggedInUser);\n      return loggedInUser;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const register = async (email: string, password: string): Promise<User> => {\n    try {\n      setLoading(true);\n      const registeredUser = await registerWithEmail(email, password);\n      setUser(registeredUser);\n      return registeredUser;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loginWithGoogle = async (): Promise<User> => {\n    try {\n      setLoading(true);\n      const loggedInUser = await googleLogin();\n      setUser(loggedInUser);\n      return loggedInUser;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const logout = async (): Promise<void> => {\n    try {\n      setLoading(true);\n      await logoutUser();\n      setUser(null);\n      setRole(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const setUserRole = async (newRole: UserRole) => {\n    setRole(newRole);\n    if (user) {\n      // Save role to localStorage for quick access\n      localStorage.setItem(`role_${user.uid}`, newRole as string);\n      \n      // Persist to database\n      try {\n        const idToken = await user.getIdToken();\n        await fetch('/api/user/role', {\n          method: 'PATCH',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${idToken}`\n          },\n          body: JSON.stringify({ role: newRole })\n        });\n      } catch (error) {\n        console.error('Failed to persist role to database:', error);\n      }\n    }\n  };\n\n  const value = {\n    user,\n    role,\n    loading,\n    login,\n    loginWithGoogle,\n    register,\n    logout,\n    setUserRole,\n  };\n\n  // Use createElement instead of JSX to avoid build issues\n  return React.createElement(AuthContext.Provider, { value }, children);\n};","path":null,"size_bytes":3567,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"server/storage.ts":{"content":"import { \n  User, InsertUser, Property, InsertProperty, Scan, InsertScan, Report, InsertReport, \n  CrmConfig, InsertCrmConfig, CrmSyncLog, InsertCrmSyncLog, KnowledgeBase, InsertKnowledgeBase,\n  InspectionSession, InsertInspectionSession, EvidenceAsset, InsertEvidenceAsset,\n  LimitlessTranscript, InsertLimitlessTranscript, InspectorProgress, InsertInspectorProgress,\n  Project, InsertProject, ScheduledInspection, InsertScheduledInspection,\n  TeamAssignment, InsertTeamAssignment, DamageTemplate, InsertDamageTemplate,\n  AIConversation, InsertAIConversation, AIMessage, InsertAIMessage, AIMemory, InsertAIMemory,\n  WinnMethodologyStep, WINN_METHODOLOGY_STEPS,\n  users, properties, scans, reports, crmConfigs, crmSyncLogs, knowledgeBase,\n  inspectionSessions, evidenceAssets, limitlessTranscripts, inspectorProgress, projects, clients,\n  scheduledInspections, teamAssignments, damageTemplates, aiConversations, aiMessages, aiMemory\n} from \"@shared/schema\";\nimport { db } from './db';\nimport { eq, or, inArray } from 'drizzle-orm';\n\n// Interface for storage\nexport interface IStorage {\n  // User methods\n  getUser(id: number): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: number, updates: Partial<User>): Promise<User | undefined>;\n  \n  // Project methods\n  getProject(id: number): Promise<Project | undefined>;\n  getProjectsByConsultant(consultantId: number): Promise<Project[]>;\n  createProject(project: InsertProject): Promise<Project>;\n  updateProject(id: number, updates: Partial<Project>): Promise<Project | undefined>;\n  \n  // Property methods\n  getProperty(id: number): Promise<Property | undefined>;\n  getPropertiesByUser(userId: number): Promise<Property[]>;\n  createProperty(property: InsertProperty): Promise<Property>;\n  updateProperty(id: number, property: Partial<Property>): Promise<Property | undefined>;\n  \n  // Scan methods\n  getScan(id: number): Promise<Scan | undefined>;\n  getScansByProperty(propertyId: number): Promise<Scan[]>;\n  createScan(scan: InsertScan): Promise<Scan>;\n  \n  // Report methods\n  getReport(id: number): Promise<Report | undefined>;\n  getReportsByScan(scanId: number): Promise<Report[]>;\n  createReport(report: InsertReport): Promise<Report>;\n  \n  // CRM methods\n  getCrmConfig(id: number): Promise<CrmConfig | undefined>;\n  getCrmConfigsByUser(userId: number): Promise<CrmConfig[]>;\n  createCrmConfig(config: InsertCrmConfig & { userId: number }): Promise<CrmConfig>;\n  updateCrmConfig(id: number, config: Partial<CrmConfig>): Promise<CrmConfig | undefined>;\n  deleteCrmConfig(id: number): Promise<boolean>;\n  \n  // CRM sync log methods\n  getCrmSyncLog(id: number): Promise<CrmSyncLog | undefined>;\n  getCrmSyncLogsByConfig(crmConfigId: number): Promise<CrmSyncLog[]>;\n  createCrmSyncLog(log: InsertCrmSyncLog): Promise<CrmSyncLog>;\n  \n  // Knowledge Base methods\n  getKnowledgeEntry(id: number): Promise<KnowledgeBase | undefined>;\n  getAllKnowledgeEntries(): Promise<KnowledgeBase[]>;\n  searchKnowledge(query: string, workflowStep?: string): Promise<KnowledgeBase[]>;\n  createKnowledgeEntry(entry: InsertKnowledgeBase): Promise<KnowledgeBase>;\n  updateKnowledgeEntry(id: number, entry: Partial<KnowledgeBase>): Promise<KnowledgeBase | undefined>;\n  deleteKnowledgeEntry(id: number): Promise<boolean>;\n  \n  // Inspection Session methods (Winn Methodology State Machine)\n  getInspectionSession(id: number): Promise<InspectionSession | undefined>;\n  getInspectionSessionsByProperty(propertyId: number): Promise<InspectionSession[]>;\n  getInspectionSessionsByInspector(inspectorId: number): Promise<InspectionSession[]>;\n  getActiveInspectionSession(propertyId: number, inspectorId: number): Promise<InspectionSession | undefined>;\n  createInspectionSession(session: InsertInspectionSession): Promise<InspectionSession>;\n  updateInspectionSession(id: number, updates: Partial<InspectionSession>): Promise<InspectionSession | undefined>;\n  advanceInspectionStep(id: number, nextStep: WinnMethodologyStep): Promise<InspectionSession | undefined>;\n  completeInspectionSession(id: number): Promise<InspectionSession | undefined>;\n  \n  // Evidence Asset methods\n  getEvidenceAsset(id: number): Promise<EvidenceAsset | undefined>;\n  getEvidenceAssetsBySession(sessionId: number): Promise<EvidenceAsset[]>;\n  getEvidenceAssetsByStep(sessionId: number, step: WinnMethodologyStep): Promise<EvidenceAsset[]>;\n  createEvidenceAsset(asset: InsertEvidenceAsset): Promise<EvidenceAsset>;\n  updateEvidenceAsset(id: number, updates: Partial<EvidenceAsset>): Promise<EvidenceAsset | undefined>;\n  deleteEvidenceAsset(id: number): Promise<boolean>;\n  \n  // Limitless Transcript methods\n  getLimitlessTranscript(id: number): Promise<LimitlessTranscript | undefined>;\n  getAllLimitlessTranscripts(): Promise<LimitlessTranscript[]>;\n  createLimitlessTranscript(transcript: InsertLimitlessTranscript): Promise<LimitlessTranscript>;\n  updateLimitlessTranscript(id: number, updates: Partial<LimitlessTranscript>): Promise<LimitlessTranscript | undefined>;\n  \n  // Inspector Progress methods (Compliance tracking)\n  getInspectorProgress(userId: number): Promise<InspectorProgress | undefined>;\n  createInspectorProgress(progress: InsertInspectorProgress): Promise<InspectorProgress>;\n  updateInspectorProgress(userId: number, updates: Partial<InspectorProgress>): Promise<InspectorProgress | undefined>;\n  \n  // Scheduled Inspection methods\n  getScheduledInspection(id: number): Promise<ScheduledInspection | undefined>;\n  getScheduledInspectionsByInspector(inspectorId: number, startDate?: Date, endDate?: Date): Promise<ScheduledInspection[]>;\n  getScheduledInspectionsByDate(date: Date, inspectorId?: number): Promise<ScheduledInspection[]>;\n  createScheduledInspection(inspection: InsertScheduledInspection): Promise<ScheduledInspection>;\n  updateScheduledInspection(id: number, updates: Partial<ScheduledInspection>): Promise<ScheduledInspection | undefined>;\n  cancelScheduledInspection(id: number, reason: string): Promise<ScheduledInspection | undefined>;\n  \n  // Team Assignment methods\n  getTeamAssignment(inspectorId: number): Promise<TeamAssignment | undefined>;\n  getAllTeamAssignments(): Promise<TeamAssignment[]>;\n  createTeamAssignment(assignment: InsertTeamAssignment): Promise<TeamAssignment>;\n  updateTeamAssignment(id: number, updates: Partial<TeamAssignment>): Promise<TeamAssignment | undefined>;\n  deleteTeamAssignment(id: number): Promise<boolean>;\n  \n  // Damage Template methods\n  getDamageTemplate(id: number): Promise<DamageTemplate | undefined>;\n  getAllDamageTemplates(): Promise<DamageTemplate[]>;\n  getDamageTemplatesByCategory(category: string): Promise<DamageTemplate[]>;\n  createDamageTemplate(template: InsertDamageTemplate): Promise<DamageTemplate>;\n  updateDamageTemplate(id: number, updates: Partial<DamageTemplate>): Promise<DamageTemplate | undefined>;\n  deleteDamageTemplate(id: number): Promise<boolean>;\n  \n  // AI Conversation methods (Stormy)\n  getAIConversation(id: number): Promise<AIConversation | undefined>;\n  getAIConversationsByUser(userId: string): Promise<AIConversation[]>;\n  createAIConversation(conversation: InsertAIConversation): Promise<AIConversation>;\n  updateAIConversation(id: number, updates: Partial<AIConversation>): Promise<AIConversation | undefined>;\n  \n  // AI Message methods\n  getAIMessage(id: number): Promise<AIMessage | undefined>;\n  getAIMessagesByConversation(conversationId: number): Promise<AIMessage[]>;\n  createAIMessage(message: InsertAIMessage): Promise<AIMessage>;\n  \n  // AI Memory methods\n  getAIMemory(id: number): Promise<AIMemory | undefined>;\n  getAIMemoryByUser(userId: string): Promise<AIMemory[]>;\n  createAIMemory(memory: InsertAIMemory): Promise<AIMemory>;\n  updateAIMemory(id: number, updates: Partial<AIMemory>): Promise<AIMemory>;\n}\n\n// Database storage implementation using Drizzle ORM\nexport class DatabaseStorage implements IStorage {\n  // User methods\n  async getUser(id: number): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.id, id));\n      return user as User || undefined;\n    } catch (error) {\n      console.error('Error fetching user:', error);\n      return undefined;\n    }\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.email, email));\n      return user as User || undefined;\n    } catch (error) {\n      console.error('Error fetching user by email:', error);\n      return undefined;\n    }\n  }\n\n  async createUser(user: InsertUser): Promise<User> {\n    const [newUser] = await db.insert(users).values(user).returning();\n    return newUser as User;\n  }\n\n  async updateUser(id: number, updates: Partial<User>): Promise<User | undefined> {\n    try {\n      const [updatedUser] = await db.update(users).set(updates).where(eq(users.id, id)).returning();\n      return updatedUser as User || undefined;\n    } catch (error) {\n      console.error('Error updating user:', error);\n      return undefined;\n    }\n  }\n\n  // Project methods\n  async getProject(id: number): Promise<Project | undefined> {\n    try {\n      const [project] = await db.select().from(projects).where(eq(projects.id, id));\n      return project as Project || undefined;\n    } catch (error) {\n      console.error('Error fetching project:', error);\n      return undefined;\n    }\n  }\n\n  async getProjectsByConsultant(consultantId: number): Promise<Project[]> {\n    try {\n      // Get projects assigned directly to consultant OR projects whose clients belong to consultant\n      const consultantClients = await db.select({ id: clients.id }).from(clients).where(eq(clients.userId, consultantId));\n      const clientIds = consultantClients.map(c => c.id);\n      \n      let result: Project[] = [];\n      \n      if (clientIds.length > 0) {\n        // Get projects for consultant's clients\n        const clientProjects = await db.select().from(projects).where(inArray(projects.clientId, clientIds));\n        result = clientProjects as Project[];\n      }\n      \n      // Also get directly assigned projects (if assignedConsultantId is set)\n      const assignedProjects = await db.select().from(projects).where(eq(projects.assignedConsultantId, consultantId));\n      \n      // Merge and dedupe\n      const existingIds = new Set(result.map(p => p.id));\n      for (const project of assignedProjects) {\n        if (!existingIds.has(project.id)) {\n          result.push(project as Project);\n        }\n      }\n      \n      return result;\n    } catch (error) {\n      console.error('Error fetching projects by consultant:', error);\n      return [];\n    }\n  }\n\n  async createProject(project: InsertProject): Promise<Project> {\n    const [newProject] = await db.insert(projects).values(project).returning();\n    return newProject as Project;\n  }\n\n  async updateProject(id: number, updates: Partial<Project>): Promise<Project | undefined> {\n    try {\n      const [updatedProject] = await db.update(projects).set(updates).where(eq(projects.id, id)).returning();\n      return updatedProject as Project || undefined;\n    } catch (error) {\n      console.error('Error updating project:', error);\n      return undefined;\n    }\n  }\n\n  // Property methods\n  async getProperty(id: number): Promise<Property | undefined> {\n    try {\n      const [property] = await db.select().from(properties).where(eq(properties.id, id));\n      if (!property) return undefined;\n\n      // Get scans for this property\n      const propertyScans = await db.select().from(scans).where(eq(scans.propertyId, id));\n      \n      // Get reports for property scans\n      const scanIds = propertyScans.map(s => s.id);\n      const propertyReports = scanIds.length > 0 \n        ? await db.select().from(reports).where(eq(reports.scanId, scanIds[0])) // Simplified for now\n        : [];\n\n      // Return extended property object\n      return {\n        ...property,\n        scans: propertyScans,\n        reports: propertyReports,\n        healthScore: propertyScans.length > 0 ? propertyScans[0].healthScore || 50 : 50,\n        lastScanDate: propertyScans.length > 0 ? propertyScans[0].date : null\n      } as any;\n    } catch (error) {\n      console.error('Error fetching property:', error);\n      return undefined;\n    }\n  }\n\n  async getPropertiesByUser(userId: number): Promise<Property[]> {\n    try {\n      const userProperties = await db.select().from(properties).where(eq(properties.userId, userId));\n      \n      // Extend each property with scans and reports\n      const extendedProperties = await Promise.all(\n        userProperties.map(async (property) => {\n          const propertyScans = await db.select().from(scans).where(eq(scans.propertyId, property.id));\n          const scanIds = propertyScans.map(s => s.id);\n          const propertyReports = scanIds.length > 0 \n            ? await db.select().from(reports).where(eq(reports.scanId, scanIds[0]))\n            : [];\n\n          return {\n            ...property,\n            scans: propertyScans,\n            reports: propertyReports,\n            healthScore: propertyScans.length > 0 ? propertyScans[0].healthScore || 50 : 50,\n            lastScanDate: propertyScans.length > 0 ? propertyScans[0].date : null\n          } as any;\n        })\n      );\n\n      return extendedProperties;\n    } catch (error) {\n      console.error('Error fetching properties by user:', error);\n      return [];\n    }\n  }\n\n  async createProperty(property: InsertProperty): Promise<Property> {\n    const [newProperty] = await db.insert(properties).values([property]).returning();\n    return {\n      ...newProperty,\n      scans: [],\n      reports: [],\n      healthScore: 50,\n      lastScanDate: null\n    } as any;\n  }\n\n  async updateProperty(id: number, updates: Partial<Property>): Promise<Property | undefined> {\n    try {\n      const [updatedProperty] = await db\n        .update(properties)\n        .set(updates)\n        .where(eq(properties.id, id))\n        .returning();\n      return updatedProperty as Property || undefined;\n    } catch (error) {\n      console.error('Error updating property:', error);\n      return undefined;\n    }\n  }\n\n  // Scan methods\n  async getScan(id: number): Promise<Scan | undefined> {\n    try {\n      const [scan] = await db.select().from(scans).where(eq(scans.id, id));\n      return scan as Scan || undefined;\n    } catch (error) {\n      console.error('Error fetching scan:', error);\n      return undefined;\n    }\n  }\n\n  async getScansByProperty(propertyId: number): Promise<Scan[]> {\n    try {\n      const results = await db.select().from(scans).where(eq(scans.propertyId, propertyId));\n      return results as Scan[];\n    } catch (error) {\n      console.error('Error fetching scans by property:', error);\n      return [];\n    }\n  }\n\n  async createScan(scan: InsertScan): Promise<Scan> {\n    const [newScan] = await db.insert(scans).values([scan]).returning();\n    return newScan as Scan;\n  }\n\n  // Report methods\n  async getReport(id: number): Promise<Report | undefined> {\n    try {\n      const [report] = await db.select().from(reports).where(eq(reports.id, id));\n      return report || undefined;\n    } catch (error) {\n      console.error('Error fetching report:', error);\n      return undefined;\n    }\n  }\n\n  async getReportsByScan(scanId: number): Promise<Report[]> {\n    try {\n      return await db.select().from(reports).where(eq(reports.scanId, scanId));\n    } catch (error) {\n      console.error('Error fetching reports by scan:', error);\n      return [];\n    }\n  }\n\n  async createReport(report: InsertReport): Promise<Report> {\n    const [newReport] = await db.insert(reports).values(report).returning();\n    return newReport;\n  }\n\n  // CRM Configuration methods\n  async getCrmConfig(id: number): Promise<CrmConfig | undefined> {\n    try {\n      const [config] = await db.select().from(crmConfigs).where(eq(crmConfigs.id, id));\n      return config || undefined;\n    } catch (error) {\n      console.error('Error fetching CRM config:', error);\n      return undefined;\n    }\n  }\n\n  async getCrmConfigsByUser(userId: number): Promise<CrmConfig[]> {\n    try {\n      return await db.select().from(crmConfigs).where(eq(crmConfigs.userId, userId));\n    } catch (error) {\n      console.error('Error fetching CRM configs by user:', error);\n      return [];\n    }\n  }\n\n  async createCrmConfig(config: InsertCrmConfig & { userId: number }): Promise<CrmConfig> {\n    const [newConfig] = await db.insert(crmConfigs).values(config).returning();\n    return newConfig;\n  }\n\n  async updateCrmConfig(id: number, updates: Partial<CrmConfig>): Promise<CrmConfig | undefined> {\n    try {\n      const [updatedConfig] = await db\n        .update(crmConfigs)\n        .set(updates)\n        .where(eq(crmConfigs.id, id))\n        .returning();\n      return updatedConfig || undefined;\n    } catch (error) {\n      console.error('Error updating CRM config:', error);\n      return undefined;\n    }\n  }\n\n  async deleteCrmConfig(id: number): Promise<boolean> {\n    try {\n      const result = await db.delete(crmConfigs).where(eq(crmConfigs.id, id)).returning();\n      return result.length > 0;\n    } catch (error) {\n      console.error('Error deleting CRM config:', error);\n      return false;\n    }\n  }\n\n  // CRM Sync Log methods\n  async getCrmSyncLog(id: number): Promise<CrmSyncLog | undefined> {\n    try {\n      const [log] = await db.select().from(crmSyncLogs).where(eq(crmSyncLogs.id, id));\n      return log || undefined;\n    } catch (error) {\n      console.error('Error fetching CRM sync log:', error);\n      return undefined;\n    }\n  }\n\n  async getCrmSyncLogsByConfig(crmConfigId: number): Promise<CrmSyncLog[]> {\n    try {\n      return await db.select().from(crmSyncLogs).where(eq(crmSyncLogs.crmConfigId, crmConfigId));\n    } catch (error) {\n      console.error('Error fetching CRM sync logs by config:', error);\n      return [];\n    }\n  }\n\n  async createCrmSyncLog(log: InsertCrmSyncLog): Promise<CrmSyncLog> {\n    const [newLog] = await db.insert(crmSyncLogs).values(log).returning();\n    return newLog;\n  }\n\n  // Knowledge Base methods\n  async getKnowledgeEntry(id: number): Promise<KnowledgeBase | undefined> {\n    try {\n      const [entry] = await db.select().from(knowledgeBase).where(eq(knowledgeBase.id, id));\n      return entry || undefined;\n    } catch (error) {\n      console.error('Error fetching knowledge entry:', error);\n      return undefined;\n    }\n  }\n\n  async getAllKnowledgeEntries(): Promise<KnowledgeBase[]> {\n    try {\n      return await db.select().from(knowledgeBase);\n    } catch (error) {\n      console.error('Error fetching all knowledge entries:', error);\n      return [];\n    }\n  }\n\n  async searchKnowledge(query: string, workflowStep?: string): Promise<KnowledgeBase[]> {\n    try {\n      const entries = await db.select().from(knowledgeBase);\n      \n      const lowerQuery = query.toLowerCase();\n      return entries.filter(entry => {\n        const matchesQuery = \n          entry.title.toLowerCase().includes(lowerQuery) ||\n          entry.content.toLowerCase().includes(lowerQuery) ||\n          (entry.tags && entry.tags.some(tag => tag.toLowerCase().includes(lowerQuery)));\n        \n        const matchesStep = !workflowStep || entry.workflowStep === workflowStep;\n        \n        return matchesQuery && matchesStep;\n      });\n    } catch (error) {\n      console.error('Error searching knowledge base:', error);\n      return [];\n    }\n  }\n\n  async createKnowledgeEntry(entry: InsertKnowledgeBase): Promise<KnowledgeBase> {\n    const [newEntry] = await db.insert(knowledgeBase).values(entry).returning();\n    return newEntry;\n  }\n\n  async updateKnowledgeEntry(id: number, updates: Partial<KnowledgeBase>): Promise<KnowledgeBase | undefined> {\n    try {\n      const [updatedEntry] = await db\n        .update(knowledgeBase)\n        .set(updates)\n        .where(eq(knowledgeBase.id, id))\n        .returning();\n      return updatedEntry || undefined;\n    } catch (error) {\n      console.error('Error updating knowledge entry:', error);\n      return undefined;\n    }\n  }\n\n  async deleteKnowledgeEntry(id: number): Promise<boolean> {\n    try {\n      const result = await db.delete(knowledgeBase).where(eq(knowledgeBase.id, id)).returning();\n      return result.length > 0;\n    } catch (error) {\n      console.error('Error deleting knowledge entry:', error);\n      return false;\n    }\n  }\n\n  // ============================================================================\n  // INSPECTION SESSION METHODS - Winn Methodology State Machine\n  // ============================================================================\n\n  async getInspectionSession(id: number): Promise<InspectionSession | undefined> {\n    try {\n      const [session] = await db.select().from(inspectionSessions).where(eq(inspectionSessions.id, id));\n      return session || undefined;\n    } catch (error) {\n      console.error('Error fetching inspection session:', error);\n      return undefined;\n    }\n  }\n\n  async getInspectionSessionsByProperty(propertyId: number): Promise<InspectionSession[]> {\n    try {\n      return await db.select().from(inspectionSessions).where(eq(inspectionSessions.propertyId, propertyId));\n    } catch (error) {\n      console.error('Error fetching inspection sessions by property:', error);\n      return [];\n    }\n  }\n\n  async getInspectionSessionsByInspector(inspectorId: number): Promise<InspectionSession[]> {\n    try {\n      return await db.select().from(inspectionSessions).where(eq(inspectionSessions.inspectorId, inspectorId));\n    } catch (error) {\n      console.error('Error fetching inspection sessions by inspector:', error);\n      return [];\n    }\n  }\n\n  async getActiveInspectionSession(propertyId: number, inspectorId: number): Promise<InspectionSession | undefined> {\n    try {\n      const sessions = await db.select().from(inspectionSessions)\n        .where(eq(inspectionSessions.propertyId, propertyId));\n      \n      // Find active session for this inspector\n      const activeSession = sessions.find(s => \n        s.inspectorId === inspectorId && \n        (s.status === 'in_progress' || s.status === 'paused')\n      );\n      \n      return activeSession;\n    } catch (error) {\n      console.error('Error fetching active inspection session:', error);\n      return undefined;\n    }\n  }\n\n  async createInspectionSession(session: InsertInspectionSession): Promise<InspectionSession> {\n    const [newSession] = await db.insert(inspectionSessions).values({\n      ...session,\n      status: session.status || 'in_progress',\n      currentStep: session.currentStep || 'weather_verification',\n      stepsCompleted: [],\n      startedAt: new Date(),\n      lastActivityAt: new Date(),\n    }).returning();\n    return newSession;\n  }\n\n  async updateInspectionSession(id: number, updates: Partial<InspectionSession>): Promise<InspectionSession | undefined> {\n    try {\n      const [updatedSession] = await db\n        .update(inspectionSessions)\n        .set({\n          ...updates,\n          lastActivityAt: new Date(),\n          updatedAt: new Date(),\n        })\n        .where(eq(inspectionSessions.id, id))\n        .returning();\n      return updatedSession || undefined;\n    } catch (error) {\n      console.error('Error updating inspection session:', error);\n      return undefined;\n    }\n  }\n\n  async advanceInspectionStep(id: number, nextStep: WinnMethodologyStep): Promise<InspectionSession | undefined> {\n    try {\n      const session = await this.getInspectionSession(id);\n      if (!session) return undefined;\n\n      const stepsCompleted = [...(session.stepsCompleted || [])];\n      if (session.currentStep && !stepsCompleted.includes(session.currentStep)) {\n        stepsCompleted.push(session.currentStep);\n      }\n\n      const [updatedSession] = await db\n        .update(inspectionSessions)\n        .set({\n          currentStep: nextStep,\n          stepsCompleted,\n          lastActivityAt: new Date(),\n          updatedAt: new Date(),\n        })\n        .where(eq(inspectionSessions.id, id))\n        .returning();\n      return updatedSession || undefined;\n    } catch (error) {\n      console.error('Error advancing inspection step:', error);\n      return undefined;\n    }\n  }\n\n  async completeInspectionSession(id: number): Promise<InspectionSession | undefined> {\n    try {\n      const session = await this.getInspectionSession(id);\n      if (!session) return undefined;\n\n      const stepsCompleted = [...(session.stepsCompleted || [])];\n      if (session.currentStep && !stepsCompleted.includes(session.currentStep)) {\n        stepsCompleted.push(session.currentStep);\n      }\n\n      const [updatedSession] = await db\n        .update(inspectionSessions)\n        .set({\n          status: 'completed',\n          stepsCompleted,\n          completedAt: new Date(),\n          lastActivityAt: new Date(),\n          updatedAt: new Date(),\n        })\n        .where(eq(inspectionSessions.id, id))\n        .returning();\n      return updatedSession || undefined;\n    } catch (error) {\n      console.error('Error completing inspection session:', error);\n      return undefined;\n    }\n  }\n\n  // ============================================================================\n  // EVIDENCE ASSET METHODS - Photos, Thermal Images, Documents\n  // ============================================================================\n\n  async getEvidenceAsset(id: number): Promise<EvidenceAsset | undefined> {\n    try {\n      const [asset] = await db.select().from(evidenceAssets).where(eq(evidenceAssets.id, id));\n      return asset || undefined;\n    } catch (error) {\n      console.error('Error fetching evidence asset:', error);\n      return undefined;\n    }\n  }\n\n  async getEvidenceAssetsBySession(sessionId: number): Promise<EvidenceAsset[]> {\n    try {\n      return await db.select().from(evidenceAssets).where(eq(evidenceAssets.inspectionSessionId, sessionId));\n    } catch (error) {\n      console.error('Error fetching evidence assets by session:', error);\n      return [];\n    }\n  }\n\n  async getEvidenceAssetsByStep(sessionId: number, step: WinnMethodologyStep): Promise<EvidenceAsset[]> {\n    try {\n      const assets = await db.select().from(evidenceAssets)\n        .where(eq(evidenceAssets.inspectionSessionId, sessionId));\n      return assets.filter(a => a.step === step);\n    } catch (error) {\n      console.error('Error fetching evidence assets by step:', error);\n      return [];\n    }\n  }\n\n  async createEvidenceAsset(asset: InsertEvidenceAsset): Promise<EvidenceAsset> {\n    const [newAsset] = await db.insert(evidenceAssets).values(asset).returning();\n    return newAsset;\n  }\n\n  async updateEvidenceAsset(id: number, updates: Partial<EvidenceAsset>): Promise<EvidenceAsset | undefined> {\n    try {\n      const [updatedAsset] = await db\n        .update(evidenceAssets)\n        .set(updates)\n        .where(eq(evidenceAssets.id, id))\n        .returning();\n      return updatedAsset || undefined;\n    } catch (error) {\n      console.error('Error updating evidence asset:', error);\n      return undefined;\n    }\n  }\n\n  async deleteEvidenceAsset(id: number): Promise<boolean> {\n    try {\n      const result = await db.delete(evidenceAssets).where(eq(evidenceAssets.id, id)).returning();\n      return result.length > 0;\n    } catch (error) {\n      console.error('Error deleting evidence asset:', error);\n      return false;\n    }\n  }\n\n  // ============================================================================\n  // LIMITLESS TRANSCRIPT METHODS - Eric Winn Recording Ingestion\n  // ============================================================================\n\n  async getLimitlessTranscript(id: number): Promise<LimitlessTranscript | undefined> {\n    try {\n      const [transcript] = await db.select().from(limitlessTranscripts).where(eq(limitlessTranscripts.id, id));\n      return transcript || undefined;\n    } catch (error) {\n      console.error('Error fetching limitless transcript:', error);\n      return undefined;\n    }\n  }\n\n  async getAllLimitlessTranscripts(): Promise<LimitlessTranscript[]> {\n    try {\n      return await db.select().from(limitlessTranscripts);\n    } catch (error) {\n      console.error('Error fetching all limitless transcripts:', error);\n      return [];\n    }\n  }\n\n  async createLimitlessTranscript(transcript: InsertLimitlessTranscript): Promise<LimitlessTranscript> {\n    const [newTranscript] = await db.insert(limitlessTranscripts).values({\n      ...transcript,\n      status: 'pending',\n    }).returning();\n    return newTranscript;\n  }\n\n  async updateLimitlessTranscript(id: number, updates: Partial<LimitlessTranscript>): Promise<LimitlessTranscript | undefined> {\n    try {\n      const [updatedTranscript] = await db\n        .update(limitlessTranscripts)\n        .set({\n          ...updates,\n          updatedAt: new Date(),\n        })\n        .where(eq(limitlessTranscripts.id, id))\n        .returning();\n      return updatedTranscript || undefined;\n    } catch (error) {\n      console.error('Error updating limitless transcript:', error);\n      return undefined;\n    }\n  }\n\n  // ============================================================================\n  // INSPECTOR PROGRESS METHODS - Compliance & Proficiency Tracking\n  // ============================================================================\n\n  async getInspectorProgress(userId: number): Promise<InspectorProgress | undefined> {\n    try {\n      const [progress] = await db.select().from(inspectorProgress).where(eq(inspectorProgress.userId, userId));\n      return progress || undefined;\n    } catch (error) {\n      console.error('Error fetching inspector progress:', error);\n      return undefined;\n    }\n  }\n\n  async createInspectorProgress(progress: InsertInspectorProgress): Promise<InspectorProgress> {\n    const [newProgress] = await db.insert(inspectorProgress).values({\n      ...progress,\n      totalInspections: 0,\n      completedInspections: 0,\n    }).returning();\n    return newProgress;\n  }\n\n  async updateInspectorProgress(userId: number, updates: Partial<InspectorProgress>): Promise<InspectorProgress | undefined> {\n    try {\n      const [updatedProgress] = await db\n        .update(inspectorProgress)\n        .set({\n          ...updates,\n          updatedAt: new Date(),\n        })\n        .where(eq(inspectorProgress.userId, userId))\n        .returning();\n      return updatedProgress || undefined;\n    } catch (error) {\n      console.error('Error updating inspector progress:', error);\n      return undefined;\n    }\n  }\n\n  // ============================================================================\n  // SCHEDULED INSPECTION METHODS - Multi-property scheduling\n  // ============================================================================\n\n  async getScheduledInspection(id: number): Promise<ScheduledInspection | undefined> {\n    try {\n      const [inspection] = await db.select().from(scheduledInspections).where(eq(scheduledInspections.id, id));\n      return inspection || undefined;\n    } catch (error) {\n      console.error('Error fetching scheduled inspection:', error);\n      return undefined;\n    }\n  }\n\n  async getScheduledInspectionsByInspector(\n    inspectorId: number,\n    startDate?: Date,\n    endDate?: Date\n  ): Promise<ScheduledInspection[]> {\n    try {\n      let query = db.select().from(scheduledInspections).where(eq(scheduledInspections.inspectorId, inspectorId));\n      const results = await query;\n      \n      if (startDate || endDate) {\n        return results.filter(i => {\n          const date = new Date(i.scheduledDate);\n          if (startDate && date < startDate) return false;\n          if (endDate && date > endDate) return false;\n          return true;\n        });\n      }\n      \n      return results;\n    } catch (error) {\n      console.error('Error fetching scheduled inspections by inspector:', error);\n      return [];\n    }\n  }\n\n  async getScheduledInspectionsByDate(date: Date, inspectorId?: number): Promise<ScheduledInspection[]> {\n    try {\n      const startOfDay = new Date(date);\n      startOfDay.setHours(0, 0, 0, 0);\n      const endOfDay = new Date(date);\n      endOfDay.setHours(23, 59, 59, 999);\n\n      let results = await db.select().from(scheduledInspections);\n      \n      return results.filter(i => {\n        const inspectionDate = new Date(i.scheduledDate);\n        const matchesDate = inspectionDate >= startOfDay && inspectionDate <= endOfDay;\n        const matchesInspector = inspectorId ? i.inspectorId === inspectorId : true;\n        return matchesDate && matchesInspector;\n      });\n    } catch (error) {\n      console.error('Error fetching scheduled inspections by date:', error);\n      return [];\n    }\n  }\n\n  async createScheduledInspection(inspection: InsertScheduledInspection): Promise<ScheduledInspection> {\n    const [newInspection] = await db.insert(scheduledInspections).values(inspection).returning();\n    return newInspection;\n  }\n\n  async updateScheduledInspection(id: number, updates: Partial<ScheduledInspection>): Promise<ScheduledInspection | undefined> {\n    try {\n      const [updatedInspection] = await db\n        .update(scheduledInspections)\n        .set({\n          ...updates,\n          updatedAt: new Date(),\n        })\n        .where(eq(scheduledInspections.id, id))\n        .returning();\n      return updatedInspection || undefined;\n    } catch (error) {\n      console.error('Error updating scheduled inspection:', error);\n      return undefined;\n    }\n  }\n\n  async cancelScheduledInspection(id: number, reason: string): Promise<ScheduledInspection | undefined> {\n    try {\n      const [cancelled] = await db\n        .update(scheduledInspections)\n        .set({\n          status: 'cancelled',\n          cancelledAt: new Date(),\n          cancelReason: reason,\n          updatedAt: new Date(),\n        })\n        .where(eq(scheduledInspections.id, id))\n        .returning();\n      return cancelled || undefined;\n    } catch (error) {\n      console.error('Error cancelling scheduled inspection:', error);\n      return undefined;\n    }\n  }\n\n  // Team Assignment methods\n  async getTeamAssignment(inspectorId: number): Promise<TeamAssignment | undefined> {\n    try {\n      const [assignment] = await db.select().from(teamAssignments).where(eq(teamAssignments.inspectorId, inspectorId));\n      return assignment || undefined;\n    } catch (error) {\n      console.error('Error fetching team assignment:', error);\n      return undefined;\n    }\n  }\n\n  async getAllTeamAssignments(): Promise<TeamAssignment[]> {\n    try {\n      return await db.select().from(teamAssignments);\n    } catch (error) {\n      console.error('Error fetching all team assignments:', error);\n      return [];\n    }\n  }\n\n  async createTeamAssignment(assignment: InsertTeamAssignment): Promise<TeamAssignment> {\n    const [newAssignment] = await db.insert(teamAssignments).values(assignment).returning();\n    return newAssignment;\n  }\n\n  async updateTeamAssignment(id: number, updates: Partial<TeamAssignment>): Promise<TeamAssignment | undefined> {\n    try {\n      const [updated] = await db\n        .update(teamAssignments)\n        .set({ ...updates, updatedAt: new Date() })\n        .where(eq(teamAssignments.id, id))\n        .returning();\n      return updated || undefined;\n    } catch (error) {\n      console.error('Error updating team assignment:', error);\n      return undefined;\n    }\n  }\n\n  async deleteTeamAssignment(id: number): Promise<boolean> {\n    try {\n      await db.delete(teamAssignments).where(eq(teamAssignments.id, id));\n      return true;\n    } catch (error) {\n      console.error('Error deleting team assignment:', error);\n      return false;\n    }\n  }\n\n  // Damage Template methods\n  async getDamageTemplate(id: number): Promise<DamageTemplate | undefined> {\n    try {\n      const [template] = await db.select().from(damageTemplates).where(eq(damageTemplates.id, id));\n      return template || undefined;\n    } catch (error) {\n      console.error('Error fetching damage template:', error);\n      return undefined;\n    }\n  }\n\n  async getAllDamageTemplates(): Promise<DamageTemplate[]> {\n    try {\n      return await db.select().from(damageTemplates).orderBy(damageTemplates.sortOrder);\n    } catch (error) {\n      console.error('Error fetching all damage templates:', error);\n      return [];\n    }\n  }\n\n  async getDamageTemplatesByCategory(category: string): Promise<DamageTemplate[]> {\n    try {\n      return await db.select().from(damageTemplates).where(eq(damageTemplates.category, category));\n    } catch (error) {\n      console.error('Error fetching damage templates by category:', error);\n      return [];\n    }\n  }\n\n  async createDamageTemplate(template: InsertDamageTemplate): Promise<DamageTemplate> {\n    const [newTemplate] = await db.insert(damageTemplates).values(template).returning();\n    return newTemplate;\n  }\n\n  async updateDamageTemplate(id: number, updates: Partial<DamageTemplate>): Promise<DamageTemplate | undefined> {\n    try {\n      const [updated] = await db\n        .update(damageTemplates)\n        .set({ ...updates, updatedAt: new Date() })\n        .where(eq(damageTemplates.id, id))\n        .returning();\n      return updated || undefined;\n    } catch (error) {\n      console.error('Error updating damage template:', error);\n      return undefined;\n    }\n  }\n\n  async deleteDamageTemplate(id: number): Promise<boolean> {\n    try {\n      await db.delete(damageTemplates).where(eq(damageTemplates.id, id));\n      return true;\n    } catch (error) {\n      console.error('Error deleting damage template:', error);\n      return false;\n    }\n  }\n\n  // AI Conversation methods (Stormy)\n  async getAIConversation(id: number): Promise<AIConversation | undefined> {\n    try {\n      const [conversation] = await db.select().from(aiConversations).where(eq(aiConversations.id, id));\n      return conversation || undefined;\n    } catch (error) {\n      console.error('Error fetching AI conversation:', error);\n      return undefined;\n    }\n  }\n\n  async getAIConversationsByUser(userId: string): Promise<AIConversation[]> {\n    try {\n      return await db.select().from(aiConversations).where(eq(aiConversations.userId, userId));\n    } catch (error) {\n      console.error('Error fetching AI conversations by user:', error);\n      return [];\n    }\n  }\n\n  async createAIConversation(conversation: InsertAIConversation): Promise<AIConversation> {\n    const [newConversation] = await db.insert(aiConversations).values(conversation).returning();\n    return newConversation;\n  }\n\n  async updateAIConversation(id: number, updates: Partial<AIConversation>): Promise<AIConversation | undefined> {\n    try {\n      const [updated] = await db\n        .update(aiConversations)\n        .set({ ...updates, updatedAt: new Date() })\n        .where(eq(aiConversations.id, id))\n        .returning();\n      return updated || undefined;\n    } catch (error) {\n      console.error('Error updating AI conversation:', error);\n      return undefined;\n    }\n  }\n\n  // AI Message methods\n  async getAIMessage(id: number): Promise<AIMessage | undefined> {\n    try {\n      const [message] = await db.select().from(aiMessages).where(eq(aiMessages.id, id));\n      return message || undefined;\n    } catch (error) {\n      console.error('Error fetching AI message:', error);\n      return undefined;\n    }\n  }\n\n  async getAIMessagesByConversation(conversationId: number): Promise<AIMessage[]> {\n    try {\n      return await db.select().from(aiMessages).where(eq(aiMessages.conversationId, conversationId));\n    } catch (error) {\n      console.error('Error fetching AI messages by conversation:', error);\n      return [];\n    }\n  }\n\n  async createAIMessage(message: InsertAIMessage): Promise<AIMessage> {\n    const [newMessage] = await db.insert(aiMessages).values(message).returning();\n    return newMessage;\n  }\n\n  // AI Memory methods\n  async getAIMemory(id: number): Promise<AIMemory | undefined> {\n    try {\n      const [memory] = await db.select().from(aiMemory).where(eq(aiMemory.id, id));\n      return memory || undefined;\n    } catch (error) {\n      console.error('Error fetching AI memory:', error);\n      return undefined;\n    }\n  }\n\n  async getAIMemoryByUser(userId: string): Promise<AIMemory[]> {\n    try {\n      return await db.select().from(aiMemory).where(eq(aiMemory.userId, userId));\n    } catch (error) {\n      console.error('Error fetching AI memory by user:', error);\n      return [];\n    }\n  }\n\n  async createAIMemory(memory: InsertAIMemory): Promise<AIMemory> {\n    const [newMemory] = await db.insert(aiMemory).values(memory).returning();\n    return newMemory;\n  }\n\n  async updateAIMemory(id: number, updates: Partial<AIMemory>): Promise<AIMemory> {\n    const [updated] = await db\n      .update(aiMemory)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(aiMemory.id, id))\n      .returning();\n    return updated;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":40769,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/pages/property-detail.tsx":{"content":"import { useParams, useLocation } from 'wouter';\nimport { useQuery } from '@tanstack/react-query';\nimport { Header, Footer } from '@/components/navbar';\nimport { \n  Card, \n  CardContent \n} from '@/components/ui/card';\nimport { \n  Button \n} from '@/components/ui/button';\nimport {\n  ArrowLeft,\n  Camera,\n  Share,\n  Sparkles\n} from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\nimport { Property, Scan } from '@shared/schema';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { CrmSync } from '@/components/crm-sync';\n\nconst PropertyDetail = () => {\n  const params = useParams();\n  const [, navigate] = useLocation();\n  const propertyId = params.id;\n\n  const { data: property, isLoading } = useQuery<Property>({\n    queryKey: [`/api/properties/${propertyId}`],\n  });\n\n  const getScoreColor = (score: number) => {\n    if (score >= 80) return \"bg-success bg-opacity-10 text-success\";\n    if (score >= 60) return \"bg-warning bg-opacity-10 text-warning\";\n    return \"bg-destructive bg-opacity-10 text-destructive\";\n  };\n\n  const getChartBarColor = (score: number) => {\n    if (score >= 80) return \"bg-success\";\n    if (score >= 60) return \"bg-warning\";\n    return \"bg-destructive\";\n  };\n\n  const formatDate = (dateString: string | undefined) => {\n    if (!dateString) return '';\n    return new Date(dateString).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric'\n    });\n  };\n\n  // Sort scans by date (newest first)\n  const sortedScans = property?.scans?.slice().sort((a, b) => \n    new Date(b.date).getTime() - new Date(a.date).getTime()\n  );\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative\">\n      <Header />\n      \n      <main className=\"flex-grow pb-20\">\n        {/* Property Header */}\n        <div className=\"relative h-48\">\n          {isLoading ? (\n            <Skeleton className=\"w-full h-48\" />\n          ) : (\n            <>\n              <img \n                src={property?.imageUrl} \n                alt={property?.name} \n                className=\"w-full h-48 object-cover\" \n              />\n              <div className=\"absolute inset-0 bg-gradient-to-t from-black opacity-50\"></div>\n            </>\n          )}\n          <button className=\"absolute top-4 left-4 bg-white bg-opacity-80 p-2 rounded-full\" onClick={() => navigate('/dashboard')}>\n            <ArrowLeft className=\"text-neutral-darker\" />\n          </button>\n          <div className=\"absolute bottom-4 left-4 text-white\">\n            {isLoading ? (\n              <>\n                <Skeleton className=\"h-7 w-48 bg-white bg-opacity-25\" />\n                <Skeleton className=\"h-5 w-64 mt-1 bg-white bg-opacity-25\" />\n              </>\n            ) : (\n              <>\n                <h2 className=\"text-xl font-semibold\">{property?.name}</h2>\n                <p className=\"text-sm\">{property?.address}</p>\n              </>\n            )}\n          </div>\n        </div>\n\n        <div className=\"p-4\">\n          {/* Health Score Card */}\n          <Card className=\"mb-6\">\n            <CardContent className=\"p-4\">\n              {isLoading ? (\n                <>\n                  <div className=\"flex justify-between items-center mb-3\">\n                    <Skeleton className=\"h-6 w-48\" />\n                    <Skeleton className=\"h-6 w-24\" />\n                  </div>\n                  <Skeleton className=\"h-40 w-full\" />\n                  <div className=\"flex justify-between mt-2\">\n                    {Array(6).fill(0).map((_, i) => (\n                      <Skeleton key={i} className=\"h-4 w-8\" />\n                    ))}\n                  </div>\n                </>\n              ) : (\n                <>\n                  <div className=\"flex justify-between items-center mb-3\">\n                    <h3 className=\"font-semibold text-neutral-darker\">Roof Health History</h3>\n                    <Badge variant=\"outline\" className={getScoreColor(property?.healthScore || 0)}>\n                      Current: {property?.healthScore}\n                    </Badge>\n                  </div>\n                  \n                  {/* Score History Chart (simplified) */}\n                  <div className=\"h-40 flex items-end space-x-1 mb-2\">\n                    {property?.scans?.slice(0, 6).reverse().map((scan, index) => (\n                      <div \n                        key={index} \n                        className={`${getChartBarColor(scan.healthScore)} rounded-t-sm flex-1`} \n                        style={{ height: `${scan.healthScore}%` }}\n                      ></div>\n                    ))}\n                  </div>\n                  \n                  <div className=\"flex justify-between text-xs text-neutral-dark\">\n                    {property?.scans?.slice(0, 6).reverse().map((scan, index) => (\n                      <span key={index}>\n                        {new Date(scan.date).toLocaleDateString('en-US', { month: 'short' })}\n                      </span>\n                    ))}\n                  </div>\n                </>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Scan History */}\n          <h3 className=\"font-semibold text-neutral-darker mb-3\">Scan History</h3>\n          \n          {isLoading ? (\n            <div className=\"space-y-3 mb-6\">\n              {[1, 2, 3].map((i) => (\n                <Card key={i}>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex justify-between items-start\">\n                      <div>\n                        <Skeleton className=\"h-6 w-32 mb-1\" />\n                        <Skeleton className=\"h-5 w-48\" />\n                      </div>\n                      <div className=\"flex flex-col items-end\">\n                        <Skeleton className=\"h-6 w-20 mb-1\" />\n                        <Skeleton className=\"h-5 w-24\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : sortedScans && sortedScans.length > 0 ? (\n            <div className=\"space-y-3 mb-6\">\n              {sortedScans.map((scan) => (\n                <Card \n                  key={scan.id} \n                  className=\"cursor-pointer\"\n                  onClick={() => navigate(`/analysis/${scan.id}`)}\n                >\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex justify-between items-start\">\n                      <div>\n                        <h4 className=\"font-medium text-neutral-darker\">{formatDate(scan.date)}</h4>\n                        <p className=\"text-sm text-neutral-dark\">\n                          {scan.scanType === 'drone' ? 'Drone scan' : 'Handheld scan'} \n                          {scan.deviceType ? ` - ${scan.deviceType}` : ''}\n                        </p>\n                      </div>\n                      <div className=\"flex flex-col items-end\">\n                        <Badge variant=\"outline\" className={getScoreColor(scan.healthScore)} style={{ marginBottom: '4px' }}>\n                          Score: {scan.healthScore}\n                        </Badge>\n                        <span className=\"text-sm text-primary\">View Analysis →</span>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <Card className=\"mb-6\">\n              <CardContent className=\"p-4 text-center text-neutral-dark\">\n                No scan history available. Add your first scan.\n              </CardContent>\n            </Card>\n          )}\n\n          {/* CRM Sync Component */}\n          {property && sortedScans && sortedScans.length > 0 && (\n            <div className=\"mb-6\">\n              <CrmSync property={property} scan={sortedScans[0]} />\n            </div>\n          )}\n\n          {/* Primary Action - Start Inspection */}\n          <Button\n            className=\"w-full h-14 mb-4 bg-gradient-to-r from-primary to-cyan-500 hover:from-primary/90 hover:to-cyan-500/90 text-white font-medium rounded-lg transition flex items-center justify-center text-lg\"\n            onClick={() => navigate(`/inspection/${propertyId}`)}\n            data-testid=\"button-start-inspection\"\n          >\n            <Sparkles className=\"mr-2 h-6 w-6\" />\n            Inspect with Stormy\n          </Button>\n\n          {/* Secondary Action Buttons */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <Button\n              className=\"bg-primary hover:bg-primary-light text-white font-medium py-3 px-4 rounded-lg transition flex items-center justify-center\"\n              onClick={() => navigate('/upload')}\n            >\n              <Camera className=\"mr-2 h-5 w-5\" />\n              New Scan\n            </Button>\n            <Button\n              variant=\"outline\"\n              className=\"bg-white border border-neutral-medium hover:bg-neutral-light text-neutral-darker font-medium py-3 px-4 rounded-lg transition flex items-center justify-center\"\n            >\n              <Share className=\"mr-2 h-5 w-5\" />\n              Share History\n            </Button>\n          </div>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n};\n\nexport default PropertyDetail;\n","path":null,"size_bytes":9254,"size_tokens":null},"client/src/pages/training.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useLocation } from 'wouter';\nimport { Header, Footer } from '@/components/navbar';\nimport { useAuth } from '@/hooks/use-auth';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Separator } from '@/components/ui/separator';\nimport { \n  GraduationCap, \n  Clock, \n  CheckCircle, \n  PlayCircle, \n  FileText, \n  Award,\n  BookOpen,\n  Target,\n  TrendingUp,\n  AlertCircle\n} from 'lucide-react';\nimport { SEO, courseSchema, breadcrumbSchema } from '@/components/seo';\n\ninterface TrainingCourse {\n  id: number;\n  title: string;\n  description: string;\n  day: string;\n  subject: string;\n  contentType: string;\n  contentUrl: string;\n  duration: number;\n  requiredForCertification: boolean;\n  certificationLevel: string;\n  orderIndex: number;\n  completed?: boolean;\n  progress?: number;\n}\n\ninterface UserProgress {\n  totalCourses: number;\n  completedCourses: number;\n  certificationProgress: number;\n  currentLevel: string;\n  nextLevel: string;\n}\n\nconst Training = () => {\n  const { user, role } = useAuth();\n  const [, navigate] = useLocation();\n  const [selectedDay, setSelectedDay] = useState('orientation');\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!user) {\n      navigate('/');\n    }\n  }, [user, navigate]);\n\n  // Mock training data based on WinnStorm™ methodology\n  const mockCourses: TrainingCourse[] = [\n    // Orientation Day\n    {\n      id: 1,\n      title: \"Welcome to WinnStorm™\",\n      description: \"Introduction to the Winn Methodology and damage assessment fundamentals\",\n      day: \"orientation\",\n      subject: \"overview\",\n      contentType: \"video\",\n      contentUrl: \"/training/welcome.mp4\",\n      duration: 45,\n      requiredForCertification: true,\n      certificationLevel: \"both\",\n      orderIndex: 1,\n      completed: true,\n      progress: 100\n    },\n    {\n      id: 2,\n      title: \"Safety Protocols & Equipment\",\n      description: \"Essential safety procedures for roof inspections and thermal imaging\",\n      day: \"orientation\",\n      subject: \"safety\",\n      contentType: \"document\",\n      contentUrl: \"/training/safety-protocols.pdf\",\n      duration: 30,\n      requiredForCertification: true,\n      certificationLevel: \"both\",\n      orderIndex: 2,\n      completed: true,\n      progress: 100\n    },\n    // Day 1 - Technology & Equipment\n    {\n      id: 3,\n      title: \"Thermal Imaging Fundamentals\",\n      description: \"Understanding thermal cameras, infrared radiation, and temperature differentials\",\n      day: \"day1\",\n      subject: \"technology\",\n      contentType: \"video\",\n      contentUrl: \"/training/thermal-fundamentals.mp4\",\n      duration: 90,\n      requiredForCertification: true,\n      certificationLevel: \"both\",\n      orderIndex: 3,\n      completed: false,\n      progress: 60\n    },\n    {\n      id: 4,\n      title: \"FLIR Camera Operation\",\n      description: \"Hands-on training with FLIR thermal imaging equipment\",\n      day: \"day1\",\n      subject: \"technology\",\n      contentType: \"video\",\n      contentUrl: \"/training/flir-operation.mp4\",\n      duration: 120,\n      requiredForCertification: true,\n      certificationLevel: \"both\",\n      orderIndex: 4,\n      completed: false,\n      progress: 0\n    },\n    // Day 2 - Inspection Techniques\n    {\n      id: 5,\n      title: \"Roof Inspection Methodology\",\n      description: \"The Winn Method for systematic roof damage assessment\",\n      day: \"day2\",\n      subject: \"inspections\",\n      contentType: \"video\",\n      contentUrl: \"/training/inspection-methodology.mp4\",\n      duration: 150,\n      requiredForCertification: true,\n      certificationLevel: \"both\",\n      orderIndex: 5,\n      completed: false,\n      progress: 0\n    },\n    {\n      id: 6,\n      title: \"Moisture Detection Techniques\",\n      description: \"Advanced methods for identifying water intrusion and damage\",\n      day: \"day2\",\n      subject: \"inspections\",\n      contentType: \"video\",\n      contentUrl: \"/training/moisture-detection.mp4\",\n      duration: 100,\n      requiredForCertification: true,\n      certificationLevel: \"both\",\n      orderIndex: 6,\n      completed: false,\n      progress: 0\n    }\n  ];\n\n  const mockProgress: UserProgress = {\n    totalCourses: mockCourses.length,\n    completedCourses: mockCourses.filter(c => c.completed).length,\n    certificationProgress: 35,\n    currentLevel: \"Junior Consultant\",\n    nextLevel: \"Senior Consultant\"\n  };\n\n  const dayOptions = [\n    { value: 'orientation', label: 'Orientation', icon: GraduationCap },\n    { value: 'day1', label: 'Day 1 - Technology', icon: PlayCircle },\n    { value: 'day2', label: 'Day 2 - Inspections', icon: Target },\n    { value: 'day3', label: 'Day 3 - Sales & Insurance', icon: TrendingUp },\n  ];\n\n  const filteredCourses = mockCourses.filter(course => course.day === selectedDay);\n\n  const trainingStructuredData = [\n    breadcrumbSchema([\n      { name: 'Home', url: '/' },\n      { name: 'Training Portal', url: '/training' }\n    ]),\n    courseSchema({\n      name: 'WinnStorm™ Damage Assessment Certification',\n      description: 'Comprehensive training program covering the Winn Methodology for professional damage assessment, thermal imaging analysis, and industry-leading reporting techniques.',\n      provider: 'WinnStorm™'\n    })\n  ];\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative bg-background text-foreground\">\n      <SEO\n        title=\"Training Portal - Certification Program\"\n        description=\"Master the Winn Methodology with our comprehensive training portal. Earn Junior and Senior Consultant certifications through video courses, quizzes, and hands-on assessments.\"\n        canonical=\"/training\"\n        noindex={true}\n        keywords={['damage assessment training', 'property inspection certification', 'Winn Methodology course', 'thermal imaging training', 'consultant certification']}\n        structuredData={trainingStructuredData}\n      />\n      <Header />\n      \n      <main className=\"flex-grow pb-20\">\n        <div className=\"p-6\">\n          {/* Training Portal Header */}\n          <div className=\"mb-8\">\n            <div className=\"flex items-center mb-4\">\n              <div className=\"p-3 bg-gradient-to-br from-primary/20 to-cyan-500/20 rounded-xl\">\n                <GraduationCap className=\"h-8 w-8 text-primary\" />\n              </div>\n              <div className=\"ml-4\">\n                <h1 className=\"text-3xl font-bold bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent\">\n                  Training Portal\n                </h1>\n                <p className=\"text-muted-foreground\">WinnStorm™ Certification Program</p>\n              </div>\n            </div>\n            \n            {/* Progress Overview */}\n            <Card className=\"bg-gradient-to-r from-primary/5 to-cyan-500/5 border-primary/20\">\n              <CardContent className=\"p-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                  <div>\n                    <div className=\"flex items-center mb-2\">\n                      <Award className=\"h-5 w-5 text-primary mr-2\" />\n                      <span className=\"font-semibold\">Current Level</span>\n                    </div>\n                    <div className=\"text-2xl font-bold text-primary\">{mockProgress.currentLevel}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      Progress to {mockProgress.nextLevel}\n                    </div>\n                    <Progress value={mockProgress.certificationProgress} className=\"mt-2\" />\n                    <div className=\"text-xs text-muted-foreground mt-1\">\n                      {mockProgress.certificationProgress}% Complete\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <div className=\"flex items-center mb-2\">\n                      <BookOpen className=\"h-5 w-5 text-cyan-500 mr-2\" />\n                      <span className=\"font-semibold\">Course Progress</span>\n                    </div>\n                    <div className=\"text-2xl font-bold text-cyan-600\">\n                      {mockProgress.completedCourses}/{mockProgress.totalCourses}\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">Courses Completed</div>\n                  </div>\n                  \n                  <div>\n                    <div className=\"flex items-center mb-2\">\n                      <Clock className=\"h-5 w-5 text-blue-500 mr-2\" />\n                      <span className=\"font-semibold\">Study Time</span>\n                    </div>\n                    <div className=\"text-2xl font-bold text-blue-600\">\n                      {Math.floor(mockCourses.reduce((acc, course) => acc + (course.completed ? course.duration : 0), 0) / 60)}h\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">Hours Completed</div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Training Content */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n            {/* Day Navigation */}\n            <div className=\"lg:col-span-1\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">Training Days</CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-0\">\n                  <div className=\"space-y-1\">\n                    {dayOptions.map((day) => {\n                      const Icon = day.icon;\n                      const dayCourses = mockCourses.filter(c => c.day === day.value);\n                      const completedCount = dayCourses.filter(c => c.completed).length;\n                      \n                      return (\n                        <Button\n                          key={day.value}\n                          variant={selectedDay === day.value ? \"default\" : \"ghost\"}\n                          className=\"w-full justify-start p-4 h-auto\"\n                          onClick={() => setSelectedDay(day.value)}\n                        >\n                          <div className=\"flex items-center space-x-3\">\n                            <Icon className=\"h-5 w-5\" />\n                            <div className=\"text-left\">\n                              <div className=\"font-medium\">{day.label}</div>\n                              <div className=\"text-xs text-muted-foreground\">\n                                {completedCount}/{dayCourses.length} completed\n                              </div>\n                            </div>\n                          </div>\n                        </Button>\n                      );\n                    })}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Course Content */}\n            <div className=\"lg:col-span-3\">\n              <div className=\"space-y-4\">\n                {filteredCourses.map((course) => (\n                  <Card key={course.id} className=\"hover:shadow-md transition-shadow\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center space-x-3 mb-2\">\n                            <div className=\"flex items-center space-x-2\">\n                              {course.completed ? (\n                                <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                              ) : course.progress && course.progress > 0 ? (\n                                <PlayCircle className=\"h-5 w-5 text-primary\" />\n                              ) : (\n                                <AlertCircle className=\"h-5 w-5 text-muted-foreground\" />\n                              )}\n                              <h3 className=\"text-lg font-semibold\">{course.title}</h3>\n                            </div>\n                            \n                            <div className=\"flex items-center space-x-2\">\n                              <Badge variant=\"secondary\" className=\"text-xs\">\n                                {course.subject}\n                              </Badge>\n                              {course.requiredForCertification && (\n                                <Badge variant=\"outline\" className=\"text-xs\">\n                                  Required\n                                </Badge>\n                              )}\n                            </div>\n                          </div>\n                          \n                          <p className=\"text-muted-foreground mb-3\">{course.description}</p>\n                          \n                          <div className=\"flex items-center space-x-4 text-sm text-muted-foreground\">\n                            <div className=\"flex items-center\">\n                              <Clock className=\"h-4 w-4 mr-1\" />\n                              {course.duration} minutes\n                            </div>\n                            <div className=\"flex items-center\">\n                              <FileText className=\"h-4 w-4 mr-1\" />\n                              {course.contentType}\n                            </div>\n                          </div>\n                          \n                          {course.progress && course.progress > 0 && !course.completed && (\n                            <div className=\"mt-3\">\n                              <Progress value={course.progress} className=\"h-2\" />\n                              <div className=\"text-xs text-muted-foreground mt-1\">\n                                {course.progress}% complete\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                        \n                        <div className=\"ml-4\">\n                          <Button\n                            variant={course.completed ? \"outline\" : \"default\"}\n                            size=\"sm\"\n                          >\n                            {course.completed ? \"Review\" : course.progress && course.progress > 0 ? \"Continue\" : \"Start\"}\n                          </Button>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n};\n\nexport default Training;","path":null,"size_bytes":14859,"size_tokens":null},"server/thermal-analysis.ts":{"content":"import OpenAI from \"openai\";\nimport { ThermalReading, DetailedIssue, InspectionMetric } from \"@shared/schema\";\n\n// This is using Replit's AI Integrations service, which provides OpenAI-compatible API access without requiring your own OpenAI API key.\n// the newest OpenAI model is \"gpt-5.1\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY\n});\n\nexport interface ThermalAnalysisResult {\n  thermalReadings: ThermalReading[];\n  issues: DetailedIssue[];\n  metrics: InspectionMetric[];\n  summary: string;\n  recommendations: string[];\n  confidence: number;\n}\n\nexport async function analyzeThermalImage(\n  imageBase64: string,\n  imageMetadata: {\n    location: string;\n    timestamp: Date;\n    ambientTemp?: number;\n    humidity?: number;\n  }\n): Promise<ThermalAnalysisResult> {\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5.1\", // the newest OpenAI model is \"gpt-5.1\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        {\n          role: \"system\",\n          content: `You are an expert thermal imaging analyst specializing in commercial roofing systems and damage assessment using the Eric Winn methodology. Analyze the thermal image and provide detailed findings in JSON format.\n\nFocus on:\n1. Temperature anomalies and patterns indicating potential damage\n2. Moisture detection and water infiltration (critical for roof damage assessment)\n3. Insulation gaps and thermal bridging\n4. Structural integrity indicators and substrate damage\n5. Energy efficiency issues\n6. Impact damage signatures from hail or debris\n7. Material degradation patterns\n\nProvide response in this exact JSON format:\n{\n  \"thermalReadings\": [\n    {\n      \"location\": \"string\",\n      \"temperature\": number,\n      \"timestamp\": \"ISO date string\",\n      \"coordinates\": {\"x\": number, \"y\": number},\n      \"alertLevel\": \"normal|caution|warning|critical\"\n    }\n  ],\n  \"issues\": [\n    {\n      \"id\": \"string\",\n      \"title\": \"string\",\n      \"description\": \"string\",\n      \"severity\": \"critical|major|minor|informational\",\n      \"category\": \"string\",\n      \"location\": \"string\",\n      \"coordinates\": {\"x\": number, \"y\": number},\n      \"component\": \"string\",\n      \"recommendedAction\": \"string\",\n      \"urgency\": \"immediate|short_term|long_term|monitoring\",\n      \"estimatedCost\": number,\n      \"discoveredDate\": \"ISO date string\",\n      \"reportedBy\": \"AI Thermal Analysis\"\n    }\n  ],\n  \"metrics\": [\n    {\n      \"category\": \"string\",\n      \"subcategory\": \"string\",\n      \"name\": \"string\",\n      \"value\": number,\n      \"unit\": \"string\",\n      \"threshold\": number,\n      \"status\": \"pass|fail|caution\",\n      \"location\": \"string\",\n      \"notes\": \"string\"\n    }\n  ],\n  \"summary\": \"string\",\n  \"recommendations\": [\"string\"],\n  \"confidence\": number\n}`\n        },\n        {\n          role: \"user\",\n          content: [\n            {\n              type: \"text\",\n              text: `Analyze this thermal image from location: ${imageMetadata.location}\n              Timestamp: ${imageMetadata.timestamp.toISOString()}\n              ${imageMetadata.ambientTemp ? `Ambient Temperature: ${imageMetadata.ambientTemp}°F` : ''}\n              ${imageMetadata.humidity ? `Humidity: ${imageMetadata.humidity}%` : ''}\n              \n              Provide comprehensive thermal analysis focusing on commercial roofing damage assessment using Eric Winn's methodology. Identify moisture intrusion, thermal anomalies, and potential impact damage areas.`\n            },\n            {\n              type: \"image_url\",\n              image_url: {\n                url: `data:image/jpeg;base64,${imageBase64}`\n              }\n            }\n          ]\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      max_completion_tokens: 4000 // GPT-5.1 uses max_completion_tokens instead of max_tokens\n    });\n\n    const content = response.choices[0].message.content;\n    if (!content) {\n      throw new Error('No response content from OpenAI');\n    }\n    const result = JSON.parse(content);\n    \n    // Process and validate the response\n    const thermalReadings: ThermalReading[] = result.thermalReadings.map((reading: any) => ({\n      location: reading.location,\n      temperature: reading.temperature,\n      timestamp: new Date(reading.timestamp),\n      coordinates: reading.coordinates,\n      alertLevel: reading.alertLevel\n    }));\n\n    const issues: DetailedIssue[] = result.issues.map((issue: any) => ({\n      id: issue.id,\n      title: issue.title,\n      description: issue.description,\n      severity: issue.severity,\n      category: issue.category,\n      location: issue.location,\n      coordinates: issue.coordinates,\n      component: issue.component,\n      recommendedAction: issue.recommendedAction,\n      urgency: issue.urgency,\n      estimatedCost: issue.estimatedCost,\n      images: [],\n      thermalImages: [imageBase64],\n      discoveredDate: new Date(issue.discoveredDate),\n      reportedBy: issue.reportedBy\n    }));\n\n    const metrics: InspectionMetric[] = result.metrics.map((metric: any) => ({\n      category: metric.category,\n      subcategory: metric.subcategory,\n      name: metric.name,\n      value: metric.value,\n      unit: metric.unit,\n      threshold: metric.threshold,\n      status: metric.status,\n      location: metric.location,\n      notes: metric.notes\n    }));\n\n    return {\n      thermalReadings,\n      issues,\n      metrics,\n      summary: result.summary,\n      recommendations: result.recommendations,\n      confidence: result.confidence\n    };\n\n  } catch (error) {\n    console.error('Error analyzing thermal image:', error);\n    throw new Error('Failed to analyze thermal image: ' + (error as Error).message);\n  }\n}\n\nexport async function generateThermalReport(\n  analysisResults: ThermalAnalysisResult[],\n  buildingInfo: any\n): Promise<string> {\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5.1\", // the newest OpenAI model is \"gpt-5.1\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are a professional thermal imaging report writer for commercial roofing damage assessment using the Eric Winn methodology. Generate a comprehensive executive summary based on the thermal analysis results that can be used for insurance claims and restoration planning.\"\n        },\n        {\n          role: \"user\",\n          content: `Generate a professional executive summary for thermal imaging analysis of ${buildingInfo.buildingName} at ${buildingInfo.address}.\n          \n          Analysis Results: ${JSON.stringify(analysisResults)}\n          \n          Include:\n          - Overall thermal performance and damage assessment\n          - Critical findings and priorities (moisture intrusion, structural damage)\n          - Documentation of anomalies for insurance claims\n          - Maintenance and restoration recommendations\n          - Risk assessment and urgency classification\n          \n          Write in professional, technical language appropriate for insurance adjusters, facility managers, and building owners. Follow Eric Winn's methodology for damage documentation.`\n        }\n      ],\n      max_completion_tokens: 2000 // GPT-5.1 uses max_completion_tokens instead of max_tokens\n    });\n\n    const content = response.choices[0].message.content;\n    if (!content) {\n      throw new Error('No response content from OpenAI');\n    }\n    return content;\n  } catch (error) {\n    console.error('Error generating thermal report:', error);\n    throw new Error('Failed to generate thermal report: ' + (error as Error).message);\n  }\n}","path":null,"size_bytes":7860,"size_tokens":null},"client/src/components/property-card.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useLocation } from \"wouter\";\nimport { Property } from \"@shared/schema\";\n\ninterface PropertyCardProps {\n  property: Property;\n}\n\nexport const PropertyCard = ({ property }: PropertyCardProps) => {\n  const [, navigate] = useLocation();\n\n  const getScoreColor = (score: number) => {\n    if (score >= 80) return \"bg-success bg-opacity-10 text-success\";\n    if (score >= 60) return \"bg-warning bg-opacity-10 text-warning\";\n    return \"bg-destructive bg-opacity-10 text-destructive\";\n  };\n\n  const formatDate = (date: Date) => {\n    const now = new Date();\n    const diffDays = Math.round((now.getTime() - date.getTime()) / (1000 * 3600 * 24));\n    \n    if (diffDays === 0) return \"Today\";\n    if (diffDays === 1) return \"Yesterday\";\n    if (diffDays < 7) return `${diffDays} days ago`;\n    if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;\n    return `${Math.floor(diffDays / 30)} months ago`;\n  };\n\n  return (\n    <Card className=\"overflow-hidden cursor-pointer border border-border hover:border-primary transition-colors shadow-md\" onClick={() => navigate(`/property/${property.id}`)}>\n      <div className=\"h-48 w-full overflow-hidden\">\n        <img \n          src={property.imageUrl} \n          alt={property.name} \n          className=\"w-full h-full object-cover\"\n        />\n      </div>\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h3 className=\"font-bold text-foreground\">{property.name}</h3>\n          <Badge variant=\"outline\" className={getScoreColor(75)}>\n            {property.overallCondition}\n          </Badge>\n        </div>\n        <p className=\"text-muted-foreground text-sm mb-3\">{property.address}</p>\n        <div className=\"flex items-center justify-between text-sm\">\n          <span className=\"text-muted-foreground\">Last scan: {formatDate(new Date(property.lastInspectionDate))}</span>\n          <span className=\"text-primary font-medium\">View Details →</span>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n","path":null,"size_bytes":2134,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2254,"size_tokens":null},"server/crm-integrations.ts":{"content":"import { Property, Scan, Report } from \"@shared/schema\";\n\n// CRM Integration Types\nexport interface CRMConfig {\n  type: 'jobnimbus' | 'gohighlevel' | 'salesforce' | 'hubspot' | 'pipedrive';\n  apiKey: string;\n  baseUrl: string;\n  webhookUrl?: string;\n  customFields?: Record<string, string>;\n}\n\nexport interface CRMContact {\n  id: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n  company?: string;\n  address?: {\n    street: string;\n    city: string;\n    state: string;\n    zipCode: string;\n  };\n  customFields?: Record<string, any>;\n}\n\nexport interface CRMJob {\n  id: string;\n  contactId: string;\n  name: string;\n  type: string;\n  status: string;\n  address: string;\n  estimatedValue?: number;\n  notes?: string;\n  scheduledDate?: Date;\n  customFields?: Record<string, any>;\n}\n\nexport interface CRMSyncResult {\n  success: boolean;\n  contactId?: string;\n  jobId?: string;\n  error?: string;\n  syncedAt: Date;\n}\n\n// JobNimbus Integration\nclass JobNimbusIntegration {\n  private config: CRMConfig;\n\n  constructor(config: CRMConfig) {\n    this.config = config;\n  }\n\n  async createContact(contact: CRMContact): Promise<CRMSyncResult> {\n    try {\n      const response = await fetch(`${this.config.baseUrl}/contacts`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          first_name: contact.firstName,\n          last_name: contact.lastName,\n          email: contact.email,\n          phone: contact.phone,\n          company: contact.company,\n          address_line_1: contact.address?.street,\n          city: contact.address?.city,\n          state_text: contact.address?.state,\n          zip: contact.address?.zipCode,\n          ...contact.customFields\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`JobNimbus API error: ${response.statusText}`);\n      }\n\n      const result = await response.json();\n      \n      return {\n        success: true,\n        contactId: result.jnid,\n        syncedAt: new Date()\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n        syncedAt: new Date()\n      };\n    }\n  }\n\n  async createJob(job: CRMJob): Promise<CRMSyncResult> {\n    try {\n      const response = await fetch(`${this.config.baseUrl}/jobs`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          name: job.name,\n          number: `WINN-${Date.now()}`,\n          job_type: job.type,\n          stage: job.status,\n          primary_contact: job.contactId,\n          address_line_1: job.address,\n          estimated_value: job.estimatedValue,\n          description: job.notes,\n          date_start: job.scheduledDate?.toISOString(),\n          ...job.customFields\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`JobNimbus API error: ${response.statusText}`);\n      }\n\n      const result = await response.json();\n      \n      return {\n        success: true,\n        jobId: result.jnid,\n        syncedAt: new Date()\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n        syncedAt: new Date()\n      };\n    }\n  }\n\n  async uploadDocument(jobId: string, fileName: string, fileData: Buffer): Promise<boolean> {\n    try {\n      const formData = new FormData();\n      formData.append('file', new Blob([fileData]), fileName);\n      formData.append('related_id', jobId);\n      formData.append('related_type', 'job');\n\n      const response = await fetch(`${this.config.baseUrl}/files`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`\n        },\n        body: formData\n      });\n\n      return response.ok;\n    } catch (error) {\n      console.error('JobNimbus document upload error:', error);\n      return false;\n    }\n  }\n}\n\n// Salesforce Integration\nclass SalesforceIntegration {\n  private config: CRMConfig;\n\n  constructor(config: CRMConfig) {\n    this.config = config;\n  }\n\n  async createContact(contact: CRMContact): Promise<CRMSyncResult> {\n    try {\n      const response = await fetch(`${this.config.baseUrl}/services/data/v58.0/sobjects/Contact`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          FirstName: contact.firstName,\n          LastName: contact.lastName,\n          Email: contact.email,\n          Phone: contact.phone,\n          MailingStreet: contact.address?.street,\n          MailingCity: contact.address?.city,\n          MailingState: contact.address?.state,\n          MailingPostalCode: contact.address?.zipCode,\n          Description: contact.company ? `Company: ${contact.company}` : undefined,\n          ...contact.customFields\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(`Salesforce API error: ${response.statusText} - ${JSON.stringify(errorData)}`);\n      }\n\n      const result = await response.json();\n      \n      return {\n        success: true,\n        contactId: result.id,\n        syncedAt: new Date()\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n        syncedAt: new Date()\n      };\n    }\n  }\n\n  async createJob(job: CRMJob): Promise<CRMSyncResult> {\n    try {\n      // Salesforce uses Opportunities for deals/jobs\n      const response = await fetch(`${this.config.baseUrl}/services/data/v58.0/sobjects/Opportunity`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          Name: job.name,\n          StageName: this.mapStatusToSalesforceStage(job.status),\n          Amount: job.estimatedValue,\n          Description: job.notes,\n          CloseDate: job.scheduledDate?.toISOString().split('T')[0] || new Date().toISOString().split('T')[0],\n          Type: job.type,\n          ...job.customFields\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(`Salesforce API error: ${response.statusText} - ${JSON.stringify(errorData)}`);\n      }\n\n      const result = await response.json();\n      \n      // Link contact to opportunity via OpportunityContactRole\n      if (job.contactId) {\n        await this.linkContactToOpportunity(result.id, job.contactId);\n      }\n      \n      return {\n        success: true,\n        jobId: result.id,\n        syncedAt: new Date()\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n        syncedAt: new Date()\n      };\n    }\n  }\n\n  private async linkContactToOpportunity(opportunityId: string, contactId: string): Promise<void> {\n    try {\n      await fetch(`${this.config.baseUrl}/services/data/v58.0/sobjects/OpportunityContactRole`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          OpportunityId: opportunityId,\n          ContactId: contactId,\n          IsPrimary: true,\n          Role: 'Decision Maker'\n        })\n      });\n    } catch (error) {\n      console.error('Failed to link contact to opportunity:', error);\n    }\n  }\n\n  private mapStatusToSalesforceStage(status: string): string {\n    const stageMap: Record<string, string> = {\n      'New': 'Prospecting',\n      'In Progress': 'Qualification',\n      'Pending': 'Needs Analysis',\n      'Completed': 'Closed Won',\n      'Cancelled': 'Closed Lost'\n    };\n    return stageMap[status] || 'Qualification';\n  }\n\n  async uploadDocument(jobId: string, fileName: string, fileData: Buffer): Promise<boolean> {\n    try {\n      // Create ContentVersion (file) in Salesforce\n      const base64Data = fileData.toString('base64');\n      \n      const response = await fetch(`${this.config.baseUrl}/services/data/v58.0/sobjects/ContentVersion`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          Title: fileName.replace('.pdf', ''),\n          PathOnClient: fileName,\n          VersionData: base64Data,\n          FirstPublishLocationId: jobId\n        })\n      });\n\n      return response.ok;\n    } catch (error) {\n      console.error('Salesforce document upload error:', error);\n      return false;\n    }\n  }\n}\n\n// HubSpot Integration\nclass HubSpotIntegration {\n  private config: CRMConfig;\n\n  constructor(config: CRMConfig) {\n    this.config = config;\n  }\n\n  async createContact(contact: CRMContact): Promise<CRMSyncResult> {\n    try {\n      const response = await fetch(`${this.config.baseUrl}/crm/v3/objects/contacts`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          properties: {\n            firstname: contact.firstName,\n            lastname: contact.lastName,\n            email: contact.email,\n            phone: contact.phone,\n            company: contact.company,\n            address: contact.address?.street,\n            city: contact.address?.city,\n            state: contact.address?.state,\n            zip: contact.address?.zipCode,\n            ...contact.customFields\n          }\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(`HubSpot API error: ${response.statusText} - ${JSON.stringify(errorData)}`);\n      }\n\n      const result = await response.json();\n      \n      return {\n        success: true,\n        contactId: result.id,\n        syncedAt: new Date()\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n        syncedAt: new Date()\n      };\n    }\n  }\n\n  async createJob(job: CRMJob): Promise<CRMSyncResult> {\n    try {\n      // HubSpot uses Deals for jobs/opportunities\n      const response = await fetch(`${this.config.baseUrl}/crm/v3/objects/deals`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          properties: {\n            dealname: job.name,\n            dealstage: this.mapStatusToHubSpotStage(job.status),\n            amount: job.estimatedValue?.toString(),\n            description: job.notes,\n            closedate: job.scheduledDate?.toISOString(),\n            pipeline: 'default',\n            ...job.customFields\n          }\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(`HubSpot API error: ${response.statusText} - ${JSON.stringify(errorData)}`);\n      }\n\n      const result = await response.json();\n      \n      // Associate deal with contact\n      if (job.contactId) {\n        await this.associateDealWithContact(result.id, job.contactId);\n      }\n      \n      return {\n        success: true,\n        jobId: result.id,\n        syncedAt: new Date()\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n        syncedAt: new Date()\n      };\n    }\n  }\n\n  private async associateDealWithContact(dealId: string, contactId: string): Promise<void> {\n    try {\n      await fetch(`${this.config.baseUrl}/crm/v4/objects/deals/${dealId}/associations/contacts/${contactId}`, {\n        method: 'PUT',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify([{\n          associationCategory: 'HUBSPOT_DEFINED',\n          associationTypeId: 3 // Deal to Contact\n        }])\n      });\n    } catch (error) {\n      console.error('Failed to associate deal with contact:', error);\n    }\n  }\n\n  private mapStatusToHubSpotStage(status: string): string {\n    const stageMap: Record<string, string> = {\n      'New': 'appointmentscheduled',\n      'In Progress': 'qualifiedtobuy',\n      'Pending': 'presentationscheduled',\n      'Completed': 'closedwon',\n      'Cancelled': 'closedlost'\n    };\n    return stageMap[status] || 'qualifiedtobuy';\n  }\n\n  async uploadDocument(jobId: string, fileName: string, fileData: Buffer): Promise<boolean> {\n    try {\n      // HubSpot file upload through Files API\n      const formData = new FormData();\n      formData.append('file', new Blob([fileData], { type: 'application/pdf' }), fileName);\n      formData.append('options', JSON.stringify({\n        access: 'PRIVATE',\n        ttl: 'P12M',\n        overwrite: false,\n        duplicateValidationStrategy: 'NONE',\n        duplicateValidationScope: 'EXACT_FOLDER'\n      }));\n      formData.append('folderPath', '/winn-reports');\n\n      const uploadResponse = await fetch(`${this.config.baseUrl}/files/v3/files`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`\n        },\n        body: formData\n      });\n\n      if (!uploadResponse.ok) return false;\n\n      const fileResult = await uploadResponse.json();\n\n      // Create engagement/note with file attachment on deal\n      await fetch(`${this.config.baseUrl}/crm/v3/objects/notes`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          properties: {\n            hs_note_body: `Winn Report attached: ${fileName}`,\n            hs_attachment_ids: fileResult.id\n          },\n          associations: [{\n            to: { id: jobId },\n            types: [{ associationCategory: 'HUBSPOT_DEFINED', associationTypeId: 214 }]\n          }]\n        })\n      });\n\n      return true;\n    } catch (error) {\n      console.error('HubSpot document upload error:', error);\n      return false;\n    }\n  }\n}\n\n// Pipedrive Integration\nclass PipedriveIntegration {\n  private config: CRMConfig;\n\n  constructor(config: CRMConfig) {\n    this.config = config;\n  }\n\n  async createContact(contact: CRMContact): Promise<CRMSyncResult> {\n    try {\n      // Pipedrive uses \"persons\" for contacts\n      const response = await fetch(`${this.config.baseUrl}/persons?api_token=${this.config.apiKey}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          name: `${contact.firstName} ${contact.lastName}`,\n          email: [{ value: contact.email, primary: true }],\n          phone: [{ value: contact.phone, primary: true }],\n          org_id: contact.company ? undefined : undefined, // Would need org lookup\n          visible_to: 3, // Shared with everyone\n          ...contact.customFields\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(`Pipedrive API error: ${response.statusText} - ${JSON.stringify(errorData)}`);\n      }\n\n      const result = await response.json();\n      \n      return {\n        success: true,\n        contactId: result.data.id.toString(),\n        syncedAt: new Date()\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n        syncedAt: new Date()\n      };\n    }\n  }\n\n  async createJob(job: CRMJob): Promise<CRMSyncResult> {\n    try {\n      // Pipedrive uses \"deals\" for jobs/opportunities\n      const response = await fetch(`${this.config.baseUrl}/deals?api_token=${this.config.apiKey}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          title: job.name,\n          person_id: parseInt(job.contactId),\n          value: job.estimatedValue,\n          currency: 'USD',\n          status: this.mapStatusToPipedriveStatus(job.status),\n          expected_close_date: job.scheduledDate?.toISOString().split('T')[0],\n          visible_to: 3,\n          ...job.customFields\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(`Pipedrive API error: ${response.statusText} - ${JSON.stringify(errorData)}`);\n      }\n\n      const result = await response.json();\n      \n      // Add note with job details\n      if (job.notes) {\n        await this.addNoteToDeal(result.data.id, job.notes);\n      }\n      \n      return {\n        success: true,\n        jobId: result.data.id.toString(),\n        syncedAt: new Date()\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n        syncedAt: new Date()\n      };\n    }\n  }\n\n  private async addNoteToDeal(dealId: number, content: string): Promise<void> {\n    try {\n      await fetch(`${this.config.baseUrl}/notes?api_token=${this.config.apiKey}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          content: content,\n          deal_id: dealId\n        })\n      });\n    } catch (error) {\n      console.error('Failed to add note to deal:', error);\n    }\n  }\n\n  private mapStatusToPipedriveStatus(status: string): string {\n    const statusMap: Record<string, string> = {\n      'New': 'open',\n      'In Progress': 'open',\n      'Pending': 'open',\n      'Completed': 'won',\n      'Cancelled': 'lost'\n    };\n    return statusMap[status] || 'open';\n  }\n\n  async uploadDocument(jobId: string, fileName: string, fileData: Buffer): Promise<boolean> {\n    try {\n      const formData = new FormData();\n      formData.append('file', new Blob([fileData], { type: 'application/pdf' }), fileName);\n      formData.append('deal_id', jobId);\n\n      const response = await fetch(`${this.config.baseUrl}/files?api_token=${this.config.apiKey}`, {\n        method: 'POST',\n        body: formData\n      });\n\n      return response.ok;\n    } catch (error) {\n      console.error('Pipedrive document upload error:', error);\n      return false;\n    }\n  }\n}\n\n// GoHighLevel Integration\nclass GoHighLevelIntegration {\n  private config: CRMConfig;\n\n  constructor(config: CRMConfig) {\n    this.config = config;\n  }\n\n  async createContact(contact: CRMContact): Promise<CRMSyncResult> {\n    try {\n      const response = await fetch(`${this.config.baseUrl}/contacts/`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          firstName: contact.firstName,\n          lastName: contact.lastName,\n          email: contact.email,\n          phone: contact.phone,\n          companyName: contact.company,\n          address1: contact.address?.street,\n          city: contact.address?.city,\n          state: contact.address?.state,\n          postalCode: contact.address?.zipCode,\n          customFields: contact.customFields\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`GoHighLevel API error: ${response.statusText}`);\n      }\n\n      const result = await response.json();\n      \n      return {\n        success: true,\n        contactId: result.contact.id,\n        syncedAt: new Date()\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n        syncedAt: new Date()\n      };\n    }\n  }\n\n  async createOpportunity(job: CRMJob): Promise<CRMSyncResult> {\n    try {\n      const response = await fetch(`${this.config.baseUrl}/opportunities/`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          title: job.name,\n          contactId: job.contactId,\n          status: job.status,\n          monetaryValue: job.estimatedValue,\n          notes: job.notes,\n          customFields: job.customFields\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`GoHighLevel API error: ${response.statusText}`);\n      }\n\n      const result = await response.json();\n      \n      return {\n        success: true,\n        jobId: result.opportunity.id,\n        syncedAt: new Date()\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n        syncedAt: new Date()\n      };\n    }\n  }\n}\n\n// CRM Integration Manager\nexport class CRMIntegrationManager {\n  private integrations: Map<string, any> = new Map();\n\n  addIntegration(name: string, config: CRMConfig) {\n    switch (config.type) {\n      case 'jobnimbus':\n        this.integrations.set(name, new JobNimbusIntegration(config));\n        break;\n      case 'gohighlevel':\n        this.integrations.set(name, new GoHighLevelIntegration(config));\n        break;\n      case 'salesforce':\n        this.integrations.set(name, new SalesforceIntegration(config));\n        break;\n      case 'hubspot':\n        this.integrations.set(name, new HubSpotIntegration(config));\n        break;\n      case 'pipedrive':\n        this.integrations.set(name, new PipedriveIntegration(config));\n        break;\n      default:\n        throw new Error(`Unsupported CRM type: ${config.type}`);\n    }\n  }\n\n  async syncPropertyToCRM(\n    crmName: string, \n    property: Property, \n    scan: Scan, \n    ownerInfo: CRMContact\n  ): Promise<CRMSyncResult[]> {\n    const integration = this.integrations.get(crmName);\n    if (!integration) {\n      throw new Error(`CRM integration '${crmName}' not found`);\n    }\n\n    const results: CRMSyncResult[] = [];\n\n    // Create or update contact\n    const contactResult = await integration.createContact(ownerInfo);\n    results.push(contactResult);\n\n    if (contactResult.success && contactResult.contactId) {\n      // Create job for thermal inspection\n      const issues = scan.issues || [];\n      const criticalCount = issues.filter(i => i.severity === 'critical').length;\n      \n      const job: CRMJob = {\n        id: '',\n        contactId: contactResult.contactId,\n        name: `Thermal Roof Inspection - ${property.name}`,\n        type: 'Thermal Inspection',\n        status: 'In Progress',\n        address: property.address,\n        estimatedValue: this.calculateInspectionValue(scan),\n        notes: `Thermal inspection completed on ${scan.date.toLocaleDateString()}. Issues found: ${issues.length}`,\n        scheduledDate: scan.date,\n        customFields: {\n          property_id: property.id.toString(),\n          scan_id: scan.id.toString(),\n          condition: property.overallCondition || 'unknown',\n          critical_issues: criticalCount.toString()\n        }\n      };\n\n      const jobResult = await integration.createJob(job);\n      results.push(jobResult);\n    }\n\n    return results;\n  }\n\n  async syncReportToCRM(\n    crmName: string,\n    jobId: string,\n    reportPdf: Buffer,\n    fileName: string\n  ): Promise<boolean> {\n    const integration = this.integrations.get(crmName);\n    if (!integration || !integration.uploadDocument) {\n      return false;\n    }\n\n    return await integration.uploadDocument(jobId, fileName, reportPdf);\n  }\n\n  private calculateInspectionValue(scan: Scan): number {\n    // Base inspection fee\n    let value = 2500;\n    \n    // Add value based on issues found\n    const issues = scan.issues || [];\n    const criticalIssues = issues.filter(i => i.severity === 'critical').length;\n    const warningIssues = issues.filter(i => i.severity === 'warning').length;\n    \n    value += criticalIssues * 500; // $500 per critical issue for follow-up\n    value += warningIssues * 250;  // $250 per warning issue for follow-up\n    \n    return value;\n  }\n}\n\n// Export singleton instance\nexport const crmManager = new CRMIntegrationManager();","path":null,"size_bytes":24122,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/pages/report.tsx":{"content":"import { useParams, useLocation } from 'wouter';\nimport { useQuery } from '@tanstack/react-query';\nimport { Header, Footer } from '@/components/navbar';\nimport { ReportPreview } from '@/components/report-preview';\nimport {\n  ArrowLeft,\n} from 'lucide-react';\nimport { Scan, Property } from '@shared/schema';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useMutation } from '@tanstack/react-query';\nimport { apiRequestRaw, queryClient } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\n\nconst Report = () => {\n  const params = useParams();\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const scanId = params.id;\n\n  const { data: scan, isLoading: isScanLoading } = useQuery<Scan>({\n    queryKey: [`/api/scans/${scanId}`],\n  });\n\n  const { data: property, isLoading: isPropertyLoading } = useQuery<Property>({\n    queryKey: [`/api/properties/${scan?.propertyId}`],\n    enabled: !!scan?.propertyId,\n  });\n\n  const isLoading = isScanLoading || isPropertyLoading;\n\n  const sendReportMutation = useMutation({\n    mutationFn: async (email: string) => {\n      const res = await apiRequestRaw('POST', `/api/reports/send/${scanId}`, { email });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/scans/${scanId}`] });\n    },\n    onError: (error) => {\n      toast({\n        title: 'Failed to send report',\n        description: error.message || 'There was an error sending the report',\n        variant: 'destructive',\n      });\n    }\n  });\n\n  const downloadReportMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(`/api/reports/download/${scanId}`, {\n        method: 'GET',\n        credentials: 'include',\n      });\n      \n      if (!res.ok) {\n        throw new Error('Failed to download report');\n      }\n      \n      const blob = await res.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      const disposition = res.headers.get('Content-Disposition');\n      const filename = disposition?.match(/filename=\"(.+)\"/)?.[1] || 'WinnReport.pdf';\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n      \n      return true;\n    },\n    onSuccess: () => {\n      toast({\n        title: 'Report downloaded',\n        description: 'Your Winn Report PDF has been downloaded successfully.',\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: 'Failed to download report',\n        description: error.message || 'There was an error downloading the report',\n        variant: 'destructive',\n      });\n    }\n  });\n\n  const handleSendReport = (email: string) => {\n    sendReportMutation.mutate(email);\n  };\n\n  const handleDownloadReport = () => {\n    downloadReportMutation.mutate();\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative\">\n      <Header />\n      \n      <main className=\"flex-grow pb-20\">\n        <div className=\"p-4\">\n          <div className=\"flex items-center mb-4\">\n            <button className=\"mr-2\" onClick={() => navigate(`/analysis/${scanId}`)}>\n              <ArrowLeft className=\"text-neutral-dark\" />\n            </button>\n            <div>\n              <h2 className=\"text-xl font-semibold text-neutral-darker\">Report Generator</h2>\n              <p className=\"text-neutral-dark text-sm\">Customize and generate client report</p>\n            </div>\n          </div>\n\n          {isLoading ? (\n            <>\n              <Skeleton className=\"w-full h-96 mb-6\" />\n              <div className=\"grid grid-cols-2 gap-4\">\n                <Skeleton className=\"h-12 w-full\" />\n                <Skeleton className=\"h-12 w-full\" />\n              </div>\n            </>\n          ) : (\n            property && scan && (\n              <ReportPreview \n                property={property} \n                scan={scan} \n                onSend={handleSendReport}\n                onDownload={handleDownloadReport}\n              />\n            )\n          )}\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n};\n\nexport default Report;\n","path":null,"size_bytes":4224,"size_tokens":null},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp, jsonb, doublePrecision } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// User Schema - Updated for WinnStorm™ Consultant Management\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\"),\n  role: text(\"role\"), // 'junior_consultant', 'senior_consultant', 'admin', 'client'\n  firstName: text(\"first_name\"),\n  lastName: text(\"last_name\"),\n  phone: text(\"phone\"),\n  certificationLevel: text(\"certification_level\"), // 'junior', 'senior', 'none'\n  certificationDate: timestamp(\"certification_date\"),\n  certificationExpiry: timestamp(\"certification_expiry\"),\n  inspectionHours: integer(\"inspection_hours\").default(0),\n  approvedDARs: integer(\"approved_dars\").default(0),\n  trainingProgress: jsonb(\"training_progress\").$type<TrainingProgress>(),\n  performanceMetrics: jsonb(\"performance_metrics\").$type<PerformanceMetrics>(),\n  onboardingCompleted: boolean(\"onboarding_completed\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  email: true,\n  password: true,\n  role: true,\n  firstName: true,\n  lastName: true,\n  phone: true,\n  certificationLevel: true,\n});\n\n// Client Schema for WinnStorm™ CRM\nexport const clients = pgTable(\"clients\", {\n  id: serial(\"id\").primaryKey(),\n  companyName: text(\"company_name\").notNull(),\n  contactPerson: text(\"contact_person\").notNull(),\n  phone: text(\"phone\").notNull(),\n  email: text(\"email\").notNull(),\n  address: text(\"address\"),\n  city: text(\"city\"),\n  state: text(\"state\"),\n  zipCode: text(\"zip_code\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  userId: integer(\"user_id\").references(() => users.id), // Consultant who added client\n});\n\n// Project Schema - Core project management for damage assessments\nexport const projects = pgTable(\"projects\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: text(\"project_id\").notNull().unique(), // Custom project identifier\n  clientId: integer(\"client_id\").references(() => clients.id).notNull(),\n  propertyAddress: text(\"property_address\").notNull(),\n  lossType: text(\"loss_type\").notNull(), // 'hail', 'wind', 'hurricane', 'flood', etc.\n  dateOfLoss: timestamp(\"date_of_loss\").notNull(),\n  inspectionDate: timestamp(\"inspection_date\"),\n  reportDueDate: timestamp(\"report_due_date\"),\n  submissionDate: timestamp(\"submission_date\"),\n  approvalDate: timestamp(\"approval_date\"),\n  status: text(\"status\").notNull(), // 'prospecting', 'inspection_scheduled', 'report_draft', 'submitted_to_insurance', 'approved', 'denied', 'completed'\n  estimatedValue: integer(\"estimated_value\"), // in cents\n  approvedAmount: integer(\"approved_amount\"), // in cents\n  assignedConsultantId: integer(\"assigned_consultant_id\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Property Schema - Updated for WinnStorm™ damage assessment\nexport const properties = pgTable(\"properties\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => projects.id),\n  name: text(\"name\").notNull(),\n  address: text(\"address\").notNull(),\n  buildingInfo: jsonb(\"building_info\").$type<BuildingInformation>(),\n  roofSystemDetails: jsonb(\"roof_system_details\").$type<RoofSystemDetails>(),\n  imageUrl: text(\"image_url\"),\n  overallCondition: text(\"overall_condition\"), // 'excellent', 'good', 'fair', 'poor', 'critical'\n  lastInspectionDate: timestamp(\"last_inspection_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  userId: integer(\"user_id\").references(() => users.id),\n});\n\nexport const insertClientSchema = createInsertSchema(clients).pick({\n  companyName: true,\n  contactPerson: true,\n  phone: true,\n  email: true,\n  address: true,\n  city: true,\n  state: true,\n  zipCode: true,\n  userId: true,\n});\n\nexport const insertProjectSchema = createInsertSchema(projects).pick({\n  projectId: true,\n  clientId: true,\n  propertyAddress: true,\n  lossType: true,\n  dateOfLoss: true,\n  inspectionDate: true,\n  reportDueDate: true,\n  status: true,\n  estimatedValue: true,\n  assignedConsultantId: true,\n});\n\nexport const insertPropertySchema = createInsertSchema(properties).pick({\n  projectId: true,\n  name: true,\n  address: true,\n  buildingInfo: true,\n  roofSystemDetails: true,\n  imageUrl: true,\n  overallCondition: true,\n  userId: true,\n});\n\n// Scans Schema - Thermal and inspection data\nexport const scans = pgTable(\"scans\", {\n  id: serial(\"id\").primaryKey(),\n  propertyId: integer(\"property_id\").references(() => properties.id).notNull(),\n  date: timestamp(\"date\").notNull(),\n  scanType: text(\"scan_type\").notNull(), // 'drone', 'handheld', 'terrestrial'\n  deviceType: text(\"device_type\"),\n  standardImageUrl: text(\"standard_image_url\"),\n  thermalImageUrl: text(\"thermal_image_url\"),\n  healthScore: integer(\"health_score\"),\n  metrics: jsonb(\"metrics\").$type<Metric[]>(),\n  issues: jsonb(\"issues\").$type<Issue[]>(),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  userId: integer(\"user_id\").references(() => users.id),\n});\n\nexport const insertScanSchema = createInsertSchema(scans).pick({\n  propertyId: true,\n  date: true,\n  scanType: true,\n  deviceType: true,\n  standardImageUrl: true,\n  thermalImageUrl: true,\n  healthScore: true,\n  metrics: true,\n  issues: true,\n  notes: true,\n  userId: true,\n});\n\n// Training Courses Schema for WinnStorm™ Certification\nexport const trainingCourses = pgTable(\"training_courses\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  day: text(\"day\"), // 'orientation', 'day1', 'day2', etc.\n  subject: text(\"subject\"), // 'technology', 'inspections', 'sales', 'insurance', etc.\n  contentType: text(\"content_type\"), // 'video', 'text', 'document', 'external_link'\n  contentUrl: text(\"content_url\"),\n  duration: integer(\"duration\"), // in minutes\n  requiredForCertification: boolean(\"required_for_certification\").default(false),\n  certificationLevel: text(\"certification_level\"), // 'junior', 'senior', 'both'\n  orderIndex: integer(\"order_index\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Training Quizzes Schema\nexport const trainingQuizzes = pgTable(\"training_quizzes\", {\n  id: serial(\"id\").primaryKey(),\n  courseId: integer(\"course_id\").references(() => trainingCourses.id),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  passingScore: integer(\"passing_score\").default(85), // percentage\n  questions: jsonb(\"questions\").$type<QuizQuestion[]>().notNull(),\n  timeLimit: integer(\"time_limit\"), // in minutes\n  maxAttempts: integer(\"max_attempts\").default(3),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User Training Progress Schema\nexport const userTrainingProgress = pgTable(\"user_training_progress\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  courseId: integer(\"course_id\").references(() => trainingCourses.id).notNull(),\n  quizId: integer(\"quiz_id\").references(() => trainingQuizzes.id),\n  status: text(\"status\").notNull(), // 'not_started', 'in_progress', 'completed', 'failed'\n  score: integer(\"score\"), // percentage for quizzes\n  attempts: integer(\"attempts\").default(0),\n  startedAt: timestamp(\"started_at\"),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Damage Assessment Reports Schema - Core WinnStorm™ functionality\nexport const damageAssessments = pgTable(\"damage_assessments\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => projects.id).notNull(),\n  propertyId: integer(\"property_id\").references(() => properties.id).notNull(),\n  inspectionDate: timestamp(\"inspection_date\").notNull(),\n  inspectorId: integer(\"inspector_id\").references(() => users.id).notNull(),\n  reportType: text(\"report_type\").notNull(), // 'initial_dar', 'v2_comprehensive_dar', 'proof_of_loss', 'winn_report'\n  weatherData: jsonb(\"weather_data\").$type<WeatherVerificationData>(),\n  thermalData: jsonb(\"thermal_data\").$type<ThermalInspectionData>(),\n  terrestrialWalk: jsonb(\"terrestrial_walk\").$type<TerrestrialWalkData>(),\n  testSquares: jsonb(\"test_squares\").$type<TestSquareData[]>(),\n  softMetals: jsonb(\"soft_metals\").$type<SoftMetalData[]>(),\n  moistureTests: jsonb(\"moisture_tests\").$type<MoistureTestData[]>(),\n  coreSamples: jsonb(\"core_samples\").$type<CoreSampleData[]>(),\n  damageFindings: jsonb(\"damage_findings\").$type<DamageFindings>(),\n  repairAnalysis: jsonb(\"repair_analysis\").$type<RepairAnalysis>(),\n  codeCompliance: jsonb(\"code_compliance\").$type<CodeComplianceData>(),\n  photos: jsonb(\"photos\").$type<AssessmentPhotos>(),\n  status: text(\"status\").notNull(), // 'in_progress', 'review', 'completed', 'submitted'\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Insert schemas for the new tables\nexport const insertTrainingCourseSchema = createInsertSchema(trainingCourses).pick({\n  title: true,\n  description: true,\n  day: true,\n  subject: true,\n  contentType: true,\n  contentUrl: true,\n  duration: true,\n  requiredForCertification: true,\n  certificationLevel: true,\n  orderIndex: true,\n});\n\nexport const insertTrainingQuizSchema = createInsertSchema(trainingQuizzes).pick({\n  courseId: true,\n  title: true,\n  description: true,\n  passingScore: true,\n  questions: true,\n  timeLimit: true,\n  maxAttempts: true,\n});\n\nexport const insertUserTrainingProgressSchema = createInsertSchema(userTrainingProgress).pick({\n  userId: true,\n  courseId: true,\n  quizId: true,\n  status: true,\n  score: true,\n  attempts: true,\n  startedAt: true,\n  completedAt: true,\n});\n\nexport const insertDamageAssessmentSchema = createInsertSchema(damageAssessments).pick({\n  projectId: true,\n  propertyId: true,\n  inspectionDate: true,\n  inspectorId: true,\n  reportType: true,\n  weatherData: true,\n  thermalData: true,\n  terrestrialWalk: true,\n  testSquares: true,\n  softMetals: true,\n  moistureTests: true,\n  coreSamples: true,\n  damageFindings: true,\n  repairAnalysis: true,\n  codeCompliance: true,\n  photos: true,\n  status: true,\n});\n\n// Report Schema\nexport const reports = pgTable(\"reports\", {\n  id: serial(\"id\").primaryKey(),\n  scanId: integer(\"scan_id\").references(() => scans.id).notNull(),\n  title: text(\"title\").notNull(),\n  pdfUrl: text(\"pdf_url\"),\n  sentTo: text(\"sent_to\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  userId: integer(\"user_id\").references(() => users.id),\n});\n\nexport const insertReportSchema = createInsertSchema(reports).pick({\n  scanId: true,\n  title: true,\n  pdfUrl: true,\n  sentTo: true,\n  userId: true,\n});\n\n// Basic scan data types\nexport interface Metric {\n  name: string;\n  value: number;\n}\n\nexport interface Issue {\n  title: string;\n  description: string;\n  severity: 'info' | 'warning' | 'critical';\n}\n\n// WinnStorm™ Training and Assessment Types\nexport interface TrainingProgress {\n  coursesCompleted: number;\n  totalCourses: number;\n  quizzesPassed: number;\n  totalQuizzes: number;\n  currentLevel: 'junior' | 'senior';\n  certificationEligible: boolean;\n}\n\nexport interface PerformanceMetrics {\n  inspectionHours: number;\n  approvedDARs: number;\n  averageReportQuality: number;\n  clientSatisfaction: number;\n  revenueGenerated: number;\n  conversionRate: number;\n}\n\nexport interface QuizQuestion {\n  id: string;\n  question: string;\n  type: 'multiple_choice' | 'true_false' | 'short_answer';\n  options?: string[];\n  correctAnswer: string;\n  explanation?: string;\n  points: number;\n}\n\n// Weather Verification Data - Core WinnStorm™ requirement\nexport interface WeatherVerificationData {\n  hailTraceData: HailTraceData;\n  noaaData: NOAAData;\n  newsReports: NewsReport[];\n  socialMediaReports: SocialMediaReport[];\n  ownerPhotos: string[];\n  hailReconData: HailReconData;\n  verificationTier: 'tier1_verified_spotter' | 'meteorologist_verified' | 'impact_report_ai';\n  verificationSources: string[];\n}\n\nexport interface HailTraceData {\n  stormDate: string;\n  stormPath: string;\n  maxHailSize: number;\n  windSpeed: number;\n  verifiedSpotter: boolean;\n  reportId: string;\n}\n\nexport interface NOAAData {\n  stormReportId: string;\n  location: string;\n  hailSize: number;\n  windSpeed: number;\n  reportTime: string;\n  verification: string;\n}\n\nexport interface NewsReport {\n  source: string;\n  headline: string;\n  date: string;\n  url: string;\n  relevantQuotes: string[];\n}\n\nexport interface SocialMediaReport {\n  platform: string;\n  postUrl: string;\n  content: string;\n  images: string[];\n  timestamp: string;\n  verification: string;\n}\n\nexport interface HailReconData {\n  reportId: string;\n  location: string;\n  hailSize: number;\n  confidence: number;\n  radarData: string;\n}\n\n// Thermal Inspection Data\nexport interface ThermalInspectionData {\n  thermalLoadObservations: string[];\n  dryRoofStatus: boolean;\n  moistureMapMosaic: string; // URL to thermal image\n  irxMap: string; // URL to IRX map\n  emissivitySettings: number;\n  thermalOrthoMaps: string[];\n  flightPlans: string[];\n  temperatureReadings: ThermalReading[];\n}\n\n// Terrestrial Walk Data\nexport interface TerrestrialWalkData {\n  buildingLabels: BuildingLabel[];\n  moistureAreas: MoistureArea[];\n  featureMarkers: FeatureMarker[];\n  damageMarkers: DamageMarker[];\n  walkPath: string; // GPS coordinates or route description\n}\n\nexport interface BuildingLabel {\n  id: string;\n  label: string; // e.g., \"#1\", \"#2\", \"R17\", \"R18\"\n  coordinates: { x: number; y: number };\n  sectionType: string;\n}\n\nexport interface MoistureArea {\n  id: string;\n  coordinates: { x: number; y: number };\n  size: string; // e.g., \"2'x2'\"\n  severity: 'low' | 'medium' | 'high';\n  arrowDirection: string;\n  paintColor: 'blue';\n}\n\nexport interface FeatureMarker {\n  id: string;\n  coordinates: { x: number; y: number };\n  label: string; // e.g., \"1 HV 1\", \"1 D1\"\n  featureType: 'hvac' | 'drain' | 'vent' | 'electrical' | 'satellite' | 'other';\n  paintColor: 'orange';\n}\n\nexport interface DamageMarker {\n  id: string;\n  coordinates: { x: number; y: number };\n  damageType: 'moisture_entry' | 'hole' | 'damaged_seam' | 'lifted_membrane' | 'flashing_damage' | 'blister' | 'debris_strike';\n  severity: 'minor' | 'moderate' | 'severe';\n  paintColor: 'pink';\n}\n\n// Test Square Data\nexport interface TestSquareData {\n  id: string;\n  location: string;\n  sectionId: string;\n  size: '10x10'; // standard size\n  totalImpacts: number;\n  individualImpacts: ImpactMarker[];\n  photos: string[];\n}\n\nexport interface ImpactMarker {\n  id: string;\n  coordinates: { x: number; y: number };\n  diameter: number; // in inches\n  depth: number; // in inches\n  label: string; // pink L marking\n}\n\n// Soft Metal Data\nexport interface SoftMetalData {\n  id: string;\n  type: 'parapet_cap' | 'coping' | 'flashing' | 'gutter';\n  location: string;\n  squareFootage: number;\n  impactCount: number;\n  impactSizes: number[]; // array of impact diameters\n  copingSize?: string;\n  labelConvention: string;\n  photos: string[];\n}\n\n// Moisture Test Data\nexport interface MoistureTestData {\n  id: string;\n  location: string;\n  sectionId: string;\n  testNumber: number;\n  moisturePercentage: number;\n  testArea: '2x2'; // 2'x2' square\n  labelHeight: '2ft'; // 2ft tall letters\n  tramexReading: number;\n  photos: string[];\n}\n\n// Core Sample Data\nexport interface CoreSampleData {\n  id: string;\n  location: string;\n  sampleArea: '2x2'; // 2'x2' location\n  cutSize: '1x1'; // 1'x1' cut on 3 sides\n  insulationDepth: number;\n  insulationLayers: InsulationLayer[];\n  deckingType: string;\n  prickTest: string;\n  layerPhotos: string[];\n  centerCutPhoto: string;\n  hailImpactPhoto: string;\n  insulationFracturePhoto: string;\n  membraneDamageTop: string;\n  membraneDamageBottom: string;\n  pullTestResults: string;\n  taperDrainage: string;\n}\n\nexport interface InsulationLayer {\n  layerNumber: number;\n  material: string;\n  thickness: number;\n  condition: string;\n  rValue: number;\n}\n\n// Damage Findings\nexport interface DamageFindings {\n  damageType: 'hail' | 'wind' | 'hurricane' | 'flood';\n  roofSystemType: 'metal' | 'mod_bit' | 'epdm' | 'shingle' | 'tpo' | 'pvc';\n  overallCondition: 'no_damage' | 'minor' | 'moderate' | 'severe' | 'total_loss';\n  damageAreas: DamageArea[];\n  impactDensity: number; // impacts per square foot\n  totalDamageSquareFootage: number;\n}\n\nexport interface DamageArea {\n  id: string;\n  location: string;\n  damageType: string;\n  severity: 'minor' | 'moderate' | 'severe';\n  squareFootage: number;\n  description: string;\n  photos: string[];\n}\n\n// Repair Analysis\nexport interface RepairAnalysis {\n  repairFeasibility: 'repair' | 'replace';\n  reasoning: string;\n  waterSaturation: boolean;\n  discontinuedMaterials: boolean;\n  emsRequirements: string[];\n  preLossConditionRestoration: boolean;\n  estimatedRepairCost: number;\n  estimatedReplacementCost: number;\n  recommendation: string;\n}\n\n// Code Compliance Data\nexport interface CodeComplianceData {\n  buildingCodes: BuildingCodeReference[];\n  laws: LegalReference[];\n  statutesOfLimitations: string;\n  manufacturerSpecs: ManufacturerSpec[];\n  technicalBulletins: TechnicalBulletin[];\n  permitHistory: PermitRecord[];\n  foiaRequests: FOIARequest[];\n}\n\nexport interface BuildingCodeReference {\n  code: string;\n  section: string;\n  description: string;\n  relevance: string;\n}\n\nexport interface LegalReference {\n  statute: string;\n  description: string;\n  applicability: string;\n}\n\nexport interface ManufacturerSpec {\n  manufacturer: string;\n  product: string;\n  specification: string;\n  requirement: string;\n}\n\nexport interface TechnicalBulletin {\n  bulletinNumber: string;\n  title: string;\n  relevantSection: string;\n}\n\nexport interface PermitRecord {\n  permitNumber: string;\n  issueDate: string;\n  type: string;\n  description: string;\n  status: string;\n}\n\nexport interface FOIARequest {\n  requestId: string;\n  agency: string;\n  requestDate: string;\n  response: string;\n  documents: string[];\n}\n\n// Assessment Photos\nexport interface AssessmentPhotos {\n  overview: OverviewPhotos;\n  midRange: MidRangePhotos;\n  closeUp: CloseUpPhotos;\n  microscope: MicroscopePhotos;\n  drone: DronePhotos;\n  videos: VideoFiles[];\n}\n\nexport interface OverviewPhotos {\n  fromCenter: string[];\n  fromCorners: string[];\n  testSquareOverview: string[];\n  frontRearBackLeft: string[];\n}\n\nexport interface MidRangePhotos {\n  approaching: string[];\n  closer: string[];\n}\n\nexport interface CloseUpPhotos {\n  individualImpacts: ImpactPhoto[];\n  precisionSquare: string[];\n  zoomed5x: string[];\n  zoomed10x: string[];\n  zoomed15x: string[];\n}\n\nexport interface ImpactPhoto {\n  url: string;\n  impactId: string;\n  measurements: string;\n  annotations: PhotoAnnotation[];\n}\n\nexport interface MicroscopePhotos {\n  impacts: string[];\n  materialDetail: string[];\n}\n\nexport interface DronePhotos {\n  orthoReports: string[];\n  naderTopographical: string[];\n  oblique3DModel: string[];\n  orbitalPerSection: string[];\n}\n\nexport interface VideoFiles {\n  url: string;\n  type: 'inspection' | 'overview' | 'damage_detail';\n  duration: number;\n  description: string;\n}\n\nexport interface PhotoAnnotation {\n  type: 'circle' | 'arrow' | 'label' | 'measurement';\n  color: 'yellow' | 'pink' | 'blue' | 'orange';\n  coordinates: { x: number; y: number };\n  text?: string;\n  measurements?: string;\n}\n\n// Types\nexport type User = typeof users.$inferSelect & {\n  trainingProgress?: TrainingProgress;\n  performanceMetrics?: PerformanceMetrics;\n};\nexport type InsertUser = z.infer<typeof insertUserSchema>;\n\nexport type Client = typeof clients.$inferSelect;\nexport type InsertClient = z.infer<typeof insertClientSchema>;\n\nexport type Project = typeof projects.$inferSelect & {\n  client?: Client;\n  property?: Property;\n  assessments?: DamageAssessment[];\n};\nexport type InsertProject = z.infer<typeof insertProjectSchema>;\n\nexport type Property = typeof properties.$inferSelect & {\n  project?: Project;\n  buildingInfo?: BuildingInformation;\n  roofSystemDetails?: RoofSystemDetails;\n  assessments?: DamageAssessment[];\n};\nexport type InsertProperty = z.infer<typeof insertPropertySchema>;\n\nexport type TrainingCourse = typeof trainingCourses.$inferSelect;\nexport type InsertTrainingCourse = z.infer<typeof insertTrainingCourseSchema>;\n\nexport type TrainingQuiz = typeof trainingQuizzes.$inferSelect & {\n  questions: QuizQuestion[];\n};\nexport type InsertTrainingQuiz = z.infer<typeof insertTrainingQuizSchema>;\n\nexport type UserTrainingProgress = typeof userTrainingProgress.$inferSelect;\nexport type InsertUserTrainingProgress = z.infer<typeof insertUserTrainingProgressSchema>;\n\nexport type DamageAssessment = typeof damageAssessments.$inferSelect & {\n  project?: Project;\n  property?: Property;\n  inspector?: User;\n  weatherData?: WeatherVerificationData;\n  thermalData?: ThermalInspectionData;\n  terrestrialWalk?: TerrestrialWalkData;\n  testSquares?: TestSquareData[];\n  softMetals?: SoftMetalData[];\n  moistureTests?: MoistureTestData[];\n  coreSamples?: CoreSampleData[];\n  damageFindings?: DamageFindings;\n  repairAnalysis?: RepairAnalysis;\n  codeCompliance?: CodeComplianceData;\n  photos?: AssessmentPhotos;\n};\nexport type InsertDamageAssessment = z.infer<typeof insertDamageAssessmentSchema>;\n\n// Comprehensive data structures for Winn reports\nexport interface RoofComponent {\n  id: string;\n  name: string;\n  type: 'membrane' | 'insulation' | 'deck' | 'drainage' | 'flashing' | 'penetration' | 'equipment';\n  condition: 'excellent' | 'good' | 'fair' | 'poor' | 'critical';\n  installDate?: Date;\n  lastInspection?: Date;\n  estimatedLifespan?: number;\n  notes?: string;\n  images?: string[];\n  thermalData?: ThermalReading[];\n}\n\nexport interface ThermalReading {\n  location: string;\n  temperature: number;\n  timestamp: Date;\n  coordinates?: { x: number; y: number };\n  alertLevel: 'normal' | 'caution' | 'warning' | 'critical';\n}\n\nexport interface WeatherCondition {\n  temperature: number;\n  humidity: number;\n  windSpeed: number;\n  precipitation: number;\n  visibility: number;\n  timestamp: Date;\n}\n\nexport interface InspectionMetric {\n  category: string;\n  subcategory: string;\n  name: string;\n  value: number;\n  unit: string;\n  threshold?: number;\n  status: 'pass' | 'fail' | 'caution';\n  location?: string;\n  notes?: string;\n}\n\nexport interface DetailedIssue {\n  id: string;\n  title: string;\n  description: string;\n  severity: 'critical' | 'major' | 'minor' | 'informational';\n  category: string;\n  location: string;\n  coordinates?: { x: number; y: number };\n  component?: string;\n  recommendedAction: string;\n  urgency: 'immediate' | 'short_term' | 'long_term' | 'monitoring';\n  estimatedCost?: number;\n  images?: string[];\n  thermalImages?: string[];\n  discoveredDate: Date;\n  reportedBy: string;\n}\n\n// Roof Section Interface for Google Maps Drawing\nexport interface RoofSection {\n  id: string;\n  number: number;\n  type: 'polygon' | 'rectangle' | 'circle';\n  coordinates: any[];\n  area?: number;\n  label: string;\n  notes: string;\n}\n\n// Additional comprehensive data structures for Winn reports\nexport interface BuildingInformation {\n  address: string;\n  propertyType: 'commercial' | 'residential' | 'industrial' | 'institutional';\n  yearBuilt: number;\n  squareFootage: number;\n  stories: number;\n  occupancy: string;\n  ownerName: string;\n  ownerContact: string;\n  roofSections: RoofSection[];\n}\n\nexport interface RoofSystemDetails {\n  roofType: 'flat' | 'sloped' | 'mixed';\n  primaryMaterial: 'membrane' | 'shingle' | 'metal' | 'tile' | 'other';\n  age: number;\n  condition: 'excellent' | 'good' | 'fair' | 'poor';\n  previousRepairs: string[];\n  warrantyInfo: string;\n}\n\nexport interface RoofWarranty {\n  type: 'material' | 'labor' | 'system';\n  provider: string;\n  startDate: Date;\n  endDate: Date;\n  coverage: string;\n  status: 'active' | 'expired' | 'void';\n}\n\nexport interface RepairHistory {\n  date: Date;\n  description: string;\n  contractor: string;\n  cost: number;\n  warrantyPeriod?: number;\n  documentation?: string[];\n}\n\nexport interface InspectionSection {\n  sectionId: string;\n  name: string;\n  area: number;\n  condition: 'excellent' | 'good' | 'fair' | 'poor' | 'critical';\n  components: RoofComponent[];\n  observations: string[];\n  recommendations: string[];\n  photos: string[];\n  thermalImages: string[];\n}\n\nexport interface CostEstimate {\n  itemDescription: string;\n  quantity: number;\n  unit: string;\n  unitCost: number;\n  totalCost: number;\n  priority: 'immediate' | 'within_1_year' | 'within_5_years' | 'monitoring';\n  laborHours?: number;\n}\n\nexport type Scan = typeof scans.$inferSelect & {\n  metrics: InspectionMetric[];\n  issues: DetailedIssue[];\n  roofComponents: RoofComponent[];\n  weatherConditions: WeatherCondition[];\n  thermalReadings: ThermalReading[];\n};\nexport type InsertScan = z.infer<typeof insertScanSchema>;\n\nexport type Report = typeof reports.$inferSelect;\nexport type InsertReport = z.infer<typeof insertReportSchema>;\n\n// CRM Integration schemas\nexport const crmConfigs = pgTable(\"crm_configs\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  name: text(\"name\").notNull(), // User-defined name for this integration\n  type: text(\"type\").notNull(), // 'jobnimbus', 'gohighlevel', etc.\n  apiKey: text(\"api_key\").notNull(),\n  baseUrl: text(\"base_url\").notNull(),\n  webhookUrl: text(\"webhook_url\"),\n  customFields: jsonb(\"custom_fields\").$type<Record<string, string>>(),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const crmSyncLogs = pgTable(\"crm_sync_logs\", {\n  id: serial(\"id\").primaryKey(),\n  crmConfigId: integer(\"crm_config_id\").notNull().references(() => crmConfigs.id),\n  propertyId: integer(\"property_id\").references(() => properties.id),\n  scanId: integer(\"scan_id\").references(() => scans.id),\n  reportId: integer(\"report_id\").references(() => reports.id),\n  syncType: text(\"sync_type\").notNull(), // 'contact', 'job', 'document'\n  externalId: text(\"external_id\"), // ID in the external CRM\n  status: text(\"status\").notNull(), // 'success', 'failed', 'pending'\n  errorMessage: text(\"error_message\"),\n  syncedAt: timestamp(\"synced_at\").defaultNow(),\n});\n\nexport const insertCrmConfigSchema = createInsertSchema(crmConfigs).pick({\n  name: true,\n  type: true,\n  apiKey: true,\n  baseUrl: true,\n  webhookUrl: true,\n  customFields: true,\n  isActive: true,\n});\n\nexport const insertCrmSyncLogSchema = createInsertSchema(crmSyncLogs).pick({\n  crmConfigId: true,\n  propertyId: true,\n  scanId: true,\n  reportId: true,\n  syncType: true,\n  externalId: true,\n  status: true,\n  errorMessage: true,\n});\n\nexport type CrmConfig = typeof crmConfigs.$inferSelect;\nexport type InsertCrmConfig = z.infer<typeof insertCrmConfigSchema>;\nexport type CrmSyncLog = typeof crmSyncLogs.$inferSelect;\nexport type InsertCrmSyncLog = z.infer<typeof insertCrmSyncLogSchema>;\n\n// Knowledge Base Schema - Eric Winn Methodology Documentation\nexport const knowledgeBase = pgTable(\"knowledge_base\", {\n  id: serial(\"id\").primaryKey(),\n  category: text(\"category\").notNull(), // 'procedure', 'decision_tree', 'terminology', 'best_practice', 'common_mistake'\n  title: text(\"title\").notNull(),\n  content: text(\"content\").notNull(), // Full text content\n  tags: text(\"tags\").array(), // Searchable tags\n  workflowStep: text(\"workflow_step\"), // Maps to inspection workflow steps (weather, thermal, terrestrial, etc.)\n  difficulty: text(\"difficulty\"), // 'beginner', 'intermediate', 'expert'\n  relatedIds: integer(\"related_ids\").array(), // Links to related knowledge entries\n  videoUrl: text(\"video_url\"), // Link to Eric's video demonstrations\n  imageUrls: text(\"image_urls\").array(), // Reference images\n  createdBy: integer(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertKnowledgeBaseSchema = createInsertSchema(knowledgeBase).pick({\n  category: true,\n  title: true,\n  content: true,\n  tags: true,\n  workflowStep: true,\n  difficulty: true,\n  relatedIds: true,\n  videoUrl: true,\n  imageUrls: true,\n  createdBy: true,\n});\n\nexport type KnowledgeBase = typeof knowledgeBase.$inferSelect;\nexport type InsertKnowledgeBase = z.infer<typeof insertKnowledgeBaseSchema>;\n\n// ============================================================================\n// MULTIMODAL INSPECTION COACH - Eric Winn Methodology State Machine\n// ============================================================================\n\n// Winn Methodology Steps (strict sequential order)\nexport const WINN_METHODOLOGY_STEPS = [\n  'weather_verification',\n  'thermal_imaging', \n  'terrestrial_walk',\n  'test_squares',\n  'soft_metals',\n  'moisture_testing',\n  'core_samples',\n  'report_assembly'\n] as const;\n\nexport type WinnMethodologyStep = typeof WINN_METHODOLOGY_STEPS[number];\n\n// Step requirements and gating rules\nexport interface StepRequirements {\n  minPhotos: number;\n  requiredFields: string[];\n  aiValidationRequired: boolean;\n  canSkip: boolean;\n  skipReasons?: string[];\n}\n\n// AI validation result for each step\nexport interface AIStepValidation {\n  isValid: boolean;\n  confidence: number;\n  findings: string[];\n  recommendations: string[];\n  warnings: string[];\n  analysisTimestamp: string;\n}\n\n// Evidence Asset - Photos, thermal images, transcripts with GPT analysis\nexport const evidenceAssets = pgTable(\"evidence_assets\", {\n  id: serial(\"id\").primaryKey(),\n  inspectionSessionId: integer(\"inspection_session_id\").notNull(),\n  step: text(\"step\").notNull(), // Which methodology step this evidence belongs to\n  assetType: text(\"asset_type\").notNull(), // 'photo', 'thermal', 'audio', 'transcript', 'document'\n  filename: text(\"filename\").notNull(),\n  fileUrl: text(\"file_url\").notNull(),\n  mimeType: text(\"mime_type\"),\n  fileSize: integer(\"file_size\"),\n  caption: text(\"caption\"),\n  location: text(\"location\"), // GPS or description of where on property\n  aiAnalysis: jsonb(\"ai_analysis\").$type<AIStepValidation>(),\n  rawAiResponse: text(\"raw_ai_response\"), // Full GPT response for debugging\n  metadata: jsonb(\"metadata\").$type<Record<string, any>>(), // Flexible metadata (EXIF, thermal calibration, etc.)\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  uploadedBy: integer(\"uploaded_by\").references(() => users.id),\n});\n\n// Inspection Session - State machine tracking progress through methodology\nexport const inspectionSessions = pgTable(\"inspection_sessions\", {\n  id: serial(\"id\").primaryKey(),\n  propertyId: integer(\"property_id\").references(() => properties.id).notNull(),\n  inspectorId: integer(\"inspector_id\").references(() => users.id).notNull(),\n  \n  // State machine\n  status: text(\"status\").notNull().default('in_progress'), // 'not_started', 'in_progress', 'paused', 'completed', 'abandoned'\n  currentStep: text(\"current_step\").notNull().default('weather_verification'), // Current step in WINN_METHODOLOGY_STEPS\n  \n  // Step completion tracking\n  stepsCompleted: text(\"steps_completed\").array().default([]), // Array of completed step names\n  stepData: jsonb(\"step_data\").$type<Record<WinnMethodologyStep, StepData>>(), // Data collected at each step\n  stepValidations: jsonb(\"step_validations\").$type<Record<WinnMethodologyStep, AIStepValidation>>(), // AI validations per step\n  \n  // Compliance tracking\n  overrides: jsonb(\"overrides\").$type<StepOverride[]>(), // When inspector skips steps with reason\n  complianceScore: integer(\"compliance_score\"), // 0-100 based on methodology adherence\n  \n  // Timing\n  startedAt: timestamp(\"started_at\").defaultNow(),\n  lastActivityAt: timestamp(\"last_activity_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n  \n  // AI coaching context\n  stormyConversation: jsonb(\"stormy_conversation\").$type<ConversationMessage[]>(), // Chat history for context\n  aiRecommendations: text(\"ai_recommendations\").array(), // Current coaching tips\n  \n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Step data collected during inspection\nexport interface StepData {\n  completed: boolean;\n  completedAt?: string;\n  evidenceCount: number;\n  notes: string;\n  findings: string[];\n  measurements?: Record<string, any>; // Step-specific measurements\n}\n\n// Override record when inspector skips a step\nexport interface StepOverride {\n  step: WinnMethodologyStep;\n  reason: string;\n  timestamp: string;\n  approvedBy?: number; // Senior consultant ID if escalated\n}\n\n// Stormy conversation message\nexport interface ConversationMessage {\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: string;\n  step?: WinnMethodologyStep; // Which step this message relates to\n  evidenceRef?: number; // Reference to evidence asset if discussing an image\n}\n\n// Inspector Progress - Long-term performance tracking\nexport const inspectorProgress = pgTable(\"inspector_progress\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  \n  // Aggregate metrics\n  totalInspections: integer(\"total_inspections\").default(0),\n  completedInspections: integer(\"completed_inspections\").default(0),\n  averageComplianceScore: integer(\"average_compliance_score\"),\n  \n  // Per-step proficiency\n  stepProficiency: jsonb(\"step_proficiency\").$type<Record<WinnMethodologyStep, StepProficiency>>(),\n  \n  // Knowledge gaps identified by AI\n  knowledgeGaps: text(\"knowledge_gaps\").array(), // Topics needing improvement\n  recommendedTraining: text(\"recommended_training\").array(), // Course IDs\n  \n  // Achievements\n  certificationsEarned: text(\"certifications_earned\").array(),\n  lastAssessmentDate: timestamp(\"last_assessment_date\"),\n  \n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Proficiency tracking per methodology step\nexport interface StepProficiency {\n  attemptCount: number;\n  averageTimeMinutes: number;\n  aiInterventionCount: number;\n  overrideCount: number;\n  lastAttempt: string;\n  proficiencyLevel: 'novice' | 'learning' | 'competent' | 'proficient' | 'expert';\n}\n\n// Zod schemas for compliance API validation\nexport const recordStepPayloadSchema = z.object({\n  step: z.enum(WINN_METHODOLOGY_STEPS),\n  timeSpentMinutes: z.number().min(0).optional(),\n  aiInterventions: z.number().min(0).optional(),\n  wasOverridden: z.boolean().optional(),\n});\nexport type RecordStepPayload = z.infer<typeof recordStepPayloadSchema>;\n\nexport const recordOverridePayloadSchema = z.object({\n  sessionId: z.string(),\n  step: z.enum(WINN_METHODOLOGY_STEPS),\n  reason: z.string().min(5, 'Override reason must be at least 5 characters'),\n});\nexport type RecordOverridePayload = z.infer<typeof recordOverridePayloadSchema>;\n\n// Limitless Transcript - For ingesting Eric Winn recordings\nexport const limitlessTranscripts = pgTable(\"limitless_transcripts\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  rawTranscript: text(\"raw_transcript\").notNull(), // Full transcript text\n  duration: integer(\"duration\"), // Recording duration in seconds\n  recordingDate: timestamp(\"recording_date\"),\n  \n  // AI-parsed content\n  parsedSegments: jsonb(\"parsed_segments\").$type<TranscriptSegment[]>(),\n  extractedKnowledge: jsonb(\"extracted_knowledge\").$type<ExtractedKnowledge[]>(),\n  \n  // Review status\n  status: text(\"status\").notNull().default('pending'), // 'pending', 'processing', 'reviewed', 'approved', 'rejected'\n  reviewedBy: integer(\"reviewed_by\").references(() => users.id),\n  reviewNotes: text(\"review_notes\"),\n  \n  // Integration\n  knowledgeEntriesCreated: integer(\"knowledge_entries_created\").array(), // IDs of knowledge_base entries created\n  \n  uploadedBy: integer(\"uploaded_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Parsed segment from transcript\nexport interface TranscriptSegment {\n  startTime: number;\n  endTime: number;\n  speaker?: string;\n  text: string;\n  topic?: string; // AI-classified topic\n  methodologyStep?: WinnMethodologyStep; // Which step this relates to\n  confidence: number;\n}\n\n// Knowledge extracted from transcript for review\nexport interface ExtractedKnowledge {\n  category: 'procedure' | 'decision_tree' | 'terminology' | 'best_practice' | 'common_mistake';\n  title: string;\n  content: string;\n  sourceSegments: number[]; // Indices into parsedSegments\n  suggestedTags: string[];\n  suggestedStep: WinnMethodologyStep;\n  confidence: number;\n  approved?: boolean;\n}\n\n// Insert schemas\nexport const insertEvidenceAssetSchema = createInsertSchema(evidenceAssets).pick({\n  inspectionSessionId: true,\n  step: true,\n  assetType: true,\n  filename: true,\n  fileUrl: true,\n  mimeType: true,\n  fileSize: true,\n  caption: true,\n  location: true,\n  aiAnalysis: true,\n  rawAiResponse: true,\n  metadata: true,\n  uploadedBy: true,\n});\n\nexport const insertInspectionSessionSchema = createInsertSchema(inspectionSessions).pick({\n  propertyId: true,\n  inspectorId: true,\n  status: true,\n  currentStep: true,\n});\n\nexport const insertInspectorProgressSchema = createInsertSchema(inspectorProgress).pick({\n  userId: true,\n});\n\nexport const insertLimitlessTranscriptSchema = createInsertSchema(limitlessTranscripts).pick({\n  title: true,\n  rawTranscript: true,\n  duration: true,\n  recordingDate: true,\n  uploadedBy: true,\n});\n\n// ============================================================================\n// SCHEDULED INSPECTIONS\n// ============================================================================\n\nexport interface ScheduledPropertyDetails {\n  estimatedDuration: number;\n  priority: 'low' | 'normal' | 'high' | 'urgent';\n  notes?: string;\n  accessInstructions?: string;\n  contactName?: string;\n  contactPhone?: string;\n}\n\nexport interface RouteOptimizationData {\n  orderIndex: number;\n  distanceFromPrevious?: number;\n  estimatedTravelTime?: number;\n  estimatedArrival?: string;\n}\n\nexport const scheduledInspections = pgTable(\"scheduled_inspections\", {\n  id: serial(\"id\").primaryKey(),\n  propertyId: integer(\"property_id\").references(() => properties.id).notNull(),\n  inspectorId: integer(\"inspector_id\").references(() => users.id).notNull(),\n  scheduledDate: timestamp(\"scheduled_date\").notNull(),\n  scheduledTime: text(\"scheduled_time\"),\n  estimatedDuration: integer(\"estimated_duration\").default(60),\n  status: text(\"status\").notNull().default('scheduled'),\n  priority: text(\"priority\").notNull().default('normal'),\n  notes: text(\"notes\"),\n  accessInstructions: text(\"access_instructions\"),\n  contactName: text(\"contact_name\"),\n  contactPhone: text(\"contact_phone\"),\n  latitude: doublePrecision(\"latitude\"),\n  longitude: doublePrecision(\"longitude\"),\n  routeOptimization: jsonb(\"route_optimization\").$type<RouteOptimizationData>(),\n  reminderSent: boolean(\"reminder_sent\").default(false),\n  completedAt: timestamp(\"completed_at\"),\n  cancelledAt: timestamp(\"cancelled_at\"),\n  cancelReason: text(\"cancel_reason\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertScheduledInspectionSchema = createInsertSchema(scheduledInspections).omit({\n  id: true,\n  routeOptimization: true,\n  reminderSent: true,\n  completedAt: true,\n  cancelledAt: true,\n  cancelReason: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Team Assignments for workload balancing\nexport const teamAssignments = pgTable(\"team_assignments\", {\n  id: serial(\"id\").primaryKey(),\n  inspectorId: integer(\"inspector_id\").references(() => users.id).notNull(),\n  supervisorId: integer(\"supervisor_id\").references(() => users.id),\n  teamName: text(\"team_name\"),\n  region: text(\"region\"),\n  maxDailyInspections: integer(\"max_daily_inspections\").default(4),\n  maxWeeklyInspections: integer(\"max_weekly_inspections\").default(20),\n  skillLevel: text(\"skill_level\").default('standard'),\n  specializations: text(\"specializations\").array().default([]),\n  isAvailable: boolean(\"is_available\").default(true),\n  unavailableUntil: timestamp(\"unavailable_until\"),\n  unavailableReason: text(\"unavailable_reason\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertTeamAssignmentSchema = createInsertSchema(teamAssignments).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Damage Templates for quick application during inspections\nexport interface DamageTemplateRecommendation {\n  action: string;\n  priority: 'immediate' | 'short_term' | 'long_term';\n  estimatedCost?: string;\n}\n\nexport const damageTemplates = pgTable(\"damage_templates\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  category: text(\"category\").notNull(),\n  damageType: text(\"damage_type\").notNull(),\n  description: text(\"description\").notNull(),\n  defaultSeverity: text(\"default_severity\").notNull().default('warning'),\n  affectedComponents: text(\"affected_components\").array().default([]),\n  typicalCauses: text(\"typical_causes\").array().default([]),\n  recommendations: jsonb(\"recommendations\").$type<DamageTemplateRecommendation[]>(),\n  inspectionNotes: text(\"inspection_notes\"),\n  requiredEvidence: text(\"required_evidence\").array().default([]),\n  isActive: boolean(\"is_active\").default(true),\n  sortOrder: integer(\"sort_order\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertDamageTemplateSchema = createInsertSchema(damageTemplates).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Types\nexport type EvidenceAsset = typeof evidenceAssets.$inferSelect;\nexport type InsertEvidenceAsset = z.infer<typeof insertEvidenceAssetSchema>;\nexport type InspectionSession = typeof inspectionSessions.$inferSelect;\nexport type InsertInspectionSession = z.infer<typeof insertInspectionSessionSchema>;\nexport type InspectorProgress = typeof inspectorProgress.$inferSelect;\nexport type InsertInspectorProgress = z.infer<typeof insertInspectorProgressSchema>;\nexport type LimitlessTranscript = typeof limitlessTranscripts.$inferSelect;\nexport type InsertLimitlessTranscript = z.infer<typeof insertLimitlessTranscriptSchema>;\nexport type ScheduledInspection = typeof scheduledInspections.$inferSelect;\nexport type InsertScheduledInspection = z.infer<typeof insertScheduledInspectionSchema>;\nexport type TeamAssignment = typeof teamAssignments.$inferSelect;\nexport type InsertTeamAssignment = z.infer<typeof insertTeamAssignmentSchema>;\nexport type DamageTemplate = typeof damageTemplates.$inferSelect;\nexport type InsertDamageTemplate = z.infer<typeof insertDamageTemplateSchema>;\n\n// AI Conversations - Stormy chat sessions with per-user memory\nexport interface AIMessageAttachment {\n  type: 'image' | 'thermal' | 'document';\n  assetId?: number;\n  url?: string;\n  mimeType?: string;\n  filename?: string;\n}\n\nexport interface AIMemoryPreferences {\n  communicationStyle?: 'technical' | 'simplified' | 'detailed';\n  focusAreas?: string[];\n  propertyProfiles?: Record<string, any>;\n  inspectionHistory?: Array<{\n    inspectionId: number;\n    date: string;\n    summary: string;\n  }>;\n  userPreferences?: Record<string, any>;\n}\n\nexport const aiConversations = pgTable(\"ai_conversations\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull(),\n  title: text(\"title\"),\n  relatedPropertyId: integer(\"related_property_id\").references(() => properties.id),\n  relatedInspectionId: integer(\"related_inspection_id\").references(() => inspectionSessions.id),\n  contextType: text(\"context_type\").default('general'),\n  status: text(\"status\").notNull().default('active'),\n  messageCount: integer(\"message_count\").default(0),\n  lastMessageAt: timestamp(\"last_message_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertAIConversationSchema = createInsertSchema(aiConversations).omit({\n  id: true,\n  messageCount: true,\n  lastMessageAt: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const aiMessages = pgTable(\"ai_messages\", {\n  id: serial(\"id\").primaryKey(),\n  conversationId: integer(\"conversation_id\").references(() => aiConversations.id).notNull(),\n  role: text(\"role\").notNull(),\n  content: text(\"content\").notNull(),\n  model: text(\"model\"),\n  attachments: jsonb(\"attachments\").$type<AIMessageAttachment[]>(),\n  tokenCount: integer(\"token_count\"),\n  processingTime: integer(\"processing_time\"),\n  metadata: jsonb(\"metadata\").$type<Record<string, any>>(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertAIMessageSchema = createInsertSchema(aiMessages).omit({\n  id: true,\n  tokenCount: true,\n  processingTime: true,\n  createdAt: true,\n});\n\nexport const aiMemory = pgTable(\"ai_memory\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull(),\n  scope: text(\"scope\").notNull().default('global'),\n  sourceConversationId: integer(\"source_conversation_id\").references(() => aiConversations.id),\n  summary: text(\"summary\"),\n  keywords: text(\"keywords\").array().default([]),\n  preferences: jsonb(\"preferences\").$type<AIMemoryPreferences>(),\n  contextSnapshot: text(\"context_snapshot\"),\n  tokenEstimate: integer(\"token_estimate\"),\n  lastRefreshedAt: timestamp(\"last_refreshed_at\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertAIMemorySchema = createInsertSchema(aiMemory).omit({\n  id: true,\n  tokenEstimate: true,\n  lastRefreshedAt: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type AIConversation = typeof aiConversations.$inferSelect;\nexport type InsertAIConversation = z.infer<typeof insertAIConversationSchema>;\nexport type AIMessage = typeof aiMessages.$inferSelect;\nexport type InsertAIMessage = z.infer<typeof insertAIMessageSchema>;\nexport type AIMemory = typeof aiMemory.$inferSelect;\nexport type InsertAIMemory = z.infer<typeof insertAIMemorySchema>;\n\n// ============================================================================\n// INNOVATION FRAMEWORKS - Enterprise Features for World-Class Platform\n// ============================================================================\n\n// -----------------------------------------------------------------------------\n// 1. PREDICTIVE CLAIM OUTCOME ENGINE\n// AI-powered claim success prediction using historical data and insurer patterns\n// -----------------------------------------------------------------------------\n\nexport interface ClaimOutcomeFactors {\n  evidenceQuality: number;\n  documentationCompleteness: number;\n  weatherDataMatch: number;\n  damageConsistency: number;\n  insulorHistoricalRate: number;\n  propertyAge: number;\n  previousClaimHistory: number;\n}\n\nexport interface PredictionConfidence {\n  overall: number;\n  dataQuality: 'high' | 'medium' | 'low';\n  factorsConsidered: number;\n  similarCasesAnalyzed: number;\n}\n\nexport const claimOutcomes = pgTable(\"claim_outcomes\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => projects.id),\n  insurerName: text(\"insurer_name\").notNull(),\n  insurerRegion: text(\"insurer_region\"),\n  claimType: text(\"claim_type\").notNull(),\n  claimAmount: integer(\"claim_amount\"),\n  approvedAmount: integer(\"approved_amount\"),\n  outcome: text(\"outcome\").notNull(),\n  daysToResolution: integer(\"days_to_resolution\"),\n  appealAttempts: integer(\"appeal_attempts\").default(0),\n  factors: jsonb(\"factors\").$type<ClaimOutcomeFactors>(),\n  notes: text(\"notes\"),\n  anonymized: boolean(\"anonymized\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const claimPredictions = pgTable(\"claim_predictions\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => projects.id).notNull(),\n  predictedOutcome: text(\"predicted_outcome\").notNull(),\n  confidenceScore: doublePrecision(\"confidence_score\").notNull(),\n  confidence: jsonb(\"confidence\").$type<PredictionConfidence>(),\n  predictedAmount: integer(\"predicted_amount\"),\n  predictedDaysToResolution: integer(\"predicted_days_to_resolution\"),\n  recommendations: text(\"recommendations\").array().default([]),\n  riskFactors: text(\"risk_factors\").array().default([]),\n  strengthFactors: text(\"strength_factors\").array().default([]),\n  modelVersion: text(\"model_version\"),\n  actualOutcome: text(\"actual_outcome\"),\n  accuracyScore: doublePrecision(\"accuracy_score\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insurerPatterns = pgTable(\"insurer_patterns\", {\n  id: serial(\"id\").primaryKey(),\n  insurerName: text(\"insurer_name\").notNull().unique(),\n  region: text(\"region\"),\n  avgApprovalRate: doublePrecision(\"avg_approval_rate\"),\n  avgDaysToDecision: doublePrecision(\"avg_days_to_decision\"),\n  avgPayoutPercentage: doublePrecision(\"avg_payout_percentage\"),\n  preferredEvidenceTypes: text(\"preferred_evidence_types\").array().default([]),\n  commonDenialReasons: text(\"common_denial_reasons\").array().default([]),\n  appealSuccessRate: doublePrecision(\"appeal_success_rate\"),\n  claimVolume: integer(\"claim_volume\").default(0),\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n  dataQuality: text(\"data_quality\").default('medium'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertClaimOutcomeSchema = createInsertSchema(claimOutcomes).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertClaimPredictionSchema = createInsertSchema(claimPredictions).omit({\n  id: true,\n  actualOutcome: true,\n  accuracyScore: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertInsurerPatternSchema = createInsertSchema(insurerPatterns).omit({\n  id: true,\n  lastUpdated: true,\n  createdAt: true,\n});\n\n// -----------------------------------------------------------------------------\n// 2. STORMY FIELD CO-PILOT\n// Real-time AI guidance during inspections with wearable integration\n// -----------------------------------------------------------------------------\n\nexport interface FieldSessionContext {\n  currentStep: string;\n  completedSteps: string[];\n  activeGuidance: string;\n  environmentalConditions: {\n    lighting: string;\n    weather: string;\n    accessibility: string;\n  };\n  realTimeAlerts: Array<{\n    type: 'warning' | 'info' | 'critical';\n    message: string;\n    timestamp: string;\n  }>;\n}\n\nexport interface WearableDevice {\n  deviceId: string;\n  deviceType: 'limitless_pendant' | 'smart_glasses' | 'smartwatch' | 'ar_headset';\n  capabilities: string[];\n  lastSync: string;\n  batteryLevel?: number;\n}\n\nexport const fieldCopilotSessions = pgTable(\"field_copilot_sessions\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull(),\n  inspectionId: integer(\"inspection_id\").references(() => inspectionSessions.id),\n  propertyId: integer(\"property_id\").references(() => properties.id),\n  sessionType: text(\"session_type\").notNull(),\n  status: text(\"status\").notNull().default('active'),\n  context: jsonb(\"context\").$type<FieldSessionContext>(),\n  connectedDevices: jsonb(\"connected_devices\").$type<WearableDevice[]>(),\n  guidanceMode: text(\"guidance_mode\").default('standard'),\n  voiceEnabled: boolean(\"voice_enabled\").default(true),\n  handsFreeMode: boolean(\"hands_free_mode\").default(false),\n  totalGuidanceEvents: integer(\"total_guidance_events\").default(0),\n  startedAt: timestamp(\"started_at\").defaultNow(),\n  endedAt: timestamp(\"ended_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const copilotGuidanceEvents = pgTable(\"copilot_guidance_events\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => fieldCopilotSessions.id).notNull(),\n  eventType: text(\"event_type\").notNull(),\n  triggerSource: text(\"trigger_source\"),\n  guidanceContent: text(\"guidance_content\").notNull(),\n  visualContext: text(\"visual_context\"),\n  userAction: text(\"user_action\"),\n  feedbackRating: integer(\"feedback_rating\"),\n  responseTimeMs: integer(\"response_time_ms\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const wearableDevices = pgTable(\"wearable_devices\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull(),\n  deviceId: text(\"device_id\").notNull().unique(),\n  deviceType: text(\"device_type\").notNull(),\n  deviceName: text(\"device_name\"),\n  capabilities: text(\"capabilities\").array().default([]),\n  firmwareVersion: text(\"firmware_version\"),\n  isActive: boolean(\"is_active\").default(true),\n  lastConnectedAt: timestamp(\"last_connected_at\"),\n  configSettings: jsonb(\"config_settings\").$type<Record<string, any>>(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertFieldCopilotSessionSchema = createInsertSchema(fieldCopilotSessions).omit({\n  id: true,\n  totalGuidanceEvents: true,\n  endedAt: true,\n  createdAt: true,\n});\n\nexport const insertCopilotGuidanceEventSchema = createInsertSchema(copilotGuidanceEvents).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertWearableDeviceSchema = createInsertSchema(wearableDevices).omit({\n  id: true,\n  lastConnectedAt: true,\n  createdAt: true,\n});\n\n// -----------------------------------------------------------------------------\n// 3. SMART SENSOR NETWORK (IoT)\n// Property monitoring sensors for moisture, impact, and environmental tracking\n// -----------------------------------------------------------------------------\n\nexport interface SensorReadingData {\n  value: number;\n  unit: string;\n  timestamp: string;\n  quality: 'good' | 'degraded' | 'poor';\n}\n\nexport interface AlertThreshold {\n  metric: string;\n  operator: 'gt' | 'lt' | 'eq' | 'gte' | 'lte';\n  value: number;\n  severity: 'info' | 'warning' | 'critical';\n  autoNotify: boolean;\n}\n\nexport const iotDevices = pgTable(\"iot_devices\", {\n  id: serial(\"id\").primaryKey(),\n  propertyId: integer(\"property_id\").references(() => properties.id),\n  deviceSerialNumber: text(\"device_serial_number\").notNull().unique(),\n  deviceType: text(\"device_type\").notNull(),\n  manufacturer: text(\"manufacturer\"),\n  model: text(\"model\"),\n  firmwareVersion: text(\"firmware_version\"),\n  installLocation: text(\"install_location\"),\n  installDate: timestamp(\"install_date\"),\n  gpsCoordinates: jsonb(\"gps_coordinates\").$type<{ lat: number; lng: number }>(),\n  batteryLevel: integer(\"battery_level\"),\n  signalStrength: integer(\"signal_strength\"),\n  status: text(\"status\").notNull().default('active'),\n  lastCommunication: timestamp(\"last_communication\"),\n  alertThresholds: jsonb(\"alert_thresholds\").$type<AlertThreshold[]>(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const sensorReadings = pgTable(\"sensor_readings\", {\n  id: serial(\"id\").primaryKey(),\n  deviceId: integer(\"device_id\").references(() => iotDevices.id).notNull(),\n  readingType: text(\"reading_type\").notNull(),\n  value: doublePrecision(\"value\").notNull(),\n  unit: text(\"unit\").notNull(),\n  quality: text(\"quality\").default('good'),\n  anomalyDetected: boolean(\"anomaly_detected\").default(false),\n  recordedAt: timestamp(\"recorded_at\").notNull(),\n  receivedAt: timestamp(\"received_at\").defaultNow(),\n});\n\nexport const sensorAlerts = pgTable(\"sensor_alerts\", {\n  id: serial(\"id\").primaryKey(),\n  deviceId: integer(\"device_id\").references(() => iotDevices.id).notNull(),\n  propertyId: integer(\"property_id\").references(() => properties.id),\n  alertType: text(\"alert_type\").notNull(),\n  severity: text(\"severity\").notNull(),\n  message: text(\"message\").notNull(),\n  triggerValue: doublePrecision(\"trigger_value\"),\n  thresholdValue: doublePrecision(\"threshold_value\"),\n  acknowledged: boolean(\"acknowledged\").default(false),\n  acknowledgedBy: text(\"acknowledged_by\"),\n  acknowledgedAt: timestamp(\"acknowledged_at\"),\n  autoCreatedClaim: boolean(\"auto_created_claim\").default(false),\n  relatedClaimId: integer(\"related_claim_id\").references(() => projects.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertIotDeviceSchema = createInsertSchema(iotDevices).omit({\n  id: true,\n  lastCommunication: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertSensorReadingSchema = createInsertSchema(sensorReadings).omit({\n  id: true,\n  receivedAt: true,\n});\n\nexport const insertSensorAlertSchema = createInsertSchema(sensorAlerts).omit({\n  id: true,\n  acknowledgedAt: true,\n  createdAt: true,\n});\n\n// -----------------------------------------------------------------------------\n// 4. DRONE INTEGRATION\n// Autonomous drone flights with thermal mapping and 3D modeling\n// -----------------------------------------------------------------------------\n\nexport interface FlightPath {\n  waypoints: Array<{ lat: number; lng: number; altitude: number }>;\n  totalDistance: number;\n  estimatedDuration: number;\n}\n\nexport interface ThermalMapData {\n  heatmapUrl: string;\n  minTemp: number;\n  maxTemp: number;\n  avgTemp: number;\n  hotspots: Array<{ lat: number; lng: number; temp: number; severity: string }>;\n}\n\nexport interface Model3DData {\n  modelUrl: string;\n  format: string;\n  vertexCount: number;\n  textureResolution: string;\n  capturePoints: number;\n}\n\nexport const dronePilots = pgTable(\"drone_pilots\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  faaLicenseNumber: text(\"faa_license_number\"),\n  licenseType: text(\"license_type\"),\n  licenseExpiry: timestamp(\"license_expiry\"),\n  totalFlightHours: doublePrecision(\"total_flight_hours\").default(0),\n  certifications: text(\"certifications\").array().default([]),\n  insuranceProvider: text(\"insurance_provider\"),\n  insuranceExpiry: timestamp(\"insurance_expiry\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const droneAssets = pgTable(\"drone_assets\", {\n  id: serial(\"id\").primaryKey(),\n  ownerId: integer(\"owner_id\").references(() => users.id),\n  serialNumber: text(\"serial_number\").notNull().unique(),\n  manufacturer: text(\"manufacturer\").notNull(),\n  model: text(\"model\").notNull(),\n  nickname: text(\"nickname\"),\n  droneType: text(\"drone_type\"),\n  hasThermallCamera: boolean(\"has_thermal_camera\").default(false),\n  thermalCameraModel: text(\"thermal_camera_model\"),\n  maxFlightTime: integer(\"max_flight_time\"),\n  maxAltitude: integer(\"max_altitude\"),\n  firmwareVersion: text(\"firmware_version\"),\n  lastMaintenance: timestamp(\"last_maintenance\"),\n  status: text(\"status\").notNull().default('available'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const flightSessions = pgTable(\"flight_sessions\", {\n  id: serial(\"id\").primaryKey(),\n  droneId: integer(\"drone_id\").references(() => droneAssets.id).notNull(),\n  pilotId: integer(\"pilot_id\").references(() => dronePilots.id).notNull(),\n  propertyId: integer(\"property_id\").references(() => properties.id),\n  inspectionId: integer(\"inspection_id\").references(() => inspectionSessions.id),\n  flightPlan: jsonb(\"flight_plan\").$type<FlightPath>(),\n  flightMode: text(\"flight_mode\").notNull(),\n  weatherConditions: jsonb(\"weather_conditions\").$type<Record<string, any>>(),\n  startTime: timestamp(\"start_time\").notNull(),\n  endTime: timestamp(\"end_time\"),\n  actualDuration: integer(\"actual_duration\"),\n  distanceCovered: doublePrecision(\"distance_covered\"),\n  maxAltitudeReached: integer(\"max_altitude_reached\"),\n  batteryUsed: integer(\"battery_used\"),\n  photosCapture: integer(\"photos_captured\").default(0),\n  thermalMaps: jsonb(\"thermal_maps\").$type<ThermalMapData[]>(),\n  model3D: jsonb(\"model_3d\").$type<Model3DData>(),\n  status: text(\"status\").notNull().default('planned'),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertDronePilotSchema = createInsertSchema(dronePilots).omit({\n  id: true,\n  totalFlightHours: true,\n  createdAt: true,\n});\n\nexport const insertDroneAssetSchema = createInsertSchema(droneAssets).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertFlightSessionSchema = createInsertSchema(flightSessions).omit({\n  id: true,\n  endTime: true,\n  actualDuration: true,\n  createdAt: true,\n});\n\n// -----------------------------------------------------------------------------\n// 5. INSURANCE CARRIER CONSOLE\n// White-label portal for insurance companies to receive structured claims\n// -----------------------------------------------------------------------------\n\nexport interface CarrierBranding {\n  logoUrl: string;\n  primaryColor: string;\n  secondaryColor: string;\n  companyName: string;\n}\n\nexport interface AdjudicationWorkflow {\n  steps: Array<{\n    name: string;\n    required: boolean;\n    assignedRole: string;\n    slaHours: number;\n  }>;\n  autoApprovalThreshold: number;\n  escalationRules: Record<string, any>;\n}\n\nexport const carrierAccounts = pgTable(\"carrier_accounts\", {\n  id: serial(\"id\").primaryKey(),\n  carrierCode: text(\"carrier_code\").notNull().unique(),\n  companyName: text(\"company_name\").notNull(),\n  contactEmail: text(\"contact_email\").notNull(),\n  contactPhone: text(\"contact_phone\"),\n  branding: jsonb(\"branding\").$type<CarrierBranding>(),\n  apiKey: text(\"api_key\"),\n  webhookUrl: text(\"webhook_url\"),\n  adjudicationWorkflow: jsonb(\"adjudication_workflow\").$type<AdjudicationWorkflow>(),\n  preferredFormats: text(\"preferred_formats\").array().default([]),\n  autoIngestEnabled: boolean(\"auto_ingest_enabled\").default(false),\n  subscriptionTier: text(\"subscription_tier\").default('standard'),\n  monthlyClaimLimit: integer(\"monthly_claim_limit\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const carrierUsers = pgTable(\"carrier_users\", {\n  id: serial(\"id\").primaryKey(),\n  carrierId: integer(\"carrier_id\").references(() => carrierAccounts.id).notNull(),\n  email: text(\"email\").notNull(),\n  name: text(\"name\").notNull(),\n  role: text(\"role\").notNull(),\n  permissions: text(\"permissions\").array().default([]),\n  lastLoginAt: timestamp(\"last_login_at\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const carrierClaimSubmissions = pgTable(\"carrier_claim_submissions\", {\n  id: serial(\"id\").primaryKey(),\n  carrierId: integer(\"carrier_id\").references(() => carrierAccounts.id).notNull(),\n  projectId: integer(\"project_id\").references(() => projects.id).notNull(),\n  submissionFormat: text(\"submission_format\").notNull(),\n  evidencePackageUrl: text(\"evidence_package_url\"),\n  structuredData: jsonb(\"structured_data\").$type<Record<string, any>>(),\n  aiSummary: text(\"ai_summary\"),\n  adjudicationStatus: text(\"adjudication_status\").notNull().default('pending'),\n  assignedAdjusterId: integer(\"assigned_adjuster_id\").references(() => carrierUsers.id),\n  reviewNotes: text(\"review_notes\"),\n  decision: text(\"decision\"),\n  decisionReason: text(\"decision_reason\"),\n  approvedAmount: integer(\"approved_amount\"),\n  submittedAt: timestamp(\"submitted_at\").defaultNow(),\n  decidedAt: timestamp(\"decided_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertCarrierAccountSchema = createInsertSchema(carrierAccounts).omit({\n  id: true,\n  apiKey: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCarrierUserSchema = createInsertSchema(carrierUsers).omit({\n  id: true,\n  lastLoginAt: true,\n  createdAt: true,\n});\n\nexport const insertCarrierClaimSubmissionSchema = createInsertSchema(carrierClaimSubmissions).omit({\n  id: true,\n  submittedAt: true,\n  decidedAt: true,\n  createdAt: true,\n});\n\n// -----------------------------------------------------------------------------\n// 6. CONTRACTOR MARKETPLACE\n// Matching verified contractors with property owners for repairs\n// -----------------------------------------------------------------------------\n\nexport interface ContractorCredentials {\n  licenses: Array<{ type: string; number: string; state: string; expiry: string }>;\n  insurance: Array<{ type: string; provider: string; coverage: number; expiry: string }>;\n  certifications: Array<{ name: string; issuer: string; date: string }>;\n}\n\nexport interface ContractorRating {\n  overall: number;\n  quality: number;\n  timeliness: number;\n  communication: number;\n  value: number;\n  reviewCount: number;\n}\n\nexport const contractorProfiles = pgTable(\"contractor_profiles\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id),\n  companyName: text(\"company_name\").notNull(),\n  contactEmail: text(\"contact_email\").notNull(),\n  contactPhone: text(\"contact_phone\").notNull(),\n  serviceAreas: text(\"service_areas\").array().default([]),\n  specialties: text(\"specialties\").array().default([]),\n  credentials: jsonb(\"credentials\").$type<ContractorCredentials>(),\n  rating: jsonb(\"rating\").$type<ContractorRating>(),\n  yearsInBusiness: integer(\"years_in_business\"),\n  employeeCount: integer(\"employee_count\"),\n  portfolioUrls: text(\"portfolio_urls\").array().default([]),\n  description: text(\"description\"),\n  responseTimeHours: integer(\"response_time_hours\"),\n  verificationStatus: text(\"verification_status\").notNull().default('pending'),\n  verifiedAt: timestamp(\"verified_at\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const repairJobs = pgTable(\"repair_jobs\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => projects.id),\n  propertyId: integer(\"property_id\").references(() => properties.id),\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  jobType: text(\"job_type\").notNull(),\n  urgency: text(\"urgency\").notNull().default('standard'),\n  estimatedBudget: integer(\"estimated_budget\"),\n  requiredSpecialties: text(\"required_specialties\").array().default([]),\n  preferredStartDate: timestamp(\"preferred_start_date\"),\n  status: text(\"status\").notNull().default('open'),\n  selectedContractorId: integer(\"selected_contractor_id\").references(() => contractorProfiles.id),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const contractorBids = pgTable(\"contractor_bids\", {\n  id: serial(\"id\").primaryKey(),\n  jobId: integer(\"job_id\").references(() => repairJobs.id).notNull(),\n  contractorId: integer(\"contractor_id\").references(() => contractorProfiles.id).notNull(),\n  bidAmount: integer(\"bid_amount\").notNull(),\n  estimatedDays: integer(\"estimated_days\").notNull(),\n  proposalText: text(\"proposal_text\"),\n  includedServices: text(\"included_services\").array().default([]),\n  warranty: text(\"warranty\"),\n  status: text(\"status\").notNull().default('submitted'),\n  isWinningBid: boolean(\"is_winning_bid\").default(false),\n  submittedAt: timestamp(\"submitted_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const referralFees = pgTable(\"referral_fees\", {\n  id: serial(\"id\").primaryKey(),\n  jobId: integer(\"job_id\").references(() => repairJobs.id).notNull(),\n  contractorId: integer(\"contractor_id\").references(() => contractorProfiles.id).notNull(),\n  referringConsultantId: integer(\"referring_consultant_id\").references(() => users.id),\n  feePercentage: doublePrecision(\"fee_percentage\").notNull(),\n  feeAmount: integer(\"fee_amount\"),\n  jobValue: integer(\"job_value\").notNull(),\n  status: text(\"status\").notNull().default('pending'),\n  paidAt: timestamp(\"paid_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertContractorProfileSchema = createInsertSchema(contractorProfiles).omit({\n  id: true,\n  verifiedAt: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertRepairJobSchema = createInsertSchema(repairJobs).omit({\n  id: true,\n  completedAt: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertContractorBidSchema = createInsertSchema(contractorBids).omit({\n  id: true,\n  submittedAt: true,\n  updatedAt: true,\n});\n\nexport const insertReferralFeeSchema = createInsertSchema(referralFees).omit({\n  id: true,\n  paidAt: true,\n  createdAt: true,\n});\n\n// -----------------------------------------------------------------------------\n// 7. REGIONAL RISK INTELLIGENCE\n// Anonymized data product for insurers and reinsurers\n// -----------------------------------------------------------------------------\n\nexport interface GeographicRiskMetrics {\n  hailFrequency: number;\n  windDamageFrequency: number;\n  floodRisk: number;\n  avgClaimSeverity: number;\n  avgPropertyAge: number;\n  predominantRoofTypes: Record<string, number>;\n}\n\nexport interface RiskTrend {\n  period: string;\n  claimCount: number;\n  avgSeverity: number;\n  totalPayout: number;\n  primaryDamageTypes: string[];\n}\n\nexport const riskRegions = pgTable(\"risk_regions\", {\n  id: serial(\"id\").primaryKey(),\n  regionCode: text(\"region_code\").notNull().unique(),\n  regionName: text(\"region_name\").notNull(),\n  regionType: text(\"region_type\").notNull(),\n  state: text(\"state\"),\n  boundaryGeoJson: jsonb(\"boundary_geo_json\").$type<Record<string, any>>(),\n  centerPoint: jsonb(\"center_point\").$type<{ lat: number; lng: number }>(),\n  propertyCount: integer(\"property_count\").default(0),\n  dataQuality: text(\"data_quality\").default('medium'),\n  lastCalculated: timestamp(\"last_calculated\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const riskAssessments = pgTable(\"risk_assessments\", {\n  id: serial(\"id\").primaryKey(),\n  regionId: integer(\"region_id\").references(() => riskRegions.id).notNull(),\n  assessmentPeriod: text(\"assessment_period\").notNull(),\n  metrics: jsonb(\"metrics\").$type<GeographicRiskMetrics>(),\n  riskScore: doublePrecision(\"risk_score\").notNull(),\n  riskCategory: text(\"risk_category\").notNull(),\n  trends: jsonb(\"trends\").$type<RiskTrend[]>(),\n  comparisonToState: doublePrecision(\"comparison_to_state\"),\n  comparisonToNational: doublePrecision(\"comparison_to_national\"),\n  confidenceLevel: doublePrecision(\"confidence_level\"),\n  sampleSize: integer(\"sample_size\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const riskDataExports = pgTable(\"risk_data_exports\", {\n  id: serial(\"id\").primaryKey(),\n  carrierId: integer(\"carrier_id\").references(() => carrierAccounts.id),\n  exportType: text(\"export_type\").notNull(),\n  regionsIncluded: text(\"regions_included\").array().default([]),\n  dateRange: jsonb(\"date_range\").$type<{ start: string; end: string }>(),\n  format: text(\"format\").notNull(),\n  fileUrl: text(\"file_url\"),\n  recordCount: integer(\"record_count\"),\n  pricePaid: integer(\"price_paid\"),\n  status: text(\"status\").notNull().default('pending'),\n  generatedAt: timestamp(\"generated_at\"),\n  expiresAt: timestamp(\"expires_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertRiskRegionSchema = createInsertSchema(riskRegions).omit({\n  id: true,\n  lastCalculated: true,\n  createdAt: true,\n});\n\nexport const insertRiskAssessmentSchema = createInsertSchema(riskAssessments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertRiskDataExportSchema = createInsertSchema(riskDataExports).omit({\n  id: true,\n  generatedAt: true,\n  createdAt: true,\n});\n\n// -----------------------------------------------------------------------------\n// 8. INNOVATION MODULE REGISTRY\n// Tracks enabled/disabled features per organization\n// -----------------------------------------------------------------------------\n\nexport interface ModuleConfig {\n  settings: Record<string, any>;\n  limits: Record<string, number>;\n  integrations: string[];\n}\n\nexport const innovationModules = pgTable(\"innovation_modules\", {\n  id: serial(\"id\").primaryKey(),\n  moduleCode: text(\"module_code\").notNull().unique(),\n  moduleName: text(\"module_name\").notNull(),\n  description: text(\"description\"),\n  category: text(\"category\").notNull(),\n  version: text(\"version\").notNull().default('1.0.0'),\n  status: text(\"status\").notNull().default('preview'),\n  requiredSubscription: text(\"required_subscription\"),\n  defaultConfig: jsonb(\"default_config\").$type<ModuleConfig>(),\n  dependencies: text(\"dependencies\").array().default([]),\n  isActive: boolean(\"is_active\").default(false),\n  releasedAt: timestamp(\"released_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const organizationModules = pgTable(\"organization_modules\", {\n  id: serial(\"id\").primaryKey(),\n  organizationId: integer(\"organization_id\"),\n  moduleId: integer(\"module_id\").references(() => innovationModules.id).notNull(),\n  enabled: boolean(\"enabled\").default(false),\n  config: jsonb(\"config\").$type<ModuleConfig>(),\n  enabledBy: text(\"enabled_by\"),\n  enabledAt: timestamp(\"enabled_at\"),\n  usageStats: jsonb(\"usage_stats\").$type<Record<string, number>>(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertInnovationModuleSchema = createInsertSchema(innovationModules).omit({\n  id: true,\n  releasedAt: true,\n  createdAt: true,\n});\n\nexport const insertOrganizationModuleSchema = createInsertSchema(organizationModules).omit({\n  id: true,\n  enabledAt: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// -----------------------------------------------------------------------------\n// TYPE EXPORTS FOR ALL INNOVATION FRAMEWORKS\n// -----------------------------------------------------------------------------\n\nexport type ClaimOutcome = typeof claimOutcomes.$inferSelect;\nexport type InsertClaimOutcome = z.infer<typeof insertClaimOutcomeSchema>;\nexport type ClaimPrediction = typeof claimPredictions.$inferSelect;\nexport type InsertClaimPrediction = z.infer<typeof insertClaimPredictionSchema>;\nexport type InsurerPattern = typeof insurerPatterns.$inferSelect;\nexport type InsertInsurerPattern = z.infer<typeof insertInsurerPatternSchema>;\n\nexport type FieldCopilotSession = typeof fieldCopilotSessions.$inferSelect;\nexport type InsertFieldCopilotSession = z.infer<typeof insertFieldCopilotSessionSchema>;\nexport type CopilotGuidanceEvent = typeof copilotGuidanceEvents.$inferSelect;\nexport type InsertCopilotGuidanceEvent = z.infer<typeof insertCopilotGuidanceEventSchema>;\nexport type WearableDeviceRecord = typeof wearableDevices.$inferSelect;\nexport type InsertWearableDeviceRecord = z.infer<typeof insertWearableDeviceSchema>;\n\nexport type IotDevice = typeof iotDevices.$inferSelect;\nexport type InsertIotDevice = z.infer<typeof insertIotDeviceSchema>;\nexport type SensorReading = typeof sensorReadings.$inferSelect;\nexport type InsertSensorReading = z.infer<typeof insertSensorReadingSchema>;\nexport type SensorAlert = typeof sensorAlerts.$inferSelect;\nexport type InsertSensorAlert = z.infer<typeof insertSensorAlertSchema>;\n\nexport type DronePilot = typeof dronePilots.$inferSelect;\nexport type InsertDronePilot = z.infer<typeof insertDronePilotSchema>;\nexport type DroneAsset = typeof droneAssets.$inferSelect;\nexport type InsertDroneAsset = z.infer<typeof insertDroneAssetSchema>;\nexport type FlightSession = typeof flightSessions.$inferSelect;\nexport type InsertFlightSession = z.infer<typeof insertFlightSessionSchema>;\n\nexport type CarrierAccount = typeof carrierAccounts.$inferSelect;\nexport type InsertCarrierAccount = z.infer<typeof insertCarrierAccountSchema>;\nexport type CarrierUser = typeof carrierUsers.$inferSelect;\nexport type InsertCarrierUser = z.infer<typeof insertCarrierUserSchema>;\nexport type CarrierClaimSubmission = typeof carrierClaimSubmissions.$inferSelect;\nexport type InsertCarrierClaimSubmission = z.infer<typeof insertCarrierClaimSubmissionSchema>;\n\nexport type ContractorProfile = typeof contractorProfiles.$inferSelect;\nexport type InsertContractorProfile = z.infer<typeof insertContractorProfileSchema>;\nexport type RepairJob = typeof repairJobs.$inferSelect;\nexport type InsertRepairJob = z.infer<typeof insertRepairJobSchema>;\nexport type ContractorBid = typeof contractorBids.$inferSelect;\nexport type InsertContractorBid = z.infer<typeof insertContractorBidSchema>;\nexport type ReferralFee = typeof referralFees.$inferSelect;\nexport type InsertReferralFee = z.infer<typeof insertReferralFeeSchema>;\n\nexport type RiskRegion = typeof riskRegions.$inferSelect;\nexport type InsertRiskRegion = z.infer<typeof insertRiskRegionSchema>;\nexport type RiskAssessment = typeof riskAssessments.$inferSelect;\nexport type InsertRiskAssessment = z.infer<typeof insertRiskAssessmentSchema>;\nexport type RiskDataExport = typeof riskDataExports.$inferSelect;\nexport type InsertRiskDataExport = z.infer<typeof insertRiskDataExportSchema>;\n\nexport type InnovationModule = typeof innovationModules.$inferSelect;\nexport type InsertInnovationModule = z.infer<typeof insertInnovationModuleSchema>;\nexport type OrganizationModule = typeof organizationModules.$inferSelect;\nexport type InsertOrganizationModule = z.infer<typeof insertOrganizationModuleSchema>;\n","path":null,"size_bytes":76608,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5742,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }","path":null,"size_bytes":1583,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":23567,"size_tokens":null},"client/src/components/thermal-slider.tsx":{"content":"import { useState, useRef, useEffect } from 'react';\n\ninterface ThermalSliderProps {\n  standardImage: string;\n  thermalImage: string;\n  alt?: string;\n}\n\nexport const ThermalSlider = ({ standardImage, thermalImage, alt = \"Thermal image comparison\" }: ThermalSliderProps) => {\n  const [sliderPosition, setSliderPosition] = useState(50);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const isDragging = useRef(false);\n\n  const handleSliderChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setSliderPosition(Number(e.target.value));\n  };\n\n  const startDrag = (e: React.MouseEvent | React.TouchEvent) => {\n    isDragging.current = true;\n    document.body.style.userSelect = 'none';\n    updateSliderPosition(e);\n  };\n\n  const stopDrag = () => {\n    isDragging.current = false;\n    document.body.style.userSelect = '';\n  };\n\n  const updateSliderPosition = (e: React.MouseEvent | React.TouchEvent | MouseEvent | TouchEvent) => {\n    if (!isDragging.current || !containerRef.current) return;\n    \n    let clientX: number;\n    \n    if ('touches' in e) {\n      clientX = e.touches[0].clientX;\n    } else {\n      clientX = e.clientX;\n    }\n    \n    const rect = containerRef.current.getBoundingClientRect();\n    const position = ((clientX - rect.left) / rect.width) * 100;\n    \n    setSliderPosition(Math.max(0, Math.min(100, position)));\n  };\n\n  useEffect(() => {\n    const handleMove = (e: MouseEvent | TouchEvent) => updateSliderPosition(e);\n    const handleUp = () => stopDrag();\n    \n    if (isDragging.current) {\n      window.addEventListener('mousemove', handleMove);\n      window.addEventListener('touchmove', handleMove);\n      window.addEventListener('mouseup', handleUp);\n      window.addEventListener('touchend', handleUp);\n    }\n    \n    return () => {\n      window.removeEventListener('mousemove', handleMove);\n      window.removeEventListener('touchmove', handleMove);\n      window.removeEventListener('mouseup', handleUp);\n      window.removeEventListener('touchend', handleUp);\n    };\n  }, []);\n\n  return (\n    <div className=\"mb-6\">\n      <div className=\"mb-4 relative\" ref={containerRef}>\n        {/* Standard Image */}\n        <img \n          src={standardImage} \n          alt={`Standard view - ${alt}`} \n          className=\"w-full h-auto rounded-lg\"\n        />\n        \n        {/* Thermal Overlay */}\n        <div \n          className=\"absolute top-0 left-0 right-0 bottom-0 rounded-lg overflow-hidden\" \n          style={{clipPath: `polygon(0 0, ${sliderPosition}% 0, ${sliderPosition}% 100%, 0 100%)`}}\n        >\n          <img \n            src={thermalImage} \n            alt={`Thermal view - ${alt}`} \n            className=\"w-full h-full object-cover\"\n          />\n        </div>\n        \n        {/* Slider Control */}\n        <div className=\"absolute top-0 left-0 right-0 bottom-0 flex items-center pointer-events-none\">\n          <div \n            className=\"h-full w-0.5 bg-white\" \n            style={{position: 'absolute', left: `${sliderPosition}%`}}\n          ></div>\n          <div \n            className=\"absolute bg-white rounded-full w-8 h-8 flex items-center justify-center shadow-lg pointer-events-auto cursor-move\"\n            style={{\n              left: `${sliderPosition}%`,\n              top: '50%',\n              transform: 'translate(-50%, -50%)'\n            }}\n            onMouseDown={startDrag}\n            onTouchStart={startDrag}\n          >\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" \n                strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" \n                className=\"text-primary\">\n              <path d=\"M18 21V3M6 21V3M12 21v-9\"></path>\n            </svg>\n          </div>\n        </div>\n      </div>\n      \n      <div className=\"flex justify-between mb-4\">\n        <span className=\"text-sm font-medium text-neutral-darker\">Standard View</span>\n        <span className=\"text-sm font-medium text-neutral-darker\">Thermal View</span>\n      </div>\n      \n      <input \n        type=\"range\" \n        className=\"slide-track w-full\" \n        min=\"0\" \n        max=\"100\" \n        value={sliderPosition} \n        onChange={handleSliderChange}\n      />\n    </div>\n  );\n};\n","path":null,"size_bytes":4197,"size_tokens":null},"client/src/lib/firebase.ts":{"content":"import { initializeApp } from \"firebase/app\";\nimport { \n  getAuth, \n  signInWithEmailAndPassword, \n  createUserWithEmailAndPassword, \n  signOut,\n  GoogleAuthProvider,\n  signInWithPopup,\n  onAuthStateChanged,\n  User\n} from \"firebase/auth\";\nimport { \n  getStorage, \n  ref, \n  uploadBytes, \n  getDownloadURL,\n  listAll\n} from \"firebase/storage\";\n\n// Firebase configuration using environment variables\nconst firebaseConfig = {\n  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\n  authDomain: `${import.meta.env.VITE_FIREBASE_PROJECT_ID}.firebaseapp.com`,\n  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\n  storageBucket: `${import.meta.env.VITE_FIREBASE_PROJECT_ID}.firebasestorage.app`,\n  appId: import.meta.env.VITE_FIREBASE_APP_ID\n};\n\n// Debug: Log Firebase config (without sensitive values)\nconsole.log(\"Firebase config loaded:\", {\n  projectId: firebaseConfig.projectId,\n  authDomain: firebaseConfig.authDomain\n});\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst auth = getAuth(app);\nconst storage = getStorage(app);\nconst googleProvider = new GoogleAuthProvider();\n\n// Auth functions\nexport const loginWithEmail = async (email: string, password: string) => {\n  try {\n    const userCredential = await signInWithEmailAndPassword(auth, email, password);\n    return userCredential.user;\n  } catch (error) {\n    throw error;\n  }\n};\n\nexport const registerWithEmail = async (email: string, password: string) => {\n  try {\n    const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n    return userCredential.user;\n  } catch (error) {\n    throw error;\n  }\n};\n\nexport const loginWithGoogle = async () => {\n  try {\n    const result = await signInWithPopup(auth, googleProvider);\n    return result.user;\n  } catch (error) {\n    throw error;\n  }\n};\n\nexport const logoutUser = async () => {\n  try {\n    await signOut(auth);\n  } catch (error) {\n    throw error;\n  }\n};\n\nexport const onAuthChange = (callback: (user: User | null) => void) => {\n  return onAuthStateChanged(auth, callback);\n};\n\n// Storage functions\nexport const uploadFile = async (file: File, path: string) => {\n  try {\n    const storageRef = ref(storage, path);\n    const result = await uploadBytes(storageRef, file);\n    const downloadURL = await getDownloadURL(result.ref);\n    return { ref: result.ref, downloadURL };\n  } catch (error) {\n    throw error;\n  }\n};\n\nexport const getFileURL = async (path: string) => {\n  try {\n    const storageRef = ref(storage, path);\n    return await getDownloadURL(storageRef);\n  } catch (error) {\n    throw error;\n  }\n};\n\nexport const listFiles = async (path: string) => {\n  try {\n    const storageRef = ref(storage, path);\n    const result = await listAll(storageRef);\n    return result.items;\n  } catch (error) {\n    throw error;\n  }\n};\n\nexport { auth, storage };\n","path":null,"size_bytes":2812,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/winn-report-workflow.tsx":{"content":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { \n  RoofComponent, \n  ThermalReading, \n  WeatherCondition, \n  InspectionMetric, \n  DetailedIssue,\n  BuildingInformation,\n  RoofSystemDetails,\n  InspectionSection,\n  CostEstimate,\n  RoofSection\n} from '@shared/schema';\nimport { Plus, Upload, Camera, MapPin, AlertTriangle, FileText, Database } from 'lucide-react';\nimport { ThermalAnalysis } from './thermal-analysis';\nimport { GoogleMapsDrawing } from './google-maps-drawing';\nimport { AIInspectionAssistant } from './ai-inspection-assistant';\nimport { MobileWorkflowNav } from './mobile-workflow-nav';\nimport { EducationalTooltip } from './educational-tooltip';\nimport { CameraCapture } from './camera-capture';\n\ninterface WinnReportWorkflowProps {\n  propertyId: number;\n  onComplete: (reportData: WinnReportData) => void;\n}\n\ninterface WinnReportData {\n  propertyId: number;\n  inspectionDate: Date;\n  inspector: string;\n  buildingInfo: BuildingInformation;\n  roofSystemDetails: RoofSystemDetails;\n  weatherConditions: WeatherCondition[];\n  inspectionSections: InspectionSection[];\n  roofComponents: RoofComponent[];\n  thermalReadings: ThermalReading[];\n  metrics: InspectionMetric[];\n  issues: DetailedIssue[];\n  costEstimates: CostEstimate[];\n  executiveSummary: string;\n  recommendations: string;\n  notes: string;\n  images: string[];\n  thermalImages: string[];\n}\n\nconst WORKFLOW_STEPS = [\n  { id: 'building-info', title: 'Building Information', icon: MapPin },\n  { id: 'roof-system', title: 'Roof System Details', icon: Database },\n  { id: 'weather', title: 'Weather Conditions', icon: Database },\n  { id: 'thermal', title: 'Thermal Analysis', icon: Camera },\n  { id: 'components', title: 'Roof Components', icon: FileText },\n  { id: 'issues', title: 'Issues & Findings', icon: AlertTriangle },\n  { id: 'cost-estimates', title: 'Cost Estimates', icon: FileText },\n  { id: 'review', title: 'Review & Generate', icon: FileText },\n];\n\nexport const WinnReportWorkflow: React.FC<WinnReportWorkflowProps> = ({ propertyId, onComplete }) => {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [reportData, setReportData] = useState<WinnReportData>({\n    propertyId,\n    inspectionDate: new Date(),\n    inspector: '',\n    buildingInfo: {\n      address: '',\n      propertyType: 'commercial',\n      yearBuilt: new Date().getFullYear(),\n      squareFootage: 0,\n      stories: 1,\n      occupancy: '',\n      ownerName: '',\n      ownerContact: '',\n      roofSections: []\n    },\n    roofSystemDetails: {\n      roofType: 'flat',\n      primaryMaterial: 'membrane',\n      age: 0,\n      condition: 'good',\n      previousRepairs: [],\n      warrantyInfo: ''\n    },\n    weatherConditions: [],\n    inspectionSections: [],\n    roofComponents: [],\n    thermalReadings: [],\n    metrics: [],\n    issues: [],\n    costEstimates: [],\n    executiveSummary: '',\n    recommendations: '',\n    notes: '',\n    images: [],\n    thermalImages: [],\n  });\n\n  const progressPercentage = ((currentStep + 1) / WORKFLOW_STEPS.length) * 100;\n\n  const nextStep = () => {\n    if (currentStep < WORKFLOW_STEPS.length - 1) {\n      setCurrentStep(currentStep + 1);\n    }\n  };\n\n  const prevStep = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const addWeatherCondition = () => {\n    const newCondition: WeatherCondition = {\n      temperature: 0,\n      humidity: 0,\n      windSpeed: 0,\n      precipitation: 0,\n      visibility: 0,\n      timestamp: new Date(),\n    };\n    setReportData(prev => ({\n      ...prev,\n      weatherConditions: [...prev.weatherConditions, newCondition]\n    }));\n  };\n\n  const addRoofComponent = () => {\n    const newComponent: RoofComponent = {\n      id: `component-${Date.now()}`,\n      name: '',\n      type: 'membrane',\n      condition: 'good',\n      notes: '',\n      images: [],\n      thermalData: [],\n    };\n    setReportData(prev => ({\n      ...prev,\n      roofComponents: [...prev.roofComponents, newComponent]\n    }));\n  };\n\n  const addThermalReading = () => {\n    const newReading: ThermalReading = {\n      location: '',\n      temperature: 0,\n      timestamp: new Date(),\n      alertLevel: 'normal',\n    };\n    setReportData(prev => ({\n      ...prev,\n      thermalReadings: [...prev.thermalReadings, newReading]\n    }));\n  };\n\n  const addIssue = () => {\n    const newIssue: DetailedIssue = {\n      id: `issue-${Date.now()}`,\n      title: '',\n      description: '',\n      severity: 'minor',\n      category: '',\n      location: '',\n      recommendedAction: '',\n      urgency: 'monitoring',\n      images: [],\n      thermalImages: [],\n      discoveredDate: new Date(),\n      reportedBy: reportData.inspector,\n    };\n    setReportData(prev => ({\n      ...prev,\n      issues: [...prev.issues, newIssue]\n    }));\n  };\n\n  const renderStepContent = () => {\n    switch (currentStep) {\n      case 0: // Building Information  \n        return (\n          <div className=\"space-y-6\">\n            {/* Basic Property Information */}\n            <Card className=\"bg-card border-border\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-foreground\">\n                  <MapPin className=\"h-5 w-5 text-primary\" />\n                  Basic Property Information\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"inspector\" className=\"text-foreground flex items-center\">\n                      Inspector Name\n                      <EducationalTooltip \n                        content=\"Document who conducted this inspection for accountability and certification tracking.\"\n                        learnMore=\"This information appears on the final Winn Report and is linked to your consultant certification.\"\n                      />\n                    </Label>\n                    <Input\n                      id=\"inspector\"\n                      data-testid=\"input-inspector-name\"\n                      value={reportData.inspector}\n                      onChange={(e) => setReportData(prev => ({ ...prev, inspector: e.target.value }))}\n                      className=\"bg-background text-foreground border-border field-input\"\n                      placeholder=\"Enter inspector name\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"inspection-date\" className=\"text-foreground\">Inspection Date</Label>\n                    <Input\n                      id=\"inspection-date\"\n                      type=\"date\"\n                      value={reportData.inspectionDate.toISOString().split('T')[0]}\n                      onChange={(e) => setReportData(prev => ({ ...prev, inspectionDate: new Date(e.target.value) }))}\n                      className=\"bg-background text-foreground border-border\"\n                    />\n                  </div>\n                </div>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"owner-name\" className=\"text-foreground flex items-center\">\n                      Property Owner\n                      <EducationalTooltip \n                        content=\"Record the property owner's name for report authorization and insurance claim documentation.\"\n                        learnMore=\"Accurate owner information is critical for legal compliance and insurance processing.\"\n                      />\n                    </Label>\n                    <Input\n                      id=\"owner-name\"\n                      data-testid=\"input-property-owner\"\n                      value={reportData.buildingInfo.ownerName}\n                      onChange={(e) => setReportData(prev => ({ \n                        ...prev, \n                        buildingInfo: { ...prev.buildingInfo, ownerName: e.target.value }\n                      }))}\n                      className=\"bg-background text-foreground border-border field-input\"\n                      placeholder=\"Enter property owner name\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"owner-contact\" className=\"text-foreground\">Owner Contact</Label>\n                    <Input\n                      id=\"owner-contact\"\n                      value={reportData.buildingInfo.ownerContact}\n                      onChange={(e) => setReportData(prev => ({ \n                        ...prev, \n                        buildingInfo: { ...prev.buildingInfo, ownerContact: e.target.value }\n                      }))}\n                      className=\"bg-background text-foreground border-border\"\n                      placeholder=\"Phone or email\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div>\n                    <Label htmlFor=\"property-type\" className=\"text-foreground\">Property Type</Label>\n                    <Select\n                      value={reportData.buildingInfo.propertyType}\n                      onValueChange={(value) => setReportData(prev => ({ \n                        ...prev, \n                        buildingInfo: { ...prev.buildingInfo, propertyType: value as any }\n                      }))}\n                    >\n                      <SelectTrigger className=\"bg-background text-foreground border-border\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"commercial\">Commercial</SelectItem>\n                        <SelectItem value=\"residential\">Residential</SelectItem>\n                        <SelectItem value=\"industrial\">Industrial</SelectItem>\n                        <SelectItem value=\"institutional\">Institutional</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div>\n                    <Label htmlFor=\"year-built\" className=\"text-foreground\">Year Built</Label>\n                    <Input\n                      id=\"year-built\"\n                      type=\"number\"\n                      value={reportData.buildingInfo.yearBuilt}\n                      onChange={(e) => setReportData(prev => ({ \n                        ...prev, \n                        buildingInfo: { ...prev.buildingInfo, yearBuilt: parseInt(e.target.value) }\n                      }))}\n                      className=\"bg-background text-foreground border-border\"\n                      placeholder=\"2020\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"square-footage\" className=\"text-foreground flex items-center\">\n                      Square Footage\n                      <EducationalTooltip \n                        content=\"Total roof square footage is essential for material estimates, cost calculations, and damage assessment scope.\"\n                        learnMore=\"Winn Methodology requires precise measurements verified through on-site inspection and satellite imagery.\"\n                      />\n                    </Label>\n                    <Input\n                      id=\"square-footage\"\n                      data-testid=\"input-square-footage\"\n                      type=\"number\"\n                      inputMode=\"numeric\"\n                      value={reportData.buildingInfo.squareFootage}\n                      onChange={(e) => setReportData(prev => ({ \n                        ...prev, \n                        buildingInfo: { ...prev.buildingInfo, squareFootage: parseInt(e.target.value) }\n                      }))}\n                      className=\"bg-background text-foreground border-border field-input\"\n                      placeholder=\"10000\"\n                    />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Google Maps Property Location & Roof Section Drawing */}\n            <GoogleMapsDrawing\n              address={reportData.buildingInfo.address}\n              onAddressChange={(address) => setReportData(prev => ({ \n                ...prev, \n                buildingInfo: { ...prev.buildingInfo, address }\n              }))}\n              roofSections={reportData.buildingInfo.roofSections}\n              onSectionsChange={(roofSections) => setReportData(prev => ({ \n                ...prev, \n                buildingInfo: { ...prev.buildingInfo, roofSections }\n              }))}\n            />\n\n            {/* Initial Notes */}\n            <Card className=\"bg-card border-border\">\n              <CardHeader>\n                <CardTitle className=\"text-foreground\">Initial Inspection Notes</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Textarea\n                  value={reportData.notes}\n                  onChange={(e) => setReportData(prev => ({ ...prev, notes: e.target.value }))}\n                  className=\"bg-background text-foreground border-border\"\n                  placeholder=\"Enter initial inspection observations, weather conditions, access notes, etc.\"\n                  rows={4}\n                />\n              </CardContent>\n            </Card>\n          </div>\n        );\n\n      case 1: // Weather Conditions\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n              <h3 className=\"text-foreground font-semibold\">Weather Conditions</h3>\n              <Button \n                data-testid=\"button-add-weather\"\n                onClick={addWeatherCondition} \n                className=\"bg-primary text-primary-foreground touch-target\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Reading\n              </Button>\n            </div>\n            <div className=\"space-y-4\">\n              {reportData.weatherConditions.map((condition, index) => (\n                <Card key={index} className=\"bg-card border-border\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n                      <div>\n                        <Label className=\"text-foreground\">Temperature (°F)</Label>\n                        <Input\n                          type=\"number\"\n                          value={condition.temperature}\n                          onChange={(e) => {\n                            const newConditions = [...reportData.weatherConditions];\n                            newConditions[index].temperature = parseFloat(e.target.value);\n                            setReportData(prev => ({ ...prev, weatherConditions: newConditions }));\n                          }}\n                          className=\"bg-card text-foreground border-border\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-foreground\">Humidity (%)</Label>\n                        <Input\n                          type=\"number\"\n                          value={condition.humidity}\n                          onChange={(e) => {\n                            const newConditions = [...reportData.weatherConditions];\n                            newConditions[index].humidity = parseFloat(e.target.value);\n                            setReportData(prev => ({ ...prev, weatherConditions: newConditions }));\n                          }}\n                          className=\"bg-card text-foreground border-border\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-foreground\">Wind Speed (mph)</Label>\n                        <Input\n                          type=\"number\"\n                          value={condition.windSpeed}\n                          onChange={(e) => {\n                            const newConditions = [...reportData.weatherConditions];\n                            newConditions[index].windSpeed = parseFloat(e.target.value);\n                            setReportData(prev => ({ ...prev, weatherConditions: newConditions }));\n                          }}\n                          className=\"bg-card text-foreground border-border\"\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        );\n\n      case 2: // Thermal Analysis\n        return (\n          <ThermalAnalysis\n            location={reportData.buildingInfo?.address || \"Unknown location\"}\n            ambientTemp={reportData.weatherConditions[0]?.temperature}\n            humidity={reportData.weatherConditions[0]?.humidity}\n            onAnalysisComplete={(result) => {\n              setReportData(prev => ({\n                ...prev,\n                thermalReadings: [...prev.thermalReadings, ...result.thermalReadings],\n                issues: [...prev.issues, ...result.issues],\n                metrics: [...prev.metrics, ...result.metrics],\n                recommendations: result.summary,\n                thermalImages: [...prev.thermalImages, ...result.thermalReadings.map(r => r.location)]\n              }));\n            }}\n          />\n        );\n\n      case 3: // Roof Components\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n              <h3 className=\"text-foreground font-semibold\">Roof Components</h3>\n              <Button \n                data-testid=\"button-add-component\"\n                onClick={addRoofComponent} \n                className=\"bg-primary text-primary-foreground touch-target\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Component\n              </Button>\n            </div>\n            <div className=\"space-y-4\">\n              {reportData.roofComponents.map((component, index) => (\n                <Card key={component.id} className=\"bg-card border-border\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <Label className=\"text-foreground\">Component Name</Label>\n                        <Input\n                          value={component.name}\n                          onChange={(e) => {\n                            const newComponents = [...reportData.roofComponents];\n                            newComponents[index].name = e.target.value;\n                            setReportData(prev => ({ ...prev, roofComponents: newComponents }));\n                          }}\n                          className=\"bg-card text-foreground border-border\"\n                          placeholder=\"e.g., TPO Membrane, Insulation Layer\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-foreground\">Type</Label>\n                        <Select\n                          value={component.type}\n                          onValueChange={(value) => {\n                            const newComponents = [...reportData.roofComponents];\n                            newComponents[index].type = value as RoofComponent['type'];\n                            setReportData(prev => ({ ...prev, roofComponents: newComponents }));\n                          }}\n                        >\n                          <SelectTrigger className=\"bg-card text-foreground border-border\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"membrane\">Membrane</SelectItem>\n                            <SelectItem value=\"insulation\">Insulation</SelectItem>\n                            <SelectItem value=\"deck\">Deck</SelectItem>\n                            <SelectItem value=\"drainage\">Drainage</SelectItem>\n                            <SelectItem value=\"flashing\">Flashing</SelectItem>\n                            <SelectItem value=\"penetration\">Penetration</SelectItem>\n                            <SelectItem value=\"equipment\">Equipment</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div>\n                        <Label className=\"text-foreground\">Condition</Label>\n                        <Select\n                          value={component.condition}\n                          onValueChange={(value) => {\n                            const newComponents = [...reportData.roofComponents];\n                            newComponents[index].condition = value as RoofComponent['condition'];\n                            setReportData(prev => ({ ...prev, roofComponents: newComponents }));\n                          }}\n                        >\n                          <SelectTrigger className=\"bg-card text-foreground border-border\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"excellent\">Excellent</SelectItem>\n                            <SelectItem value=\"good\">Good</SelectItem>\n                            <SelectItem value=\"fair\">Fair</SelectItem>\n                            <SelectItem value=\"poor\">Poor</SelectItem>\n                            <SelectItem value=\"critical\">Critical</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div>\n                        <Label className=\"text-foreground\">Estimated Lifespan (years)</Label>\n                        <Input\n                          type=\"number\"\n                          value={component.estimatedLifespan || ''}\n                          onChange={(e) => {\n                            const newComponents = [...reportData.roofComponents];\n                            newComponents[index].estimatedLifespan = e.target.value ? parseInt(e.target.value) : undefined;\n                            setReportData(prev => ({ ...prev, roofComponents: newComponents }));\n                          }}\n                          className=\"bg-card text-foreground border-border\"\n                          placeholder=\"e.g., 20\"\n                        />\n                      </div>\n                    </div>\n                    <div className=\"mt-4\">\n                      <Label className=\"text-foreground\">Notes</Label>\n                      <Textarea\n                        value={component.notes || ''}\n                        onChange={(e) => {\n                          const newComponents = [...reportData.roofComponents];\n                          newComponents[index].notes = e.target.value;\n                          setReportData(prev => ({ ...prev, roofComponents: newComponents }));\n                        }}\n                        className=\"bg-card text-foreground border-border\"\n                        placeholder=\"Detailed notes about this component...\"\n                        rows={2}\n                      />\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        );\n\n      case 4: // Issues & Findings\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n              <h3 className=\"text-foreground font-semibold\">Issues & Findings</h3>\n              <Button \n                data-testid=\"button-add-issue\"\n                onClick={addIssue} \n                className=\"bg-primary text-primary-foreground touch-target\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Issue\n              </Button>\n            </div>\n            <div className=\"space-y-4\">\n              {reportData.issues.map((issue, index) => (\n                <Card key={issue.id} className=\"bg-card border-border\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <Label className=\"text-foreground\">Issue Title</Label>\n                        <Input\n                          value={issue.title}\n                          onChange={(e) => {\n                            const newIssues = [...reportData.issues];\n                            newIssues[index].title = e.target.value;\n                            setReportData(prev => ({ ...prev, issues: newIssues }));\n                          }}\n                          className=\"bg-card text-foreground border-border\"\n                          placeholder=\"e.g., Membrane Puncture, Drainage Blockage\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-foreground\">Severity</Label>\n                        <Select\n                          value={issue.severity}\n                          onValueChange={(value) => {\n                            const newIssues = [...reportData.issues];\n                            newIssues[index].severity = value as DetailedIssue['severity'];\n                            setReportData(prev => ({ ...prev, issues: newIssues }));\n                          }}\n                        >\n                          <SelectTrigger className=\"bg-card text-foreground border-border\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"critical\">Critical</SelectItem>\n                            <SelectItem value=\"major\">Major</SelectItem>\n                            <SelectItem value=\"minor\">Minor</SelectItem>\n                            <SelectItem value=\"informational\">Informational</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div>\n                        <Label className=\"text-foreground\">Location</Label>\n                        <Input\n                          value={issue.location}\n                          onChange={(e) => {\n                            const newIssues = [...reportData.issues];\n                            newIssues[index].location = e.target.value;\n                            setReportData(prev => ({ ...prev, issues: newIssues }));\n                          }}\n                          className=\"bg-card text-foreground border-border\"\n                          placeholder=\"e.g., North roof section, Building A\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-foreground\">Urgency</Label>\n                        <Select\n                          value={issue.urgency}\n                          onValueChange={(value) => {\n                            const newIssues = [...reportData.issues];\n                            newIssues[index].urgency = value as DetailedIssue['urgency'];\n                            setReportData(prev => ({ ...prev, issues: newIssues }));\n                          }}\n                        >\n                          <SelectTrigger className=\"bg-card text-foreground border-border\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"immediate\">Immediate</SelectItem>\n                            <SelectItem value=\"short_term\">Short Term</SelectItem>\n                            <SelectItem value=\"long_term\">Long Term</SelectItem>\n                            <SelectItem value=\"monitoring\">Monitoring</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n                    <div className=\"mt-4 space-y-4\">\n                      <div>\n                        <Label className=\"text-foreground\">Description</Label>\n                        <Textarea\n                          value={issue.description}\n                          onChange={(e) => {\n                            const newIssues = [...reportData.issues];\n                            newIssues[index].description = e.target.value;\n                            setReportData(prev => ({ ...prev, issues: newIssues }));\n                          }}\n                          className=\"bg-card text-foreground border-border\"\n                          placeholder=\"Detailed description of the issue...\"\n                          rows={3}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-foreground\">Recommended Action</Label>\n                        <Textarea\n                          value={issue.recommendedAction}\n                          onChange={(e) => {\n                            const newIssues = [...reportData.issues];\n                            newIssues[index].recommendedAction = e.target.value;\n                            setReportData(prev => ({ ...prev, issues: newIssues }));\n                          }}\n                          className=\"bg-card text-foreground border-border\"\n                          placeholder=\"Recommended action to address this issue...\"\n                          rows={2}\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        );\n\n      case 5: // Review & Generate\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <h3 className=\"text-foreground font-semibold text-lg mb-2\">Review Your Winn Report</h3>\n              <p className=\"text-muted-foreground\">Please review all collected data before generating the comprehensive report.</p>\n            </div>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <Card className=\"bg-card border-border\">\n                <CardContent className=\"p-4 text-center\">\n                  <div className=\"text-2xl font-bold text-primary\">{reportData.weatherConditions.length}</div>\n                  <div className=\"text-sm text-muted-foreground\">Weather Readings</div>\n                </CardContent>\n              </Card>\n              <Card className=\"bg-card border-border\">\n                <CardContent className=\"p-4 text-center\">\n                  <div className=\"text-2xl font-bold text-secondary\">{reportData.thermalReadings.length}</div>\n                  <div className=\"text-sm text-muted-foreground\">Thermal Readings</div>\n                </CardContent>\n              </Card>\n              <Card className=\"bg-card border-border\">\n                <CardContent className=\"p-4 text-center\">\n                  <div className=\"text-2xl font-bold text-accent\">{reportData.roofComponents.length}</div>\n                  <div className=\"text-sm text-muted-foreground\">Components</div>\n                </CardContent>\n              </Card>\n              <Card className=\"bg-card border-border\">\n                <CardContent className=\"p-4 text-center\">\n                  <div className=\"text-2xl font-bold text-destructive\">{reportData.issues.length}</div>\n                  <div className=\"text-sm text-muted-foreground\">Issues Found</div>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Card className=\"bg-card border-border\">\n              <CardHeader>\n                <CardTitle className=\"text-foreground\">Report Summary</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Inspector:</span>\n                    <span className=\"text-foreground\">{reportData.inspector}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Inspection Date:</span>\n                    <span className=\"text-foreground\">{reportData.inspectionDate.toLocaleDateString()}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Critical Issues:</span>\n                    <span className=\"text-destructive font-semibold\">\n                      {reportData.issues.filter(i => i.severity === 'critical').length}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Estimated Report Pages:</span>\n                    <span className=\"text-foreground font-semibold\">\n                      {Math.max(300, reportData.roofComponents.length * 15 + reportData.issues.length * 8 + reportData.thermalReadings.length * 3)}+\n                    </span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className=\"max-w-7xl mx-auto p-4 md:p-6 pb-32 md:pb-6\">\n      <div className=\"mb-6 md:mb-8\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h1 className=\"text-2xl md:text-3xl font-bold text-foreground\">Winn Report Generation</h1>\n          <Badge variant=\"outline\" className=\"text-primary border-primary hidden md:inline-flex\">\n            Step {currentStep + 1} of {WORKFLOW_STEPS.length}\n          </Badge>\n        </div>\n        <Progress value={progressPercentage} className=\"mb-4\" />\n        <div className=\"hidden md:flex justify-between text-sm text-muted-foreground\">\n          {WORKFLOW_STEPS.map((step, index) => (\n            <div key={step.id} className={`flex items-center ${index <= currentStep ? 'text-primary' : ''}`}>\n              <step.icon className=\"h-4 w-4 mr-1\" />\n              {step.title}\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Main Content Grid: Workflow Steps + AI Assistant */}\n      <div className=\"grid grid-cols-1 xl:grid-cols-3 gap-6\">\n        {/* Workflow Content - Takes 2/3 of the width */}\n        <div className=\"xl:col-span-2\">\n          <Card className=\"bg-card border-border shadow-lg\">\n            <CardHeader>\n              <CardTitle className=\"text-foreground flex items-center\">\n                {React.createElement(WORKFLOW_STEPS[currentStep].icon, { className: \"h-5 w-5 mr-2\" })}\n                {WORKFLOW_STEPS[currentStep].title}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"min-h-[500px]\">\n              {renderStepContent()}\n            </CardContent>\n          </Card>\n\n          {/* Desktop Navigation - Hidden on mobile */}\n          <div className=\"hidden md:flex justify-between mt-6\">\n            <Button \n              data-testid=\"button-previous-step\"\n              onClick={prevStep} \n              disabled={currentStep === 0}\n              variant=\"outline\"\n              className=\"border-border text-foreground touch-target\"\n            >\n              Previous\n            </Button>\n            {currentStep === WORKFLOW_STEPS.length - 1 ? (\n              <Button \n                data-testid=\"button-generate-report\"\n                onClick={() => onComplete(reportData)}\n                className=\"bg-primary text-primary-foreground touch-target\"\n              >\n                Generate Winn Report\n              </Button>\n            ) : (\n              <Button \n                data-testid=\"button-next-step\"\n                onClick={nextStep}\n                className=\"bg-primary text-primary-foreground touch-target\"\n              >\n                Next\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {/* AI Assistant Panel - Takes 1/3 of the width */}\n        <div className=\"xl:col-span-1\">\n          <div className=\"sticky top-6\">\n            <AIInspectionAssistant\n              currentStep={WORKFLOW_STEPS[currentStep]?.id}\n              propertyData={reportData.buildingInfo}\n              thermalData={reportData.thermalReadings}\n              roofSections={reportData.buildingInfo.roofSections}\n              weatherData={reportData.weatherConditions}\n              issues={reportData.issues}\n              components={reportData.roofComponents}\n              onGuidanceReceived={() => {}}\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Mobile Navigation - Fixed bottom bar */}\n      <MobileWorkflowNav\n        currentStep={currentStep}\n        totalSteps={WORKFLOW_STEPS.length}\n        onPrevious={prevStep}\n        onNext={nextStep}\n        onComplete={() => onComplete(reportData)}\n        isFirstStep={currentStep === 0}\n        isLastStep={currentStep === WORKFLOW_STEPS.length - 1}\n        stepTitle={WORKFLOW_STEPS[currentStep].title}\n      />\n    </div>\n  );\n};","path":null,"size_bytes":37803,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/pages/upload.tsx":{"content":"import { useState, useRef } from 'react';\nimport { useMutation } from '@tanstack/react-query';\nimport { useLocation } from 'wouter';\nimport { Header, Footer } from '@/components/navbar';\nimport { \n  Card, \n  CardContent \n} from '@/components/ui/card';\nimport { \n  Input \n} from '@/components/ui/input';\nimport { \n  Label \n} from '@/components/ui/label';\nimport { \n  Textarea \n} from '@/components/ui/textarea';\nimport { \n  Button \n} from '@/components/ui/button';\nimport {\n  ArrowLeft, \n  Upload as UploadIcon, \n  CloudUpload, \n  Check, \n  Image\n} from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { uploadFile } from '@/lib/firebase';\nimport { queryClient } from '@/lib/queryClient';\nimport { SEO } from '@/components/seo';\n\ninterface FileUploadItem {\n  id: string;\n  file: File;\n  progress: number;\n  status: 'pending' | 'uploading' | 'success' | 'error';\n  url?: string;\n  error?: string;\n}\n\nconst UploadPage = () => {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [propertyName, setPropertyName] = useState('');\n  const [address, setAddress] = useState('');\n  const [scanType, setScanType] = useState<'drone' | 'handheld'>('drone');\n  const [notes, setNotes] = useState('');\n  const [files, setFiles] = useState<FileUploadItem[]>([]);\n\n  const uploadMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest('/api/properties', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data)\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/properties'] });\n      window.hideLoading();\n      navigate('/dashboard');\n      toast({\n        title: 'Upload successful',\n        description: 'Your thermal scan has been uploaded and analyzed',\n      });\n    },\n    onError: (error) => {\n      window.hideLoading();\n      toast({\n        title: 'Upload failed',\n        description: error.message || 'There was an error uploading your scan',\n        variant: 'destructive',\n      });\n    }\n  });\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!e.target.files?.length) return;\n    \n    const newFiles = Array.from(e.target.files).map(file => ({\n      id: Math.random().toString(36).substring(2, 11),\n      file,\n      progress: 0,\n      status: 'pending' as const\n    }));\n    \n    setFiles([...files, ...newFiles]);\n    \n    // Reset input value so the same file can be selected again\n    e.target.value = '';\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    if (e.dataTransfer.files?.length) {\n      const newFiles = Array.from(e.dataTransfer.files).map(file => ({\n        id: Math.random().toString(36).substring(2, 11),\n        file,\n        progress: 0,\n        status: 'pending' as const\n      }));\n      \n      setFiles([...files, ...newFiles]);\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!propertyName || !address) {\n      toast({\n        title: 'Missing information',\n        description: 'Please provide a property name and address',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    if (files.length === 0) {\n      toast({\n        title: 'No files selected',\n        description: 'Please upload at least one thermal image',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    // Show loading overlay\n    window.showLoading('Analyzing thermal data...', 'Identifying hotspots and moisture infiltration');\n\n    try {\n      let imageUrls: string[] = [];\n      \n      // Upload files to Firebase Storage\n      try {\n        const uploadPromises = files.map(async (file) => {\n          const path = `scans/${Date.now()}_${file.file.name}`;\n          const { downloadURL } = await uploadFile(file.file, path);\n          return downloadURL;\n        });\n        imageUrls = await Promise.all(uploadPromises);\n      } catch (uploadError) {\n        console.error('Firebase upload error:', uploadError);\n        // If Firebase is not configured, use mock URLs for demo\n        imageUrls = files.map(f => `https://storage.demo.com/scans/${f.file.name}`);\n      }\n      \n      // Submit property data with image URLs\n      const propertyData = {\n        name: propertyName,\n        address,\n        scanType,\n        notes,\n        imageUrls,\n        captureDate: new Date().toISOString()\n      };\n\n      uploadMutation.mutate(propertyData);\n      \n    } catch (error: any) {\n      window.hideLoading();\n      toast({\n        title: 'Upload failed',\n        description: error.message || 'There was an error uploading your files',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024) return bytes + ' B';\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n  };\n\n  const formatDate = (date: Date) => {\n    const diffDays = Math.round((new Date().getTime() - date.getTime()) / (1000 * 3600 * 24));\n    \n    if (diffDays === 0) return 'Today';\n    if (diffDays === 1) return 'Yesterday';\n    if (diffDays < 7) return `${diffDays} days ago`;\n    return date.toLocaleDateString();\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative\">\n      <SEO\n        title=\"Upload Thermal Scan\"\n        description=\"Upload thermal imagery for AI-powered damage assessment analysis. Supports FLIR and compatible thermal cameras.\"\n        canonical=\"/upload\"\n        noindex={true}\n      />\n      <Header />\n      \n      <main className=\"flex-grow pb-20\">\n        <div className=\"p-4\">\n          <div className=\"flex items-center mb-4\">\n            <button className=\"mr-2\" onClick={() => navigate('/dashboard')}>\n              <ArrowLeft className=\"text-neutral-dark\" />\n            </button>\n            <div>\n              <h2 className=\"text-xl font-semibold text-neutral-darker\">Upload Thermal Scan</h2>\n              <p className=\"text-neutral-dark text-sm\">Upload thermal imagery for analysis</p>\n            </div>\n          </div>\n\n          {/* Upload Form */}\n          <Card className=\"mb-6\">\n            <CardContent className=\"p-4\">\n              <div className=\"mb-6\">\n                <Label className=\"block text-neutral-darker text-sm font-medium mb-2\">\n                  Property Information\n                </Label>\n                <Input\n                  value={propertyName}\n                  onChange={(e) => setPropertyName(e.target.value)}\n                  className=\"w-full p-3 border border-neutral-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-primary mb-3\"\n                  placeholder=\"Property Name (e.g. Office Complex)\"\n                />\n                <Input\n                  value={address}\n                  onChange={(e) => setAddress(e.target.value)}\n                  className=\"w-full p-3 border border-neutral-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\"\n                  placeholder=\"Address\"\n                />\n              </div>\n\n              <div className=\"mb-6\">\n                <Label className=\"block text-neutral-darker text-sm font-medium mb-2\">\n                  Upload Thermal Images\n                </Label>\n                {/* Drag and Drop Area */}\n                <div\n                  className=\"border-2 border-dashed border-neutral-medium rounded-lg p-8 text-center cursor-pointer hover:bg-neutral-light transition\"\n                  onClick={() => fileInputRef.current?.click()}\n                  onDragOver={handleDragOver}\n                  onDrop={handleDrop}\n                >\n                  <CloudUpload className=\"h-12 w-12 text-neutral-dark mx-auto\" />\n                  <p className=\"mt-2 text-neutral-darker font-medium\">Drag & drop files or click to browse</p>\n                  <p className=\"text-sm text-neutral-dark mt-1\">Supports JPEG, PNG and MP4 from FLIR-compatible devices</p>\n                  <input\n                    ref={fileInputRef}\n                    id=\"file-upload\"\n                    type=\"file\"\n                    className=\"hidden\"\n                    multiple\n                    accept=\".jpg,.jpeg,.png,.mp4\"\n                    onChange={handleFileSelect}\n                  />\n                </div>\n\n                {/* File List */}\n                {files.length > 0 && (\n                  <div className=\"mt-4 space-y-2\">\n                    {files.map((file) => (\n                      <div key={file.id} className=\"flex items-center p-2 border border-neutral-medium rounded-lg\">\n                        <Image className=\"text-neutral-dark mr-3\" />\n                        <div className=\"flex-grow\">\n                          <p className=\"text-sm font-medium text-neutral-darker\">{file.file.name}</p>\n                          <p className=\"text-xs text-neutral-dark\">{formatFileSize(file.file.size)}</p>\n                        </div>\n                        {file.status === 'success' ? (\n                          <Check className=\"text-success\" />\n                        ) : (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setFiles(files.filter(f => f.id !== file.id));\n                            }}\n                          >\n                            Remove\n                          </Button>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              {/* Upload Options */}\n              <div className=\"mb-6\">\n                <Label className=\"block text-neutral-darker text-sm font-medium mb-2\">\n                  Scan Type\n                </Label>\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div \n                    className={`border rounded-lg p-3 flex items-center cursor-pointer ${\n                      scanType === 'drone' ? 'border-primary bg-blue-50' : 'border-neutral-medium'\n                    }`}\n                    onClick={() => setScanType('drone')}\n                  >\n                    <input\n                      type=\"radio\"\n                      name=\"scan-type\"\n                      id=\"drone\"\n                      className=\"h-4 w-4 text-primary focus:ring-primary\"\n                      checked={scanType === 'drone'}\n                      onChange={() => setScanType('drone')}\n                    />\n                    <Label htmlFor=\"drone\" className=\"ml-2 block text-sm text-neutral-darker cursor-pointer\">\n                      Drone Capture\n                    </Label>\n                  </div>\n                  <div \n                    className={`border rounded-lg p-3 flex items-center cursor-pointer ${\n                      scanType === 'handheld' ? 'border-primary bg-blue-50' : 'border-neutral-medium'\n                    }`}\n                    onClick={() => setScanType('handheld')}\n                  >\n                    <input\n                      type=\"radio\"\n                      name=\"scan-type\"\n                      id=\"handheld\"\n                      className=\"h-4 w-4 text-primary focus:ring-primary\"\n                      checked={scanType === 'handheld'}\n                      onChange={() => setScanType('handheld')}\n                    />\n                    <Label htmlFor=\"handheld\" className=\"ml-2 block text-sm text-neutral-darker cursor-pointer\">\n                      Handheld Camera\n                    </Label>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"mb-6\">\n                <Label htmlFor=\"notes\" className=\"block text-neutral-darker text-sm font-medium mb-2\">\n                  Additional Notes\n                </Label>\n                <Textarea\n                  id=\"notes\"\n                  value={notes}\n                  onChange={(e) => setNotes(e.target.value)}\n                  className=\"w-full p-3 border border-neutral-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-primary h-24\"\n                  placeholder=\"Add any relevant details about the property or scan conditions...\"\n                />\n              </div>\n\n              <Button\n                className=\"w-full bg-primary hover:bg-primary-light text-white font-medium py-3 px-4 rounded-lg transition flex items-center justify-center\"\n                onClick={handleUpload}\n                disabled={uploadMutation.isPending}\n              >\n                <UploadIcon className=\"mr-2 h-5 w-5\" />\n                {uploadMutation.isPending ? 'Uploading...' : 'Upload & Analyze'}\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n};\n\nexport default UploadPage;\n","path":null,"size_bytes":13104,"size_tokens":null},"client/src/components/crm-sync.tsx":{"content":"import React, { useState } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Badge } from '@/components/ui/badge';\nimport { useToast } from '@/hooks/use-toast';\nimport { Upload, Database, CheckCircle, AlertCircle, User, Building } from 'lucide-react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { Property, Scan } from '@shared/schema';\n\ninterface CrmConfig {\n  id: number;\n  name: string;\n  type: string;\n  isActive: boolean;\n}\n\ninterface CrmSyncProps {\n  property: Property;\n  scan: Scan;\n}\n\ninterface OwnerInfo {\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n  company?: string;\n  address?: {\n    street: string;\n    city: string;\n    state: string;\n    zipCode: string;\n  };\n}\n\nexport const CrmSync: React.FC<CrmSyncProps> = ({ property, scan }) => {\n  const [selectedCrmId, setSelectedCrmId] = useState<number | null>(null);\n  const [ownerInfo, setOwnerInfo] = useState<OwnerInfo>({\n    firstName: '',\n    lastName: '',\n    email: '',\n    phone: '',\n    company: '',\n    address: {\n      street: property.address || '',\n      city: '',\n      state: '',\n      zipCode: ''\n    }\n  });\n  const [isExpanded, setIsExpanded] = useState(false);\n  const { toast } = useToast();\n\n  // Fetch available CRM configurations\n  const { data: crmConfigs = [], isLoading } = useQuery<CrmConfig[]>({\n    queryKey: ['/api/crm/configs'],\n    queryFn: () => apiRequest('/api/crm/configs'),\n  });\n\n  const activeCrmConfigs = crmConfigs.filter(config => config.isActive);\n\n  // Sync to CRM mutation\n  const syncMutation = useMutation({\n    mutationFn: async (data: { crmConfigId: number; propertyId: number; ownerInfo: OwnerInfo }) => {\n      return apiRequest('/api/crm/sync/property', {\n        method: 'POST',\n        body: JSON.stringify(data)\n      });\n    },\n    onSuccess: (data) => {\n      const successResults = data.results.filter((r: any) => r.success);\n      const failedResults = data.results.filter((r: any) => !r.success);\n      \n      if (successResults.length > 0) {\n        toast({\n          title: \"CRM Sync Successful\",\n          description: `Successfully synced ${successResults.length} item(s) to CRM.`,\n        });\n      }\n      \n      if (failedResults.length > 0) {\n        toast({\n          title: \"Partial Sync Failure\",\n          description: `${failedResults.length} item(s) failed to sync. Check the logs for details.`,\n          variant: \"destructive\",\n        });\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"CRM Sync Failed\",\n        description: error.message || \"Failed to sync property data to CRM.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleSync = () => {\n    if (!selectedCrmId) {\n      toast({\n        title: \"No CRM Selected\",\n        description: \"Please select a CRM configuration first.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!ownerInfo.firstName || !ownerInfo.lastName || !ownerInfo.email) {\n      toast({\n        title: \"Missing Owner Information\",\n        description: \"Please provide at least first name, last name, and email.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    syncMutation.mutate({\n      crmConfigId: selectedCrmId,\n      propertyId: property.id,\n      ownerInfo\n    });\n  };\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'critical': return 'bg-red-600';\n      case 'major': return 'bg-orange-600';\n      case 'minor': return 'bg-yellow-600';\n      default: return 'bg-blue-600';\n    }\n  };\n\n  const getCrmTypeIcon = (type: string) => {\n    switch (type) {\n      case 'jobnimbus': return '🔧';\n      case 'gohighlevel': return '📈';\n      case 'salesforce': return '☁️';\n      case 'hubspot': return '🟠';\n      case 'pipedrive': return '🔵';\n      default: return '📊';\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Card className=\"bg-card border-border\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-red-600\"></div>\n            <span className=\"ml-2 text-muted-foreground\">Loading CRM configurations...</span>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (activeCrmConfigs.length === 0) {\n    return (\n      <Card className=\"bg-card border-border\">\n        <CardContent className=\"p-6\">\n          <div className=\"text-center text-muted-foreground\">\n            <Database className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n            <p>No active CRM integrations found.</p>\n            <p className=\"text-sm mt-1\">Configure a CRM integration to sync property data.</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"bg-card border-border\">\n      <CardHeader>\n        <CardTitle className=\"text-foreground flex items-center gap-2\">\n          <Database className=\"w-5 h-5\" />\n          CRM Integration\n        </CardTitle>\n        <CardDescription className=\"text-muted-foreground\">\n          Sync property data and inspection results to your CRM system\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {/* CRM Selection */}\n        <div>\n          <Label htmlFor=\"crm-select\" className=\"text-foreground\">Select CRM</Label>\n          <Select value={selectedCrmId?.toString()} onValueChange={(value) => setSelectedCrmId(parseInt(value))}>\n            <SelectTrigger className=\"bg-muted border-input text-foreground\">\n              <SelectValue placeholder=\"Choose a CRM integration\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-muted border-input\">\n              {activeCrmConfigs.map((config) => (\n                <SelectItem key={config.id} value={config.id.toString()}>\n                  <div className=\"flex items-center gap-2\">\n                    <span>{getCrmTypeIcon(config.type)}</span>\n                    <span>{config.name}</span>\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {config.type}\n                    </Badge>\n                  </div>\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Property Summary */}\n        <div className=\"bg-muted p-4 rounded-lg\">\n          <h4 className=\"text-foreground font-medium mb-2 flex items-center gap-2\">\n            <Building className=\"w-4 h-4\" />\n            Property Summary\n          </h4>\n          <div className=\"grid grid-cols-2 gap-4 text-sm\">\n            <div>\n              <span className=\"text-muted-foreground\">Name:</span>\n              <p className=\"text-foreground\">{property.name}</p>\n            </div>\n            <div>\n              <span className=\"text-muted-foreground\">Health Score:</span>\n              <p className=\"text-foreground\">{property.healthScore}/100</p>\n            </div>\n            <div>\n              <span className=\"text-muted-foreground\">Address:</span>\n              <p className=\"text-foreground\">{property.address}</p>\n            </div>\n            <div>\n              <span className=\"text-muted-foreground\">Issues Found:</span>\n              <p className=\"text-foreground\">{scan.issues.length} issues</p>\n            </div>\n          </div>\n          \n          {/* Issues Preview */}\n          {scan.issues.length > 0 && (\n            <div className=\"mt-3\">\n              <p className=\"text-muted-foreground text-sm mb-2\">Critical Issues:</p>\n              <div className=\"flex flex-wrap gap-1\">\n                {scan.issues.filter(issue => issue.severity === 'critical').slice(0, 3).map((issue, index) => (\n                  <Badge key={index} className={`${getSeverityColor(issue.severity)} text-foreground text-xs`}>\n                    {issue.title}\n                  </Badge>\n                ))}\n                {scan.issues.filter(issue => issue.severity === 'critical').length > 3 && (\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    +{scan.issues.filter(issue => issue.severity === 'critical').length - 3} more\n                  </Badge>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Owner Information */}\n        <div>\n          <Button\n            variant=\"outline\"\n            onClick={() => setIsExpanded(!isExpanded)}\n            className=\"w-full justify-between border-input text-foreground hover:bg-muted\"\n          >\n            <span className=\"flex items-center gap-2\">\n              <User className=\"w-4 h-4\" />\n              Property Owner Information\n            </span>\n            <span>{isExpanded ? '−' : '+'}</span>\n          </Button>\n          \n          {isExpanded && (\n            <div className=\"mt-4 space-y-3 bg-muted p-4 rounded-lg\">\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div>\n                  <Label htmlFor=\"firstName\" className=\"text-foreground\">First Name *</Label>\n                  <Input\n                    id=\"firstName\"\n                    value={ownerInfo.firstName}\n                    onChange={(e) => setOwnerInfo(prev => ({ ...prev, firstName: e.target.value }))}\n                    className=\"bg-input border-border text-foreground\"\n                    placeholder=\"John\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"lastName\" className=\"text-foreground\">Last Name *</Label>\n                  <Input\n                    id=\"lastName\"\n                    value={ownerInfo.lastName}\n                    onChange={(e) => setOwnerInfo(prev => ({ ...prev, lastName: e.target.value }))}\n                    className=\"bg-input border-border text-foreground\"\n                    placeholder=\"Doe\"\n                  />\n                </div>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-3\">\n                <div>\n                  <Label htmlFor=\"email\" className=\"text-foreground\">Email *</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={ownerInfo.email}\n                    onChange={(e) => setOwnerInfo(prev => ({ ...prev, email: e.target.value }))}\n                    className=\"bg-input border-border text-foreground\"\n                    placeholder=\"john@example.com\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"phone\" className=\"text-foreground\">Phone</Label>\n                  <Input\n                    id=\"phone\"\n                    value={ownerInfo.phone}\n                    onChange={(e) => setOwnerInfo(prev => ({ ...prev, phone: e.target.value }))}\n                    className=\"bg-input border-border text-foreground\"\n                    placeholder=\"(555) 123-4567\"\n                  />\n                </div>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"company\" className=\"text-foreground\">Company</Label>\n                <Input\n                  id=\"company\"\n                  value={ownerInfo.company}\n                  onChange={(e) => setOwnerInfo(prev => ({ ...prev, company: e.target.value }))}\n                  className=\"bg-input border-border text-foreground\"\n                  placeholder=\"Company Name\"\n                />\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-3\">\n                <div>\n                  <Label htmlFor=\"city\" className=\"text-foreground\">City</Label>\n                  <Input\n                    id=\"city\"\n                    value={ownerInfo.address?.city || ''}\n                    onChange={(e) => setOwnerInfo(prev => ({ \n                      ...prev, \n                      address: { ...prev.address!, city: e.target.value }\n                    }))}\n                    className=\"bg-input border-border text-foreground\"\n                    placeholder=\"City\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"state\" className=\"text-foreground\">State</Label>\n                  <Input\n                    id=\"state\"\n                    value={ownerInfo.address?.state || ''}\n                    onChange={(e) => setOwnerInfo(prev => ({ \n                      ...prev, \n                      address: { ...prev.address!, state: e.target.value }\n                    }))}\n                    className=\"bg-input border-border text-foreground\"\n                    placeholder=\"State\"\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Sync Button */}\n        <Button\n          onClick={handleSync}\n          disabled={!selectedCrmId || syncMutation.isPending}\n          className=\"w-full bg-gradient-to-r from-primary to-cyan-500 hover:from-primary/90 hover:to-cyan-500/90 disabled:opacity-50\"\n        >\n          {syncMutation.isPending ? (\n            <>\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n              Syncing to CRM...\n            </>\n          ) : (\n            <>\n              <Upload className=\"w-4 h-4 mr-2\" />\n              Sync to CRM\n            </>\n          )}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default CrmSync;","path":null,"size_bytes":13744,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/thermal-analysis.tsx":{"content":"import React, { useState, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Upload, Camera, Thermometer, AlertTriangle, CheckCircle, Clock, Activity, X } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { ThermalReading, DetailedIssue, InspectionMetric } from '@shared/schema';\nimport { CameraCapture } from './camera-capture';\n\ninterface ThermalAnalysisResult {\n  thermalReadings: ThermalReading[];\n  issues: DetailedIssue[];\n  metrics: InspectionMetric[];\n  summary: string;\n  recommendations: string[];\n  confidence: number;\n}\n\ninterface ThermalAnalysisProps {\n  onAnalysisComplete: (result: ThermalAnalysisResult) => void;\n  location: string;\n  ambientTemp?: number;\n  humidity?: number;\n}\n\nexport const ThermalAnalysis: React.FC<ThermalAnalysisProps> = ({\n  onAnalysisComplete,\n  location,\n  ambientTemp,\n  humidity\n}) => {\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\n  const [analyzing, setAnalyzing] = useState(false);\n  const [analysisProgress, setAnalysisProgress] = useState(0);\n  const [results, setResults] = useState<ThermalAnalysisResult[]>([]);\n  const [activeTab, setActiveTab] = useState(\"upload\");\n  const { toast } = useToast();\n\n  const handleFileSelect = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(event.target.files || []);\n    const validFiles = files.filter(file => file.type.startsWith('image/'));\n    \n    if (validFiles.length !== files.length) {\n      toast({\n        title: \"Invalid Files\",\n        description: \"Only image files are supported for thermal analysis\",\n        variant: \"destructive\",\n      });\n    }\n    \n    // Merge with existing files, avoiding duplicates by name\n    setSelectedFiles(prev => {\n      const existingNames = new Set(prev.map(f => f.name));\n      const newFiles = validFiles.filter(f => !existingNames.has(f.name));\n      return [...prev, ...newFiles];\n    });\n  }, [toast]);\n\n  const handleCameraCapture = useCallback((imageData: string, filename: string) => {\n    // Convert base64 to File object\n    const byteString = atob(imageData.split(',')[1]);\n    const mimeString = imageData.split(',')[0].split(':')[1].split(';')[0];\n    const ab = new ArrayBuffer(byteString.length);\n    const ia = new Uint8Array(ab);\n    for (let i = 0; i < byteString.length; i++) {\n      ia[i] = byteString.charCodeAt(i);\n    }\n    const blob = new Blob([ab], { type: mimeString });\n    const file = new File([blob], filename, { type: mimeString });\n    \n    setSelectedFiles(prev => [...prev, file]);\n  }, []);\n\n  const convertToBase64 = (file: File): Promise<string> => {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const base64 = reader.result as string;\n        resolve(base64.split(',')[1]); // Remove data:image/jpeg;base64, prefix\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(file);\n    });\n  };\n\n  const analyzeImage = async (file: File): Promise<ThermalAnalysisResult> => {\n    try {\n      const base64 = await convertToBase64(file);\n      \n      const response = await apiRequest('/api/thermal/analyze', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          imageBase64: base64,\n          metadata: {\n            location,\n            timestamp: new Date().toISOString(),\n            ambientTemp,\n            humidity\n          }\n        })\n      });\n      \n      return response;\n    } catch (error) {\n      console.error('Analysis error:', error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      throw new Error(`Failed to analyze ${file.name}: ${errorMessage}`);\n    }\n  };\n\n  const handleAnalyze = async () => {\n    if (selectedFiles.length === 0) {\n      toast({\n        title: \"No Files Selected\",\n        description: \"Please select thermal images to analyze\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setAnalyzing(true);\n    setAnalysisProgress(0);\n    setResults([]);\n\n    try {\n      const analysisResults: ThermalAnalysisResult[] = [];\n      \n      for (let i = 0; i < selectedFiles.length; i++) {\n        const file = selectedFiles[i];\n        setAnalysisProgress(((i + 0.5) / selectedFiles.length) * 100);\n        \n        const result = await analyzeImage(file);\n        analysisResults.push(result);\n        \n        setAnalysisProgress(((i + 1) / selectedFiles.length) * 100);\n      }\n      \n      setResults(analysisResults);\n      setActiveTab(\"results\");\n      \n      // Combine all results for the parent component\n      const combinedResult: ThermalAnalysisResult = {\n        thermalReadings: analysisResults.flatMap(r => r.thermalReadings),\n        issues: analysisResults.flatMap(r => r.issues),\n        metrics: analysisResults.flatMap(r => r.metrics),\n        summary: analysisResults.map(r => r.summary).join('\\n\\n'),\n        recommendations: analysisResults.flatMap(r => r.recommendations),\n        confidence: analysisResults.reduce((acc, r) => acc + r.confidence, 0) / analysisResults.length\n      };\n      \n      onAnalysisComplete(combinedResult);\n      \n      toast({\n        title: \"Analysis Complete\",\n        description: `Successfully analyzed ${selectedFiles.length} thermal images`,\n      });\n      \n    } catch (error) {\n      console.error('Analysis failed:', error);\n      const errorMessage = error instanceof Error ? error.message : 'Failed to analyze thermal images';\n      toast({\n        title: \"Analysis Failed\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    } finally {\n      setAnalyzing(false);\n      setAnalysisProgress(0);\n    }\n  };\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'critical': return 'bg-red-500';\n      case 'major': return 'bg-orange-500';\n      case 'minor': return 'bg-yellow-500';\n      default: return 'bg-blue-500';\n    }\n  };\n\n  const getAlertLevelColor = (level: string) => {\n    switch (level) {\n      case 'critical': return 'text-red-500';\n      case 'warning': return 'text-orange-500';\n      case 'caution': return 'text-yellow-500';\n      default: return 'text-green-500';\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center space-x-2\">\n              <Thermometer className=\"h-5 w-5 text-blue-500\" />\n              <div>\n                <p className=\"text-sm font-medium\">Location</p>\n                <p className=\"text-xs text-muted-foreground\">{location}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        \n        {ambientTemp && (\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-2\">\n                <Activity className=\"h-5 w-5 text-orange-500\" />\n                <div>\n                  <p className=\"text-sm font-medium\">Ambient Temp</p>\n                  <p className=\"text-xs text-muted-foreground\">{ambientTemp}°F</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n        \n        {humidity && (\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-2\">\n                <Clock className=\"h-5 w-5 text-cyan-500\" />\n                <div>\n                  <p className=\"text-sm font-medium\">Humidity</p>\n                  <p className=\"text-xs text-muted-foreground\">{humidity}%</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Camera className=\"h-5 w-5 mr-2\" />\n            AI Thermal Analysis\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Tabs value={activeTab} onValueChange={setActiveTab}>\n            <TabsList className=\"grid w-full grid-cols-3\">\n              <TabsTrigger value=\"upload\">Upload Images</TabsTrigger>\n              <TabsTrigger value=\"analyze\">Analyze</TabsTrigger>\n              <TabsTrigger value=\"results\">Results</TabsTrigger>\n            </TabsList>\n            \n            <TabsContent value=\"upload\" className=\"space-y-4\">\n              <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center\">\n                <Upload className=\"h-12 w-12 mx-auto text-gray-400 mb-4\" />\n                <div className=\"space-y-4\">\n                  <Label htmlFor=\"thermal-images\" className=\"text-lg font-medium cursor-pointer\">\n                    Select Thermal Images\n                  </Label>\n                  \n                  <div className=\"flex flex-col sm:flex-row gap-2 justify-center\">\n                    <Button\n                      data-testid=\"button-choose-files\"\n                      onClick={() => document.getElementById('thermal-images')?.click()}\n                      className=\"touch-target\"\n                    >\n                      Choose Files\n                    </Button>\n                    \n                    <CameraCapture\n                      onCapture={handleCameraCapture}\n                      buttonLabel=\"Take Photo\"\n                      captureType=\"thermal\"\n                      className=\"w-full sm:w-auto\"\n                    />\n                  </div>\n                  \n                  <Input\n                    id=\"thermal-images\"\n                    type=\"file\"\n                    multiple\n                    accept=\"image/*\"\n                    onChange={handleFileSelect}\n                    className=\"hidden\"\n                  />\n                  <p className=\"text-sm text-muted-foreground\">\n                    Upload or capture thermal images for AI analysis\n                  </p>\n                </div>\n              </div>\n              \n              {selectedFiles.length > 0 && (\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <h4 className=\"font-medium\">Selected Files ({selectedFiles.length}):</h4>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setSelectedFiles([])}\n                      className=\"text-destructive hover:text-destructive\"\n                    >\n                      Clear All\n                    </Button>\n                  </div>\n                  <div className=\"space-y-1\">\n                    {selectedFiles.map((file, index) => (\n                      <div key={index} className=\"flex items-center justify-between p-2 bg-muted rounded gap-2\">\n                        <span className=\"text-sm truncate flex-1\">{file.name}</span>\n                        <div className=\"flex items-center gap-2\">\n                          <Badge variant=\"secondary\">{(file.size / 1024 / 1024).toFixed(1)} MB</Badge>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => setSelectedFiles(prev => prev.filter((_, i) => i !== index))}\n                            className=\"h-6 w-6 p-0 text-destructive hover:text-destructive\"\n                          >\n                            <X className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </TabsContent>\n            \n            <TabsContent value=\"analyze\" className=\"space-y-4\">\n              <div className=\"text-center space-y-4\">\n                <div className=\"flex items-center justify-center space-x-2\">\n                  <Activity className=\"h-8 w-8 text-primary\" />\n                  <h3 className=\"text-lg font-medium\">AI Analysis Engine</h3>\n                </div>\n                \n                <p className=\"text-muted-foreground\">\n                  Advanced thermal imaging analysis powered by AI\n                </p>\n                \n                {analyzing && (\n                  <div className=\"space-y-2\">\n                    <Progress value={analysisProgress} className=\"w-full\" />\n                    <p className=\"text-sm text-muted-foreground\">\n                      Analyzing thermal images... {Math.round(analysisProgress)}%\n                    </p>\n                  </div>\n                )}\n                \n                <Button \n                  onClick={handleAnalyze}\n                  disabled={selectedFiles.length === 0 || analyzing}\n                  className=\"w-full\"\n                >\n                  {analyzing ? 'Analyzing...' : `Analyze ${selectedFiles.length} Image${selectedFiles.length !== 1 ? 's' : ''}`}\n                </Button>\n              </div>\n            </TabsContent>\n            \n            <TabsContent value=\"results\" className=\"space-y-4\">\n              {results.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <AlertTriangle className=\"h-12 w-12 mx-auto text-gray-400 mb-4\" />\n                  <p className=\"text-muted-foreground\">No analysis results yet</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {results.map((result, index) => (\n                    <Card key={index}>\n                      <CardHeader>\n                        <CardTitle className=\"flex items-center justify-between\">\n                          <span>Analysis {index + 1}</span>\n                          <Badge variant={result.confidence > 0.8 ? \"default\" : \"secondary\"}>\n                            {Math.round(result.confidence * 100)}% confidence\n                          </Badge>\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <Tabs defaultValue=\"summary\">\n                          <TabsList className=\"grid w-full grid-cols-4\">\n                            <TabsTrigger value=\"summary\">Summary</TabsTrigger>\n                            <TabsTrigger value=\"readings\">Readings</TabsTrigger>\n                            <TabsTrigger value=\"issues\">Issues</TabsTrigger>\n                            <TabsTrigger value=\"metrics\">Metrics</TabsTrigger>\n                          </TabsList>\n                          \n                          <TabsContent value=\"summary\" className=\"space-y-4\">\n                            <div className=\"prose prose-sm max-w-none\">\n                              <p className=\"text-sm\">{result.summary}</p>\n                            </div>\n                            \n                            {result.recommendations.length > 0 && (\n                              <div>\n                                <h4 className=\"font-medium mb-2\">Recommendations:</h4>\n                                <ul className=\"text-sm space-y-1\">\n                                  {result.recommendations.map((rec, i) => (\n                                    <li key={i} className=\"flex items-start\">\n                                      <CheckCircle className=\"h-4 w-4 text-green-500 mr-2 mt-0.5 flex-shrink-0\" />\n                                      {rec}\n                                    </li>\n                                  ))}\n                                </ul>\n                              </div>\n                            )}\n                          </TabsContent>\n                          \n                          <TabsContent value=\"readings\">\n                            <ScrollArea className=\"h-64\">\n                              <div className=\"space-y-2\">\n                                {result.thermalReadings.map((reading, i) => (\n                                  <div key={i} className=\"flex items-center justify-between p-2 bg-muted rounded\">\n                                    <div>\n                                      <p className=\"font-medium\">{reading.location}</p>\n                                      <p className=\"text-sm text-muted-foreground\">\n                                        {reading.temperature}°F\n                                      </p>\n                                    </div>\n                                    <Badge className={getAlertLevelColor(reading.alertLevel)}>\n                                      {reading.alertLevel}\n                                    </Badge>\n                                  </div>\n                                ))}\n                              </div>\n                            </ScrollArea>\n                          </TabsContent>\n                          \n                          <TabsContent value=\"issues\">\n                            <ScrollArea className=\"h-64\">\n                              <div className=\"space-y-2\">\n                                {result.issues.map((issue, i) => (\n                                  <div key={i} className=\"p-3 border rounded\">\n                                    <div className=\"flex items-start justify-between mb-2\">\n                                      <h4 className=\"font-medium\">{issue.title}</h4>\n                                      <Badge className={getSeverityColor(issue.severity)}>\n                                        {issue.severity}\n                                      </Badge>\n                                    </div>\n                                    <p className=\"text-sm text-muted-foreground mb-2\">{issue.description}</p>\n                                    <p className=\"text-xs text-muted-foreground\">\n                                      Location: {issue.location} | Action: {issue.recommendedAction}\n                                    </p>\n                                  </div>\n                                ))}\n                              </div>\n                            </ScrollArea>\n                          </TabsContent>\n                          \n                          <TabsContent value=\"metrics\">\n                            <ScrollArea className=\"h-64\">\n                              <div className=\"space-y-2\">\n                                {result.metrics.map((metric, i) => (\n                                  <div key={i} className=\"flex items-center justify-between p-2 bg-muted rounded\">\n                                    <div>\n                                      <p className=\"font-medium\">{metric.name}</p>\n                                      <p className=\"text-sm text-muted-foreground\">\n                                        {metric.value} {metric.unit}\n                                      </p>\n                                    </div>\n                                    <Badge variant={metric.status === 'pass' ? 'default' : 'destructive'}>\n                                      {metric.status}\n                                    </Badge>\n                                  </div>\n                                ))}\n                              </div>\n                            </ScrollArea>\n                          </TabsContent>\n                        </Tabs>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              )}\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};","path":null,"size_bytes":20035,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"server/ai-assistant.ts":{"content":"import OpenAI from 'openai';\nimport { storage } from './storage';\nimport { WinnMethodologyStep, AIStepValidation } from '@shared/schema';\n\n// This is using Replit's AI Integrations service, which provides OpenAI-compatible API access without requiring your own OpenAI API key.\n// the newest OpenAI model is \"gpt-5.1\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY\n});\n\nexport interface AIAssistantRequest {\n  message: string;\n  context: string;\n  conversationHistory?: any[];\n  attachments?: string[];\n}\n\n// Multimodal image analysis request\nexport interface ImageAnalysisRequest {\n  imageUrl: string;\n  imageType: 'photo' | 'thermal' | 'drone' | 'document';\n  step: WinnMethodologyStep;\n  propertyContext?: string;\n  previousFindings?: string[];\n}\n\n// Structured output from image analysis\nexport interface ImageAnalysisResult {\n  validation: AIStepValidation;\n  summary: string;\n  detectedElements: {\n    type: string;\n    description: string;\n    location?: string;\n    severity?: 'low' | 'medium' | 'high' | 'critical';\n    confidence: number;\n  }[];\n  measurements?: {\n    name: string;\n    value: string;\n    unit?: string;\n  }[];\n  recommendations: string[];\n  coachingTips: string[];\n}\n\nexport interface AIAssistantResponse {\n  response: string;\n  suggestions?: string[];\n  actionable_items?: string[];\n}\n\nexport async function getAIAssistance(request: AIAssistantRequest): Promise<AIAssistantResponse> {\n  try {\n    // Query knowledge base for relevant methodology entries\n    const knowledgeResults = await storage.searchKnowledge(request.message);\n    const relevantKnowledge = knowledgeResults.slice(0, 3); // Top 3 most relevant entries\n    \n    let knowledgeContext = '';\n    if (relevantKnowledge.length > 0) {\n      knowledgeContext = '\\n\\n**ERIC WINN METHODOLOGY REFERENCE:**\\n\\n' + \n        relevantKnowledge.map(entry => \n          `### ${entry.title}\\n${entry.content}\\n`\n        ).join('\\n---\\n');\n    }\n    \n    const systemPrompt = `${request.context}${knowledgeContext}\n\nYou are Stormy, the WinnStorm™ AI Assistant, an expert in damage assessment consulting based on Eric Winn's proven methodology. You have deep expertise in:\n\n1. **Thermal Inspection Analysis**\n   - Interpreting thermal imaging data for moisture detection\n   - Identifying temperature anomalies and insulation gaps\n   - Analyzing thermal signatures for damage assessment\n\n2. **Winn Methodology Implementation**\n   - Systematic data collection procedures\n   - Test square protocols and impact measurement\n   - Core sampling techniques and analysis\n   - Moisture testing procedures and interpretation\n\n3. **Weather Verification & Correlation**\n   - Meteorological data analysis\n   - Hail size and impact correlation\n   - Storm path verification and documentation\n\n4. **Professional Documentation Standards**\n   - Photo documentation requirements\n   - Measurement protocols and precision\n   - Report structure and evidence presentation\n   - Compliance with industry standards\n\n5. **Damage Assessment Expertise**\n   - Identifying various types of roof damage\n   - Impact density calculations\n   - Material analysis and failure modes\n   - Repair vs. replacement recommendations\n\n**Response Guidelines:**\n- Provide specific, actionable guidance\n- Reference relevant inspection procedures when applicable\n- Include measurement techniques and documentation requirements\n- Suggest next steps or follow-up actions\n- Maintain professional consulting tone\n- Use industry-standard terminology\n- Provide safety considerations when relevant\n\nKeep responses concise but comprehensive, focusing on practical application of the Winn Methodology.`;\n\n    // Build conversation context\n    const messages: any[] = [\n      { role: 'system', content: systemPrompt }\n    ];\n\n    // Add recent conversation history for context\n    if (request.conversationHistory && request.conversationHistory.length > 0) {\n      request.conversationHistory.forEach(msg => {\n        if (msg.role === 'user' || msg.role === 'assistant') {\n          messages.push({\n            role: msg.role,\n            content: msg.content\n          });\n        }\n      });\n    }\n\n    // Add current message\n    messages.push({ role: 'user', content: request.message });\n\n    const response = await openai.chat.completions.create({\n      model: 'gpt-5.1', // the newest OpenAI model is \"gpt-5.1\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages,\n      max_completion_tokens: 1000, // GPT-5.1 uses max_completion_tokens instead of max_tokens\n      // temperature is not specifiable for GPT-5.1 (always defaults to 1)\n    });\n\n    const content = response.choices[0].message.content;\n    if (!content) {\n      throw new Error('No response from OpenAI');\n    }\n\n    // Return the response directly for conversational AI\n    return {\n      response: content,\n      suggestions: [],\n      actionable_items: []\n    };\n\n  } catch (error) {\n    console.error('AI Assistant error:', error);\n    throw new Error('Failed to get AI assistance: ' + (error as Error).message);\n  }\n}\n\nexport async function analyzeInspectionData(data: {\n  thermalReadings?: any[];\n  roofSections?: any[];\n  weatherData?: any;\n  inspectionType: string;\n}): Promise<{\n  analysis: string;\n  recommendations: string[];\n  priority_items: string[];\n  next_steps: string[];\n}> {\n  try {\n    const prompt = `Analyze this inspection data using Eric Winn's methodology:\n\nInspection Type: ${data.inspectionType}\nThermal Readings: ${data.thermalReadings ? JSON.stringify(data.thermalReadings) : 'Not available'}\nRoof Sections: ${data.roofSections ? JSON.stringify(data.roofSections) : 'Not available'}\nWeather Data: ${data.weatherData ? JSON.stringify(data.weatherData) : 'Not available'}\n\nPlease provide a comprehensive analysis following the Winn Methodology, including:\n1. Key findings and observations\n2. Specific recommendations for further investigation\n3. Priority items requiring immediate attention\n4. Next steps in the inspection process\n\nFormat the response as JSON with the following structure:\n{\n  \"analysis\": \"detailed analysis text\",\n  \"recommendations\": [\"recommendation 1\", \"recommendation 2\"],\n  \"priority_items\": [\"priority item 1\", \"priority item 2\"],\n  \"next_steps\": [\"step 1\", \"step 2\"]\n}`;\n\n    const response = await openai.chat.completions.create({\n      model: 'gpt-5.1', // the newest OpenAI model is \"gpt-5.1\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        {\n          role: 'system',\n          content: 'You are an expert damage assessment consultant trained on Eric Winn\\'s methodology. Provide detailed technical analysis based on inspection data.'\n        },\n        { role: 'user', content: prompt }\n      ],\n      max_completion_tokens: 1500, // GPT-5.1 uses max_completion_tokens instead of max_tokens\n      // temperature is not specifiable for GPT-5.1 (always defaults to 1)\n      response_format: { type: \"json_object\" },\n    });\n\n    const content = response.choices[0].message.content;\n    if (!content) {\n      throw new Error('No response from OpenAI');\n    }\n\n    return JSON.parse(content);\n\n  } catch (error) {\n    console.error('Inspection analysis error:', error);\n    throw new Error('Failed to analyze inspection data: ' + (error as Error).message);\n  }\n}\n\n// Step-specific analysis prompts based on Winn Methodology\nconst STEP_ANALYSIS_PROMPTS: Record<WinnMethodologyStep, string> = {\n  weather_verification: `Analyze this weather documentation image. Look for:\n- Date stamps and location data that verify storm occurrence\n- NOAA or meteorological source credibility markers\n- Hail size indicators and storm severity data\n- Geographic correlation with property location\nThis confirms the causation element for the damage claim.`,\n  \n  thermal_imaging: `Analyze this thermal image for roof damage indicators. Following Eric Winn's methodology, identify:\n- Temperature anomalies indicating moisture intrusion (darker/cooler areas trapped moisture)\n- Hot spots from sun exposure through damaged materials\n- Thermal bridges indicating structural compromise\n- Systematic patterns that distinguish damage from normal thermal variation\n- Areas requiring further investigation with moisture meter\nColor scale interpretation: Cooler colors (blue/purple) often indicate moisture; warmer colors (yellow/red) indicate dry materials.`,\n  \n  terrestrial_walk: `Analyze this standard photograph from the terrestrial damage walk. Look for:\n- Visible hail impact damage (dents, fractures, granule loss)\n- Wind damage patterns (lifted edges, missing materials)\n- Mechanical damage vs. storm damage differentiation\n- Age-related wear that should be excluded from claim\n- Documentation completeness (is reference scale visible?)\nEric's tip: Always look for patterns - storm damage is random, mechanical damage is linear.`,\n  \n  test_squares: `Analyze this test square documentation image. Count and validate:\n- Impact marks within the marked 10x10 area\n- Consistency of impact size and shape with reported hail\n- Damage density per square foot for threshold calculation\n- Quality of marking and visibility of impacts\n- Reference scale for measurement verification\nIndustry standard: 8+ impacts per 100 sq ft typically indicates replacement threshold.`,\n  \n  soft_metals: `Analyze this soft metals documentation image. Evaluate:\n- Dent patterns on gutters, vents, flashings, or HVAC units\n- Dent size correlation with reported hail diameter\n- Reference object for scale (quarter = 24mm reference)\n- Impact angle and direction consistency\n- Fresh vs. old damage indicators\nSoft metals are the \"truth tellers\" - they preserve impact evidence longer than shingles.`,\n  \n  moisture_testing: `Analyze this moisture testing documentation. Verify:\n- Moisture meter positioning and reading visibility\n- Reading values and their significance (>15% is concerning)\n- Location correlation with thermal findings\n- Multiple reading documentation for pattern establishment\n- Meter type and calibration indicators\nCorrelate these readings with thermal anomalies to confirm moisture intrusion paths.`,\n  \n  core_samples: `Analyze this core sample documentation. Examine:\n- Layer-by-layer material condition\n- Moisture penetration depth indicators\n- Material degradation patterns\n- Proper sample extraction technique evidence\n- Location marking and documentation\nCore samples provide definitive evidence of substrate damage beneath surface materials.`,\n  \n  report_assembly: `Analyze this report documentation image for completeness:\n- Evidence organization and labeling\n- Date stamps and photo quality\n- Measurement visibility and accuracy\n- Professional presentation standards\n- Claim support documentation checklist items\nA well-organized report tells the complete story of the damage assessment.`\n};\n\n// Multimodal image analysis using GPT-5.1 vision\nexport async function analyzeInspectionImage(request: ImageAnalysisRequest): Promise<ImageAnalysisResult> {\n  try {\n    const stepPrompt = STEP_ANALYSIS_PROMPTS[request.step];\n    \n    const systemPrompt = `You are Stormy, the WinnStorm AI inspection coach trained on Eric Winn's damage assessment methodology. \nYou are analyzing an image captured during the \"${request.step.replace(/_/g, ' ')}\" step of a professional roof inspection.\n\nYour role is to:\n1. Analyze the image content thoroughly using your visual understanding\n2. Validate whether this evidence meets the methodology requirements\n3. Provide specific, actionable coaching based on what you observe\n4. Identify any issues or areas needing improvement\n\n${stepPrompt}\n\n${request.propertyContext ? `Property Context: ${request.propertyContext}` : ''}\n${request.previousFindings?.length ? `Previous Findings: ${request.previousFindings.join(', ')}` : ''}\n\nRespond in JSON format with the following structure:\n{\n  \"validation\": {\n    \"isValid\": boolean (true if image meets step requirements),\n    \"confidence\": number (0-100, your confidence in the analysis),\n    \"findings\": [\"key finding 1\", \"key finding 2\"],\n    \"recommendations\": [\"recommendation 1\", \"recommendation 2\"],\n    \"warnings\": [\"any concerns or issues\"],\n    \"analysisTimestamp\": \"ISO timestamp\"\n  },\n  \"summary\": \"Brief 1-2 sentence summary of what you observe\",\n  \"detectedElements\": [\n    {\n      \"type\": \"damage_type or feature\",\n      \"description\": \"detailed description\",\n      \"location\": \"where in image (optional)\",\n      \"severity\": \"low|medium|high|critical (if applicable)\",\n      \"confidence\": number (0-100)\n    }\n  ],\n  \"measurements\": [\n    {\"name\": \"measurement name\", \"value\": \"value\", \"unit\": \"unit\"}\n  ],\n  \"recommendations\": [\"What inspector should do next\"],\n  \"coachingTips\": [\"Educational tips for improvement based on Eric Winn methodology\"]\n}`;\n\n    const response = await openai.chat.completions.create({\n      model: 'gpt-5.1',\n      messages: [\n        {\n          role: 'system',\n          content: systemPrompt\n        },\n        {\n          role: 'user',\n          content: [\n            {\n              type: 'text',\n              text: `Analyze this ${request.imageType} image from the ${request.step.replace(/_/g, ' ')} step. Provide detailed analysis following Eric Winn's methodology.`\n            },\n            {\n              type: 'image_url',\n              image_url: {\n                url: request.imageUrl,\n                detail: 'high'\n              }\n            }\n          ]\n        }\n      ],\n      max_completion_tokens: 2000,\n      response_format: { type: 'json_object' }\n    });\n\n    const content = response.choices[0].message.content;\n    if (!content) {\n      throw new Error('No response from AI vision analysis');\n    }\n\n    const result = JSON.parse(content);\n    \n    // Ensure timestamp is set\n    if (result.validation) {\n      result.validation.analysisTimestamp = result.validation.analysisTimestamp || new Date().toISOString();\n    }\n\n    return result as ImageAnalysisResult;\n\n  } catch (error) {\n    console.error('Image analysis error:', error);\n    \n    // Return a validation failure result instead of throwing\n    return {\n      validation: {\n        isValid: false,\n        confidence: 0,\n        findings: ['Analysis failed - please try again'],\n        recommendations: ['Ensure image is clear and properly formatted'],\n        warnings: [(error as Error).message],\n        analysisTimestamp: new Date().toISOString()\n      },\n      summary: 'Unable to analyze image due to an error',\n      detectedElements: [],\n      measurements: [],\n      recommendations: ['Re-upload the image in a supported format (JPEG, PNG)'],\n      coachingTips: ['Make sure images are well-lit and in focus']\n    };\n  }\n}\n\n// Contextual coaching based on current step and user experience level\nexport async function getStepCoaching(\n  step: WinnMethodologyStep, \n  experienceLevel: 'beginner' | 'intermediate' | 'expert',\n  currentFindings?: string[]\n): Promise<{\n  welcome: string;\n  objectives: string[];\n  checklist: string[];\n  whyItMatters: string;\n  commonMistakes: string[];\n  tips: string[];\n}> {\n  try {\n    const levelContext = {\n      beginner: 'Provide detailed explanations, define technical terms, and offer step-by-step guidance.',\n      intermediate: 'Assume basic knowledge, focus on best practices and efficiency tips.',\n      expert: 'Be concise, focus on edge cases and advanced techniques only.'\n    };\n\n    const prompt = `You are Stormy, the WinnStorm inspection coach. Generate coaching content for the \"${step.replace(/_/g, ' ')}\" step.\n\nUser Experience Level: ${experienceLevel}\n${levelContext[experienceLevel]}\n\n${currentFindings?.length ? `Current inspection findings: ${currentFindings.join(', ')}` : 'No findings recorded yet.'}\n\nGenerate coaching content in JSON format:\n{\n  \"welcome\": \"A friendly, encouraging welcome message for this step\",\n  \"objectives\": [\"Specific objective 1\", \"Objective 2\", \"Objective 3\"],\n  \"checklist\": [\"Required item 1\", \"Required item 2\"],\n  \"whyItMatters\": \"Brief explanation of why this step is important for the claim\",\n  \"commonMistakes\": [\"Common mistake to avoid 1\", \"Common mistake 2\"],\n  \"tips\": [\"Pro tip from Eric Winn's methodology 1\", \"Tip 2\"]\n}`;\n\n    const response = await openai.chat.completions.create({\n      model: 'gpt-5.1',\n      messages: [\n        { role: 'system', content: 'You are an expert damage assessment coach trained on Eric Winn methodology.' },\n        { role: 'user', content: prompt }\n      ],\n      max_completion_tokens: 1000,\n      response_format: { type: 'json_object' }\n    });\n\n    const content = response.choices[0].message.content;\n    if (!content) {\n      throw new Error('No coaching content generated');\n    }\n\n    return JSON.parse(content);\n\n  } catch (error) {\n    console.error('Step coaching error:', error);\n    throw new Error('Failed to generate coaching content');\n  }\n}\n\n// Analyze transcript from Limitless Pin recording\nexport async function parseTranscript(\n  rawTranscript: string,\n  title: string\n): Promise<{\n  segments: {\n    text: string;\n    topic?: string;\n    methodologyStep?: WinnMethodologyStep;\n    confidence: number;\n  }[];\n  extractedKnowledge: {\n    category: 'procedure' | 'decision_tree' | 'terminology' | 'best_practice' | 'common_mistake';\n    title: string;\n    content: string;\n    suggestedTags: string[];\n    suggestedStep: WinnMethodologyStep;\n    confidence: number;\n  }[];\n}> {\n  try {\n    const prompt = `Parse this damage assessment field training transcript from Eric Winn.\n\nTitle: ${title}\nTranscript:\n${rawTranscript.substring(0, 8000)} ${rawTranscript.length > 8000 ? '... [truncated]' : ''}\n\nExtract and classify the content:\n\n1. Identify key segments and classify their topics\n2. Extract actionable knowledge entries that should be added to the knowledge base\n3. Map content to relevant Winn Methodology steps: weather_verification, thermal_imaging, terrestrial_walk, test_squares, soft_metals, moisture_testing, core_samples, report_assembly\n\nReturn JSON:\n{\n  \"segments\": [\n    {\n      \"text\": \"segment text\",\n      \"topic\": \"classified topic\",\n      \"methodologyStep\": \"relevant step or null\",\n      \"confidence\": 0-100\n    }\n  ],\n  \"extractedKnowledge\": [\n    {\n      \"category\": \"procedure|decision_tree|terminology|best_practice|common_mistake\",\n      \"title\": \"knowledge entry title\",\n      \"content\": \"detailed knowledge content\",\n      \"suggestedTags\": [\"tag1\", \"tag2\"],\n      \"suggestedStep\": \"methodology step\",\n      \"confidence\": 0-100\n    }\n  ]\n}\n\nFocus on extracting unique insights from Eric's field experience that would help train new inspectors.`;\n\n    const response = await openai.chat.completions.create({\n      model: 'gpt-5.1',\n      messages: [\n        { role: 'system', content: 'You are an expert at analyzing damage assessment training transcripts and extracting structured knowledge.' },\n        { role: 'user', content: prompt }\n      ],\n      max_completion_tokens: 3000,\n      response_format: { type: 'json_object' }\n    });\n\n    const content = response.choices[0].message.content;\n    if (!content) {\n      throw new Error('No transcript analysis generated');\n    }\n\n    return JSON.parse(content);\n\n  } catch (error) {\n    console.error('Transcript parsing error:', error);\n    throw new Error('Failed to parse transcript: ' + (error as Error).message);\n  }\n}","path":null,"size_bytes":19509,"size_tokens":null},"client/src/pages/auth.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useLocation } from 'wouter';\nimport { useAuth } from '@/hooks/use-auth';\nimport { User } from 'firebase/auth';\nimport { RoleSelector } from '@/components/role-selector';\nimport { \n  Card, \n  CardContent \n} from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { useToast } from '@/hooks/use-toast';\nimport { Flame } from 'lucide-react';\nimport { SEO } from '@/components/seo';\n\nconst DEMO_EMAIL = 'demo@winnstorm.com';\nconst DEMO_PASSWORD = 'DemoTest123!';\n\nconst Auth = () => {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [rememberMe, setRememberMe] = useState(false);\n  const [shouldRedirect, setShouldRedirect] = useState(false);\n  const { user, login, loginWithGoogle, register } = useAuth();\n  const { toast } = useToast();\n  const [, navigate] = useLocation();\n  \n  // Handle redirect in useEffect to avoid setState during render\n  useEffect(() => {\n    if (user && localStorage.getItem(`role_${user.uid}`)) {\n      navigate('/dashboard');\n    }\n  }, [user, navigate]);\n  \n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!email || !password) {\n      toast({\n        title: \"All fields are required\",\n        description: \"Please fill in all fields to continue.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      setIsLoading(true);\n      await login(email, password);\n      // Role selection will be shown after successful login\n    } catch (error: any) {\n      console.error(error);\n      toast({\n        title: \"Login failed\",\n        description: error.message || \"Please check your credentials and try again\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleGoogleLogin = async () => {\n    try {\n      setIsLoading(true);\n      await loginWithGoogle();\n      // Role selection will be shown after successful login\n    } catch (error: any) {\n      console.error(error);\n      toast({\n        title: \"Google login failed\",\n        description: error.message || \"There was an error with Google login\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleDemoLogin = async () => {\n    try {\n      setIsLoading(true);\n      // Try to login first, if that fails, register then login\n      try {\n        await login(DEMO_EMAIL, DEMO_PASSWORD);\n        toast({\n          title: \"Demo Login Successful\",\n          description: \"Welcome to WinnStorm! You're logged in as a demo user.\",\n        });\n      } catch (loginError: any) {\n        // If login fails, try to register the demo account\n        if (loginError.code === 'auth/user-not-found' || loginError.code === 'auth/invalid-credential') {\n          await register(DEMO_EMAIL, DEMO_PASSWORD);\n          toast({\n            title: \"Demo Account Created\",\n            description: \"Your demo account has been created and you're now logged in.\",\n          });\n        } else {\n          throw loginError;\n        }\n      }\n    } catch (error: any) {\n      console.error(error);\n      toast({\n        title: \"Demo login failed\",\n        description: error.message || \"There was an error with demo login\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // If user is logged in but no role is selected yet\n  if (user && !localStorage.getItem(`role_${user.uid}`)) {\n    return <RoleSelector />;\n  }\n  \n  // If user is logged in with a role, show loading while redirecting (handled by useEffect)\n  if (user && localStorage.getItem(`role_${user.uid}`)) {\n    return (\n      <div className=\"min-h-screen section-dark flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-white/60\">Redirecting to dashboard...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen section-dark flex flex-col items-center justify-center p-6\">\n      <SEO\n        title=\"Sign In - Access Your Account\"\n        description=\"Sign in to WinnStorm™ to access your damage assessment dashboard, training portal, and Winn Reports. Secure login with Google or email.\"\n        canonical=\"/auth\"\n        keywords={['WinnStorm login', 'damage assessment platform login', 'consultant portal access']}\n      />\n      <div className=\"max-w-md w-full\">\n        {/* WinnStorm Logo */}\n        <div className=\"text-center mb-8\">\n          <div className=\"flex justify-center mb-4\">\n            <img src=\"/winnstorm-logo.png\" alt=\"WinnStorm Restoration Pro\" className=\"h-28\" />\n          </div>\n          <div className=\"flex justify-center mb-4\">\n            <div className=\"accent-bar\"></div>\n          </div>\n          <h1 className=\"headline-lg text-white mb-2\">Sign In</h1>\n          <p className=\"text-white/60\">Access your damage assessment dashboard</p>\n        </div>\n\n        {/* Login Form */}\n        <Card className=\"border border-white/20 shadow-lg bg-white/5 backdrop-blur-sm rounded-none\">\n          <CardContent className=\"pt-6\">\n            <form onSubmit={handleLogin}>\n              <div className=\"mb-6\">\n                <Label htmlFor=\"email\" className=\"block text-white text-sm font-heading uppercase tracking-wide mb-2\">\n                  Email\n                </Label>\n                <Input\n                  type=\"email\"\n                  id=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  className=\"w-full h-12 p-3 border border-white/20 rounded-none focus:outline-none focus:ring-2 focus:ring-primary bg-white/10 text-white placeholder:text-white/40 text-base\"\n                  placeholder=\"your@email.com\"\n                  disabled={isLoading}\n                  data-testid=\"input-email\"\n                />\n              </div>\n              <div className=\"mb-6\">\n                <Label htmlFor=\"password\" className=\"block text-white text-sm font-heading uppercase tracking-wide mb-2\">\n                  Password\n                </Label>\n                <Input\n                  type=\"password\"\n                  id=\"password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  className=\"w-full h-12 p-3 border border-white/20 rounded-none focus:outline-none focus:ring-2 focus:ring-primary bg-white/10 text-white placeholder:text-white/40 text-base\"\n                  placeholder=\"••••••••\"\n                  disabled={isLoading}\n                  data-testid=\"input-password\"\n                />\n              </div>\n              <Button\n                type=\"submit\"\n                className=\"w-full btn-primary rounded-none font-heading uppercase tracking-wide py-6\"\n                disabled={isLoading}\n                data-testid=\"button-signin\"\n              >\n                {isLoading ? \"Signing in...\" : \"Sign In\"}\n              </Button>\n              <div className=\"flex items-center justify-between mt-4\">\n                <div className=\"flex items-center\">\n                  <Checkbox \n                    id=\"remember\" \n                    checked={rememberMe}\n                    onCheckedChange={(checked) => setRememberMe(!!checked)}\n                    className=\"h-4 w-4 text-primary focus:ring-primary border-white/30 rounded-none\"\n                  />\n                  <Label htmlFor=\"remember\" className=\"ml-2 block text-sm text-white/60\">\n                    Remember me\n                  </Label>\n                </div>\n                <div className=\"text-sm\">\n                  <a href=\"#\" className=\"font-medium text-primary hover:text-primary/80\">\n                    Forgot password?\n                  </a>\n                </div>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n\n        {/* Social Login */}\n        <div className=\"mt-6\">\n          <div className=\"relative\">\n            <div className=\"absolute inset-0 flex items-center\">\n              <div className=\"w-full border-t border-white/20\"></div>\n            </div>\n            <div className=\"relative flex justify-center text-sm\">\n              <span className=\"px-2 bg-[#1A1A1A] text-white/60\">Or continue with</span>\n            </div>\n          </div>\n          <div className=\"mt-6 grid grid-cols-1 gap-3\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              className=\"w-full inline-flex justify-center py-6 px-4 border-2 border-white/20 rounded-none bg-white/5 text-sm font-heading uppercase tracking-wide text-white hover:bg-white hover:text-[#1A1A1A] transition-colors\"\n              onClick={handleGoogleLogin}\n              disabled={isLoading}\n              data-testid=\"button-google-signin\"\n            >\n              <svg className=\"w-5 h-5 mr-2\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\" width=\"24px\" height=\"24px\">\n                <path fill=\"#FFC107\" d=\"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z\"/>\n                <path fill=\"#FF3D00\" d=\"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z\"/>\n                <path fill=\"#4CAF50\" d=\"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z\"/>\n                <path fill=\"#1976D2\" d=\"M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z\"/>\n              </svg>\n              Sign in with Google\n            </Button>\n          </div>\n        </div>\n\n        {/* Demo Login */}\n        <div className=\"mt-6\">\n          <div className=\"relative\">\n            <div className=\"absolute inset-0 flex items-center\">\n              <div className=\"w-full border-t border-white/20\"></div>\n            </div>\n            <div className=\"relative flex justify-center text-sm\">\n              <span className=\"px-2 bg-[#1A1A1A] text-white/60\">Try it out</span>\n            </div>\n          </div>\n          <div className=\"mt-6\">\n            <Button\n              type=\"button\"\n              className=\"w-full inline-flex justify-center py-6 px-4 rounded-none bg-gradient-to-r from-[#FF6B00] to-amber-500 text-sm font-heading uppercase tracking-wide text-white hover:opacity-90 transition-opacity\"\n              onClick={handleDemoLogin}\n              disabled={isLoading}\n              data-testid=\"button-demo-login\"\n            >\n              <Flame className=\"w-5 h-5 mr-2\" />\n              Demo Login (No Sign Up Required)\n            </Button>\n            <p className=\"text-center text-xs text-white/40 mt-2\">\n              Email: demo@winnstorm.com\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Auth;\n","path":null,"size_bytes":11560,"size_tokens":null},"client/src/pages/winn-report.tsx":{"content":"import React, { useState } from 'react';\nimport { useRoute } from 'wouter';\nimport { WinnReportWorkflow } from '@/components/winn-report-workflow';\nimport { Header, Footer } from '@/components/navbar';\nimport { ErrorBoundary } from '@/components/error-boundary';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { CheckCircle, FileText, Shield, Database } from 'lucide-react';\n\ninterface WinnReportData {\n  propertyId: number;\n  inspectionDate: Date;\n  inspector: string;\n  weatherConditions: any[];\n  roofComponents: any[];\n  thermalReadings: any[];\n  metrics: any[];\n  issues: any[];\n  notes: string;\n  images: string[];\n  thermalImages: string[];\n}\n\nexport default function WinnReportPage() {\n  const [match, params] = useRoute('/winn-report/:propertyId');\n  const [reportCompleted, setReportCompleted] = useState(false);\n  const [generatedReport, setGeneratedReport] = useState<WinnReportData | null>(null);\n  \n  const propertyId = params?.propertyId ? parseInt(params.propertyId) : 1;\n\n  const handleReportComplete = (reportData: WinnReportData) => {\n    setGeneratedReport(reportData);\n    setReportCompleted(true);\n  };\n\n  const handleGenerateBlockchainEntry = () => {\n    // Future: integrate with blockchain system for immutable records\n  };\n\n  if (reportCompleted && generatedReport) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <main className=\"container mx-auto py-8\">\n          <div className=\"max-w-4xl mx-auto\">\n            <Card className=\"bg-card border-border shadow-lg\">\n              <CardHeader className=\"text-center\">\n                <div className=\"flex justify-center mb-4\">\n                  <CheckCircle className=\"h-16 w-16 text-green-500\" />\n                </div>\n                <CardTitle className=\"text-3xl font-bold text-foreground\">\n                  Winn Report Generated Successfully\n                </CardTitle>\n                <p className=\"text-muted-foreground mt-2\">\n                  Your comprehensive {Math.max(300, generatedReport.roofComponents.length * 15 + generatedReport.issues.length * 8 + generatedReport.thermalReadings.length * 3)}+ page report is ready\n                </p>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <Card className=\"bg-background border-border\">\n                    <CardContent className=\"p-4 text-center\">\n                      <FileText className=\"h-8 w-8 text-primary mx-auto mb-2\" />\n                      <div className=\"text-lg font-semibold text-foreground\">Detailed Report</div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {generatedReport.roofComponents.length} components analyzed\n                      </div>\n                    </CardContent>\n                  </Card>\n                  <Card className=\"bg-background border-border\">\n                    <CardContent className=\"p-4 text-center\">\n                      <Database className=\"h-8 w-8 text-secondary mx-auto mb-2\" />\n                      <div className=\"text-lg font-semibold text-foreground\">Data Integrity</div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {generatedReport.thermalReadings.length} thermal readings\n                      </div>\n                    </CardContent>\n                  </Card>\n                  <Card className=\"bg-background border-border\">\n                    <CardContent className=\"p-4 text-center\">\n                      <Shield className=\"h-8 w-8 text-accent mx-auto mb-2\" />\n                      <div className=\"text-lg font-semibold text-foreground\">Blockchain Ready</div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        Immutable roof history\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                <div className=\"bg-background rounded-lg p-6 border border-border\">\n                  <h3 className=\"text-lg font-semibold text-foreground mb-4\">Report Summary</h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <div className=\"flex justify-between mb-2\">\n                        <span className=\"text-muted-foreground\">Inspector:</span>\n                        <span className=\"text-foreground\">{generatedReport.inspector}</span>\n                      </div>\n                      <div className=\"flex justify-between mb-2\">\n                        <span className=\"text-muted-foreground\">Inspection Date:</span>\n                        <span className=\"text-foreground\">{generatedReport.inspectionDate.toLocaleDateString()}</span>\n                      </div>\n                      <div className=\"flex justify-between mb-2\">\n                        <span className=\"text-muted-foreground\">Weather Conditions:</span>\n                        <span className=\"text-foreground\">{generatedReport.weatherConditions.length} readings</span>\n                      </div>\n                    </div>\n                    <div>\n                      <div className=\"flex justify-between mb-2\">\n                        <span className=\"text-muted-foreground\">Total Issues:</span>\n                        <span className=\"text-foreground\">{generatedReport.issues.length}</span>\n                      </div>\n                      <div className=\"flex justify-between mb-2\">\n                        <span className=\"text-muted-foreground\">Critical Issues:</span>\n                        <Badge variant=\"destructive\">\n                          {generatedReport.issues.filter(i => i.severity === 'critical').length}\n                        </Badge>\n                      </div>\n                      <div className=\"flex justify-between mb-2\">\n                        <span className=\"text-muted-foreground\">Roof Components:</span>\n                        <span className=\"text-foreground\">{generatedReport.roofComponents.length}</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"text-center space-y-4\">\n                  <div className=\"text-sm text-muted-foreground\">\n                    This report will serve as part of the digital title for this commercial roof,\n                    providing immutable evidence of maintenance and inspection history.\n                  </div>\n                  <div className=\"flex justify-center space-x-4\">\n                    <Button \n                      onClick={handleGenerateBlockchainEntry}\n                      className=\"bg-primary text-primary-foreground\"\n                    >\n                      <Shield className=\"h-4 w-4 mr-2\" />\n                      Generate Blockchain Entry\n                    </Button>\n                    <Button \n                      variant=\"outline\" \n                      className=\"border-border text-foreground\"\n                    >\n                      <FileText className=\"h-4 w-4 mr-2\" />\n                      Download Report\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <ErrorBoundary>\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <main className=\"py-8\">\n          <WinnReportWorkflow \n            propertyId={propertyId}\n            onComplete={handleReportComplete}\n          />\n        </main>\n        <Footer />\n      </div>\n    </ErrorBoundary>\n  );\n}","path":null,"size_bytes":7827,"size_tokens":null},"client/src/components/role-selector.tsx":{"content":"import { useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { useAuth, UserRole } from '@/hooks/use-auth';\nimport { \n  Card, \n  CardContent,\n} from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Shield, ClipboardCheck, Settings, Building2 } from 'lucide-react';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\ninterface RoleOption {\n  id: UserRole;\n  title: string;\n  description: string;\n  icon: React.ReactNode;\n}\n\nconst roleOptions: RoleOption[] = [\n  {\n    id: 'junior_consultant',\n    title: 'Junior Consultant',\n    description: 'New to damage assessment, learning the Winn Methodology',\n    icon: <ClipboardCheck className=\"h-6 w-6 text-primary\" />\n  },\n  {\n    id: 'senior_consultant',\n    title: 'Senior Consultant',\n    description: 'Experienced assessor with advanced certification',\n    icon: <Shield className=\"h-6 w-6 text-primary\" />\n  },\n  {\n    id: 'admin',\n    title: 'Admin / Manager',\n    description: 'Manage team, view analytics, oversee operations',\n    icon: <Settings className=\"h-6 w-6 text-primary\" />\n  },\n  {\n    id: 'client',\n    title: 'Property Owner / Client',\n    description: 'View reports and track project status',\n    icon: <Building2 className=\"h-6 w-6 text-primary\" />\n  }\n];\n\nexport const RoleSelector = () => {\n  const { setUserRole } = useAuth();\n  const [, navigate] = useLocation();\n  const [selectedRole, setSelectedRole] = useState<UserRole>('junior_consultant');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const handleRoleSelect = (role: UserRole) => {\n    setSelectedRole(role);\n  };\n\n  const handleContinue = async () => {\n    if (!selectedRole) return;\n    \n    setIsSubmitting(true);\n    try {\n      await setUserRole(selectedRole);\n      navigate('/dashboard');\n    } catch (error) {\n      console.error('Failed to set role:', error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 section-dark z-40 flex flex-col items-center justify-center p-6\">\n      <div className=\"max-w-lg w-full\">\n        {/* WinnStorm Logo */}\n        <div className=\"text-center mb-8\">\n          <div className=\"flex justify-center mb-4\">\n            <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-24\" />\n          </div>\n          <div className=\"flex justify-center mb-4\">\n            <div className=\"accent-bar\"></div>\n          </div>\n          <h1 className=\"headline-lg text-white mb-2\">Select Your Role</h1>\n          <p className=\"text-white/60\">Choose the role that best describes you</p>\n        </div>\n\n        <div className=\"grid grid-cols-1 gap-4 mb-8\">\n          {roleOptions.map((role) => (\n            <Card \n              key={role.id}\n              className={`cursor-pointer transition-all rounded-none ${\n                selectedRole === role.id \n                  ? 'border-2 border-primary bg-primary/10' \n                  : 'border border-white/20 bg-white/5 hover:border-white/40'\n              }`}\n              onClick={() => handleRoleSelect(role.id)}\n              data-testid={`role-card-${role.id}`}\n            >\n              <CardContent className=\"p-4 flex items-center\">\n                <div className={`p-3 rounded-none ${\n                  selectedRole === role.id \n                    ? 'bg-primary/20' \n                    : 'bg-white/10'\n                }`}>\n                  {role.icon}\n                </div>\n                <div className=\"ml-4 text-left\">\n                  <h3 className={`font-heading font-semibold uppercase tracking-wide text-sm ${\n                    selectedRole === role.id ? 'text-primary' : 'text-white'\n                  }`}>{role.title}</h3>\n                  <p className=\"text-sm text-white/60\">{role.description}</p>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        <Button\n          onClick={handleContinue}\n          disabled={!selectedRole || isSubmitting}\n          className=\"w-full btn-primary rounded-none font-heading uppercase tracking-wide py-6 text-lg\"\n          data-testid=\"button-continue-role\"\n        >\n          {isSubmitting ? 'Setting up...' : 'Continue to Dashboard'}\n        </Button>\n      </div>\n    </div>\n  );\n};\n","path":null,"size_bytes":4259,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun, Monitor } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useTheme } from \"@/hooks/use-theme\";\n\nexport function ThemeToggle() {\n  const { setTheme, theme } = useTheme();\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"outline\" size=\"icon\" className=\"w-9 h-9\">\n          <Sun className=\"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n          <Moon className=\"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n          <span className=\"sr-only\">Toggle theme</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"bg-background border border-border\">\n        <DropdownMenuItem \n          onClick={() => setTheme(\"light\")}\n          className={theme === \"light\" ? \"bg-accent\" : \"\"}\n        >\n          <Sun className=\"mr-2 h-4 w-4\" />\n          <span>Light</span>\n        </DropdownMenuItem>\n        <DropdownMenuItem \n          onClick={() => setTheme(\"dark\")}\n          className={theme === \"dark\" ? \"bg-accent\" : \"\"}\n        >\n          <Moon className=\"mr-2 h-4 w-4\" />\n          <span>Dark</span>\n        </DropdownMenuItem>\n        <DropdownMenuItem \n          onClick={() => setTheme(\"system\")}\n          className={theme === \"system\" ? \"bg-accent\" : \"\"}\n        >\n          <Monitor className=\"mr-2 h-4 w-4\" />\n          <span>System</span>\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}","path":null,"size_bytes":1695,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useEffect, useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useLocation, useRoute } from 'wouter';\nimport { Header, Footer } from '@/components/navbar';\nimport { PropertyCard } from '@/components/property-card';\nimport { UserOnboarding } from '@/components/user-onboarding';\nimport { useAuth } from '@/hooks/use-auth';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Property, Project, DamageAssessment } from '@shared/schema';\nimport { FileText, Upload, BarChart3, Users, Briefcase, GraduationCap, AlertTriangle, Mic, BookOpen } from 'lucide-react';\nimport { StormyChat } from '@/components/stormy-chat';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { SEO, breadcrumbSchema } from '@/components/seo';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\nconst Dashboard = () => {\n  const { user, role } = useAuth();\n  const [, navigate] = useLocation();\n  const [, params] = useRoute('/dashboard');\n  const [showOnboarding, setShowOnboarding] = useState(false);\n  \n  // Redirect to login if not authenticated\n  useEffect(() => {\n    if (!user) {\n      navigate('/');\n    }\n  }, [user, navigate]);\n\n  // Check if user has completed onboarding\n  useEffect(() => {\n    if (user) {\n      const hasCompletedOnboarding = localStorage.getItem(`onboarding_completed_${user.uid}`);\n      if (!hasCompletedOnboarding) {\n        setShowOnboarding(true);\n      }\n    }\n  }, [user]);\n\n  const handleOnboardingComplete = async () => {\n    if (user) {\n      localStorage.setItem(`onboarding_completed_${user.uid}`, 'true');\n      // Persist to database\n      try {\n        await fetch('/api/user/onboarding', {\n          method: 'PATCH',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include'\n        });\n      } catch (error) {\n        console.error('Failed to persist onboarding status:', error);\n      }\n    }\n    setShowOnboarding(false);\n  };\n\n  // Fetch properties and projects\n  const { data: properties, isLoading: propertiesLoading } = useQuery<Property[]>({\n    queryKey: ['/api/properties'],\n  });\n\n  const { data: projectsList, isLoading: projectsLoading } = useQuery<Project[]>({\n    queryKey: ['/api/projects'],\n  });\n\n  const isLoading = propertiesLoading || projectsLoading;\n\n  // Stats calculation for WinnStorm™ dashboard\n  const activeProjects = projectsList?.filter(p => !['completed', 'denied'].includes(p.status)).length || 0;\n  const completedProjects = projectsList?.filter(p => p.status === 'completed').length || 0;\n  \n  const stats = {\n    activeProjects,\n    completedAssessments: properties?.length || completedProjects,\n    avgCondition: properties && properties.length > 0 \n      ? 'Good'\n      : 'N/A',\n    certificationLevel: role === 'senior_consultant' ? 'Senior' : \n                        role === 'admin' ? 'Admin' : 'Junior',\n    scans: properties?.length || 0,\n    reports: completedProjects || '—',\n    avgScore: '—'\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative bg-background text-foreground\">\n      <SEO\n        title=\"Dashboard\"\n        description=\"Manage your damage assessment projects, track inspections, and view certification progress. Access thermal analysis tools and generate comprehensive Winn Reports.\"\n        canonical=\"/dashboard\"\n        noindex={true}\n        structuredData={breadcrumbSchema([\n          { name: 'Home', url: '/' },\n          { name: 'Dashboard', url: '/dashboard' }\n        ])}\n      />\n      <Header />\n      \n      <main className=\"flex-grow pb-20\">\n        <div className=\"p-6\">\n          \n\n          {/* Dashboard Stats */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8\">\n            <Card className=\"bg-gradient-to-br from-card to-primary/5 border-primary/20\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center\">\n                  <div className=\"p-2 bg-gradient-to-br from-primary/20 to-cyan-500/20 rounded-lg\">\n                    <Briefcase className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <div className=\"ml-3\">\n                    <p className=\"text-sm text-muted-foreground\">Active Projects</p>\n                    <p className=\"text-2xl font-bold text-primary\">{stats.activeProjects}</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"bg-gradient-to-br from-card to-cyan-500/5 border-cyan-500/20\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center\">\n                  <div className=\"p-2 bg-gradient-to-br from-cyan-500/20 to-blue-500/20 rounded-lg\">\n                    <FileText className=\"h-6 w-6 text-cyan-500\" />\n                  </div>\n                  <div className=\"ml-3\">\n                    <p className=\"text-sm text-muted-foreground\">Assessments</p>\n                    <p className=\"text-2xl font-bold text-cyan-600\">{stats.completedAssessments}</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"bg-gradient-to-br from-card to-blue-500/5 border-blue-500/20\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center\">\n                  <div className=\"p-2 bg-gradient-to-br from-blue-500/20 to-primary/20 rounded-lg\">\n                    <BarChart3 className=\"h-6 w-6 text-blue-500\" />\n                  </div>\n                  <div className=\"ml-3\">\n                    <p className=\"text-sm text-muted-foreground\">Avg. Condition</p>\n                    <p className=\"text-2xl font-bold text-blue-600\">{stats.avgCondition}</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"bg-gradient-to-br from-card to-primary/5 border-primary/20\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center\">\n                  <div className=\"p-2 bg-gradient-to-br from-primary/20 to-cyan-500/20 rounded-lg\">\n                    <GraduationCap className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <div className=\"ml-3\">\n                    <p className=\"text-sm text-muted-foreground\">Certification</p>\n                    <p className=\"text-lg font-bold text-primary\">{stats.certificationLevel}</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Quick Actions */}\n          <div className=\"mb-8\">\n            <h3 className=\"text-xl font-semibold mb-4\">Quick Actions</h3>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              <Button \n                onClick={() => navigate('/upload')} \n                className=\"bg-gradient-to-br from-primary to-cyan-500 hover:from-primary/90 hover:to-cyan-500/90 text-white p-4 h-auto flex flex-col items-center shadow-lg border-0\"\n              >\n                <Upload className=\"h-6 w-6 mb-2\" />\n                <span>New Assessment</span>\n              </Button>\n              \n              <Button \n                variant=\"outline\" \n                className=\"p-4 h-auto flex flex-col items-center border-primary/30 hover:bg-primary/10 hover:border-primary/50\"\n                onClick={() => navigate('/training')}\n              >\n                <GraduationCap className=\"h-6 w-6 mb-2 text-primary\" />\n                <span>Training Portal</span>\n              </Button>\n              \n              <Button \n                variant=\"outline\" \n                className=\"p-4 h-auto flex flex-col items-center border-cyan-500/30 hover:bg-cyan-500/10 hover:border-cyan-500/50\"\n                onClick={() => navigate('/projects')}\n              >\n                <Briefcase className=\"h-6 w-6 mb-2 text-cyan-500\" />\n                <span>Manage Projects</span>\n              </Button>\n              \n              <Button \n                variant=\"outline\" \n                className=\"p-4 h-auto flex flex-col items-center border-blue-500/30 hover:bg-blue-500/10 hover:border-blue-500/50\"\n                onClick={() => navigate('/crm-integrations')}\n              >\n                <Users className=\"h-6 w-6 mb-2 text-blue-500\" />\n                <span>CRM Integration</span>\n              </Button>\n              \n              <Button \n                variant=\"outline\" \n                className=\"p-4 h-auto flex flex-col items-center border-purple-500/30 hover:bg-purple-500/10 hover:border-purple-500/50\"\n                onClick={() => navigate('/transcripts')}\n                data-testid=\"button-transcripts\"\n              >\n                <Mic className=\"h-6 w-6 mb-2 text-purple-500\" />\n                <span>Transcripts</span>\n              </Button>\n            </div>\n          </div>\n\n          {/* Recent Projects & Assessments */}\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-xl font-semibold\">Recent Projects</h3>\n              <Button variant=\"outline\" onClick={() => navigate('/projects')}>\n                View All Projects\n              </Button>\n            </div>\n\n            {isLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n              <Card>\n                <Skeleton className=\"h-48 w-full\" />\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <Skeleton className=\"h-6 w-1/3\" />\n                    <Skeleton className=\"h-6 w-1/4\" />\n                  </div>\n                  <Skeleton className=\"h-4 w-2/3 mb-3\" />\n                  <div className=\"flex items-center justify-between\">\n                    <Skeleton className=\"h-4 w-1/3\" />\n                    <Skeleton className=\"h-4 w-1/4\" />\n                  </div>\n                </CardContent>\n              </Card>\n              <Card>\n                <Skeleton className=\"h-48 w-full\" />\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <Skeleton className=\"h-6 w-1/3\" />\n                    <Skeleton className=\"h-6 w-1/4\" />\n                  </div>\n                  <Skeleton className=\"h-4 w-2/3 mb-3\" />\n                  <div className=\"flex items-center justify-between\">\n                    <Skeleton className=\"h-4 w-1/3\" />\n                    <Skeleton className=\"h-4 w-1/4\" />\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          ) : properties && properties.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n              {properties.map((property) => (\n                <PropertyCard key={property.id} property={property} />\n              ))}\n            </div>\n          ) : (\n            <Card className=\"mb-6 border border-border shadow-md\">\n              <CardContent className=\"p-6 text-center\">\n                <p className=\"text-muted-foreground mb-4\">No properties found. Start by adding a new thermal scan.</p>\n              </CardContent>\n            </Card>\n          )}\n          </div>\n\n          {/* Action Cards */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6\">\n            {/* Winn Report Card - Featured */}\n            <Card \n              className=\"bg-gradient-to-br from-primary/20 to-secondary/20 border-2 border-primary/30 cursor-pointer shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105\"\n              onClick={() => navigate('/winn-report/1')}\n            >\n              <CardContent className=\"p-6 text-center\">\n                <div className=\"bg-primary/20 p-4 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                  <FileText className=\"h-8 w-8 text-primary\" />\n                </div>\n                <h3 className=\"font-bold text-foreground mb-2\">Create Winn Report</h3>\n                <p className=\"text-muted-foreground text-sm mb-3\">Generate comprehensive 300+ page inspection report</p>\n                <div className=\"flex justify-center space-x-1\">\n                  <span className=\"text-xs bg-primary/20 text-primary px-2 py-1 rounded-full\">\n                    Blockchain\n                  </span>\n                  <span className=\"text-xs bg-secondary/20 text-secondary px-2 py-1 rounded-full\">\n                    Digital Title\n                  </span>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* New Scan Card */}\n            <Card \n              className=\"bg-card border border-border hover:border-secondary transition-colors cursor-pointer shadow-md\"\n              onClick={() => navigate('/upload')}\n            >\n              <CardContent className=\"p-6 text-center\">\n                <div className=\"bg-secondary/20 p-4 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                  <Upload className=\"h-8 w-8 text-secondary\" />\n                </div>\n                <h3 className=\"font-bold text-foreground mb-2\">Upload New Scan</h3>\n                <p className=\"text-muted-foreground text-sm\">Upload thermal images for analysis</p>\n              </CardContent>\n            </Card>\n\n            {/* View Reports Card */}\n            <Card \n              className=\"bg-card border border-border hover:border-accent transition-colors cursor-pointer shadow-md\"\n              onClick={() => navigate('/reports')}\n            >\n              <CardContent className=\"p-6 text-center\">\n                <div className=\"bg-accent/20 p-4 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                  <BarChart3 className=\"h-8 w-8 text-accent\" />\n                </div>\n                <h3 className=\"font-bold text-foreground mb-2\">View Reports</h3>\n                <p className=\"text-muted-foreground text-sm\">Access all damage assessment reports</p>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Quick Stats */}\n          {!isLoading && (\n            <Card className=\"bg-card border border-border shadow-md\">\n              <CardContent className=\"p-5\">\n                <h3 className=\"font-bold text-foreground mb-4\">Monthly Overview</h3>\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <div className=\"text-center p-3 bg-background rounded-lg\">\n                    <p className=\"text-2xl font-bold text-primary\">{stats.scans}</p>\n                    <p className=\"text-muted-foreground text-sm mt-1\">Scans</p>\n                  </div>\n                  <div className=\"text-center p-3 bg-background rounded-lg\">\n                    <p className=\"text-2xl font-bold text-secondary\">{stats.reports}</p>\n                    <p className=\"text-muted-foreground text-sm mt-1\">Reports</p>\n                  </div>\n                  <div className=\"text-center p-3 bg-background rounded-lg\">\n                    <p className=\"text-2xl font-bold text-accent\">{stats.avgScore}</p>\n                    <p className=\"text-muted-foreground text-sm mt-1\">Avg Score</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      </main>\n      \n      <Footer />\n\n      {/* Onboarding Modal */}\n      {user && (\n        <UserOnboarding\n          isOpen={showOnboarding}\n          onComplete={handleOnboardingComplete}\n          userEmail={user.email || ''}\n        />\n      )}\n\n      {/* Stormy AI Assistant */}\n      {user && <StormyChat contextType=\"general\" />}\n    </div>\n  );\n};\n\nexport default Dashboard;\n","path":null,"size_bytes":15856,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { z } from \"zod\";\nimport { \n  insertPropertySchema, insertReportSchema, insertScanSchema, insertCrmConfigSchema, insertCrmSyncLogSchema, insertKnowledgeBaseSchema,\n  insertInspectionSessionSchema, insertEvidenceAssetSchema, insertLimitlessTranscriptSchema,\n  WINN_METHODOLOGY_STEPS, WinnMethodologyStep, StepRequirements, AIStepValidation, StepOverride, StepProficiency,\n  recordStepPayloadSchema, recordOverridePayloadSchema\n} from \"@shared/schema\";\nimport { analyzeThermalImage, generateThermalReport } from \"./thermal-analysis\";\nimport { crmManager } from './crm-integrations';\nimport { getAIAssistance, analyzeInspectionData, AIAssistantRequest, analyzeInspectionImage, getStepCoaching, parseTranscript, ImageAnalysisRequest } from './ai-assistant';\nimport { requireAuth, optionalAuth, AuthenticatedRequest } from './auth';\nimport Stripe from 'stripe';\nimport multer from 'multer';\nimport { \n  parseExcelFile, parseCSVFile, autoDetectColumnMapping, applyColumnMapping, \n  validateImportRows, convertToPropertyInsert, ColumnMapping \n} from './property-import';\nimport innovationRoutes from './innovation-routes';\n\nfunction getAuthenticatedUserId(req: AuthenticatedRequest, res: Response): number | null {\n  if (!req.user?.dbUserId) {\n    res.status(401).json({ message: \"Authentication required. Please sign in.\" });\n    return null;\n  }\n  return req.user.dbUserId;\n}\n\n// Step requirements and gating rules for Winn Methodology\nconst STEP_REQUIREMENTS: Record<WinnMethodologyStep, StepRequirements> = {\n  weather_verification: {\n    minPhotos: 0,\n    requiredFields: ['stormDate', 'weatherSource'],\n    aiValidationRequired: false,\n    canSkip: false,\n  },\n  thermal_imaging: {\n    minPhotos: 1,\n    requiredFields: [],\n    aiValidationRequired: true,\n    canSkip: false,\n  },\n  terrestrial_walk: {\n    minPhotos: 3,\n    requiredFields: [],\n    aiValidationRequired: true,\n    canSkip: false,\n  },\n  test_squares: {\n    minPhotos: 1,\n    requiredFields: ['impactCount', 'squareSize'],\n    aiValidationRequired: true,\n    canSkip: true,\n    skipReasons: ['No accessible areas', 'Owner declined', 'Safety concern'],\n  },\n  soft_metals: {\n    minPhotos: 2,\n    requiredFields: [],\n    aiValidationRequired: true,\n    canSkip: false,\n  },\n  moisture_testing: {\n    minPhotos: 0,\n    requiredFields: ['moistureReadings'],\n    aiValidationRequired: false,\n    canSkip: true,\n    skipReasons: ['No moisture meter available', 'Weather conditions prevented testing', 'Owner declined'],\n  },\n  core_samples: {\n    minPhotos: 0,\n    requiredFields: [],\n    aiValidationRequired: false,\n    canSkip: true,\n    skipReasons: ['Not required for damage type', 'Owner declined', 'Non-invasive inspection only'],\n  },\n  report_assembly: {\n    minPhotos: 0,\n    requiredFields: [],\n    aiValidationRequired: false,\n    canSkip: false,\n  },\n};\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  const httpServer = createServer(app);\n\n  // Innovation Framework Routes - Enterprise Features\n  app.use('/api/innovation', innovationRoutes);\n\n  // Authentication routes\n  // Note: Most authentication is handled via Firebase on the client-side\n  // These endpoints are for server session management\n\n  // User routes\n  app.get(\"/api/user\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    const userId = getAuthenticatedUserId(req, res);\n    if (!userId) return;\n    \n    const user = await storage.getUser(userId);\n    if (!user) {\n      return res.status(404).json({ message: \"User not found\" });\n    }\n    \n    const { password, ...userWithoutPassword } = user;\n    res.json(userWithoutPassword);\n  });\n\n  // Update user role\n  app.patch(\"/api/user/role\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    const userId = getAuthenticatedUserId(req, res);\n    if (!userId) return;\n    \n    const { role } = req.body;\n    const validRoles = ['junior_consultant', 'senior_consultant', 'admin', 'client'];\n    \n    if (!role || !validRoles.includes(role)) {\n      return res.status(400).json({ message: \"Invalid role. Must be one of: \" + validRoles.join(', ') });\n    }\n    \n    const updatedUser = await storage.updateUser(userId, { role });\n    if (!updatedUser) {\n      return res.status(500).json({ message: \"Failed to update user role\" });\n    }\n    \n    const { password, ...userWithoutPassword } = updatedUser;\n    res.json(userWithoutPassword);\n  });\n\n  // Complete user onboarding\n  app.patch(\"/api/user/onboarding\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    const userId = getAuthenticatedUserId(req, res);\n    if (!userId) return;\n    \n    const updatedUser = await storage.updateUser(userId, { onboardingCompleted: true });\n    if (!updatedUser) {\n      return res.status(500).json({ message: \"Failed to update onboarding status\" });\n    }\n    \n    const { password, ...userWithoutPassword } = updatedUser;\n    res.json(userWithoutPassword);\n  });\n\n  // Project routes\n  app.get(\"/api/projects\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    const userId = getAuthenticatedUserId(req, res);\n    if (!userId) return;\n    \n    try {\n      const projectsList = await storage.getProjectsByConsultant(userId);\n      res.json(projectsList);\n    } catch (error) {\n      console.error('Error fetching projects:', error);\n      res.status(500).json({ message: \"Failed to fetch projects\" });\n    }\n  });\n\n  app.get(\"/api/projects/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    const userId = getAuthenticatedUserId(req, res);\n    if (!userId) return;\n    \n    try {\n      const project = await storage.getProject(parseInt(req.params.id));\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      res.json(project);\n    } catch (error) {\n      console.error('Error fetching project:', error);\n      res.status(500).json({ message: \"Failed to fetch project\" });\n    }\n  });\n\n  // Property routes\n  app.get(\"/api/properties\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    const userId = getAuthenticatedUserId(req, res);\n    if (!userId) return;\n    \n    const properties = await storage.getPropertiesByUser(userId);\n    res.json(properties);\n  });\n\n  app.get(\"/api/properties/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    const userId = getAuthenticatedUserId(req, res);\n    if (!userId) return;\n    \n    const id = parseInt(req.params.id);\n    if (isNaN(id)) {\n      return res.status(400).json({ message: \"Invalid property ID\" });\n    }\n    \n    const property = await storage.getProperty(id);\n    if (!property) {\n      return res.status(404).json({ message: \"Property not found\" });\n    }\n    \n    res.json(property);\n  });\n\n  app.post(\"/api/properties\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      // Extract and validate relevant fields\n      const { name, address, imageUrls, scanType, notes, captureDate } = req.body;\n      \n      // Validate property data\n      const propertyData = insertPropertySchema.parse({\n        name,\n        address,\n        imageUrl: imageUrls[0], // Use the first image as property image\n        userId: userId\n      });\n      \n      // Create the property\n      const property = await storage.createProperty(propertyData);\n      \n      // Create a scan for this property with mock analysis\n      const scanData = insertScanSchema.parse({\n        propertyId: property.id,\n        date: captureDate ? new Date(captureDate) : new Date(),\n        scanType: scanType || \"drone\",\n        deviceType: scanType === \"drone\" ? \"DJI Mavic 2 Enterprise\" : \"FLIR E6-XT\",\n        standardImageUrl: imageUrls[0],\n        thermalImageUrl: imageUrls.length > 1 ? imageUrls[1] : imageUrls[0],\n        notes,\n        userId: userId\n      });\n      \n      // Create scan with mock analysis\n      const scan = await storage.createScan(scanData);\n      \n      res.status(201).json({\n        property,\n        scan\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid property data\", errors: error.format() });\n      }\n      console.error(error);\n      res.status(500).json({ message: \"Failed to create property\" });\n    }\n  });\n\n  // Property import routes\n  const upload = multer({ \n    storage: multer.memoryStorage(),\n    limits: { fileSize: 10 * 1024 * 1024 }, // 10MB limit\n    fileFilter: (req, file, cb) => {\n      const allowedMimes = [\n        'text/csv',\n        'application/vnd.ms-excel',\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n      ];\n      if (allowedMimes.includes(file.mimetype) || file.originalname.match(/\\.(csv|xlsx|xls)$/i)) {\n        cb(null, true);\n      } else {\n        cb(new Error('Only CSV and Excel files are allowed'));\n      }\n    }\n  });\n\n  app.post(\"/api/properties/import/parse\", requireAuth, upload.single('file'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const file = req.file;\n      if (!file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      let headers: string[];\n      let rows: Record<string, any>[];\n\n      if (file.originalname.match(/\\.csv$/i)) {\n        const content = file.buffer.toString('utf-8');\n        const parsed = parseCSVFile(content);\n        headers = parsed.headers;\n        rows = parsed.rows;\n      } else {\n        const parsed = parseExcelFile(file.buffer);\n        headers = parsed.headers;\n        rows = parsed.rows;\n      }\n\n      const suggestedMapping = autoDetectColumnMapping(headers);\n\n      res.json({\n        headers,\n        rowCount: rows.length,\n        suggestedMapping,\n        preview: rows.slice(0, 5)\n      });\n    } catch (error: any) {\n      console.error('File parse error:', error);\n      res.status(500).json({ message: error.message || \"Failed to parse file\" });\n    }\n  });\n\n  app.post(\"/api/properties/import/validate\", requireAuth, upload.single('file'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const file = req.file;\n      const mapping = req.body.mapping ? JSON.parse(req.body.mapping) : {};\n\n      if (!file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      let rows: Record<string, any>[];\n\n      if (file.originalname.match(/\\.csv$/i)) {\n        const content = file.buffer.toString('utf-8');\n        rows = parseCSVFile(content).rows;\n      } else {\n        rows = parseExcelFile(file.buffer).rows;\n      }\n\n      const mappedRows = applyColumnMapping(rows, mapping as ColumnMapping);\n      const validationResults = validateImportRows(mappedRows);\n\n      res.json({\n        totalRows: validationResults.length,\n        validRows: validationResults.filter(r => r.isValid).length,\n        invalidRows: validationResults.filter(r => !r.isValid).length,\n        results: validationResults\n      });\n    } catch (error: any) {\n      console.error('Validation error:', error);\n      res.status(500).json({ message: error.message || \"Failed to validate data\" });\n    }\n  });\n\n  app.post(\"/api/properties/import/execute\", requireAuth, upload.single('file'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const file = req.file;\n      const mapping = req.body.mapping ? JSON.parse(req.body.mapping) : {};\n      const projectId = req.body.projectId ? parseInt(req.body.projectId) : undefined;\n\n      if (!file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      let rows: Record<string, any>[];\n\n      if (file.originalname.match(/\\.csv$/i)) {\n        const content = file.buffer.toString('utf-8');\n        rows = parseCSVFile(content).rows;\n      } else {\n        rows = parseExcelFile(file.buffer).rows;\n      }\n\n      const mappedRows = applyColumnMapping(rows, mapping as ColumnMapping);\n      const validationResults = validateImportRows(mappedRows);\n      \n      const importedProperties = [];\n      const errors: { row: number; message: string }[] = [];\n\n      for (const result of validationResults) {\n        if (!result.isValid) {\n          errors.push({ row: result.row, message: result.errors.join(', ') });\n          continue;\n        }\n\n        try {\n          const propertyData = convertToPropertyInsert(result.data, userId, projectId);\n          const property = await storage.createProperty({\n            name: propertyData.name,\n            address: propertyData.address,\n            overallCondition: propertyData.overallCondition,\n            userId: propertyData.userId,\n            projectId: propertyData.projectId,\n            buildingInfo: propertyData.buildingInfo as any,\n            roofSystemDetails: propertyData.roofSystemDetails as any\n          });\n          importedProperties.push(property);\n        } catch (err: any) {\n          errors.push({ row: result.row, message: err.message || 'Failed to create property' });\n        }\n      }\n\n      res.json({\n        totalRows: validationResults.length,\n        importedCount: importedProperties.length,\n        skippedCount: errors.length,\n        errors,\n        properties: importedProperties\n      });\n    } catch (error: any) {\n      console.error('Import error:', error);\n      res.status(500).json({ message: error.message || \"Failed to import properties\" });\n    }\n  });\n\n  // Scan routes\n  app.get(\"/api/scans/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    const userId = getAuthenticatedUserId(req, res);\n    if (!userId) return;\n    \n    const id = parseInt(req.params.id);\n    if (isNaN(id)) {\n      return res.status(400).json({ message: \"Invalid scan ID\" });\n    }\n    \n    const scan = await storage.getScan(id);\n    if (!scan) {\n      return res.status(404).json({ message: \"Scan not found\" });\n    }\n    \n    res.json(scan);\n  });\n\n  app.get(\"/api/properties/:id/scans\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    const userId = getAuthenticatedUserId(req, res);\n    if (!userId) return;\n    \n    const id = parseInt(req.params.id);\n    if (isNaN(id)) {\n      return res.status(400).json({ message: \"Invalid property ID\" });\n    }\n    \n    const scans = await storage.getScansByProperty(id);\n    res.json(scans);\n  });\n\n  // Report routes\n  app.post(\"/api/reports/send/:scanId\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const scanId = parseInt(req.params.scanId);\n      if (isNaN(scanId)) {\n        return res.status(400).json({ message: \"Invalid scan ID\" });\n      }\n      \n      const { email } = req.body;\n      if (!email) {\n        return res.status(400).json({ message: \"Email is required\" });\n      }\n      \n      // Get the scan\n      const scan = await storage.getScan(scanId);\n      if (!scan) {\n        return res.status(404).json({ message: \"Scan not found\" });\n      }\n      \n      // Create a report\n      const reportData = insertReportSchema.parse({\n        scanId,\n        title: \"Thermal Roof Assessment\",\n        pdfUrl: \"\", // In MVP, we don't actually generate a PDF\n        sentTo: email,\n        userId: userId\n      });\n      \n      const report = await storage.createReport(reportData);\n      \n      // In a real implementation, you would generate the PDF and send an email here\n      \n      res.status(201).json({\n        message: \"Report sent successfully\",\n        report\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid report data\", errors: error.format() });\n      }\n      console.error(error);\n      res.status(500).json({ message: \"Failed to send report\" });\n    }\n  });\n\n  app.get(\"/api/reports/download/:scanId\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const scanId = parseInt(req.params.scanId);\n      if (isNaN(scanId)) {\n        return res.status(400).json({ message: \"Invalid scan ID\" });\n      }\n      \n      const scan = await storage.getScan(scanId);\n      if (!scan) {\n        return res.status(404).json({ message: \"Scan not found\" });\n      }\n      \n      if (scan.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied - you do not own this scan\" });\n      }\n      \n      const property = await storage.getProperty(scan.propertyId);\n      if (!property) {\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n      \n      const { generateWinnReport, generateExecutiveSummary } = await import('./pdf-report-service');\n      \n      const executiveSummary = await generateExecutiveSummary({ property, scan });\n      \n      let thermalAnalysis = undefined;\n      if (scan.thermalImageUrl && scan.issues && scan.issues.length > 0) {\n        thermalAnalysis = {\n          overallAssessment: `Thermal analysis detected ${scan.issues.length} issue(s) during the assessment. ` +\n            `${scan.issues.filter(i => i.severity === 'critical').length > 0 ? 'Critical issues requiring immediate attention were identified.' : 'No critical issues were found.'}`,\n          anomalies: scan.issues.map(issue => ({\n            type: issue.title,\n            severity: issue.severity,\n            location: 'See thermal image',\n            description: issue.description,\n          })),\n        };\n      }\n      \n      const pdfBuffer = await generateWinnReport({\n        property,\n        scan,\n        executiveSummary,\n        thermalAnalysis,\n      });\n      \n      const sanitizedName = property.name.replace(/[^a-zA-Z0-9]/g, '_');\n      const filename = `WinnReport_${sanitizedName}_${new Date().toISOString().split('T')[0]}.pdf`;\n      \n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\n      res.setHeader('Content-Length', pdfBuffer.length);\n      res.send(pdfBuffer);\n    } catch (error) {\n      console.error('Error generating PDF report:', error);\n      res.status(500).json({ message: \"Failed to generate report\" });\n    }\n  });\n\n  // AI Executive Summary Generation\n  app.post(\"/api/reports/executive-summary/:scanId\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const scanId = parseInt(req.params.scanId);\n      if (isNaN(scanId)) {\n        return res.status(400).json({ message: \"Invalid scan ID\" });\n      }\n      \n      const scan = await storage.getScan(scanId);\n      if (!scan) {\n        return res.status(404).json({ message: \"Scan not found\" });\n      }\n      \n      if (scan.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied - you do not own this scan\" });\n      }\n      \n      const property = await storage.getProperty(scan.propertyId);\n      if (!property) {\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n      \n      const OpenAI = (await import('openai')).default;\n      const openai = new OpenAI({\n        baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n        apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY\n      });\n      \n      const issuesSummary = scan.issues && scan.issues.length > 0\n        ? scan.issues.map(i => `- ${i.severity.toUpperCase()}: ${i.title} - ${i.description}`).join('\\n')\n        : 'No significant issues detected.';\n      \n      const metricsSummary = scan.metrics && scan.metrics.length > 0\n        ? scan.metrics.map(m => `- ${m.name}: ${m.value}`).join('\\n')\n        : 'No metrics recorded.';\n\n      const prompt = `You are a professional damage assessment consultant writing an executive summary for a thermal roof assessment report. Write a professional, concise executive summary (2-3 paragraphs) based on the following inspection data:\n\nPROPERTY INFORMATION:\n- Name: ${property.name}\n- Address: ${property.address}\n- Overall Condition: ${property.overallCondition || 'Not assessed'}\n\nSCAN DETAILS:\n- Date: ${scan.date ? new Date(scan.date).toLocaleDateString() : 'N/A'}\n- Type: ${scan.scanType || 'Thermal'}\n- Device: ${scan.deviceType || 'Professional thermal camera'}\n- Health Score: ${scan.healthScore !== null ? `${scan.healthScore}/100` : 'Not calculated'}\n\nISSUES FOUND:\n${issuesSummary}\n\nPERFORMANCE METRICS:\n${metricsSummary}\n\nINSPECTOR NOTES:\n${scan.notes || 'No additional notes.'}\n\nWrite a professional executive summary following the Winn Methodology standards. Include:\n1. An opening paragraph summarizing the inspection scope and methodology\n2. Key findings and their significance\n3. Overall assessment and recommended next steps\n\nKeep the tone professional and technical but accessible.`;\n\n      const completion = await openai.chat.completions.create({\n        model: 'gpt-5.1',\n        messages: [\n          {\n            role: 'system',\n            content: 'You are Stormy, the WinnStorm AI assistant specializing in professional damage assessment reports. You follow the Winn Methodology and produce clear, actionable executive summaries.'\n          },\n          {\n            role: 'user',\n            content: prompt\n          }\n        ],\n        max_completion_tokens: 800,\n      });\n\n      const summary = completion.choices[0]?.message?.content || 'Unable to generate executive summary.';\n      \n      res.json({ \n        summary,\n        generatedAt: new Date().toISOString()\n      });\n    } catch (error) {\n      console.error('Error generating AI executive summary:', error);\n      \n      const { generateExecutiveSummary } = await import('./pdf-report-service');\n      const scan = await storage.getScan(parseInt(req.params.scanId));\n      const property = scan ? await storage.getProperty(scan.propertyId) : null;\n      \n      if (scan && property) {\n        const fallbackSummary = await generateExecutiveSummary({ property, scan });\n        return res.json({ \n          summary: fallbackSummary,\n          generatedAt: new Date().toISOString(),\n          fallback: true\n        });\n      }\n      \n      res.status(500).json({ message: \"Failed to generate executive summary\" });\n    }\n  });\n\n  // CRM Configuration routes\n  app.get(\"/api/crm/configs\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const configs = await storage.getCrmConfigsByUser(userId);\n      res.json(configs);\n    } catch (error) {\n      console.error('Error fetching CRM configs:', error);\n      res.status(500).json({ message: \"Failed to fetch CRM configurations\" });\n    }\n  });\n\n  app.post(\"/api/crm/configs\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const configData = insertCrmConfigSchema.parse(req.body);\n      const config = await storage.createCrmConfig({\n        ...configData,\n        userId: userId\n      });\n      \n      // Add configuration to CRM manager\n      crmManager.addIntegration(config.name, {\n        type: config.type as any,\n        apiKey: config.apiKey,\n        baseUrl: config.baseUrl,\n        webhookUrl: config.webhookUrl || undefined,\n        customFields: config.customFields || undefined\n      });\n      \n      res.json(config);\n    } catch (error) {\n      console.error('Error creating CRM config:', error);\n      res.status(500).json({ message: \"Failed to create CRM configuration\" });\n    }\n  });\n\n  app.put(\"/api/crm/configs/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid configuration ID\" });\n      }\n      \n      const updateData = insertCrmConfigSchema.partial().parse(req.body);\n      const updatedConfig = await storage.updateCrmConfig(id, updateData);\n      \n      if (!updatedConfig) {\n        return res.status(404).json({ message: \"Configuration not found\" });\n      }\n      \n      res.json(updatedConfig);\n    } catch (error) {\n      console.error('Error updating CRM config:', error);\n      res.status(500).json({ message: \"Failed to update CRM configuration\" });\n    }\n  });\n\n  app.delete(\"/api/crm/configs/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid configuration ID\" });\n      }\n      \n      const deleted = await storage.deleteCrmConfig(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Configuration not found\" });\n      }\n      \n      res.json({ message: \"Configuration deleted successfully\" });\n    } catch (error) {\n      console.error('Error deleting CRM config:', error);\n      res.status(500).json({ message: \"Failed to delete CRM configuration\" });\n    }\n  });\n\n  // CRM Sync routes\n  app.post(\"/api/crm/sync/property\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { crmConfigId, propertyId, ownerInfo } = req.body;\n      \n      if (!crmConfigId || !propertyId || !ownerInfo) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n      \n      const config = await storage.getCrmConfig(crmConfigId);\n      if (!config) {\n        return res.status(404).json({ message: \"CRM configuration not found\" });\n      }\n      \n      const property = await storage.getProperty(propertyId);\n      if (!property) {\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n      \n      // Get the latest scan for the property\n      const scans = await storage.getScansByProperty(propertyId);\n      if (scans.length === 0) {\n        return res.status(400).json({ message: \"No scans found for property\" });\n      }\n      \n      const latestScan = scans.sort((a, b) => b.date.getTime() - a.date.getTime())[0];\n      \n      // Sync to CRM\n      const syncResults = await crmManager.syncPropertyToCRM(\n        config.name,\n        property,\n        latestScan,\n        ownerInfo\n      );\n      \n      // Log sync results\n      for (const result of syncResults) {\n        await storage.createCrmSyncLog({\n          crmConfigId: config.id,\n          propertyId: property.id,\n          scanId: latestScan.id,\n          syncType: result.contactId ? 'contact' : 'job',\n          externalId: result.contactId || result.jobId,\n          status: result.success ? 'success' : 'failed',\n          errorMessage: result.error\n        });\n      }\n      \n      res.json({ results: syncResults });\n    } catch (error) {\n      console.error('Error syncing to CRM:', error);\n      res.status(500).json({ message: \"Failed to sync to CRM\" });\n    }\n  });\n\n  app.get(\"/api/crm/sync/logs/:configId\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const configId = parseInt(req.params.configId);\n      if (isNaN(configId)) {\n        return res.status(400).json({ message: \"Invalid configuration ID\" });\n      }\n      \n      const logs = await storage.getCrmSyncLogsByConfig(configId);\n      res.json(logs);\n    } catch (error) {\n      console.error('Error fetching sync logs:', error);\n      res.status(500).json({ message: \"Failed to fetch sync logs\" });\n    }\n  });\n\n  // Team Assignment & Workload Management routes\n  app.get(\"/api/team/assignments\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const assignments = await storage.getAllTeamAssignments();\n      res.json(assignments);\n    } catch (error) {\n      console.error('Error fetching team assignments:', error);\n      res.status(500).json({ message: \"Failed to fetch team assignments\" });\n    }\n  });\n\n  app.get(\"/api/team/assignments/:inspectorId\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const inspectorId = parseInt(req.params.inspectorId);\n      if (isNaN(inspectorId)) {\n        return res.status(400).json({ message: \"Invalid inspector ID\" });\n      }\n      \n      const assignment = await storage.getTeamAssignment(inspectorId);\n      if (!assignment) {\n        return res.status(404).json({ message: \"Team assignment not found\" });\n      }\n      \n      res.json(assignment);\n    } catch (error) {\n      console.error('Error fetching team assignment:', error);\n      res.status(500).json({ message: \"Failed to fetch team assignment\" });\n    }\n  });\n\n  app.post(\"/api/team/assignments\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const assignment = await storage.createTeamAssignment(req.body);\n      res.status(201).json(assignment);\n    } catch (error) {\n      console.error('Error creating team assignment:', error);\n      res.status(500).json({ message: \"Failed to create team assignment\" });\n    }\n  });\n\n  app.put(\"/api/team/assignments/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid assignment ID\" });\n      }\n      \n      const updated = await storage.updateTeamAssignment(id, req.body);\n      if (!updated) {\n        return res.status(404).json({ message: \"Team assignment not found\" });\n      }\n      \n      res.json(updated);\n    } catch (error) {\n      console.error('Error updating team assignment:', error);\n      res.status(500).json({ message: \"Failed to update team assignment\" });\n    }\n  });\n\n  app.delete(\"/api/team/assignments/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid assignment ID\" });\n      }\n      \n      const deleted = await storage.deleteTeamAssignment(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Team assignment not found\" });\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error('Error deleting team assignment:', error);\n      res.status(500).json({ message: \"Failed to delete team assignment\" });\n    }\n  });\n\n  // Workload Dashboard API\n  app.get(\"/api/team/workload\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const today = new Date();\n      const startOfWeek = new Date(today);\n      startOfWeek.setDate(today.getDate() - today.getDay());\n      const endOfWeek = new Date(startOfWeek);\n      endOfWeek.setDate(startOfWeek.getDate() + 6);\n      \n      const assignments = await storage.getAllTeamAssignments();\n      const workloadData = [];\n      \n      for (const assignment of assignments) {\n        const inspections = await storage.getScheduledInspectionsByInspector(\n          assignment.inspectorId, startOfWeek, endOfWeek\n        );\n        \n        const inspector = await storage.getUser(assignment.inspectorId);\n        \n        workloadData.push({\n          inspectorId: assignment.inspectorId,\n          inspectorName: inspector ? `${inspector.firstName} ${inspector.lastName}` : 'Unknown',\n          teamName: assignment.teamName,\n          region: assignment.region,\n          maxDaily: assignment.maxDailyInspections,\n          maxWeekly: assignment.maxWeeklyInspections,\n          currentWeekly: inspections.length,\n          isAvailable: assignment.isAvailable,\n          unavailableUntil: assignment.unavailableUntil,\n          specializations: assignment.specializations,\n          utilizationPercent: Math.round((inspections.length / (assignment.maxWeeklyInspections || 20)) * 100)\n        });\n      }\n      \n      res.json(workloadData);\n    } catch (error) {\n      console.error('Error fetching workload data:', error);\n      res.status(500).json({ message: \"Failed to fetch workload data\" });\n    }\n  });\n\n  // Damage Templates routes\n  app.get(\"/api/damage-templates\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const category = req.query.category as string;\n      \n      let templates;\n      if (category) {\n        templates = await storage.getDamageTemplatesByCategory(category);\n      } else {\n        templates = await storage.getAllDamageTemplates();\n      }\n      \n      res.json(templates);\n    } catch (error) {\n      console.error('Error fetching damage templates:', error);\n      res.status(500).json({ message: \"Failed to fetch damage templates\" });\n    }\n  });\n\n  app.get(\"/api/damage-templates/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid template ID\" });\n      }\n      \n      const template = await storage.getDamageTemplate(id);\n      if (!template) {\n        return res.status(404).json({ message: \"Damage template not found\" });\n      }\n      \n      res.json(template);\n    } catch (error) {\n      console.error('Error fetching damage template:', error);\n      res.status(500).json({ message: \"Failed to fetch damage template\" });\n    }\n  });\n\n  app.post(\"/api/damage-templates\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const template = await storage.createDamageTemplate(req.body);\n      res.status(201).json(template);\n    } catch (error) {\n      console.error('Error creating damage template:', error);\n      res.status(500).json({ message: \"Failed to create damage template\" });\n    }\n  });\n\n  app.put(\"/api/damage-templates/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid template ID\" });\n      }\n      \n      const updated = await storage.updateDamageTemplate(id, req.body);\n      if (!updated) {\n        return res.status(404).json({ message: \"Damage template not found\" });\n      }\n      \n      res.json(updated);\n    } catch (error) {\n      console.error('Error updating damage template:', error);\n      res.status(500).json({ message: \"Failed to update damage template\" });\n    }\n  });\n\n  app.delete(\"/api/damage-templates/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid template ID\" });\n      }\n      \n      const deleted = await storage.deleteDamageTemplate(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Damage template not found\" });\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error('Error deleting damage template:', error);\n      res.status(500).json({ message: \"Failed to delete damage template\" });\n    }\n  });\n\n  // Seed default damage templates (admin only)\n  app.post(\"/api/damage-templates/seed\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const existingTemplates = await storage.getAllDamageTemplates();\n      if (existingTemplates.length > 0) {\n        return res.json({ message: \"Templates already seeded\", count: existingTemplates.length });\n      }\n      \n      const defaultTemplates = [\n        {\n          name: \"Hail Impact Damage\",\n          category: \"Storm Damage\",\n          damageType: \"hail\",\n          description: \"Circular or irregular indentations caused by hail impact on roofing materials. May show exposed substrate or granule loss.\",\n          defaultSeverity: \"warning\",\n          affectedComponents: [\"shingles\", \"metal panels\", \"gutters\", \"vents\"],\n          typicalCauses: [\"Hailstorm\", \"Severe weather\"],\n          recommendations: [\n            { action: \"Document all impact locations with close-up photos\", priority: \"immediate\" as const },\n            { action: \"Measure and record largest hail diameter impacts\", priority: \"immediate\" as const },\n            { action: \"Schedule full roof replacement assessment\", priority: \"short_term\" as const, estimatedCost: \"$8,000-$15,000\" }\n          ],\n          inspectionNotes: \"Check soft metals (vents, gutters) first as they show clearest evidence of hail size\",\n          requiredEvidence: [\"overview_photo\", \"close_up_damage\", \"soft_metal_impacts\", \"test_square\"]\n        },\n        {\n          name: \"Wind Uplift Damage\",\n          category: \"Storm Damage\",\n          damageType: \"wind\",\n          description: \"Shingles lifted, creased, or missing due to high wind events. May show exposed underlayment or decking.\",\n          defaultSeverity: \"critical\",\n          affectedComponents: [\"shingles\", \"ridge caps\", \"drip edge\", \"fascia\"],\n          typicalCauses: [\"High winds\", \"Tornado\", \"Hurricane\"],\n          recommendations: [\n            { action: \"Emergency tarping to prevent water intrusion\", priority: \"immediate\" as const, estimatedCost: \"$200-$500\" },\n            { action: \"Full roof inspection once weather permits\", priority: \"short_term\" as const },\n            { action: \"Replace damaged sections or full roof\", priority: \"short_term\" as const, estimatedCost: \"$5,000-$20,000\" }\n          ],\n          inspectionNotes: \"Check corners and edges first - wind damage typically starts at perimeter\",\n          requiredEvidence: [\"wide_angle_damage\", \"missing_material\", \"underlayment_exposure\"]\n        },\n        {\n          name: \"Thermal Bridging\",\n          category: \"Thermal Issues\",\n          damageType: \"thermal\",\n          description: \"Heat transfer through building components visible in thermal imaging. Indicates insulation gaps or structural thermal bridges.\",\n          defaultSeverity: \"warning\",\n          affectedComponents: [\"insulation\", \"framing\", \"fasteners\", \"penetrations\"],\n          typicalCauses: [\"Poor insulation\", \"Missing vapor barrier\", \"Improper installation\"],\n          recommendations: [\n            { action: \"Mark locations for remediation\", priority: \"short_term\" as const },\n            { action: \"Add insulation at thermal bridges\", priority: \"long_term\" as const, estimatedCost: \"$1,000-$5,000\" }\n          ],\n          inspectionNotes: \"Best detected during significant indoor/outdoor temperature differential (>20°F)\",\n          requiredEvidence: [\"thermal_image\", \"standard_image\", \"temperature_readings\"]\n        },\n        {\n          name: \"Moisture Intrusion\",\n          category: \"Water Damage\",\n          damageType: \"moisture\",\n          description: \"Water infiltration detected through thermal imaging showing cooler areas or moisture meter readings above threshold.\",\n          defaultSeverity: \"critical\",\n          affectedComponents: [\"decking\", \"insulation\", \"membrane\", \"flashing\"],\n          typicalCauses: [\"Failed sealant\", \"Puncture\", \"Flashing failure\", \"Clogged drains\"],\n          recommendations: [\n            { action: \"Core sample to assess decking condition\", priority: \"immediate\" as const },\n            { action: \"Locate and repair water entry point\", priority: \"immediate\" as const, estimatedCost: \"$500-$2,000\" },\n            { action: \"Replace saturated insulation and decking\", priority: \"short_term\" as const, estimatedCost: \"$3,000-$10,000\" }\n          ],\n          inspectionNotes: \"Use moisture meter to confirm thermal anomalies. Document moisture readings at each location.\",\n          requiredEvidence: [\"thermal_image\", \"moisture_reading\", \"core_sample\"]\n        },\n        {\n          name: \"Granule Loss\",\n          category: \"Material Degradation\",\n          damageType: \"wear\",\n          description: \"Surface granules missing from asphalt shingles, exposing underlying asphalt. May be age-related or impact damage.\",\n          defaultSeverity: \"warning\",\n          affectedComponents: [\"shingles\"],\n          typicalCauses: [\"Age\", \"Hail impact\", \"Foot traffic\", \"Manufacturing defect\"],\n          recommendations: [\n            { action: \"Check gutters and downspouts for granule accumulation\", priority: \"immediate\" as const },\n            { action: \"Document extent of granule loss\", priority: \"immediate\" as const },\n            { action: \"Plan for roof replacement within 3-5 years\", priority: \"long_term\" as const, estimatedCost: \"$8,000-$15,000\" }\n          ],\n          inspectionNotes: \"Distinguish between natural aging (uniform loss) and hail damage (concentrated impact patterns)\",\n          requiredEvidence: [\"close_up_photo\", \"granule_sample\", \"age_assessment\"]\n        },\n        {\n          name: \"Flashing Failure\",\n          category: \"Penetration Issues\",\n          damageType: \"flashing\",\n          description: \"Deteriorated, lifted, or improperly installed flashing around roof penetrations, walls, or edges.\",\n          defaultSeverity: \"critical\",\n          affectedComponents: [\"flashing\", \"sealant\", \"membrane\"],\n          typicalCauses: [\"Age\", \"Thermal cycling\", \"Poor installation\", \"Storm damage\"],\n          recommendations: [\n            { action: \"Apply emergency sealant if active leak\", priority: \"immediate\" as const, estimatedCost: \"$100-$300\" },\n            { action: \"Replace failed flashing and sealant\", priority: \"short_term\" as const, estimatedCost: \"$500-$2,000\" }\n          ],\n          inspectionNotes: \"Check all penetrations: vents, pipes, chimneys, HVAC units, skylights\",\n          requiredEvidence: [\"flashing_photo\", \"sealant_condition\", \"water_staining\"]\n        }\n      ];\n      \n      const createdTemplates = [];\n      for (const template of defaultTemplates) {\n        const created = await storage.createDamageTemplate(template as any);\n        createdTemplates.push(created);\n      }\n      \n      res.status(201).json({ message: \"Templates seeded\", count: createdTemplates.length, templates: createdTemplates });\n    } catch (error) {\n      console.error('Error seeding damage templates:', error);\n      res.status(500).json({ message: \"Failed to seed damage templates\" });\n    }\n  });\n\n  // Thermal Analysis API routes\n  app.post(\"/api/thermal/analyze\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { imageBase64, metadata } = req.body;\n      \n      if (!imageBase64) {\n        return res.status(400).json({ message: \"Image data is required\" });\n      }\n      \n      if (!metadata || !metadata.location) {\n        return res.status(400).json({ message: \"Image metadata with location is required\" });\n      }\n      \n      const analysisResult = await analyzeThermalImage(imageBase64, {\n        location: metadata.location,\n        timestamp: metadata.timestamp ? new Date(metadata.timestamp) : new Date(),\n        ambientTemp: metadata.ambientTemp,\n        humidity: metadata.humidity\n      });\n      \n      res.json(analysisResult);\n    } catch (error) {\n      console.error('Thermal analysis error:', error);\n      res.status(500).json({ \n        message: \"Failed to analyze thermal image\", \n        error: (error as Error).message \n      });\n    }\n  });\n\n  app.post(\"/api/thermal/generate-report\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { analysisResults, buildingInfo } = req.body;\n      \n      if (!analysisResults || !Array.isArray(analysisResults)) {\n        return res.status(400).json({ message: \"Analysis results array is required\" });\n      }\n      \n      if (!buildingInfo) {\n        return res.status(400).json({ message: \"Building information is required\" });\n      }\n      \n      const reportSummary = await generateThermalReport(analysisResults, buildingInfo);\n      \n      res.json({ summary: reportSummary });\n    } catch (error) {\n      console.error('Thermal report generation error:', error);\n      res.status(500).json({ \n        message: \"Failed to generate thermal report\", \n        error: (error as Error).message \n      });\n    }\n  });\n\n  // AI Assistant routes\n  app.post(\"/api/ai-assistant\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { message, context, conversationHistory } = req.body;\n      \n      if (!message) {\n        return res.status(400).json({ message: \"Message is required\" });\n      }\n      \n      const assistantRequest: AIAssistantRequest = {\n        message,\n        context: context || \"General roof inspection assistance\",\n        conversationHistory: conversationHistory || []\n      };\n      \n      const response = await getAIAssistance(assistantRequest);\n      \n      res.json(response);\n    } catch (error) {\n      console.error('AI Assistant error:', error);\n      res.status(500).json({ \n        message: \"Failed to get AI assistance\", \n        error: (error as Error).message \n      });\n    }\n  });\n\n  app.post(\"/api/ai-assistant/analyze-inspection\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { thermalReadings, roofSections, weatherData, inspectionType } = req.body;\n      \n      if (!inspectionType) {\n        return res.status(400).json({ message: \"Inspection type is required\" });\n      }\n      \n      const analysisResult = await analyzeInspectionData({\n        thermalReadings,\n        roofSections,\n        weatherData,\n        inspectionType\n      });\n      \n      res.json(analysisResult);\n    } catch (error) {\n      console.error('AI Inspection analysis error:', error);\n      res.status(500).json({ \n        message: \"Failed to analyze inspection data\", \n        error: (error as Error).message \n      });\n    }\n  });\n\n  // Stripe subscription routes\n  app.post(\"/api/create-subscription\", async (req, res) => {\n    try {\n      // Prefer testing keys for development, fall back to production keys\n      const stripeSecretKey = process.env.TESTING_STRIPE_SECRET_KEY || process.env.STRIPE_SECRET_KEY;\n      \n      if (!stripeSecretKey) {\n        return res.status(500).json({ message: \"Stripe is not configured\" });\n      }\n\n      const stripe = new Stripe(stripeSecretKey, {\n        apiVersion: '2025-10-29.clover',\n      });\n\n      const { plan, email } = req.body;\n\n      // Map plan names to Stripe price IDs (configured in Stripe Dashboard)\n      // For development without price IDs, we'll create ad-hoc prices\n      const priceMap: Record<string, string> = {\n        'starter': process.env.STRIPE_PRICE_STARTER || '',\n        'professional': process.env.STRIPE_PRICE_PROFESSIONAL || '',\n        'enterprise': process.env.STRIPE_PRICE_ENTERPRISE || ''\n      };\n\n      // Plan pricing in cents for development mode\n      const planPricing: Record<string, number> = {\n        'starter': 4900,        // $49/month\n        'professional': 14900,  // $149/month\n        'enterprise': 49900     // $499/month\n      };\n\n      const planLower = plan?.toLowerCase() || 'starter';\n      let priceId = priceMap[planLower];\n      \n      // If no price ID is configured, create an ad-hoc price for development\n      if (!priceId) {\n        console.log(`No Stripe price ID for plan: ${plan}. Creating ad-hoc price for development.`);\n        \n        // First create or get a product\n        const products = await stripe.products.list({ limit: 1 });\n        let productId: string;\n        \n        if (products.data.length > 0) {\n          productId = products.data[0].id;\n        } else {\n          const product = await stripe.products.create({\n            name: 'WinnStorm Subscription',\n            description: 'WinnStorm damage assessment platform subscription',\n          });\n          productId = product.id;\n        }\n        \n        // Create a price for this subscription\n        const price = await stripe.prices.create({\n          product: productId,\n          unit_amount: planPricing[planLower] || 4900,\n          currency: 'usd',\n          recurring: { interval: 'month' },\n        });\n        priceId = price.id;\n      }\n\n      // Create a customer with email if provided\n      const customer = await stripe.customers.create({\n        email: email || undefined,\n        metadata: {\n          plan: plan,\n        },\n      });\n\n      // Create a PaymentIntent for the subscription using the invoice approach\n      // First create an incomplete subscription, then finalize the invoice\n      const subscription = await stripe.subscriptions.create({\n        customer: customer.id,\n        items: [{ price: priceId }],\n        payment_behavior: 'default_incomplete',\n        payment_settings: { \n          save_default_payment_method: 'on_subscription',\n        },\n        expand: ['latest_invoice.payment_intent'],\n      });\n\n      // Get the payment intent from the invoice\n      // Since we expanded 'latest_invoice.payment_intent', the invoice includes payment_intent\n      const invoice = subscription.latest_invoice;\n      \n      if (!invoice || typeof invoice === 'string') {\n        console.error('Subscription created but invoice not expanded');\n        return res.status(500).json({ \n          message: \"Subscription created but invoice not available. Please contact support.\",\n          subscriptionId: subscription.id\n        });\n      }\n\n      // Access payment_intent from expanded invoice (need to cast as it's an expanded relation)\n      let paymentIntent = (invoice as Stripe.Invoice & { payment_intent?: Stripe.PaymentIntent | string | null }).payment_intent;\n      \n      // If payment_intent is a string (not expanded) or null, try to finalize the invoice\n      // Only finalize if invoice is in draft status\n      if ((!paymentIntent || typeof paymentIntent === 'string') && invoice.id && invoice.status === 'draft') {\n        try {\n          const finalizedInvoice = await stripe.invoices.finalizeInvoice(invoice.id, {\n            expand: ['payment_intent'],\n          });\n          paymentIntent = (finalizedInvoice as Stripe.Invoice & { payment_intent?: Stripe.PaymentIntent | string | null }).payment_intent;\n        } catch (finalizeError) {\n          console.error('Error finalizing invoice:', finalizeError);\n        }\n      } else if (invoice.status !== 'draft' && typeof paymentIntent === 'string') {\n        // Invoice already finalized, retrieve the payment intent\n        try {\n          const retrievedIntent = await stripe.paymentIntents.retrieve(paymentIntent);\n          paymentIntent = retrievedIntent;\n        } catch (retrieveError) {\n          console.error('Error retrieving payment intent:', retrieveError);\n        }\n      }\n\n      // Validate we have a proper PaymentIntent with client_secret\n      if (!paymentIntent || typeof paymentIntent === 'string' || !paymentIntent.client_secret) {\n        // Fall back to creating a setup intent for the customer\n        console.log('Creating setup intent as fallback for customer:', customer.id);\n        const setupIntent = await stripe.setupIntents.create({\n          customer: customer.id,\n          payment_method_types: ['card'],\n          metadata: {\n            subscriptionId: subscription.id,\n          },\n        });\n\n        return res.json({\n          subscriptionId: subscription.id,\n          clientSecret: setupIntent.client_secret,\n          setupMode: true,\n        });\n      }\n\n      res.json({\n        subscriptionId: subscription.id,\n        clientSecret: paymentIntent.client_secret,\n      });\n    } catch (error) {\n      console.error('Stripe subscription creation error:', error);\n      res.status(500).json({ \n        message: \"Failed to create subscription\", \n        error: (error as Error).message \n      });\n    }\n  });\n\n  // Knowledge Base routes\n  app.get(\"/api/knowledge\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { search, workflowStep } = req.query;\n      \n      if (search) {\n        const entries = await storage.searchKnowledge(\n          String(search),\n          workflowStep ? String(workflowStep) : undefined\n        );\n        return res.json(entries);\n      }\n      \n      const entries = await storage.getAllKnowledgeEntries();\n      res.json(entries);\n    } catch (error) {\n      console.error('Error fetching knowledge base:', error);\n      res.status(500).json({ message: \"Failed to fetch knowledge base\" });\n    }\n  });\n\n  app.get(\"/api/knowledge/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid knowledge entry ID\" });\n      }\n      \n      const entry = await storage.getKnowledgeEntry(id);\n      if (!entry) {\n        return res.status(404).json({ message: \"Knowledge entry not found\" });\n      }\n      \n      res.json(entry);\n    } catch (error) {\n      console.error('Error fetching knowledge entry:', error);\n      res.status(500).json({ message: \"Failed to fetch knowledge entry\" });\n    }\n  });\n\n  app.post(\"/api/knowledge\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const entryData = insertKnowledgeBaseSchema.parse(req.body);\n      const entry = await storage.createKnowledgeEntry(entryData);\n      res.status(201).json(entry);\n    } catch (error) {\n      console.error('Error creating knowledge entry:', error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ \n          message: \"Invalid knowledge entry data\", \n          errors: error.errors \n        });\n      }\n      res.status(500).json({ message: \"Failed to create knowledge entry\" });\n    }\n  });\n\n  app.patch(\"/api/knowledge/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid knowledge entry ID\" });\n      }\n      \n      const updatedEntry = await storage.updateKnowledgeEntry(id, req.body);\n      if (!updatedEntry) {\n        return res.status(404).json({ message: \"Knowledge entry not found\" });\n      }\n      \n      res.json(updatedEntry);\n    } catch (error) {\n      console.error('Error updating knowledge entry:', error);\n      res.status(500).json({ message: \"Failed to update knowledge entry\" });\n    }\n  });\n\n  app.delete(\"/api/knowledge/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid knowledge entry ID\" });\n      }\n      \n      const deleted = await storage.deleteKnowledgeEntry(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Knowledge entry not found\" });\n      }\n      \n      res.json({ message: \"Knowledge entry deleted successfully\" });\n    } catch (error) {\n      console.error('Error deleting knowledge entry:', error);\n      res.status(500).json({ message: \"Failed to delete knowledge entry\" });\n    }\n  });\n\n  // ============================================================================\n  // INSPECTION SESSION ROUTES - Winn Methodology Workflow Engine\n  // ============================================================================\n\n  // Get step requirements configuration\n  app.get(\"/api/inspection/step-requirements\", async (req, res) => {\n    res.json({\n      steps: WINN_METHODOLOGY_STEPS,\n      requirements: STEP_REQUIREMENTS,\n    });\n  });\n\n  // Get step-specific coaching content (query param version)\n  app.get(\"/api/inspection/coaching\", async (req, res) => {\n    try {\n      const step = req.query.step as WinnMethodologyStep;\n      const experienceLevel = (req.query.level as 'beginner' | 'intermediate' | 'expert') || 'beginner';\n      \n      if (!step || !WINN_METHODOLOGY_STEPS.includes(step)) {\n        return res.status(400).json({ \n          message: \"Invalid or missing methodology step\",\n          validSteps: WINN_METHODOLOGY_STEPS \n        });\n      }\n\n      const coaching = await getStepCoaching(step, experienceLevel);\n      res.json(coaching);\n\n    } catch (error) {\n      console.error('Error getting coaching content:', error);\n      res.status(500).json({ message: \"Failed to get coaching content\" });\n    }\n  });\n\n  // Get or create active inspection session for a property\n  app.get(\"/api/inspection/session/active\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const propertyId = parseInt(req.query.propertyId as string);\n      if (isNaN(propertyId)) {\n        return res.status(400).json({ message: \"Invalid property ID\" });\n      }\n\n      let session = await storage.getActiveInspectionSession(propertyId, userId);\n      \n      if (!session) {\n        // Create new session\n        session = await storage.createInspectionSession({\n          propertyId,\n          inspectorId: userId,\n        });\n      }\n\n      // Get evidence for this session\n      const evidence = await storage.getEvidenceAssetsBySession(session.id);\n      \n      // Get property info\n      const property = await storage.getProperty(propertyId);\n\n      res.json({\n        session,\n        evidence,\n        property,\n        stepRequirements: STEP_REQUIREMENTS,\n      });\n    } catch (error) {\n      console.error('Error fetching active inspection session:', error);\n      res.status(500).json({ message: \"Failed to fetch inspection session\" });\n    }\n  });\n\n  // Get single inspection session by ID\n  app.get(\"/api/inspection/session/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid session ID\" });\n      }\n\n      const session = await storage.getInspectionSession(id);\n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      const evidence = await storage.getEvidenceAssetsBySession(id);\n      const property = await storage.getProperty(session.propertyId);\n\n      res.json({\n        session,\n        evidence,\n        property,\n        stepRequirements: STEP_REQUIREMENTS,\n      });\n    } catch (error) {\n      console.error('Error fetching inspection session:', error);\n      res.status(500).json({ message: \"Failed to fetch inspection session\" });\n    }\n  });\n\n  // Get all inspection sessions for current user\n  app.get(\"/api/inspection/sessions\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const sessions = await storage.getInspectionSessionsByInspector(userId);\n      res.json(sessions);\n    } catch (error) {\n      console.error('Error fetching inspection sessions:', error);\n      res.status(500).json({ message: \"Failed to fetch inspection sessions\" });\n    }\n  });\n\n  // Create new inspection session\n  app.post(\"/api/inspection/session\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const sessionData = insertInspectionSessionSchema.parse({\n        ...req.body,\n        inspectorId: userId,\n      });\n      \n      const session = await storage.createInspectionSession(sessionData);\n      res.status(201).json(session);\n    } catch (error) {\n      console.error('Error creating inspection session:', error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid session data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create inspection session\" });\n    }\n  });\n\n  // Update inspection session\n  app.patch(\"/api/inspection/session/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid session ID\" });\n      }\n\n      const updatedSession = await storage.updateInspectionSession(id, req.body);\n      if (!updatedSession) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      res.json(updatedSession);\n    } catch (error) {\n      console.error('Error updating inspection session:', error);\n      res.status(500).json({ message: \"Failed to update inspection session\" });\n    }\n  });\n\n  // Validate step completion and advance to next step\n  app.post(\"/api/inspection/session/:id/advance\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid session ID\" });\n      }\n\n      const session = await storage.getInspectionSession(id);\n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      const currentStep = session.currentStep as WinnMethodologyStep;\n      const currentStepIndex = WINN_METHODOLOGY_STEPS.indexOf(currentStep);\n      \n      if (currentStepIndex === -1) {\n        return res.status(400).json({ message: \"Invalid current step\" });\n      }\n\n      // Check step requirements\n      const requirements = STEP_REQUIREMENTS[currentStep];\n      const evidence = await storage.getEvidenceAssetsByStep(id, currentStep);\n      \n      // Validate minimum photos\n      if (evidence.length < requirements.minPhotos) {\n        return res.status(400).json({\n          message: `Step requires at least ${requirements.minPhotos} photos`,\n          current: evidence.length,\n          required: requirements.minPhotos,\n          canSkip: requirements.canSkip,\n          skipReasons: requirements.skipReasons,\n        });\n      }\n\n      // Check AI validation if required\n      if (requirements.aiValidationRequired) {\n        const hasValidation = evidence.some(e => e.aiAnalysis?.isValid);\n        if (!hasValidation) {\n          return res.status(400).json({\n            message: \"AI validation required before advancing\",\n            hint: \"Upload evidence and analyze with Stormy before proceeding\",\n            canSkip: requirements.canSkip,\n            skipReasons: requirements.skipReasons,\n          });\n        }\n      }\n\n      // Advance to next step\n      if (currentStepIndex === WINN_METHODOLOGY_STEPS.length - 1) {\n        // Last step - complete the session\n        const completedSession = await storage.completeInspectionSession(id);\n        return res.json({\n          session: completedSession,\n          message: \"Inspection completed!\",\n          nextStep: null,\n        });\n      }\n\n      const nextStep = WINN_METHODOLOGY_STEPS[currentStepIndex + 1];\n      const updatedSession = await storage.advanceInspectionStep(id, nextStep);\n\n      res.json({\n        session: updatedSession,\n        previousStep: currentStep,\n        nextStep,\n        message: `Advanced from ${currentStep} to ${nextStep}`,\n      });\n    } catch (error) {\n      console.error('Error advancing inspection step:', error);\n      res.status(500).json({ message: \"Failed to advance inspection step\" });\n    }\n  });\n\n  // Skip current step with reason (compliance tracking)\n  app.post(\"/api/inspection/session/:id/skip\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid session ID\" });\n      }\n\n      const { reason } = req.body;\n      if (!reason) {\n        return res.status(400).json({ message: \"Skip reason required\" });\n      }\n\n      const session = await storage.getInspectionSession(id);\n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      const currentStep = session.currentStep as WinnMethodologyStep;\n      const currentStepIndex = WINN_METHODOLOGY_STEPS.indexOf(currentStep);\n      const requirements = STEP_REQUIREMENTS[currentStep];\n\n      if (!requirements.canSkip) {\n        return res.status(400).json({\n          message: `Step '${currentStep}' cannot be skipped`,\n          hint: \"This step is required by the Winn Methodology\",\n        });\n      }\n\n      if (requirements.skipReasons && !requirements.skipReasons.includes(reason)) {\n        return res.status(400).json({\n          message: \"Invalid skip reason\",\n          validReasons: requirements.skipReasons,\n        });\n      }\n\n      // Record the override\n      const overrides = session.overrides || [];\n      overrides.push({\n        step: currentStep,\n        reason,\n        timestamp: new Date().toISOString(),\n      });\n\n      // Update step data to show skipped\n      const stepData = session.stepData || {} as any;\n      stepData[currentStep] = {\n        completed: false,\n        skipped: true,\n        skipReason: reason,\n        evidenceCount: 0,\n        notes: `Skipped: ${reason}`,\n        findings: [],\n      };\n\n      // Advance to next step\n      const nextStepIndex = currentStepIndex + 1;\n      if (nextStepIndex >= WINN_METHODOLOGY_STEPS.length) {\n        // Can't skip the final step\n        return res.status(400).json({ message: \"Cannot skip the final step\" });\n      }\n\n      const nextStep = WINN_METHODOLOGY_STEPS[nextStepIndex];\n      \n      // Calculate compliance score penalty\n      const currentScore = session.complianceScore || 100;\n      const penalty = requirements.canSkip ? 5 : 20; // Higher penalty for required steps\n\n      const updatedSession = await storage.updateInspectionSession(id, {\n        currentStep: nextStep,\n        stepsCompleted: [...(session.stepsCompleted || []), currentStep],\n        stepData,\n        overrides,\n        complianceScore: Math.max(0, currentScore - penalty),\n      });\n\n      res.json({\n        session: updatedSession,\n        previousStep: currentStep,\n        nextStep,\n        message: `Skipped ${currentStep} (reason: ${reason})`,\n        complianceImpact: `-${penalty} points`,\n      });\n    } catch (error) {\n      console.error('Error skipping inspection step:', error);\n      res.status(500).json({ message: \"Failed to skip inspection step\" });\n    }\n  });\n\n  // Complete inspection session\n  app.post(\"/api/inspection/session/:id/complete\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid session ID\" });\n      }\n\n      const session = await storage.getInspectionSession(id);\n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      // Verify we're on the last step\n      if (session.currentStep !== 'report_assembly') {\n        return res.status(400).json({\n          message: \"Cannot complete inspection before Report Assembly step\",\n          currentStep: session.currentStep,\n        });\n      }\n\n      const completedSession = await storage.completeInspectionSession(id);\n      res.json({\n        session: completedSession,\n        message: \"Inspection completed successfully!\",\n      });\n    } catch (error) {\n      console.error('Error completing inspection session:', error);\n      res.status(500).json({ message: \"Failed to complete inspection session\" });\n    }\n  });\n\n  // ============================================================================\n  // EVIDENCE ASSET ROUTES - Photo/Thermal/Document Upload\n  // ============================================================================\n\n  // Get evidence for a session\n  app.get(\"/api/inspection/session/:sessionId/evidence\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const sessionId = parseInt(req.params.sessionId);\n      if (isNaN(sessionId)) {\n        return res.status(400).json({ message: \"Invalid session ID\" });\n      }\n\n      const step = req.query.step as WinnMethodologyStep | undefined;\n      \n      let evidence;\n      if (step && WINN_METHODOLOGY_STEPS.includes(step)) {\n        evidence = await storage.getEvidenceAssetsByStep(sessionId, step);\n      } else {\n        evidence = await storage.getEvidenceAssetsBySession(sessionId);\n      }\n\n      res.json(evidence);\n    } catch (error) {\n      console.error('Error fetching evidence:', error);\n      res.status(500).json({ message: \"Failed to fetch evidence\" });\n    }\n  });\n\n  // Upload new evidence asset\n  app.post(\"/api/inspection/evidence\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const assetData = insertEvidenceAssetSchema.parse({\n        ...req.body,\n        uploadedBy: userId,\n      });\n      \n      const asset = await storage.createEvidenceAsset(assetData);\n      res.status(201).json(asset);\n    } catch (error) {\n      console.error('Error creating evidence asset:', error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid evidence data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create evidence asset\" });\n    }\n  });\n\n  // Update evidence asset (e.g., add AI analysis)\n  app.patch(\"/api/inspection/evidence/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid evidence ID\" });\n      }\n\n      const updatedAsset = await storage.updateEvidenceAsset(id, req.body);\n      if (!updatedAsset) {\n        return res.status(404).json({ message: \"Evidence asset not found\" });\n      }\n\n      res.json(updatedAsset);\n    } catch (error) {\n      console.error('Error updating evidence asset:', error);\n      res.status(500).json({ message: \"Failed to update evidence asset\" });\n    }\n  });\n\n  // Delete evidence asset\n  app.delete(\"/api/inspection/evidence/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid evidence ID\" });\n      }\n\n      const deleted = await storage.deleteEvidenceAsset(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Evidence asset not found\" });\n      }\n\n      res.json({ message: \"Evidence asset deleted successfully\" });\n    } catch (error) {\n      console.error('Error deleting evidence asset:', error);\n      res.status(500).json({ message: \"Failed to delete evidence asset\" });\n    }\n  });\n\n  // ============================================================================\n  // SCHEDULING ROUTES - Multi-property scheduling and route optimization\n  // ============================================================================\n\n  // Get scheduled inspections for a date range\n  app.get(\"/api/schedule\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { startDate, endDate, inspectorId } = req.query;\n      const targetInspectorId = inspectorId ? parseInt(inspectorId as string) : userId;\n      \n      const start = startDate ? new Date(startDate as string) : undefined;\n      const end = endDate ? new Date(endDate as string) : undefined;\n      \n      const inspections = await storage.getScheduledInspectionsByInspector(\n        targetInspectorId,\n        start,\n        end\n      );\n      \n      res.json(inspections);\n    } catch (error) {\n      console.error('Error fetching scheduled inspections:', error);\n      res.status(500).json({ message: \"Failed to fetch scheduled inspections\" });\n    }\n  });\n\n  // Get single scheduled inspection\n  app.get(\"/api/schedule/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid inspection ID\" });\n      }\n      \n      const inspection = await storage.getScheduledInspection(id);\n      if (!inspection) {\n        return res.status(404).json({ message: \"Scheduled inspection not found\" });\n      }\n      \n      // Verify ownership\n      if (inspection.inspectorId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      res.json(inspection);\n    } catch (error) {\n      console.error('Error fetching scheduled inspection:', error);\n      res.status(500).json({ message: \"Failed to fetch scheduled inspection\" });\n    }\n  });\n\n  // Create scheduled inspection\n  app.post(\"/api/schedule\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { propertyId, scheduledDate, scheduledTime, estimatedDuration, priority, notes, accessInstructions, contactName, contactPhone, latitude, longitude } = req.body;\n      \n      if (!propertyId || !scheduledDate) {\n        return res.status(400).json({ message: \"propertyId and scheduledDate are required\" });\n      }\n      \n      const inspection = await storage.createScheduledInspection({\n        propertyId,\n        inspectorId: userId,\n        scheduledDate: new Date(scheduledDate),\n        scheduledTime,\n        estimatedDuration: estimatedDuration || 60,\n        status: 'scheduled',\n        priority: priority || 'normal',\n        notes,\n        accessInstructions,\n        contactName,\n        contactPhone,\n        latitude,\n        longitude,\n      });\n      \n      res.status(201).json(inspection);\n    } catch (error) {\n      console.error('Error creating scheduled inspection:', error);\n      res.status(500).json({ message: \"Failed to create scheduled inspection\" });\n    }\n  });\n\n  // Update scheduled inspection\n  app.patch(\"/api/schedule/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid inspection ID\" });\n      }\n      \n      // Verify ownership before updating\n      const existing = await storage.getScheduledInspection(id);\n      if (!existing) {\n        return res.status(404).json({ message: \"Scheduled inspection not found\" });\n      }\n      if (existing.inspectorId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      // Only allow safe fields to be updated\n      const { scheduledDate, scheduledTime, estimatedDuration, priority, notes, accessInstructions, contactName, contactPhone, status } = req.body;\n      const safeUpdates: Record<string, any> = {};\n      \n      if (scheduledDate !== undefined) {\n        const parsedDate = new Date(scheduledDate);\n        if (isNaN(parsedDate.getTime())) {\n          return res.status(400).json({ message: \"Invalid scheduledDate format\" });\n        }\n        safeUpdates.scheduledDate = parsedDate;\n      }\n      if (scheduledTime !== undefined) safeUpdates.scheduledTime = scheduledTime;\n      if (estimatedDuration !== undefined) safeUpdates.estimatedDuration = parseInt(estimatedDuration) || 60;\n      if (priority !== undefined && ['low', 'normal', 'high', 'urgent'].includes(priority)) safeUpdates.priority = priority;\n      if (notes !== undefined) safeUpdates.notes = notes;\n      if (accessInstructions !== undefined) safeUpdates.accessInstructions = accessInstructions;\n      if (contactName !== undefined) safeUpdates.contactName = contactName;\n      if (contactPhone !== undefined) safeUpdates.contactPhone = contactPhone;\n      if (status !== undefined && ['scheduled', 'in_progress', 'completed'].includes(status)) safeUpdates.status = status;\n      \n      const updated = await storage.updateScheduledInspection(id, safeUpdates);\n      res.json(updated);\n    } catch (error) {\n      console.error('Error updating scheduled inspection:', error);\n      res.status(500).json({ message: \"Failed to update scheduled inspection\" });\n    }\n  });\n\n  // Cancel scheduled inspection\n  app.post(\"/api/schedule/:id/cancel\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid inspection ID\" });\n      }\n      \n      // Verify ownership before cancelling\n      const existing = await storage.getScheduledInspection(id);\n      if (!existing) {\n        return res.status(404).json({ message: \"Scheduled inspection not found\" });\n      }\n      if (existing.inspectorId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      const { reason } = req.body;\n      if (!reason || typeof reason !== 'string' || reason.length < 3) {\n        return res.status(400).json({ message: \"Cancellation reason is required (min 3 characters)\" });\n      }\n      \n      const cancelled = await storage.cancelScheduledInspection(id, reason);\n      res.json(cancelled);\n    } catch (error) {\n      console.error('Error cancelling scheduled inspection:', error);\n      res.status(500).json({ message: \"Failed to cancel scheduled inspection\" });\n    }\n  });\n\n  // Get inspections for a specific date (for calendar views)\n  app.get(\"/api/schedule/date/:date\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const date = new Date(req.params.date);\n      if (isNaN(date.getTime())) {\n        return res.status(400).json({ message: \"Invalid date format\" });\n      }\n      \n      const inspectorId = req.query.inspectorId ? parseInt(req.query.inspectorId as string) : userId;\n      const inspections = await storage.getScheduledInspectionsByDate(date, inspectorId);\n      \n      res.json(inspections);\n    } catch (error) {\n      console.error('Error fetching inspections by date:', error);\n      res.status(500).json({ message: \"Failed to fetch inspections by date\" });\n    }\n  });\n\n  // ============================================================================\n  // MULTIMODAL AI ANALYSIS ROUTES - GPT-5.1 Vision & Coaching\n  // ============================================================================\n\n  // Analyze an image using GPT-5.1 vision\n  app.post(\"/api/ai/analyze-image\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { imageUrl, imageType, step, propertyContext, previousFindings } = req.body;\n      \n      if (!imageUrl || !step) {\n        return res.status(400).json({ message: \"imageUrl and step are required\" });\n      }\n\n      if (!WINN_METHODOLOGY_STEPS.includes(step)) {\n        return res.status(400).json({ \n          message: \"Invalid methodology step\",\n          validSteps: WINN_METHODOLOGY_STEPS \n        });\n      }\n\n      const analysisRequest: ImageAnalysisRequest = {\n        imageUrl,\n        imageType: imageType || 'photo',\n        step,\n        propertyContext,\n        previousFindings\n      };\n\n      const result = await analyzeInspectionImage(analysisRequest);\n      res.json(result);\n\n    } catch (error) {\n      console.error('Error analyzing image:', error);\n      res.status(500).json({ message: \"Failed to analyze image\" });\n    }\n  });\n\n  // Analyze image and update evidence asset with results\n  app.post(\"/api/inspection/evidence/:id/analyze\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid evidence ID\" });\n      }\n\n      const evidence = await storage.getEvidenceAsset(id);\n      if (!evidence) {\n        return res.status(404).json({ message: \"Evidence asset not found\" });\n      }\n\n      // Get session for property context\n      const session = await storage.getInspectionSession(evidence.inspectionSessionId);\n      let propertyContext = '';\n      if (session) {\n        const property = await storage.getProperty(session.propertyId);\n        if (property) {\n          propertyContext = `Property: ${property.name} at ${property.address}`;\n        }\n      }\n\n      // Analyze the image\n      const analysisRequest: ImageAnalysisRequest = {\n        imageUrl: evidence.fileUrl,\n        imageType: evidence.assetType as 'photo' | 'thermal' | 'drone' | 'document',\n        step: evidence.step as WinnMethodologyStep,\n        propertyContext\n      };\n\n      const result = await analyzeInspectionImage(analysisRequest);\n\n      // Update evidence with analysis results\n      const updatedEvidence = await storage.updateEvidenceAsset(id, {\n        aiAnalysis: result.validation,\n        rawAiResponse: JSON.stringify(result)\n      });\n\n      res.json({\n        evidence: updatedEvidence,\n        analysis: result\n      });\n\n    } catch (error) {\n      console.error('Error analyzing evidence:', error);\n      res.status(500).json({ message: \"Failed to analyze evidence\" });\n    }\n  });\n\n  // Get step-specific coaching content\n  app.get(\"/api/ai/coaching/:step\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const step = req.params.step as WinnMethodologyStep;\n      \n      if (!WINN_METHODOLOGY_STEPS.includes(step)) {\n        return res.status(400).json({ \n          message: \"Invalid methodology step\",\n          validSteps: WINN_METHODOLOGY_STEPS \n        });\n      }\n\n      const experienceLevel = (req.query.level as 'beginner' | 'intermediate' | 'expert') || 'beginner';\n      const findingsParam = req.query.findings as string;\n      const currentFindings = findingsParam ? findingsParam.split(',') : undefined;\n\n      const coaching = await getStepCoaching(step, experienceLevel, currentFindings);\n      res.json(coaching);\n\n    } catch (error) {\n      console.error('Error getting coaching content:', error);\n      res.status(500).json({ message: \"Failed to get coaching content\" });\n    }\n  });\n\n  // Chat with Stormy - conversational AI endpoint\n  app.post(\"/api/ai/chat\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { message, context } = req.body;\n      \n      if (!message) {\n        return res.status(400).json({ message: \"Message is required\" });\n      }\n\n      const { currentStep, experienceLevel, propertyId, sessionId, evidenceCount, recentMessages } = context || {};\n\n      // Build contextual system prompt\n      let systemContext = `You are Stormy, an AI assistant for WinnStorm damage assessment consultants. You are friendly, helpful, and knowledgeable about the Winn Methodology for roof and property damage assessment.`;\n      \n      if (currentStep) {\n        systemContext += `\\n\\nThe consultant is currently working on the \"${currentStep.replace(/_/g, ' ')}\" step of the Winn Methodology.`;\n      }\n      \n      if (experienceLevel) {\n        systemContext += ` They are at the ${experienceLevel} level.`;\n        if (experienceLevel === 'beginner') {\n          systemContext += ` Provide detailed explanations and encourage questions.`;\n        } else if (experienceLevel === 'expert') {\n          systemContext += ` Be concise and technical.`;\n        }\n      }\n\n      if (evidenceCount !== undefined) {\n        systemContext += `\\n\\nThey have captured ${evidenceCount} pieces of evidence so far for this step.`;\n      }\n\n      // Use the AI assistant to generate response\n      const aiResponse = await getAIAssistance({\n        context: systemContext,\n        message: message,\n      });\n\n      res.json({ \n        response: aiResponse.response,\n        suggestedActions: aiResponse.suggestions || []\n      });\n\n    } catch (error) {\n      console.error('Error in AI chat:', error);\n      res.status(500).json({ message: \"Failed to get AI response\" });\n    }\n  });\n\n  // Transcribe audio (voice memos) using Whisper API\n  app.post(\"/api/ai/transcribe\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { audioDataUrl, duration, step } = req.body;\n      \n      if (!audioDataUrl) {\n        return res.status(400).json({ message: \"audioDataUrl is required\" });\n      }\n\n      const { transcribeAudio, summarizeVoiceMemo } = await import('./audio-transcription');\n      \n      const result = await transcribeAudio(audioDataUrl, duration || 0);\n      \n      let finalTranscription = result.transcription;\n      if (result.status === 'success' && result.transcription) {\n        finalTranscription = await summarizeVoiceMemo(result.transcription, step);\n      }\n\n      res.json({ \n        transcription: finalTranscription,\n        rawTranscription: result.transcription,\n        duration: result.duration,\n        status: result.status,\n        language: result.language,\n        segments: result.segments,\n      });\n\n    } catch (error) {\n      console.error('Error transcribing audio:', error);\n      res.status(500).json({ message: \"Failed to transcribe audio\" });\n    }\n  });\n\n  // Parse Limitless transcript and extract knowledge\n  app.post(\"/api/ai/parse-transcript\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const { rawTranscript, title } = req.body;\n      \n      if (!rawTranscript || !title) {\n        return res.status(400).json({ message: \"rawTranscript and title are required\" });\n      }\n\n      const result = await parseTranscript(rawTranscript, title);\n      res.json(result);\n\n    } catch (error) {\n      console.error('Error parsing transcript:', error);\n      res.status(500).json({ message: \"Failed to parse transcript\" });\n    }\n  });\n\n  // ============================================================================\n  // LIMITLESS TRANSCRIPT ROUTES - Eric Winn Recording Ingestion\n  // ============================================================================\n\n  // Get all transcripts\n  app.get(\"/api/transcripts\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const transcripts = await storage.getAllLimitlessTranscripts();\n      res.json(transcripts);\n    } catch (error) {\n      console.error('Error fetching transcripts:', error);\n      res.status(500).json({ message: \"Failed to fetch transcripts\" });\n    }\n  });\n\n  // Get single transcript\n  app.get(\"/api/transcripts/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid transcript ID\" });\n      }\n\n      const transcript = await storage.getLimitlessTranscript(id);\n      if (!transcript) {\n        return res.status(404).json({ message: \"Transcript not found\" });\n      }\n\n      res.json(transcript);\n    } catch (error) {\n      console.error('Error fetching transcript:', error);\n      res.status(500).json({ message: \"Failed to fetch transcript\" });\n    }\n  });\n\n  // Upload new transcript\n  app.post(\"/api/transcripts\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const transcriptData = insertLimitlessTranscriptSchema.parse({\n        ...req.body,\n        uploadedBy: userId,\n      });\n      \n      const transcript = await storage.createLimitlessTranscript(transcriptData);\n      res.status(201).json(transcript);\n    } catch (error) {\n      console.error('Error creating transcript:', error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid transcript data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create transcript\" });\n    }\n  });\n\n  // Update transcript (e.g., after AI processing or review)\n  app.patch(\"/api/transcripts/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n      \n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid transcript ID\" });\n      }\n\n      const updatedTranscript = await storage.updateLimitlessTranscript(id, req.body);\n      if (!updatedTranscript) {\n        return res.status(404).json({ message: \"Transcript not found\" });\n      }\n\n      res.json(updatedTranscript);\n    } catch (error) {\n      console.error('Error updating transcript:', error);\n      res.status(500).json({ message: \"Failed to update transcript\" });\n    }\n  });\n\n  // ============================================================================\n  // LIMITLESS PENDANT SYNC ROUTES\n  // ============================================================================\n\n  // Check Limitless connection status\n  app.get(\"/api/limitless/status\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const { getLimitlessClient } = await import('./limitless-client');\n      const client = getLimitlessClient();\n      \n      if (!client) {\n        return res.json({ \n          connected: false, \n          message: 'Limitless API key not configured. Add LIMITLESS_API_KEY to secrets.'\n        });\n      }\n\n      const isConnected = await client.testConnection();\n      res.json({ \n        connected: isConnected,\n        message: isConnected ? 'Connected to Limitless Pendant' : 'Connection test failed'\n      });\n    } catch (error) {\n      console.error('Error checking Limitless status:', error);\n      res.status(500).json({ message: \"Failed to check Limitless status\" });\n    }\n  });\n\n  // Fetch recent recordings from Limitless Pendant\n  app.get(\"/api/limitless/recordings\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const { getLimitlessClient, formatLifelogAsTranscript, extractDuration } = await import('./limitless-client');\n      const client = getLimitlessClient();\n      \n      if (!client) {\n        return res.status(400).json({ message: 'Limitless API key not configured' });\n      }\n\n      const limit = parseInt(req.query.limit as string) || 10;\n      const dateFrom = req.query.dateFrom as string;\n      const dateTo = req.query.dateTo as string;\n\n      const response = await client.getLifelogs({ \n        limit, \n        dateFrom, \n        dateTo,\n        timezone: 'America/Chicago' \n      });\n\n      const recordings = response.lifelogs.map(lifelog => ({\n        id: lifelog.id,\n        title: lifelog.title || `Recording ${lifelog.startTime}`,\n        startTime: lifelog.startTime,\n        endTime: lifelog.endTime,\n        duration: extractDuration(lifelog),\n        transcript: formatLifelogAsTranscript(lifelog),\n        summary: lifelog.summary,\n        actionItems: lifelog.actionItems || [],\n      }));\n\n      res.json({ recordings, total: response.total });\n    } catch (error) {\n      console.error('Error fetching Limitless recordings:', error);\n      res.status(500).json({ message: \"Failed to fetch recordings from Limitless\" });\n    }\n  });\n\n  // Import a Limitless recording as a transcript\n  app.post(\"/api/limitless/import/:recordingId\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const { getLimitlessClient, formatLifelogAsTranscript, extractDuration } = await import('./limitless-client');\n      const client = getLimitlessClient();\n      \n      if (!client) {\n        return res.status(400).json({ message: 'Limitless API key not configured' });\n      }\n\n      const recordingId = req.params.recordingId;\n      \n      const existingTranscripts = await storage.getAllLimitlessTranscripts();\n      const alreadyImported = existingTranscripts.find(t => \n        t.uploadedBy === userId && \n        (t as any).externalId === recordingId\n      );\n      \n      if (alreadyImported) {\n        return res.status(409).json({ \n          message: 'Recording already imported',\n          transcriptId: alreadyImported.id \n        });\n      }\n\n      const lifelog = await client.getLifelogById(recordingId);\n\n      const transcript = await storage.createLimitlessTranscript({\n        title: lifelog.title || `Recording ${lifelog.startTime}`,\n        rawTranscript: formatLifelogAsTranscript(lifelog),\n        duration: extractDuration(lifelog),\n        recordingDate: new Date(lifelog.startTime),\n        uploadedBy: userId,\n      });\n\n      res.status(201).json(transcript);\n    } catch (error) {\n      console.error('Error importing Limitless recording:', error);\n      res.status(500).json({ message: \"Failed to import recording\" });\n    }\n  });\n\n  // ============================================================================\n  // COMPLIANCE & PROFICIENCY TRACKING ROUTES\n  // ============================================================================\n\n  // Get inspector progress and compliance data\n  app.get(\"/api/compliance/progress\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      let progress = await storage.getInspectorProgress(userId);\n      \n      if (!progress) {\n        progress = await storage.createInspectorProgress({ userId: userId });\n      }\n\n      res.json(progress);\n    } catch (error) {\n      console.error('Error fetching inspector progress:', error);\n      res.status(500).json({ message: \"Failed to fetch progress\" });\n    }\n  });\n\n  // Update proficiency after completing an inspection step\n  app.post(\"/api/compliance/record-step\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const parseResult = recordStepPayloadSchema.safeParse(req.body);\n      if (!parseResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid request data\", \n          errors: parseResult.error.errors \n        });\n      }\n      \n      const { step, timeSpentMinutes, aiInterventions, wasOverridden } = parseResult.data;\n\n      let progress = await storage.getInspectorProgress(userId);\n      if (!progress) {\n        progress = await storage.createInspectorProgress({ userId: userId });\n      }\n\n      const currentProficiency = (progress.stepProficiency || {}) as Partial<Record<WinnMethodologyStep, StepProficiency>>;\n      const stepData = currentProficiency[step] || {\n        attemptCount: 0,\n        averageTimeMinutes: 0,\n        aiInterventionCount: 0,\n        overrideCount: 0,\n        lastAttempt: new Date().toISOString(),\n        proficiencyLevel: 'novice' as const\n      };\n\n      const newAttemptCount = stepData.attemptCount + 1;\n      const newAverageTime = ((stepData.averageTimeMinutes * stepData.attemptCount) + (timeSpentMinutes || 0)) / newAttemptCount;\n      const newAiInterventions = stepData.aiInterventionCount + (aiInterventions || 0);\n      const newOverrides = stepData.overrideCount + (wasOverridden ? 1 : 0);\n\n      let proficiencyLevel: 'novice' | 'learning' | 'competent' | 'proficient' | 'expert' = 'novice';\n      if (newAttemptCount >= 50 && newAiInterventions / newAttemptCount < 0.1) {\n        proficiencyLevel = 'expert';\n      } else if (newAttemptCount >= 25 && newAiInterventions / newAttemptCount < 0.2) {\n        proficiencyLevel = 'proficient';\n      } else if (newAttemptCount >= 10 && newAiInterventions / newAttemptCount < 0.3) {\n        proficiencyLevel = 'competent';\n      } else if (newAttemptCount >= 5) {\n        proficiencyLevel = 'learning';\n      }\n\n      const updatedStepProficiency: Partial<Record<WinnMethodologyStep, StepProficiency>> = {\n        ...currentProficiency,\n        [step]: {\n          attemptCount: newAttemptCount,\n          averageTimeMinutes: Math.round(newAverageTime * 10) / 10,\n          aiInterventionCount: newAiInterventions,\n          overrideCount: newOverrides,\n          lastAttempt: new Date().toISOString(),\n          proficiencyLevel\n        }\n      };\n\n      const updatedProgress = await storage.updateInspectorProgress(userId, {\n        stepProficiency: updatedStepProficiency as Record<WinnMethodologyStep, StepProficiency>\n      });\n\n      res.json({\n        step,\n        proficiency: updatedStepProficiency[step],\n        overallProgress: updatedProgress\n      });\n    } catch (error) {\n      console.error('Error recording step proficiency:', error);\n      res.status(500).json({ message: \"Failed to record step\" });\n    }\n  });\n\n  // Record an override (when step is skipped)\n  app.post(\"/api/compliance/record-override\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const parseResult = recordOverridePayloadSchema.safeParse(req.body);\n      if (!parseResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid request data\", \n          errors: parseResult.error.errors \n        });\n      }\n      \n      const { sessionId, step, reason } = parseResult.data;\n      const sessionIdNum = parseInt(sessionId, 10);\n      \n      if (isNaN(sessionIdNum) || sessionIdNum <= 0) {\n        return res.status(400).json({ message: \"Invalid session ID format\" });\n      }\n\n      const session = await storage.getInspectionSession(sessionIdNum);\n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      const currentOverrides = session.overrides || [];\n      const newOverride: StepOverride = {\n        step,\n        reason,\n        timestamp: new Date().toISOString()\n      };\n\n      const updatedSession = await storage.updateInspectionSession(sessionIdNum, {\n        overrides: [...currentOverrides, newOverride]\n      });\n\n      let progress = await storage.getInspectorProgress(userId);\n      if (progress) {\n        const currentProficiency = (progress.stepProficiency || {}) as Partial<Record<WinnMethodologyStep, StepProficiency>>;\n        const stepData = currentProficiency[step] || {\n          attemptCount: 0,\n          averageTimeMinutes: 0,\n          aiInterventionCount: 0,\n          overrideCount: 0,\n          lastAttempt: new Date().toISOString(),\n          proficiencyLevel: 'novice' as const\n        };\n\n        const updatedStepProficiency: Partial<Record<WinnMethodologyStep, StepProficiency>> = {\n          ...currentProficiency,\n          [step]: {\n            ...stepData,\n            overrideCount: stepData.overrideCount + 1,\n            lastAttempt: new Date().toISOString()\n          }\n        };\n\n        await storage.updateInspectorProgress(userId, {\n          stepProficiency: updatedStepProficiency as Record<WinnMethodologyStep, StepProficiency>\n        });\n      }\n\n      res.json({\n        override: newOverride,\n        session: updatedSession\n      });\n    } catch (error) {\n      console.error('Error recording override:', error);\n      res.status(500).json({ message: \"Failed to record override\" });\n    }\n  });\n\n  // Get training recommendations based on performance gaps\n  app.get(\"/api/compliance/recommendations\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = getAuthenticatedUserId(req, res);\n      if (!userId) return;\n\n      const progress = await storage.getInspectorProgress(userId);\n      \n      const recommendations: {\n        step: WinnMethodologyStep;\n        issue: string;\n        recommendation: string;\n        priority: 'high' | 'medium' | 'low';\n      }[] = [];\n\n      if (progress?.stepProficiency) {\n        for (const step of WINN_METHODOLOGY_STEPS) {\n          const proficiency = progress.stepProficiency[step];\n          if (!proficiency) continue;\n\n          if (proficiency.overrideCount > 2 && proficiency.attemptCount > 0) {\n            const overrideRate = proficiency.overrideCount / proficiency.attemptCount;\n            if (overrideRate > 0.3) {\n              recommendations.push({\n                step,\n                issue: `High skip rate (${Math.round(overrideRate * 100)}%)`,\n                recommendation: `Review training materials for ${step.replace(/_/g, ' ')} step`,\n                priority: 'high'\n              });\n            }\n          }\n\n          if (proficiency.aiInterventionCount > 5 && proficiency.attemptCount > 0) {\n            const interventionRate = proficiency.aiInterventionCount / proficiency.attemptCount;\n            if (interventionRate > 0.5) {\n              recommendations.push({\n                step,\n                issue: `Frequent AI assistance needed (${Math.round(interventionRate * 100)}%)`,\n                recommendation: `Complete additional practice sessions for ${step.replace(/_/g, ' ')}`,\n                priority: 'medium'\n              });\n            }\n          }\n\n          if (proficiency.proficiencyLevel === 'novice' && proficiency.attemptCount > 3) {\n            recommendations.push({\n              step,\n              issue: 'Still at novice level after multiple attempts',\n              recommendation: `Schedule a mentoring session for ${step.replace(/_/g, ' ')}`,\n              priority: 'high'\n            });\n          }\n        }\n      }\n\n      for (const step of WINN_METHODOLOGY_STEPS) {\n        const proficiency = progress?.stepProficiency?.[step];\n        if (!proficiency || proficiency.attemptCount === 0) {\n          recommendations.push({\n            step,\n            issue: 'No experience with this step',\n            recommendation: `Start training for ${step.replace(/_/g, ' ')} step`,\n            priority: 'low'\n          });\n        }\n      }\n\n      res.json({\n        recommendations: recommendations.sort((a, b) => {\n          const priorityOrder = { high: 0, medium: 1, low: 2 };\n          return priorityOrder[a.priority] - priorityOrder[b.priority];\n        }),\n        overallComplianceScore: progress?.averageComplianceScore || 0,\n        totalInspections: progress?.totalInspections || 0\n      });\n    } catch (error) {\n      console.error('Error getting recommendations:', error);\n      res.status(500).json({ message: \"Failed to get recommendations\" });\n    }\n  });\n\n  // ==========================================\n  // STORMY AI ROUTES - Multi-modal AI Assistant\n  // ==========================================\n  \n  const stormyService = await import('./stormy-ai-service');\n\n  // Get user's conversations\n  app.get(\"/api/stormy/conversations\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = req.user?.uid;\n      if (!userId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const conversations = await stormyService.getUserConversations(userId);\n      res.json(conversations);\n    } catch (error) {\n      console.error('Error fetching conversations:', error);\n      res.status(500).json({ message: \"Failed to fetch conversations\" });\n    }\n  });\n\n  // Get specific conversation with messages\n  app.get(\"/api/stormy/conversations/:id\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const conversationId = parseInt(req.params.id);\n      const messages = await stormyService.getConversationHistory(conversationId);\n      const conversation = await storage.getAIConversation(conversationId);\n      \n      res.json({\n        conversation,\n        messages\n      });\n    } catch (error) {\n      console.error('Error fetching conversation:', error);\n      res.status(500).json({ message: \"Failed to fetch conversation\" });\n    }\n  });\n\n  // Send message to Stormy\n  app.post(\"/api/stormy/message\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = req.user?.uid;\n      if (!userId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const { message, conversationId, attachments, propertyId, inspectionId, contextType } = req.body;\n\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ message: \"Message is required\" });\n      }\n\n      const result = await stormyService.sendMessage({\n        userId,\n        message,\n        conversationId,\n        attachments,\n        propertyId,\n        inspectionId,\n        contextType\n      });\n\n      res.json(result);\n    } catch (error: any) {\n      console.error('Error sending message to Stormy:', error);\n      res.status(500).json({ message: error.message || \"Failed to get response from Stormy\" });\n    }\n  });\n\n  // Analyze image directly\n  app.post(\"/api/stormy/analyze-image\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = req.user?.uid;\n      if (!userId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const { imageUrl, imageType, additionalContext } = req.body;\n\n      if (!imageUrl) {\n        return res.status(400).json({ message: \"Image URL is required\" });\n      }\n\n      const result = await stormyService.analyzeImage(\n        userId,\n        imageUrl,\n        imageType || 'general',\n        additionalContext\n      );\n\n      res.json(result);\n    } catch (error: any) {\n      console.error('Error analyzing image:', error);\n      res.status(500).json({ message: error.message || \"Failed to analyze image\" });\n    }\n  });\n\n  // Get or create conversation for context\n  app.post(\"/api/stormy/conversations\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = req.user?.uid;\n      if (!userId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const { propertyId, inspectionId, contextType } = req.body;\n      \n      const conversation = await stormyService.getOrCreateConversation(\n        userId,\n        propertyId,\n        inspectionId,\n        contextType || 'general'\n      );\n\n      res.json(conversation);\n    } catch (error) {\n      console.error('Error creating conversation:', error);\n      res.status(500).json({ message: \"Failed to create conversation\" });\n    }\n  });\n\n  // Get user's AI memory/preferences\n  app.get(\"/api/stormy/memory\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = req.user?.uid;\n      if (!userId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const memory = await stormyService.getUserMemory(userId);\n      res.json(memory || { preferences: {} });\n    } catch (error) {\n      console.error('Error fetching memory:', error);\n      res.status(500).json({ message: \"Failed to fetch memory\" });\n    }\n  });\n\n  // Update user's AI preferences\n  app.patch(\"/api/stormy/memory\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = req.user?.uid;\n      if (!userId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const { preferences, summary } = req.body;\n      const memory = await stormyService.updateUserMemory(userId, preferences || {}, summary);\n      res.json(memory);\n    } catch (error) {\n      console.error('Error updating memory:', error);\n      res.status(500).json({ message: \"Failed to update memory\" });\n    }\n  });\n\n  // ==========================================\n  // STORMY VOICE ROUTES - Hands-free Voice Chat\n  // ==========================================\n\n  const voiceService = await import('./voice-service');\n\n  // Text-to-speech for Stormy responses\n  app.post(\"/api/stormy/voice/speak\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { text } = req.body;\n\n      if (!text || typeof text !== 'string') {\n        return res.status(400).json({ message: \"Text is required\" });\n      }\n\n      const audioBuffer = await voiceService.speakStormyResponse(text);\n\n      res.set({\n        'Content-Type': 'audio/mpeg',\n        'Content-Length': audioBuffer.length.toString(),\n      });\n      res.send(audioBuffer);\n    } catch (error: any) {\n      console.error('Error generating speech:', error);\n      res.status(500).json({ message: error.message || \"Failed to generate speech\" });\n    }\n  });\n\n  // Speech-to-text for voice input\n  app.post(\"/api/stormy/voice/transcribe\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      if (!req.body || !Buffer.isBuffer(req.body)) {\n        return res.status(400).json({ message: \"Audio data is required\" });\n      }\n\n      const result = await voiceService.speechToText(req.body);\n      res.json(result);\n    } catch (error: any) {\n      console.error('Error transcribing audio:', error);\n      res.status(500).json({ message: error.message || \"Failed to transcribe audio\" });\n    }\n  });\n\n  // Full voice conversation - transcribe, process with Stormy, and return audio response\n  const voiceUpload = multer({ storage: multer.memoryStorage(), limits: { fileSize: 25 * 1024 * 1024 } });\n  \n  app.post(\"/api/stormy/voice/chat\", requireAuth, voiceUpload.single('audio'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const userId = req.user?.uid;\n      if (!userId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const contentType = req.headers['content-type'] || '';\n      let audioBuffer: Buffer;\n      let conversationId: number | undefined;\n      let imageUrl: string | undefined;\n      \n      if (contentType.includes('multipart/form-data')) {\n        if (!req.file) {\n          return res.status(400).json({ message: \"Audio file is required\" });\n        }\n        audioBuffer = req.file.buffer;\n        conversationId = req.body.conversationId ? parseInt(req.body.conversationId) : undefined;\n        imageUrl = req.body.imageUrl;\n      } else {\n        conversationId = req.query.conversationId ? parseInt(req.query.conversationId as string) : undefined;\n        imageUrl = req.query.imageUrl as string | undefined;\n\n        if (!req.body || req.body.length === 0) {\n          return res.status(400).json({ message: \"Audio data is required\" });\n        }\n        audioBuffer = Buffer.isBuffer(req.body) ? req.body : Buffer.from(req.body);\n      }\n\n      const result = await voiceService.processVoiceMessage(\n        audioBuffer,\n        userId,\n        conversationId,\n        imageUrl\n      );\n\n      res.json({\n        transcription: result.transcription,\n        response: result.response,\n        audio: result.audioBuffer ? result.audioBuffer.toString('base64') : null,\n      });\n    } catch (error: any) {\n      console.error('Error processing voice chat:', error);\n      res.status(500).json({ message: error.message || \"Failed to process voice chat\" });\n    }\n  });\n\n  // Get Stormy's greeting audio\n  app.get(\"/api/stormy/voice/greeting\", requireAuth, async (req: AuthenticatedRequest, res) => {\n    try {\n      const audioBuffer = await voiceService.generateStormyGreeting();\n\n      res.set({\n        'Content-Type': 'audio/mpeg',\n        'Content-Length': audioBuffer.length.toString(),\n      });\n      res.send(audioBuffer);\n    } catch (error: any) {\n      console.error('Error generating greeting:', error);\n      res.status(500).json({ message: error.message || \"Failed to generate greeting\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":114572,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/pages/reports.tsx":{"content":"import { useState } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { \n  ArrowLeft, \n  FileText, \n  Download, \n  Eye, \n  Filter, \n  Calendar,\n  Building,\n  Search,\n  TrendingUp,\n  BarChart3,\n  PieChart,\n  CheckCircle,\n  Clock,\n  AlertTriangle\n} from 'lucide-react';\nimport { useLocation } from 'wouter';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\nimport { Header, Footer } from '@/components/navbar';\nimport { SEO, breadcrumbSchema } from '@/components/seo';\n\ninterface Report {\n  id: number;\n  title: string;\n  propertyName: string;\n  propertyAddress: string;\n  type: 'winn-report' | 'thermal-analysis' | 'damage-assessment';\n  status: 'completed' | 'processing' | 'pending';\n  createdDate: string;\n  completedDate?: string;\n  fileSize: string;\n  pageCount: number;\n  downloadUrl: string;\n  previewUrl: string;\n  damageType: string;\n  severity: 'low' | 'moderate' | 'high' | 'critical';\n  estimatedCost: number;\n}\n\nconst ReportsPage: React.FC = () => {\n  const [, navigate] = useLocation();\n  const [activeTab, setActiveTab] = useState(\"all-reports\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterType, setFilterType] = useState(\"all\");\n  const [filterStatus, setFilterStatus] = useState(\"all\");\n\n  // Realistic report data for MVP demonstration\n  const reports: Report[] = [\n    {\n      id: 1,\n      title: \"Complete Hail Damage Assessment - Meridian Business Center\",\n      propertyName: \"Meridian Business Center\",\n      propertyAddress: \"2500 Technology Drive, Plano, TX 75074\",\n      type: \"winn-report\",\n      status: \"completed\",\n      createdDate: \"2025-01-15T10:30:00Z\",\n      completedDate: \"2025-01-15T14:45:00Z\",\n      fileSize: \"47.2 MB\",\n      pageCount: 312,\n      downloadUrl: \"/reports/meridian-hail-damage-2025-01-15.pdf\",\n      previewUrl: \"/reports/preview/meridian-hail-damage-2025-01-15\",\n      damageType: \"Hail Impact\",\n      severity: \"critical\",\n      estimatedCost: 485000\n    },\n    {\n      id: 2,\n      title: \"Wind Damage Analysis - Legacy Village Shopping Center\",\n      propertyName: \"Legacy Village Shopping Center\", \n      propertyAddress: \"7200 Bishop Road, Plano, TX 75024\",\n      type: \"damage-assessment\",\n      status: \"completed\",\n      createdDate: \"2025-01-08T09:15:00Z\",\n      completedDate: \"2025-01-08T16:30:00Z\",\n      fileSize: \"32.8 MB\",\n      pageCount: 187,\n      downloadUrl: \"/reports/legacy-wind-damage-2025-01-08.pdf\",\n      previewUrl: \"/reports/preview/legacy-wind-damage-2025-01-08\",\n      damageType: \"Wind Uplift\",\n      severity: \"moderate\",\n      estimatedCost: 287500\n    },\n    {\n      id: 3,\n      title: \"Emergency Tornado Assessment - Industrial Distribution Facility\",\n      propertyName: \"Industrial Distribution Facility\",\n      propertyAddress: \"1850 Central Expressway, Richardson, TX 75080\",\n      type: \"winn-report\",\n      status: \"processing\",\n      createdDate: \"2025-01-20T11:00:00Z\",\n      fileSize: \"Est. 65+ MB\",\n      pageCount: 450,\n      downloadUrl: \"\",\n      previewUrl: \"\",\n      damageType: \"Tornado\",\n      severity: \"critical\",\n      estimatedCost: 1200000\n    },\n    {\n      id: 4,\n      title: \"Flood Damage Documentation - Oakwood Apartments\",\n      propertyName: \"Oakwood Apartments\",\n      propertyAddress: \"5420 LBJ Freeway, Dallas, TX 75240\",\n      type: \"thermal-analysis\",\n      status: \"completed\",\n      createdDate: \"2025-01-12T14:20:00Z\",\n      completedDate: \"2025-01-12T18:45:00Z\",\n      fileSize: \"28.4 MB\",\n      pageCount: 156,\n      downloadUrl: \"/reports/oakwood-flood-damage-2025-01-12.pdf\",\n      previewUrl: \"/reports/preview/oakwood-flood-damage-2025-01-12\",\n      damageType: \"Water Intrusion\",\n      severity: \"high\",\n      estimatedCost: 342000\n    },\n    {\n      id: 5,\n      title: \"Quarterly Inspection Report - Dallas Commercial Portfolio\",\n      propertyName: \"Multiple Properties\",\n      propertyAddress: \"Various Dallas Metro Locations\",\n      type: \"damage-assessment\",\n      status: \"pending\",\n      createdDate: \"2025-01-25T08:00:00Z\",\n      fileSize: \"TBD\",\n      pageCount: 0,\n      downloadUrl: \"\",\n      previewUrl: \"\",\n      damageType: \"Preventive Maintenance\",\n      severity: \"low\",\n      estimatedCost: 0\n    }\n  ];\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'completed': return 'bg-green-500';\n      case 'processing': return 'bg-yellow-500';\n      case 'pending': return 'bg-gray-500';\n      default: return 'bg-gray-500';\n    }\n  };\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'critical': return 'text-red-600 bg-red-100';\n      case 'high': return 'text-orange-600 bg-orange-100';\n      case 'moderate': return 'text-yellow-600 bg-yellow-100';\n      case 'low': return 'text-green-600 bg-green-100';\n      default: return 'text-gray-600 bg-gray-100';\n    }\n  };\n\n  const getReportTypeIcon = (type: string) => {\n    switch (type) {\n      case 'winn-report': return <FileText className=\"h-5 w-5 text-primary\" />;\n      case 'thermal-analysis': return <TrendingUp className=\"h-5 w-5 text-cyan-500\" />;\n      case 'damage-assessment': return <BarChart3 className=\"h-5 w-5 text-blue-500\" />;\n      default: return <FileText className=\"h-5 w-5 text-gray-500\" />;\n    }\n  };\n\n  const getReportTypeName = (type: string) => {\n    switch (type) {\n      case 'winn-report': return 'Winn Report';\n      case 'thermal-analysis': return 'Thermal Analysis';\n      case 'damage-assessment': return 'Damage Assessment';\n      default: return 'Report';\n    }\n  };\n\n  const filteredReports = reports.filter(report => {\n    const matchesSearch = report.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         report.propertyName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         report.propertyAddress.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesType = filterType === 'all' || report.type === filterType;\n    const matchesStatus = filterStatus === 'all' || report.status === filterStatus;\n    \n    return matchesSearch && matchesType && matchesStatus;\n  });\n\n  const completedReports = reports.filter(r => r.status === 'completed');\n  const totalEstimatedCost = completedReports.reduce((sum, report) => sum + report.estimatedCost, 0);\n  const totalPages = completedReports.reduce((sum, report) => sum + report.pageCount, 0);\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative bg-background text-foreground\">\n      <SEO\n        title=\"Reports Library\"\n        description=\"Access and manage your damage assessment reports. View Winn Reports, thermal analysis documents, and comprehensive property evaluations.\"\n        canonical=\"/reports\"\n        noindex={true}\n        structuredData={breadcrumbSchema([\n          { name: 'Home', url: '/' },\n          { name: 'Reports', url: '/reports' }\n        ])}\n      />\n      <Header />\n      \n      <main className=\"flex-grow pb-20\">\n        <div className=\"max-w-7xl mx-auto p-6\">\n          {/* WinnStorm™ Branded Header */}\n          <div className=\"mb-8\">\n            <div className=\"flex items-center mb-6\">\n              <Button \n                variant=\"ghost\" \n                onClick={() => navigate('/dashboard')}\n                className=\"mr-4 p-2 hover:bg-primary/10\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n              <div className=\"flex items-center\">\n                <div className=\"relative mr-4\">\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-primary/30 to-cyan-500/30 rounded-lg blur-md\"></div>\n                  <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-10 relative z-10\" />\n                </div>\n                <div>\n                  <h1 className=\"text-3xl font-bold bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent\">\n                    Damage Assessment Reports\n                  </h1>\n                  <p className=\"text-muted-foreground text-sm\">\n                    Comprehensive inspection reports using the proven Winn Methodology\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Summary Statistics */}\n            <div className=\"grid md:grid-cols-4 gap-4 mb-6\">\n              <Card className=\"bg-gradient-to-br from-card to-primary/5 border-primary/20\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center\">\n                    <div className=\"p-2 bg-primary/20 rounded-lg mr-3\">\n                      <FileText className=\"h-5 w-5 text-primary\" />\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Total Reports</p>\n                      <p className=\"text-2xl font-bold text-primary\">{reports.length}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-gradient-to-br from-card to-green-500/5 border-green-500/20\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center\">\n                    <div className=\"p-2 bg-green-500/20 rounded-lg mr-3\">\n                      <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Completed</p>\n                      <p className=\"text-2xl font-bold text-green-600\">{completedReports.length}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-gradient-to-br from-card to-blue-500/5 border-blue-500/20\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center\">\n                    <div className=\"p-2 bg-blue-500/20 rounded-lg mr-3\">\n                      <PieChart className=\"h-5 w-5 text-blue-500\" />\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Total Pages</p>\n                      <p className=\"text-2xl font-bold text-blue-600\">{totalPages.toLocaleString()}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-gradient-to-br from-card to-orange-500/5 border-orange-500/20\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center\">\n                    <div className=\"p-2 bg-orange-500/20 rounded-lg mr-3\">\n                      <TrendingUp className=\"h-5 w-5 text-orange-500\" />\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Est. Damages</p>\n                      <p className=\"text-2xl font-bold text-orange-600\">${(totalEstimatedCost / 1000000).toFixed(1)}M</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n            <TabsList className=\"bg-card border-border\">\n              <TabsTrigger value=\"all-reports\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\">\n                <FileText className=\"w-4 h-4 mr-2\" />\n                All Reports\n              </TabsTrigger>\n              <TabsTrigger value=\"analytics\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\">\n                <BarChart3 className=\"w-4 h-4 mr-2\" />\n                Analytics\n              </TabsTrigger>\n            </TabsList>\n\n            {/* All Reports Tab */}\n            <TabsContent value=\"all-reports\" className=\"space-y-6\">\n              {/* Search and Filters */}\n              <Card className=\"bg-card border-border\">\n                <CardContent className=\"p-4\">\n                  <div className=\"grid md:grid-cols-4 gap-4\">\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n                      <Input\n                        placeholder=\"Search reports...\"\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                        className=\"pl-10\"\n                      />\n                    </div>\n                    <Select value={filterType} onValueChange={setFilterType}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Report Type\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Types</SelectItem>\n                        <SelectItem value=\"winn-report\">Winn Reports</SelectItem>\n                        <SelectItem value=\"thermal-analysis\">Thermal Analysis</SelectItem>\n                        <SelectItem value=\"damage-assessment\">Damage Assessment</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <Select value={filterStatus} onValueChange={setFilterStatus}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Status\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Statuses</SelectItem>\n                        <SelectItem value=\"completed\">Completed</SelectItem>\n                        <SelectItem value=\"processing\">Processing</SelectItem>\n                        <SelectItem value=\"pending\">Pending</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <Button variant=\"outline\" className=\"border-primary/30 hover:bg-primary/10\">\n                      <Filter className=\"w-4 h-4 mr-2\" />\n                      Advanced Filters\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Reports List */}\n              <div className=\"space-y-4\">\n                {filteredReports.map((report) => (\n                  <Card key={report.id} className=\"bg-card border-border hover:border-primary/50 transition-colors\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"grid md:grid-cols-12 gap-4 items-center\">\n                        {/* Report Icon and Basic Info */}\n                        <div className=\"md:col-span-5\">\n                          <div className=\"flex items-start space-x-3\">\n                            <div className=\"p-2 bg-secondary/20 rounded-lg\">\n                              {getReportTypeIcon(report.type)}\n                            </div>\n                            <div className=\"flex-1\">\n                              <h3 className=\"font-semibold text-foreground mb-1\">{report.title}</h3>\n                              <p className=\"text-sm text-muted-foreground mb-1\">\n                                <Building className=\"h-4 w-4 inline mr-1\" />\n                                {report.propertyName}\n                              </p>\n                              <p className=\"text-xs text-muted-foreground\">{report.propertyAddress}</p>\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Report Details */}\n                        <div className=\"md:col-span-4\">\n                          <div className=\"space-y-2\">\n                            <div className=\"flex items-center space-x-2\">\n                              <Badge variant=\"outline\" className={getSeverityColor(report.severity)}>\n                                {report.severity.charAt(0).toUpperCase() + report.severity.slice(1)}\n                              </Badge>\n                              <Badge variant=\"outline\">\n                                {getReportTypeName(report.type)}\n                              </Badge>\n                            </div>\n                            <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n                              <Calendar className=\"h-4 w-4\" />\n                              <span>{new Date(report.createdDate).toLocaleDateString()}</span>\n                              {report.completedDate && (\n                                <>\n                                  <span>•</span>\n                                  <span>{report.pageCount} pages</span>\n                                  <span>•</span>\n                                  <span>{report.fileSize}</span>\n                                </>\n                              )}\n                            </div>\n                            {report.estimatedCost > 0 && (\n                              <p className=\"text-sm font-medium text-orange-600\">\n                                Est. Damage: ${report.estimatedCost.toLocaleString()}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n\n                        {/* Status and Actions */}\n                        <div className=\"md:col-span-3\">\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center space-x-2\">\n                              <div className={`w-2 h-2 rounded-full ${getStatusColor(report.status)}`}></div>\n                              <span className=\"text-sm font-medium capitalize\">{report.status}</span>\n                            </div>\n                            <div className=\"flex items-center space-x-2\">\n                              {report.status === 'completed' && (\n                                <>\n                                  <Button variant=\"ghost\" size=\"sm\" className=\"text-muted-foreground hover:text-foreground\">\n                                    <Eye className=\"h-4 w-4\" />\n                                  </Button>\n                                  <Button variant=\"ghost\" size=\"sm\" className=\"text-muted-foreground hover:text-foreground\">\n                                    <Download className=\"h-4 w-4\" />\n                                  </Button>\n                                </>\n                              )}\n                              {report.status === 'processing' && (\n                                <div className=\"flex items-center space-x-2 text-yellow-600\">\n                                  <Clock className=\"h-4 w-4\" />\n                                  <span className=\"text-sm\">Processing...</span>\n                                </div>\n                              )}\n                              {report.status === 'pending' && (\n                                <div className=\"flex items-center space-x-2 text-gray-600\">\n                                  <AlertTriangle className=\"h-4 w-4\" />\n                                  <span className=\"text-sm\">Pending</span>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </TabsContent>\n\n            {/* Analytics Tab */}\n            <TabsContent value=\"analytics\" className=\"space-y-6\">\n              <div className=\"grid md:grid-cols-2 gap-6\">\n                <Card className=\"bg-card border-border\">\n                  <CardHeader>\n                    <CardTitle className=\"text-foreground flex items-center gap-2\">\n                      <PieChart className=\"h-5 w-5 text-primary\" />\n                      Report Distribution\n                    </CardTitle>\n                    <CardDescription className=\"text-muted-foreground\">\n                      Breakdown by report type and status\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      {['winn-report', 'thermal-analysis', 'damage-assessment'].map((type) => {\n                        const count = reports.filter(r => r.type === type).length;\n                        const percentage = (count / reports.length) * 100;\n                        return (\n                          <div key={type} className=\"space-y-2\">\n                            <div className=\"flex justify-between text-sm\">\n                              <span className=\"font-medium\">{getReportTypeName(type)}</span>\n                              <span className=\"text-muted-foreground\">{count} reports</span>\n                            </div>\n                            <div className=\"w-full bg-secondary/20 rounded-full h-2\">\n                              <div \n                                className=\"bg-primary h-2 rounded-full transition-all duration-300\" \n                                style={{ width: `${percentage}%` }}\n                              ></div>\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"bg-card border-border\">\n                  <CardHeader>\n                    <CardTitle className=\"text-foreground flex items-center gap-2\">\n                      <TrendingUp className=\"h-5 w-5 text-green-500\" />\n                      Damage Severity Analysis\n                    </CardTitle>\n                    <CardDescription className=\"text-muted-foreground\">\n                      Distribution of damage severity levels\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      {['critical', 'high', 'moderate', 'low'].map((severity) => {\n                        const count = reports.filter(r => r.severity === severity).length;\n                        const totalDamage = reports\n                          .filter(r => r.severity === severity)\n                          .reduce((sum, r) => sum + r.estimatedCost, 0);\n                        return (\n                          <div key={severity} className=\"flex justify-between items-center p-3 bg-secondary/10 rounded-lg\">\n                            <div className=\"flex items-center space-x-3\">\n                              <Badge variant=\"outline\" className={getSeverityColor(severity)}>\n                                {severity.charAt(0).toUpperCase() + severity.slice(1)}\n                              </Badge>\n                              <span className=\"text-sm font-medium\">{count} properties</span>\n                            </div>\n                            <span className=\"text-sm text-muted-foreground\">\n                              ${totalDamage.toLocaleString()}\n                            </span>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n};\n\nexport default ReportsPage;","path":null,"size_bytes":23753,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/navbar.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { useLocation } from \"wouter\";\nimport { Cloud, Home, CloudUpload, ChartScatter, PersonStanding, Database, LogOut } from \"lucide-react\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\nexport const Header = () => {\n  const { user, logout } = useAuth();\n  const [, navigate] = useLocation();\n  \n  // Get user initials\n  const getUserInitials = () => {\n    if (!user?.email) return 'U';\n    const parts = user.email.split('@')[0].split('.');\n    if (parts.length > 1) {\n      return (parts[0][0] + parts[1][0]).toUpperCase();\n    }\n    return parts[0].substring(0, 2).toUpperCase();\n  };\n\n  return (\n    <header className=\"bg-[#1A1A1A] border-b border-white/10\">\n      <div className=\"flex items-center justify-between p-4\">\n        <button \n          className=\"flex items-center cursor-pointer touch-target\"\n          onClick={() => navigate('/dashboard')}\n          data-testid=\"link-home\"\n        >\n          <img src={winnstormLogo} alt=\"WinnStorm Restoration Pro\" className=\"h-10 mr-3\" />\n          <div className=\"flex flex-col\">\n            <h1 className=\"text-lg font-heading font-bold text-white leading-tight\">WinnStorm™</h1>\n            <span className=\"text-xs text-white/60 -mt-1\">Restoration Pro</span>\n          </div>\n        </button>\n        <div className=\"flex items-center gap-2\">\n          <ThemeToggle />\n          <div className=\"flex items-center gap-1\">\n            <div \n              className=\"w-11 h-11 bg-primary text-white rounded-none flex items-center justify-center font-heading font-bold text-sm touch-target\"\n              data-testid=\"text-user-avatar\"\n              title={`Signed in as ${user?.email || 'User'}`}\n            >\n              {getUserInitials()}\n            </div>\n            <button \n              className=\"w-11 h-11 bg-white/10 hover:bg-white/20 transition-colors text-white rounded-none flex items-center justify-center touch-target\"\n              onClick={logout}\n              data-testid=\"button-logout\"\n              title=\"Sign out\"\n            >\n              <LogOut className=\"h-5 w-5\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n};\n\nexport const Footer = () => {\n  const [location, navigate] = useLocation();\n  \n  return (\n    <footer className=\"fixed bottom-0 left-0 right-0 bg-[#1A1A1A] border-t border-white/10 py-2 px-4 z-10 safe-area-bottom\">\n      <div className=\"flex justify-around items-center max-w-md mx-auto\">\n        <button \n          className={`flex flex-col items-center min-w-[56px] min-h-[48px] py-2 px-2 touch-target ${location === '/dashboard' ? 'text-primary' : 'text-white/60 hover:text-white active:text-primary'}`}\n          onClick={() => navigate('/dashboard')}\n          data-testid=\"nav-dashboard\"\n        >\n          <Home className=\"h-6 w-6\" />\n          <span className=\"text-xs mt-1 font-heading uppercase tracking-wide\">Home</span>\n        </button>\n        <button \n          className={`flex flex-col items-center min-w-[56px] min-h-[48px] py-2 px-2 touch-target ${location === '/upload' ? 'text-primary' : 'text-white/60 hover:text-white active:text-primary'}`}\n          onClick={() => navigate('/upload')}\n          data-testid=\"nav-upload\"\n        >\n          <CloudUpload className=\"h-6 w-6\" />\n          <span className=\"text-xs mt-1 font-heading uppercase tracking-wide\">Upload</span>\n        </button>\n        <button \n          className={`flex flex-col items-center min-w-[56px] min-h-[48px] py-2 px-2 touch-target ${location === '/crm-integrations' ? 'text-primary' : 'text-white/60 hover:text-white active:text-primary'}`}\n          onClick={() => navigate('/crm-integrations')}\n          data-testid=\"nav-crm\"\n        >\n          <Database className=\"h-6 w-6\" />\n          <span className=\"text-xs mt-1 font-heading uppercase tracking-wide\">CRM</span>\n        </button>\n        <button \n          className={`flex flex-col items-center min-w-[56px] min-h-[48px] py-2 px-2 touch-target ${location === '/reports' ? 'text-primary' : 'text-white/60 hover:text-white active:text-primary'}`}\n          onClick={() => navigate('/reports')}\n          data-testid=\"nav-reports\"\n        >\n          <ChartScatter className=\"h-6 w-6\" />\n          <span className=\"text-xs mt-1 font-heading uppercase tracking-wide\">Reports</span>\n        </button>\n      </div>\n    </footer>\n  );\n};","path":null,"size_bytes":4461,"size_tokens":null},"client/src/pages/crm-integrations.tsx":{"content":"import React, { useState } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Database, Settings, Activity, Plus, CheckCircle, AlertCircle, Clock, ArrowLeft, Zap, Building2 } from 'lucide-react';\nimport CrmConfigManager from '@/components/crm-config';\nimport { useQuery } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useLocation } from 'wouter';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\nimport { Header, Footer } from '@/components/navbar';\n\ninterface CrmConfig {\n  id: number;\n  name: string;\n  type: string;\n  isActive: boolean;\n  createdAt: string;\n}\n\ninterface CrmSyncLog {\n  id: number;\n  crmConfigId: number;\n  propertyId?: number;\n  scanId?: number;\n  syncType: string;\n  externalId?: string;\n  status: string;\n  errorMessage?: string;\n  syncedAt: string;\n}\n\nconst CrmIntegrationsPage: React.FC = () => {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const [, navigate] = useLocation();\n\n  // Mock data for demonstration - in real implementation this would connect to APIs\n  const configs: CrmConfig[] = [\n    {\n      id: 1,\n      name: \"JobNimbus Production\",\n      type: \"jobnimbus\",\n      isActive: true,\n      createdAt: \"2025-01-20T10:00:00Z\"\n    },\n    {\n      id: 2,\n      name: \"Salesforce CRM\",\n      type: \"salesforce\",\n      isActive: true,\n      createdAt: \"2025-01-18T14:30:00Z\"\n    },\n    {\n      id: 3,\n      name: \"HubSpot Pipeline\",\n      type: \"hubspot\",\n      isActive: false,\n      createdAt: \"2025-01-15T09:15:00Z\"\n    }\n  ];\n\n  const allSyncLogs: CrmSyncLog[] = [\n    {\n      id: 1,\n      crmConfigId: 1,\n      propertyId: 1,\n      syncType: \"contact\",\n      externalId: \"JN-2025-001\",\n      status: \"success\",\n      syncedAt: \"2025-01-27T18:30:00Z\"\n    },\n    {\n      id: 2,\n      crmConfigId: 2,\n      propertyId: 2,\n      syncType: \"job\",\n      externalId: \"SF-OP-2025-087\",\n      status: \"success\",\n      syncedAt: \"2025-01-27T17:45:00Z\"\n    },\n    {\n      id: 3,\n      crmConfigId: 1,\n      scanId: 1,\n      syncType: \"document\",\n      externalId: \"JN-DOC-4512\",\n      status: \"success\",\n      syncedAt: \"2025-01-27T16:20:00Z\"\n    },\n    {\n      id: 4,\n      crmConfigId: 2,\n      propertyId: 3,\n      syncType: \"contact\",\n      status: \"failed\",\n      errorMessage: \"Invalid API key format\",\n      syncedAt: \"2025-01-27T15:10:00Z\"\n    }\n  ];\n\n  const configsLoading = false;\n  const logsLoading = false;\n\n  const activeConfigs = configs.filter(config => config.isActive);\n  const recentLogs = allSyncLogs.slice(0, 10);\n  const successfulSyncs = allSyncLogs.filter(log => log.status === 'success').length;\n  const failedSyncs = allSyncLogs.filter(log => log.status === 'failed').length;\n\n  const getCrmTypeIcon = (type: string) => {\n    switch (type) {\n      case 'jobnimbus': return '🔧';\n      case 'gohighlevel': return '📈';\n      case 'salesforce': return '☁️';\n      case 'hubspot': return '🟠';\n      case 'pipedrive': return '🔵';\n      default: return '📊';\n    }\n  };\n\n  const getCrmTypeName = (type: string) => {\n    switch (type) {\n      case 'jobnimbus': return 'JobNimbus';\n      case 'gohighlevel': return 'GoHighLevel';\n      case 'salesforce': return 'Salesforce';\n      case 'hubspot': return 'HubSpot';\n      case 'pipedrive': return 'Pipedrive';\n      default: return type;\n    }\n  };\n\n  const formatSyncType = (type: string) => {\n    switch (type) {\n      case 'contact': return 'Contact';\n      case 'job': return 'Job/Opportunity';\n      case 'document': return 'Document';\n      default: return type;\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative bg-background text-foreground\">\n      <Header />\n      \n      <main className=\"flex-grow pb-20\">\n        <div className=\"max-w-7xl mx-auto p-6\">\n          {/* WinnStorm™ Branded Header */}\n          <div className=\"mb-8\">\n            <div className=\"flex items-center mb-6\">\n              <Button \n                variant=\"ghost\" \n                onClick={() => navigate('/dashboard')}\n                className=\"mr-4 p-2 hover:bg-primary/10\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n              <div className=\"flex items-center\">\n                <div className=\"relative mr-4\">\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-primary/30 to-cyan-500/30 rounded-lg blur-md\"></div>\n                  <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-10 relative z-10\" />\n                </div>\n                <div>\n                  <h1 className=\"text-3xl font-bold bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent\">\n                    CRM Integrations\n                  </h1>\n                  <p className=\"text-muted-foreground text-sm\">\n                    Connect roofing CRM systems to automatically sync property data, inspection results, and Winn Reports\n                  </p>\n                </div>\n              </div>\n            </div>\n            \n            {/* Integration Benefits Banner */}\n            <Card className=\"bg-gradient-to-r from-primary/10 to-cyan-500/10 border-primary/30 mb-6\">\n              <CardContent className=\"p-6\">\n                <div className=\"grid md:grid-cols-3 gap-6\">\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"p-3 bg-primary/20 rounded-lg\">\n                      <Zap className=\"h-6 w-6 text-primary\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-foreground\">Automated Workflows</h3>\n                      <p className=\"text-sm text-muted-foreground\">Auto-sync damage assessments to your CRM</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"p-3 bg-cyan-500/20 rounded-lg\">\n                      <Building2 className=\"h-6 w-6 text-cyan-500\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-foreground\">Property Management</h3>\n                      <p className=\"text-sm text-muted-foreground\">Seamless property data synchronization</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"p-3 bg-blue-500/20 rounded-lg\">\n                      <Database className=\"h-6 w-6 text-blue-500\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-foreground\">Report Delivery</h3>\n                      <p className=\"text-sm text-muted-foreground\">Direct Winn Report delivery to clients</p>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n            <TabsList className=\"bg-card border-border\">\n              <TabsTrigger value=\"overview\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\">\n                <Database className=\"w-4 h-4 mr-2\" />\n                Overview\n              </TabsTrigger>\n              <TabsTrigger value=\"configurations\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\">\n                <Settings className=\"w-4 h-4 mr-2\" />\n                Configurations\n              </TabsTrigger>\n              <TabsTrigger value=\"activity\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\">\n                <Activity className=\"w-4 h-4 mr-2\" />\n                Activity\n              </TabsTrigger>\n            </TabsList>\n\n          {/* Overview Tab */}\n          <TabsContent value=\"overview\" className=\"space-y-6\">\n            {/* Stats Cards */}\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <Card className=\"bg-gradient-to-br from-card to-primary/5 border-primary/20\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-foreground flex items-center gap-2\">\n                      <Database className=\"w-5 h-5 text-primary\" />\n                      Active Integrations\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-3xl font-bold text-primary mb-2\">\n                      {configsLoading ? '...' : activeConfigs.length}\n                    </div>\n                    <p className=\"text-muted-foreground text-sm\">\n                      {configs.length - activeConfigs.length} inactive\n                    </p>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"bg-gradient-to-br from-card to-green-500/5 border-green-500/20\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-foreground flex items-center gap-2\">\n                      <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                      Successful Syncs\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-3xl font-bold text-green-600 mb-2\">\n                      {logsLoading ? '...' : successfulSyncs}\n                    </div>\n                    <p className=\"text-muted-foreground text-sm\">\n                      {((successfulSyncs / (successfulSyncs + failedSyncs)) * 100 || 0).toFixed(1)}% success rate\n                    </p>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"bg-gradient-to-br from-card to-red-500/5 border-red-500/20\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-foreground flex items-center gap-2\">\n                      <AlertCircle className=\"w-5 h-5 text-red-500\" />\n                      Failed Syncs\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-3xl font-bold text-red-600 mb-2\">\n                      {logsLoading ? '...' : failedSyncs}\n                    </div>\n                    <p className=\"text-muted-foreground text-sm\">\n                      Last 30 days\n                    </p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Active Integrations */}\n              <Card className=\"bg-card border-border\">\n                <CardHeader>\n                  <CardTitle className=\"text-foreground\">Active Integrations</CardTitle>\n                  <CardDescription className=\"text-muted-foreground\">\n                    Your currently connected CRM systems\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {configsLoading ? (\n                    <div className=\"flex items-center justify-center p-8\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : activeConfigs.length === 0 ? (\n                    <div className=\"text-center py-8\">\n                      <Database className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                      <p className=\"text-muted-foreground mb-4\">No active CRM integrations</p>\n                      <Button\n                        onClick={() => setActiveTab('configurations')}\n                        className=\"bg-primary hover:bg-primary/90\"\n                      >\n                        <Plus className=\"w-4 h-4 mr-2\" />\n                        Add Integration\n                      </Button>\n                    </div>\n                  ) : (\n                    <div className=\"grid gap-4\">\n                      {activeConfigs.map((config) => (\n                        <div\n                          key={config.id}\n                          className=\"flex items-center justify-between p-4 bg-secondary/10 rounded-lg border border-border\"\n                        >\n                          <div className=\"flex items-center gap-3\">\n                            <span className=\"text-2xl\">{getCrmTypeIcon(config.type)}</span>\n                            <div>\n                              <h3 className=\"text-foreground font-medium\">{config.name}</h3>\n                              <p className=\"text-muted-foreground text-sm\">{getCrmTypeName(config.type)}</p>\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <Badge variant=\"default\" className=\"bg-green-600 hover:bg-green-700\">\n                              Active\n                            </Badge>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => setActiveTab('configurations')}\n                              className=\"text-muted-foreground hover:text-foreground\"\n                            >\n                              <Settings className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Recent Activity */}\n              <Card className=\"bg-card border-border\">\n                <CardHeader>\n                  <CardTitle className=\"text-foreground\">Recent Activity</CardTitle>\n                  <CardDescription className=\"text-muted-foreground\">\n                    Latest synchronization events\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {logsLoading ? (\n                    <div className=\"flex items-center justify-center p-8\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : recentLogs.length === 0 ? (\n                    <div className=\"text-center py-8\">\n                      <Activity className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                      <p className=\"text-muted-foreground\">No recent activity</p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-3\">\n                      {recentLogs.map((log) => (\n                        <div\n                          key={log.id}\n                          className=\"flex items-center justify-between p-3 bg-secondary/10 rounded-lg border border-border\"\n                        >\n                          <div className=\"flex items-center gap-3\">\n                            {log.status === 'success' ? (\n                              <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                            ) : log.status === 'failed' ? (\n                              <AlertCircle className=\"w-5 h-5 text-red-500\" />\n                            ) : (\n                              <Clock className=\"w-5 h-5 text-yellow-500\" />\n                            )}\n                            <div>\n                              <p className=\"text-foreground font-medium\">\n                                {formatSyncType(log.syncType)} sync\n                              </p>\n                              <p className=\"text-muted-foreground text-sm\">\n                                {new Date(log.syncedAt).toLocaleString()}\n                              </p>\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <Badge\n                              variant={log.status === 'success' ? 'default' : 'destructive'}\n                              className={log.status === 'success' ? 'bg-green-600 hover:bg-green-700' : ''}\n                            >\n                              {log.status}\n                            </Badge>\n                            {log.externalId && (\n                              <p className=\"text-muted-foreground text-xs mt-1\">\n                                ID: {log.externalId}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Configurations Tab */}\n            <TabsContent value=\"configurations\" className=\"space-y-6\">\n              <Card className=\"bg-card border-border\">\n                <CardHeader>\n                  <CardTitle className=\"text-foreground flex items-center gap-2\">\n                    <Settings className=\"w-5 h-5 text-primary\" />\n                    CRM Configuration Manager\n                  </CardTitle>\n                  <CardDescription className=\"text-muted-foreground\">\n                    Set up and manage your CRM system connections for automated Winn Report delivery\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-6\">\n                    {/* Available CRM Systems */}\n                    <div>\n                      <h3 className=\"text-lg font-semibold text-foreground mb-4\">Available Integrations</h3>\n                      <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                        {['jobnimbus', 'salesforce', 'hubspot', 'pipedrive', 'gohighlevel'].map((crm) => (\n                          <Card key={crm} className=\"bg-secondary/10 border-border hover:border-primary/50 transition-colors cursor-pointer\">\n                            <CardContent className=\"p-4 text-center\">\n                              <div className=\"text-3xl mb-2\">{getCrmTypeIcon(crm)}</div>\n                              <h4 className=\"font-medium text-foreground\">{getCrmTypeName(crm)}</h4>\n                              <p className=\"text-sm text-muted-foreground mb-3\">Professional roofing CRM</p>\n                              <Button size=\"sm\" className=\"bg-primary hover:bg-primary/90\">\n                                <Plus className=\"w-4 h-4 mr-1\" />\n                                Connect\n                              </Button>\n                            </CardContent>\n                          </Card>\n                        ))}\n                      </div>\n                    </div>\n\n                    {/* Current Configurations */}\n                    <div>\n                      <h3 className=\"text-lg font-semibold text-foreground mb-4\">Current Configurations</h3>\n                      <div className=\"space-y-3\">\n                        {configs.map((config) => (\n                          <div key={config.id} className=\"flex items-center justify-between p-4 bg-secondary/10 rounded-lg border border-border\">\n                            <div className=\"flex items-center gap-3\">\n                              <span className=\"text-2xl\">{getCrmTypeIcon(config.type)}</span>\n                              <div>\n                                <h4 className=\"font-medium text-foreground\">{config.name}</h4>\n                                <p className=\"text-sm text-muted-foreground\">{getCrmTypeName(config.type)} • Created {new Date(config.createdAt).toLocaleDateString()}</p>\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Badge variant={config.isActive ? 'default' : 'secondary'} className={config.isActive ? 'bg-green-600' : ''}>\n                                {config.isActive ? 'Active' : 'Inactive'}\n                              </Badge>\n                              <Button variant=\"ghost\" size=\"sm\">\n                                <Settings className=\"w-4 h-4\" />\n                              </Button>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Activity Tab */}\n            <TabsContent value=\"activity\" className=\"space-y-6\">\n              <Card className=\"bg-card border-border\">\n                <CardHeader>\n                  <CardTitle className=\"text-foreground\">All Sync Activity</CardTitle>\n                  <CardDescription className=\"text-muted-foreground\">\n                    Complete history of CRM synchronization events\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {logsLoading ? (\n                    <div className=\"flex items-center justify-center p-8\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : allSyncLogs.length === 0 ? (\n                    <div className=\"text-center py-8\">\n                      <Activity className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n                      <p className=\"text-muted-foreground\">No sync activity found</p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-3\">\n                      {allSyncLogs.map((log) => (\n                        <div\n                          key={log.id}\n                          className=\"flex items-start justify-between p-4 bg-secondary/10 rounded-lg border border-border\"\n                        >\n                          <div className=\"flex items-start gap-3\">\n                            {log.status === 'success' ? (\n                              <CheckCircle className=\"w-5 h-5 text-green-500 mt-0.5\" />\n                            ) : log.status === 'failed' ? (\n                              <AlertCircle className=\"w-5 h-5 text-red-500 mt-0.5\" />\n                            ) : (\n                              <Clock className=\"w-5 h-5 text-yellow-500 mt-0.5\" />\n                            )}\n                            <div className=\"flex-1\">\n                              <p className=\"text-foreground font-medium\">\n                                {formatSyncType(log.syncType)} sync\n                              </p>\n                              <p className=\"text-muted-foreground text-sm\">\n                                {new Date(log.syncedAt).toLocaleString()}\n                              </p>\n                              {log.errorMessage && (\n                                <p className=\"text-red-500 text-sm mt-1\">\n                                  Error: {log.errorMessage}\n                                </p>\n                              )}\n                              {log.propertyId && (\n                                <p className=\"text-muted-foreground text-xs mt-1\">\n                                  Property ID: {log.propertyId}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <Badge\n                              variant={log.status === 'success' ? 'default' : 'destructive'}\n                              className={log.status === 'success' ? 'bg-green-600 hover:bg-green-700' : ''}\n                            >\n                              {log.status}\n                            </Badge>\n                            {log.externalId && (\n                              <p className=\"text-muted-foreground text-xs mt-1\">\n                                External ID: {log.externalId}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n};\n\nexport default CrmIntegrationsPage;","path":null,"size_bytes":24471,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/pages/projects.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useLocation } from 'wouter';\nimport { Header, Footer } from '@/components/navbar';\nimport { useAuth } from '@/hooks/use-auth';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Project } from '@shared/schema';\nimport { \n  Briefcase, \n  Plus, \n  Search, \n  Filter, \n  Calendar, \n  FileText,\n  Clock,\n  CheckCircle,\n  AlertTriangle,\n  Eye\n} from 'lucide-react';\nimport { SEO, breadcrumbSchema } from '@/components/seo';\n\nconst Projects = () => {\n  const { user, role, loading: authLoading } = useAuth();\n  const [, navigate] = useLocation();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState('all');\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!authLoading && !user) {\n      navigate('/');\n    }\n  }, [user, authLoading, navigate]);\n\n  // Fetch real projects from database\n  const { data: projects, isLoading, error, refetch } = useQuery<Project[]>({\n    queryKey: ['/api/projects'],\n    enabled: !!user,\n  });\n\n  // Show loading during auth resolution or data fetch\n  const showLoading = authLoading || (!!user && isLoading);\n\n  // Transform projects for display\n  const displayProjects = (projects || []).map(project => ({\n    id: project.id,\n    projectId: project.projectId,\n    name: project.propertyAddress,\n    address: project.propertyAddress,\n    lossType: project.lossType,\n    status: project.status,\n    dateOfLoss: project.dateOfLoss ? new Date(project.dateOfLoss) : null,\n    inspectionDate: project.inspectionDate ? new Date(project.inspectionDate) : null,\n    estimatedValue: project.estimatedValue,\n    approvedAmount: project.approvedAmount\n  }));\n\n  // Filter projects\n  const filteredProjects = displayProjects.filter(project => {\n    const matchesSearch = project.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         project.projectId.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         project.lossType.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesStatus = statusFilter === 'all' || project.status === statusFilter;\n    return matchesSearch && matchesStatus;\n  });\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'prospecting': return 'bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400';\n      case 'inspection_scheduled': return 'bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400';\n      case 'report_draft': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400';\n      case 'submitted_to_insurance': return 'bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400';\n      case 'approved': return 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400';\n      case 'denied': return 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400';\n      case 'completed': return 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400';\n      default: return 'bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400';\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative bg-background text-foreground\">\n      <SEO\n        title=\"Project Management\"\n        description=\"Manage damage assessment projects, track client progress, and coordinate inspections. Comprehensive project management for property consultants.\"\n        canonical=\"/projects\"\n        noindex={true}\n        structuredData={breadcrumbSchema([\n          { name: 'Home', url: '/' },\n          { name: 'Projects', url: '/projects' }\n        ])}\n      />\n      <Header />\n      \n      <main className=\"flex-grow pb-20\">\n        <div className=\"p-6\">\n          {/* Projects Header */}\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div className=\"flex items-center\">\n                <div className=\"p-3 bg-gradient-to-br from-primary/20 to-cyan-500/20 rounded-xl\">\n                  <Briefcase className=\"h-8 w-8 text-primary\" />\n                </div>\n                <div className=\"ml-4\">\n                  <h1 className=\"text-3xl font-bold bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent\">\n                    Project Management\n                  </h1>\n                  <p className=\"text-muted-foreground\">Manage damage assessment projects and clients</p>\n                </div>\n              </div>\n              \n              <Button className=\"bg-gradient-to-r from-primary to-cyan-500 hover:from-primary/90 hover:to-cyan-500/90\" data-testid=\"btn-new-project\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                New Project\n              </Button>\n            </div>\n\n            {/* Filters and Search */}\n            <div className=\"flex flex-col sm:flex-row gap-4 mb-6\">\n              <div className=\"relative flex-1\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search projects...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10\"\n                  data-testid=\"input-search-projects\"\n                />\n              </div>\n              \n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-full sm:w-[200px]\" data-testid=\"status-filter\">\n                  <Filter className=\"h-4 w-4 mr-2\" />\n                  <SelectValue placeholder=\"Filter by status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Projects</SelectItem>\n                  <SelectItem value=\"prospecting\">Prospecting</SelectItem>\n                  <SelectItem value=\"inspection_scheduled\">Inspection Scheduled</SelectItem>\n                  <SelectItem value=\"report_draft\">Report Draft</SelectItem>\n                  <SelectItem value=\"submitted_to_insurance\">Submitted</SelectItem>\n                  <SelectItem value=\"approved\">Approved</SelectItem>\n                  <SelectItem value=\"completed\">Completed</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Project Stats */}\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\" data-testid=\"project-stats\">\n              <Card className=\"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center\">\n                    <Briefcase className=\"h-5 w-5 text-primary mr-2\" />\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Total Projects</p>\n                      <p className=\"text-2xl font-bold text-primary\" data-testid=\"stat-total-projects\">{displayProjects.length}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-gradient-to-br from-blue-500/5 to-blue-500/10 border-blue-500/20\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center\">\n                    <Clock className=\"h-5 w-5 text-blue-500 mr-2\" />\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">In Progress</p>\n                      <p className=\"text-2xl font-bold text-blue-600\" data-testid=\"stat-in-progress\">\n                        {displayProjects.filter(p => !['completed', 'approved', 'denied'].includes(p.status)).length}\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-gradient-to-br from-green-500/5 to-green-500/10 border-green-500/20\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center\">\n                    <CheckCircle className=\"h-5 w-5 text-green-500 mr-2\" />\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Completed</p>\n                      <p className=\"text-2xl font-bold text-green-600\" data-testid=\"stat-completed\">\n                        {displayProjects.filter(p => p.status === 'completed' || p.status === 'approved').length}\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-gradient-to-br from-cyan-500/5 to-cyan-500/10 border-cyan-500/20\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center\">\n                    <FileText className=\"h-5 w-5 text-cyan-500 mr-2\" />\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Total Value</p>\n                      <p className=\"text-2xl font-bold text-cyan-600\" data-testid=\"stat-total-value\">\n                        ${((displayProjects.reduce((sum, p) => sum + (p.estimatedValue || 0), 0)) / 100).toLocaleString()}\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n\n          {/* Projects List */}\n          <div className=\"space-y-4\" data-testid=\"projects-list\">\n            {showLoading ? (\n              <div className=\"space-y-4\">\n                {[1, 2, 3].map((i) => (\n                  <Card key={i} className=\"animate-pulse\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"h-4 bg-muted rounded w-1/4 mb-2\"></div>\n                      <div className=\"h-3 bg-muted rounded w-1/2 mb-2\"></div>\n                      <div className=\"h-3 bg-muted rounded w-1/3\"></div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : error ? (\n              <Card className=\"border-destructive\">\n                <CardContent className=\"p-12 text-center\">\n                  <AlertTriangle className=\"h-12 w-12 text-destructive mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold mb-2\">Failed to load projects</h3>\n                  <p className=\"text-muted-foreground mb-4\">\n                    There was an error loading your projects. Please try again.\n                  </p>\n                  <Button variant=\"outline\" onClick={() => refetch()} data-testid=\"btn-retry\">\n                    Try Again\n                  </Button>\n                </CardContent>\n              </Card>\n            ) : filteredProjects.length === 0 ? (\n              <Card>\n                <CardContent className=\"p-12 text-center\">\n                  <Briefcase className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold mb-2\">No projects found</h3>\n                  <p className=\"text-muted-foreground mb-4\">\n                    {searchTerm || statusFilter !== 'all' \n                      ? \"Try adjusting your search or filters\" \n                      : \"Create your first project to get started\"}\n                  </p>\n                  <Button className=\"bg-gradient-to-r from-primary to-cyan-500\" data-testid=\"btn-create-project-empty\">\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Create Project\n                  </Button>\n                </CardContent>\n              </Card>\n            ) : (\n              filteredProjects.map((project) => (\n                <Card key={project.id} className=\"hover:shadow-md transition-shadow cursor-pointer\" data-testid={`project-card-${project.id}`}>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-3 mb-2\">\n                          <span className=\"text-xs font-mono text-muted-foreground bg-muted px-2 py-1 rounded\" data-testid={`project-id-${project.id}`}>\n                            {project.projectId}\n                          </span>\n                          <Badge className={getStatusColor(project.status)} data-testid={`project-status-${project.id}`}>\n                            {project.status.replace(/_/g, ' ')}\n                          </Badge>\n                          <Badge variant=\"outline\" className=\"capitalize\">\n                            {project.lossType}\n                          </Badge>\n                        </div>\n                        \n                        <h3 className=\"text-lg font-semibold mb-3\" data-testid={`project-address-${project.id}`}>{project.address}</h3>\n                        \n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n                          <div className=\"flex items-center text-sm text-muted-foreground\">\n                            <AlertTriangle className=\"h-4 w-4 mr-2 text-orange-500\" />\n                            <span>Loss Date: {project.dateOfLoss ? project.dateOfLoss.toLocaleDateString() : 'N/A'}</span>\n                          </div>\n                          <div className=\"flex items-center text-sm text-muted-foreground\">\n                            <Calendar className=\"h-4 w-4 mr-2\" />\n                            <span>Inspection: {project.inspectionDate ? project.inspectionDate.toLocaleDateString() : 'Not scheduled'}</span>\n                          </div>\n                          <div className=\"flex items-center text-sm text-muted-foreground\">\n                            <FileText className=\"h-4 w-4 mr-2\" />\n                            <span>Est. Value: ${project.estimatedValue ? (project.estimatedValue / 100).toLocaleString() : '0'}</span>\n                          </div>\n                        </div>\n                        \n                        {project.approvedAmount && (\n                          <div className=\"flex items-center text-sm text-green-600 font-medium\">\n                            <CheckCircle className=\"h-4 w-4 mr-2\" />\n                            <span>Approved: ${(project.approvedAmount / 100).toLocaleString()}</span>\n                          </div>\n                        )}\n                      </div>\n                      \n                      <div className=\"ml-4 flex flex-col space-y-2\">\n                        <Button\n                          size=\"sm\"\n                          onClick={() => navigate(`/property/${project.id}`)}\n                          data-testid={`btn-view-project-${project.id}`}\n                        >\n                          <Eye className=\"h-4 w-4 mr-2\" />\n                          View Details\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => navigate(`/winn-report/${project.id}`)}\n                          data-testid={`btn-generate-report-${project.id}`}\n                        >\n                          <FileText className=\"h-4 w-4 mr-2\" />\n                          Generate Report\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))\n            )}\n          </div>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n};\n\nexport default Projects;","path":null,"size_bytes":15877,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1858,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/report-preview.tsx":{"content":"import { useState } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Flame, Send, Download } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { Property, Scan } from '@shared/schema';\n\ninterface ReportPreviewProps {\n  property: Property;\n  scan: Scan;\n  onSend: (email: string) => void;\n  onDownload: () => void;\n}\n\nexport const ReportPreview = ({ property, scan, onSend, onDownload }: ReportPreviewProps) => {\n  const { toast } = useToast();\n  const [reportTitle, setReportTitle] = useState('Thermal Roof Assessment');\n  const [recipientName, setRecipientName] = useState('');\n  const [recipientEmail, setRecipientEmail] = useState('');\n  const [includes, setIncludes] = useState({\n    summary: true,\n    findings: true,\n    recommendations: true,\n    thermalImages: true,\n    costEstimates: false\n  });\n\n  const handleDownload = () => {\n    onDownload();\n    toast({\n      title: 'Report downloaded successfully!',\n      description: 'Your PDF report is ready.',\n    });\n  };\n\n  const handleSend = () => {\n    if (!recipientEmail) {\n      toast({\n        title: 'Email required',\n        description: 'Please enter a recipient email address.',\n        variant: 'destructive'\n      });\n      return;\n    }\n    \n    onSend(recipientEmail);\n    toast({\n      title: 'Report sent successfully!',\n      description: `The report has been sent to ${recipientEmail}.`,\n    });\n  };\n\n  const formatDate = (date: Date) => {\n    return new Date(date).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  const getScoreColor = (score: number) => {\n    if (score >= 80) return \"bg-success\";\n    if (score >= 60) return \"bg-warning\";\n    return \"bg-destructive\";\n  };\n\n  return (\n    <>\n      <Card className=\"mb-6\">\n        <CardContent className=\"p-4\">\n          <div className=\"border border-neutral-medium rounded-lg p-4 mb-4\">\n            {/* Report Header (Preview) */}\n            <div className=\"flex justify-between items-center mb-4 pb-4 border-b border-neutral-medium\">\n              <div>\n                <h3 className=\"font-bold text-primary text-lg\">{reportTitle}</h3>\n                <p className=\"text-neutral-dark text-sm\">{property.name} - {property.address}</p>\n                <p className=\"text-neutral-dark text-sm\">Assessment Date: {formatDate(new Date(scan.date))}</p>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"flex items-center justify-end\">\n                  <Flame className=\"text-secondary mr-1\" />\n                  <span className=\"font-semibold text-primary\">ThermalRoof</span>\n                </div>\n                <p className=\"text-neutral-dark text-xs mt-1\">Professional Roofing Intelligence</p>\n              </div>\n            </div>\n\n            {/* Report Content Preview */}\n            <div className=\"space-y-3 mb-4\">\n              <div>\n                <h4 className=\"font-semibold text-neutral-darker\">Roof Health Score: {scan.healthScore}/100</h4>\n                <div className=\"w-full bg-neutral-medium rounded-full h-2 mt-1\">\n                  <div className={`${getScoreColor(scan.healthScore)} h-2 rounded-full`} style={{ width: `${scan.healthScore}%` }}></div>\n                </div>\n                <p className=\"text-xs text-neutral-dark mt-1\">\n                  {scan.healthScore >= 80 ? 'Good: No immediate action required' : \n                   scan.healthScore >= 60 ? 'Warning: Maintenance recommended' : \n                   'Critical: Immediate attention required'}\n                </p>\n              </div>\n\n              {includes.summary && (\n                <p className=\"text-sm text-neutral-dark\">\n                  Assessment summary and thermal analysis for the commercial property located at {property.address}. \n                  Scan performed on {formatDate(new Date(scan.date))} using {scan.deviceType || 'thermal imaging equipment'}.\n                </p>\n              )}\n\n              {includes.thermalImages && (\n                <div className=\"w-full rounded-lg overflow-hidden\">\n                  <img src={scan.thermalImageUrl} alt=\"Thermal imaging of the roof\" className=\"w-full h-auto\" />\n                </div>\n              )}\n              \n              {includes.findings && (\n                <div>\n                  <h4 className=\"font-semibold text-neutral-darker text-sm\">Key Findings:</h4>\n                  <ul className=\"text-sm text-neutral-dark list-disc pl-5 mt-1\">\n                    {scan.issues.map((issue, index) => (\n                      <li key={index}>{issue.description}</li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </div>\n\n            {/* Preview pagination */}\n            <div className=\"flex justify-center\">\n              <span className=\"text-xs text-neutral-dark\">Preview - Page 1 of {includes.costEstimates ? 4 : 3}</span>\n            </div>\n          </div>\n\n          {/* Report Options */}\n          <h3 className=\"font-semibold text-neutral-darker mb-3\">Report Options</h3>\n          \n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"report-title\" className=\"block text-neutral-darker text-sm font-medium mb-2\">\n                Report Title\n              </Label>\n              <Input \n                id=\"report-title\"\n                value={reportTitle}\n                onChange={(e) => setReportTitle(e.target.value)}\n                className=\"w-full p-3 border border-neutral-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\"\n              />\n            </div>\n            \n            <div>\n              <Label className=\"block text-neutral-darker text-sm font-medium mb-2\">\n                Include Sections\n              </Label>\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center\">\n                  <Checkbox \n                    id=\"include-summary\" \n                    checked={includes.summary}\n                    onCheckedChange={(checked) => setIncludes({...includes, summary: !!checked})}\n                    className=\"h-4 w-4 text-primary focus:ring-primary border-neutral-medium rounded\" \n                  />\n                  <Label htmlFor=\"include-summary\" className=\"ml-2 block text-sm text-neutral-darker\">\n                    Executive Summary\n                  </Label>\n                </div>\n                <div className=\"flex items-center\">\n                  <Checkbox \n                    id=\"include-findings\" \n                    checked={includes.findings}\n                    onCheckedChange={(checked) => setIncludes({...includes, findings: !!checked})}\n                    className=\"h-4 w-4 text-primary focus:ring-primary border-neutral-medium rounded\" \n                  />\n                  <Label htmlFor=\"include-findings\" className=\"ml-2 block text-sm text-neutral-darker\">\n                    Detailed Findings\n                  </Label>\n                </div>\n                <div className=\"flex items-center\">\n                  <Checkbox \n                    id=\"include-recommendations\" \n                    checked={includes.recommendations}\n                    onCheckedChange={(checked) => setIncludes({...includes, recommendations: !!checked})}\n                    className=\"h-4 w-4 text-primary focus:ring-primary border-neutral-medium rounded\" \n                  />\n                  <Label htmlFor=\"include-recommendations\" className=\"ml-2 block text-sm text-neutral-darker\">\n                    Recommendations\n                  </Label>\n                </div>\n                <div className=\"flex items-center\">\n                  <Checkbox \n                    id=\"include-thermal\" \n                    checked={includes.thermalImages}\n                    onCheckedChange={(checked) => setIncludes({...includes, thermalImages: !!checked})}\n                    className=\"h-4 w-4 text-primary focus:ring-primary border-neutral-medium rounded\" \n                  />\n                  <Label htmlFor=\"include-thermal\" className=\"ml-2 block text-sm text-neutral-darker\">\n                    Thermal Images & Analysis\n                  </Label>\n                </div>\n                <div className=\"flex items-center\">\n                  <Checkbox \n                    id=\"include-cost\" \n                    checked={includes.costEstimates}\n                    onCheckedChange={(checked) => setIncludes({...includes, costEstimates: !!checked})}\n                    className=\"h-4 w-4 text-primary focus:ring-primary border-neutral-medium rounded\"\n                  />\n                  <Label htmlFor=\"include-cost\" className=\"ml-2 block text-sm text-neutral-darker\">\n                    Cost Estimates\n                  </Label>\n                </div>\n              </div>\n            </div>\n            \n            <div>\n              <Label htmlFor=\"recipient-name\" className=\"block text-neutral-darker text-sm font-medium mb-2\">\n                Recipient Information\n              </Label>\n              <Input \n                id=\"recipient-name\"\n                value={recipientName}\n                onChange={(e) => setRecipientName(e.target.value)}\n                placeholder=\"Recipient Name\"\n                className=\"w-full p-3 border border-neutral-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-primary mb-2\"\n              />\n              <Input \n                id=\"recipient-email\"\n                type=\"email\"\n                value={recipientEmail}\n                onChange={(e) => setRecipientEmail(e.target.value)}\n                placeholder=\"Email Address\"\n                className=\"w-full p-3 border border-neutral-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n      \n      {/* Action Buttons */}\n      <div className=\"grid grid-cols-2 gap-4\">\n        <Button \n          className=\"bg-primary hover:bg-primary-light text-white font-medium py-3 px-4 rounded-lg transition flex items-center justify-center\"\n          onClick={handleSend}\n        >\n          <Send className=\"mr-2 h-5 w-5\" />\n          Send Report\n        </Button>\n        <Button \n          variant=\"outline\"\n          className=\"bg-white border border-neutral-medium hover:bg-neutral-light text-neutral-darker font-medium py-3 px-4 rounded-lg transition flex items-center justify-center\"\n          onClick={handleDownload}\n        >\n          <Download className=\"mr-2 h-5 w-5\" />\n          Download PDF\n        </Button>\n      </div>\n    </>\n  );\n};\n","path":null,"size_bytes":10858,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/stormy-avatar.tsx":{"content":"import React from 'react';\nimport stormyAvatarImage from '@assets/ChatGPT Image Jul 31, 2025, 03_42_36 PM_1753998186905.png';\n\ninterface StormyAvatarProps {\n  size?: number;\n  className?: string;\n}\n\nexport function StormyAvatar({ size = 32, className = \"\" }: StormyAvatarProps) {\n  return (\n    <div \n      className={`relative inline-block rounded-full overflow-hidden ${className}`}\n      style={{ width: size, height: size }}\n    >\n      <img\n        src={stormyAvatarImage}\n        alt=\"Stormy - AI Assistant\"\n        width={size}\n        height={size}\n        className=\"w-full h-full object-cover\"\n      />\n    </div>\n  );\n}","path":null,"size_bytes":630,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":1921,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"DEPLOYMENT.md":{"content":"# WinnStorm™ Native App Deployment Guide\n\n## Overview\nWinnStorm is now a cross-platform native application built with React + TypeScript + Capacitor, deployable to iOS App Store and Google Play Store.\n\n## Platform Information\n- **App Name**: WinnStorm\n- **Bundle ID**: `com.winnstorm.inspector`\n- **Platforms**: iOS (via Xcode) and Android (via Android Studio)\n- **Technology**: Capacitor 7.x wrapping React web app\n\n---\n\n## 📱 iOS App Store Deployment\n\n### Prerequisites\n1. **Mac Computer** with macOS (required for iOS development)\n2. **Xcode** 15.0 or later (download from Mac App Store)\n3. **Apple Developer Account** ($99/year)\n   - Sign up at: https://developer.apple.com/programs/\n4. **CocoaPods** (iOS dependency manager)\n   ```bash\n   sudo gem install cocoapods\n   ```\n\n### Step 1: Open iOS Project\n```bash\nnpx cap open ios\n```\nThis opens the project in Xcode.\n\n### Step 2: Configure Signing & Capabilities\n1. In Xcode, select **WinnStorm** project in the navigator\n2. Select the **App** target\n3. Go to **Signing & Capabilities** tab\n4. Select your **Team** (Apple Developer Account)\n5. Xcode will automatically create provisioning profiles\n\n### Step 3: Configure Camera Permissions\nThe app requires camera access for inspection photos. Xcode should auto-configure this, but verify:\n\n1. Open `ios/App/App/Info.plist`\n2. Ensure these keys exist:\n   ```xml\n   <key>NSCameraUsageDescription</key>\n   <string>WinnStorm needs camera access to capture inspection photos and thermal images for damage assessment reports.</string>\n   <key>NSPhotoLibraryUsageDescription</key>\n   <string>WinnStorm needs photo library access to save and retrieve inspection photos.</string>\n   <key>NSPhotoLibraryAddUsageDescription</key>\n   <string>WinnStorm needs permission to save inspection photos to your photo library.</string>\n   ```\n\n### Step 4: Update App Icons\n1. Prepare icons in required sizes (see iOS Icon Sizes below)\n2. In Xcode, go to **App** > **Assets.xcassets** > **AppIcon**\n3. Drag and drop icons for each size\n4. Ensure all slots are filled\n\n**iOS Icon Sizes Required:**\n- 20x20 pt (2x, 3x) - Notifications\n- 29x29 pt (2x, 3x) - Settings\n- 40x40 pt (2x, 3x) - Spotlight\n- 60x60 pt (2x, 3x) - App Icon\n- 1024x1024 pt (1x) - App Store\n\n### Step 5: Build for Testing (TestFlight)\n1. Select **Any iOS Device** as the build target\n2. Product → Archive\n3. Once archive completes, click **Distribute App**\n4. Choose **App Store Connect**\n5. Upload to App Store Connect\n6. Add to TestFlight for beta testing\n\n### Step 6: Submit to App Store\n1. Go to [App Store Connect](https://appstoreconnect.apple.com/)\n2. Create new app listing\n3. Fill in app metadata:\n   - App Name: WinnStorm\n   - Subtitle: Professional Damage Assessment\n   - Description: (See marketing copy below)\n   - Keywords: damage assessment, roofing inspection, thermal imaging\n   - Screenshots: Capture from iOS simulator/device\n   - Category: Business / Productivity\n4. Upload build from TestFlight\n5. Submit for review\n\n---\n\n## 🤖 Google Play Store Deployment\n\n### Prerequisites\n1. **Android Studio** (download from https://developer.android.com/studio)\n2. **Google Play Developer Account** ($25 one-time fee)\n   - Sign up at: https://play.google.com/console/signup\n3. **Java Development Kit (JDK)** 17 or later\n\n### Step 1: Open Android Project\n```bash\nnpx cap open android\n```\nThis opens the project in Android Studio.\n\n### Step 2: Configure App Signing\nFor production releases, you need a signing key:\n\n```bash\n# Generate keystore (do this ONCE and keep it safe!)\nkeytool -genkey -v -keystore winnstorm-release.keystore -alias winnstorm -keyalg RSA -keysize 2048 -validity 10000\n\n# Save keystore in a secure location\n# NEVER commit this to version control!\n```\n\nUpdate `android/app/build.gradle`:\n```gradle\nandroid {\n    ...\n    signingConfigs {\n        release {\n            storeFile file(\"path/to/winnstorm-release.keystore\")\n            storePassword \"YOUR_STORE_PASSWORD\"\n            keyAlias \"winnstorm\"\n            keyPassword \"YOUR_KEY_PASSWORD\"\n        }\n    }\n    buildTypes {\n        release {\n            signingConfig signingConfigs.release\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n```\n\n### Step 3: Configure Camera Permissions\nCamera permissions are already configured in `android/app/src/main/AndroidManifest.xml`:\n\n```xml\n<uses-permission android:name=\"android.permission.CAMERA\" />\n<uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" />\n<uses-permission android:name=\"android.permission.READ_EXTERNAL_STORAGE\" />\n<uses-feature android:name=\"android.hardware.camera\" android:required=\"true\" />\n```\n\n### Step 4: Update App Icons and Splash Screen\n1. Prepare icons in required densities (see Android Icon Sizes below)\n2. In Android Studio, right-click **res** → New → Image Asset\n3. Configure Asset Type: **Launcher Icons (Adaptive and Legacy)**\n4. Upload high-res icon (512x512 recommended)\n5. Generate icons for all densities\n\n**Android Icon Densities:**\n- mdpi: 48x48\n- hdpi: 72x72\n- xhdpi: 96x96\n- xxhdpi: 144x144\n- xxxhdpi: 192x192\n\n### Step 5: Build Release APK/AAB\n```bash\ncd android\n./gradlew bundleRelease\n```\n\nThe signed AAB will be at:\n`android/app/build/outputs/bundle/release/app-release.aab`\n\n### Step 6: Upload to Google Play Console\n1. Go to [Google Play Console](https://play.google.com/console/)\n2. Create a new application\n3. Fill in app details:\n   - App Name: WinnStorm\n   - Short Description: Professional damage assessment platform for inspectors\n   - Full Description: (See marketing copy below)\n   - Category: Business\n   - Screenshots: Capture from Android emulator/device\n4. Upload the AAB file\n5. Create a release:\n   - Choose **Production** or **Internal Testing** track\n   - Upload APK/AAB\n   - Fill release notes\n6. Submit for review\n\n---\n\n## 📸 Screenshots Requirements\n\n### iOS (Required Sizes)\n- 6.7\" Display: 1290x2796 (iPhone 15 Pro Max)\n- 6.5\" Display: 1284x2778 (iPhone 14 Pro Max)\n- 5.5\" Display: 1242x2208 (iPhone 8 Plus) - Optional\n\n### Android (Required)\n- Phone: 320-3840 px wide (landscape or portrait)\n- 7\" Tablet: 1024x600 or higher\n- 10\" Tablet: 1920x1200 or higher\n\n**Recommended Screenshot Scenes:**\n1. Dashboard with inspection overview\n2. Winn Report workflow in progress\n3. Thermal analysis with AI results\n4. Mobile-optimized navigation\n5. Camera capture interface\n6. Stormy AI assistant interaction\n\n---\n\n## 🔑 Environment Variables for Production\n\nBefore deploying, ensure these environment variables are configured:\n\n```bash\n# Firebase Configuration (for authentication)\nVITE_FIREBASE_API_KEY=your_firebase_api_key\nVITE_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com\nVITE_FIREBASE_PROJECT_ID=your_project_id\nVITE_FIREBASE_STORAGE_BUCKET=your_project.appspot.com\nVITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id\nVITE_FIREBASE_APP_ID=your_app_id\n\n# OpenAI (for Stormy AI Assistant)\nOPENAI_API_KEY=your_openai_api_key\n\n# Google Maps (for property mapping)\nVITE_GOOGLE_MAPS_API_KEY=your_google_maps_key\n```\n\n---\n\n## 🚀 Build and Sync Workflow\n\n### Standard Development Cycle\n```bash\n# 1. Make code changes in client/src/\n\n# 2. Build web app\nnpm run build\n\n# 3. Sync to native platforms\nnpx cap sync\n\n# 4. Open in IDE for native development\nnpx cap open ios    # or\nnpx cap open android\n\n# 5. Run from Xcode or Android Studio\n```\n\n### Quick Sync (After Code Changes)\n```bash\nnpm run build && npx cap sync\n```\n\n---\n\n## 📱 Testing on Physical Devices\n\n### iOS Device Testing\n1. Connect iPhone/iPad via USB\n2. In Xcode, select your device from the dropdown\n3. Click the \"Play\" button to build and run\n4. Trust the developer certificate on device if prompted\n\n### Android Device Testing\n1. Enable Developer Options on Android device\n2. Enable USB Debugging\n3. Connect device via USB\n4. In Android Studio, select your device\n5. Click the \"Run\" button\n\n---\n\n## 🔒 Security Considerations\n\n1. **API Keys**: Never commit API keys to version control\n2. **Keystore**: Store Android keystore in a secure, encrypted location\n3. **Environment Variables**: Use Replit Secrets or environment-specific configs\n4. **HTTPS Only**: All API endpoints must use HTTPS in production\n5. **Code Signing**: Both platforms require proper code signing certificates\n\n---\n\n## 📋 App Store Listing Copy\n\n### Short Description (80 chars max)\nProfessional damage assessment platform powered by AI and thermal imaging.\n\n### Full Description\nWinnStorm™ is the premier mobile platform for damage assessment consultants, bringing Eric Winn's proven methodology to iOS and Android devices. Conduct comprehensive roof inspections with confidence using AI-powered guidance, thermal imaging analysis, and field-optimized workflows.\n\n**Key Features:**\n✓ AI-Powered Inspection Coach - Stormy adapts guidance to your experience level\n✓ Native Camera Integration - Capture thermal images and damage photos instantly\n✓ Comprehensive Winn Methodology - Step-by-step workflows for professional reports\n✓ Mobile-First Design - Optimized for outdoor use with large touch targets\n✓ Offline Capability - Work on rooftops without internet connectivity\n✓ Thermal Analysis - AI-powered temperature anomaly detection\n✓ Educational Tooltips - Learn the \"why\" behind each inspection step\n✓ Weather Verification - Correlate damage with meteorological data\n\n**Perfect For:**\n- Roofing Inspectors\n- Insurance Adjusters  \n- Damage Assessment Consultants\n- Property Restoration Professionals\n\nTransform your inspection workflow with the most advanced damage assessment platform available.\n\n---\n\n## 🆘 Troubleshooting\n\n### iOS Build Errors\n- **\"No provisioning profiles found\"**: Select your Team in Xcode signing settings\n- **\"Pod install failed\"**: Run `cd ios/App && pod install`\n- **\"Module not found\"**: Clean build folder: Product → Clean Build Folder\n\n### Android Build Errors\n- **\"SDK not found\"**: Set ANDROID_HOME in environment variables\n- **\"Gradle sync failed\"**: File → Invalidate Caches → Restart\n- **\"Keystore not found\"**: Verify keystore path in build.gradle\n\n### Capacitor Sync Issues\n```bash\n# Clear and rebuild\nrm -rf dist\nrm -rf ios/App/App/public\nrm -rf android/app/src/main/assets/public\nnpm run build\nnpx cap sync\n```\n\n---\n\n## 📚 Additional Resources\n\n- **Capacitor Docs**: https://capacitorjs.com/docs\n- **iOS App Distribution**: https://developer.apple.com/distribute/\n- **Google Play Console Help**: https://support.google.com/googleplay/android-developer\n- **App Store Review Guidelines**: https://developer.apple.com/app-store/review/guidelines/\n- **Google Play Policy**: https://play.google.com/about/developer-content-policy/\n\n---\n\n## ✅ Pre-Launch Checklist\n\n### iOS\n- [ ] All app icons uploaded (all sizes)\n- [ ] Privacy policy URL provided\n- [ ] Support URL provided\n- [ ] Screenshots for all required device sizes\n- [ ] App Store description and keywords\n- [ ] Test on physical iOS devices\n- [ ] TestFlight beta testing completed\n- [ ] All camera permissions configured\n\n### Android\n- [ ] App icons for all densities\n- [ ] Privacy policy URL provided\n- [ ] Screenshots for phone and tablet\n- [ ] Google Play description complete\n- [ ] Test on physical Android devices\n- [ ] Content rating questionnaire completed\n- [ ] All permissions justified and configured\n- [ ] Release signed with production keystore\n\n---\n\n**Ready to Deploy!** 🚀\n\nFollow this guide step-by-step and WinnStorm will be live on both app stores. For support, refer to the troubleshooting section or official platform documentation.\n","path":null,"size_bytes":11593,"size_tokens":null},"ios/App/App/AppDelegate.swift":{"content":"import UIKit\nimport Capacitor\n\n@UIApplicationMain\nclass AppDelegate: UIResponder, UIApplicationDelegate {\n\n    var window: UIWindow?\n\n    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {\n        // Override point for customization after application launch.\n        return true\n    }\n\n    func applicationWillResignActive(_ application: UIApplication) {\n        // Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.\n        // Use this method to pause ongoing tasks, disable timers, and invalidate graphics rendering callbacks. Games should use this method to pause the game.\n    }\n\n    func applicationDidEnterBackground(_ application: UIApplication) {\n        // Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later.\n        // If your application supports background execution, this method is called instead of applicationWillTerminate: when the user quits.\n    }\n\n    func applicationWillEnterForeground(_ application: UIApplication) {\n        // Called as part of the transition from the background to the active state; here you can undo many of the changes made on entering the background.\n    }\n\n    func applicationDidBecomeActive(_ application: UIApplication) {\n        // Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.\n    }\n\n    func applicationWillTerminate(_ application: UIApplication) {\n        // Called when the application is about to terminate. Save data if appropriate. See also applicationDidEnterBackground:.\n    }\n\n    func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:]) -> Bool {\n        // Called when the app was launched with a url. Feel free to add additional processing here,\n        // but if you want the App API to support tracking app url opens, make sure to keep this call\n        return ApplicationDelegateProxy.shared.application(app, open: url, options: options)\n    }\n\n    func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {\n        // Called when the app was launched with an activity, including Universal Links.\n        // Feel free to add additional processing here, but if you want the App API to support\n        // tracking app url opens, make sure to keep this call\n        return ApplicationDelegateProxy.shared.application(application, continue: userActivity, restorationHandler: restorationHandler)\n    }\n\n}\n","path":null,"size_bytes":3031,"size_tokens":null},"android/app/src/main/java/com/winnstorm/inspector/MainActivity.java":{"content":"package com.winnstorm.inspector;\n\nimport com.getcapacitor.BridgeActivity;\n\npublic class MainActivity extends BridgeActivity {}\n","path":null,"size_bytes":127,"size_tokens":null},"client/src/components/mobile-workflow-nav.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { ChevronLeft, ChevronRight, Check } from 'lucide-react';\n\ninterface MobileWorkflowNavProps {\n  currentStep: number;\n  totalSteps: number;\n  onPrevious: () => void;\n  onNext: () => void;\n  onComplete?: () => void;\n  isFirstStep: boolean;\n  isLastStep: boolean;\n  stepTitle: string;\n}\n\nexport function MobileWorkflowNav({\n  currentStep,\n  totalSteps,\n  onPrevious,\n  onNext,\n  onComplete,\n  isFirstStep,\n  isLastStep,\n  stepTitle\n}: MobileWorkflowNavProps) {\n  const progress = ((currentStep + 1) / totalSteps) * 100;\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-card border-t-2 border-primary shadow-lg z-50 md:hidden\">\n      <div className=\"p-4 space-y-3\">\n        <div className=\"flex items-center justify-between text-sm\">\n          <span className=\"text-muted-foreground\">\n            Step {currentStep + 1} of {totalSteps}\n          </span>\n          <span className=\"font-medium text-foreground truncate ml-2\">\n            {stepTitle}\n          </span>\n        </div>\n        \n        <Progress value={progress} className=\"h-2\" />\n        \n        <div className=\"flex gap-3\">\n          <Button\n            data-testid=\"button-previous-step\"\n            onClick={onPrevious}\n            disabled={isFirstStep}\n            variant=\"outline\"\n            size=\"lg\"\n            className=\"flex-1 mobile-nav-btn touch-target\"\n          >\n            <ChevronLeft className=\"h-5 w-5 mr-1\" />\n            Previous\n          </Button>\n          \n          {isLastStep ? (\n            <Button\n              data-testid=\"button-generate-report\"\n              onClick={onComplete}\n              size=\"lg\"\n              className=\"flex-1 mobile-nav-btn touch-target bg-primary text-primary-foreground font-bold\"\n            >\n              <Check className=\"h-5 w-5 mr-2\" />\n              Generate Report\n            </Button>\n          ) : (\n            <Button\n              data-testid=\"button-next-step\"\n              onClick={onNext}\n              size=\"lg\"\n              className=\"flex-1 mobile-nav-btn touch-target bg-primary text-primary-foreground\"\n            >\n              Next\n              <ChevronRight className=\"h-5 w-5 ml-1\" />\n            </Button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":2352,"size_tokens":null},"client/src/components/camera-capture.tsx":{"content":"import { useState, useRef } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Camera as CameraIcon, X, Check, RotateCw } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { Camera } from '@capacitor/camera';\nimport { CameraResultType, CameraSource } from '@capacitor/camera';\nimport { Capacitor } from '@capacitor/core';\n\ninterface CameraCaptureProps {\n  onCapture: (imageData: string, filename: string) => void;\n  buttonLabel?: string;\n  captureType?: 'thermal' | 'damage' | 'general';\n  className?: string;\n}\n\nexport function CameraCapture({ \n  onCapture, \n  buttonLabel = \"Take Photo\",\n  captureType = 'general',\n  className = ''\n}: CameraCaptureProps) {\n  const [capturedImage, setCapturedImage] = useState<string | null>(null);\n  const [isReviewing, setIsReviewing] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const isNative = Capacitor.isNativePlatform();\n\n  const handleNativeCameraClick = async () => {\n    try {\n      const image = await Camera.getPhoto({\n        quality: 90,\n        allowEditing: false,\n        resultType: CameraResultType.Base64,\n        source: CameraSource.Camera,\n        saveToGallery: true,\n        presentationStyle: 'fullscreen'\n      });\n\n      if (image.base64String) {\n        const imageData = `data:image/${image.format};base64,${image.base64String}`;\n        setCapturedImage(imageData);\n        setIsReviewing(true);\n      }\n    } catch (error) {\n      if (error instanceof Error && error.message !== 'User cancelled photos app') {\n        console.error('Native camera error:', error);\n        toast({\n          title: \"Camera Error\",\n          description: \"Failed to access camera. Please check permissions.\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const handleWebCameraClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleCameraClick = () => {\n    if (isNative) {\n      handleNativeCameraClick();\n    } else {\n      handleWebCameraClick();\n    }\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (!file.type.startsWith('image/')) {\n      toast({\n        title: \"Invalid File\",\n        description: \"Please select an image file.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const reader = new FileReader();\n    reader.onload = (event) => {\n      const imageData = event.target?.result as string;\n      setCapturedImage(imageData);\n      setIsReviewing(true);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleConfirm = () => {\n    if (!capturedImage) return;\n\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const filename = `${captureType}_${timestamp}.jpg`;\n    \n    onCapture(capturedImage, filename);\n    \n    setCapturedImage(null);\n    setIsReviewing(false);\n    \n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n\n    toast({\n      title: \"Photo Captured\",\n      description: `${captureType} photo saved successfully.`,\n    });\n  };\n\n  const handleRetake = () => {\n    setCapturedImage(null);\n    setIsReviewing(false);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n    // Immediately open camera again\n    setTimeout(() => handleCameraClick(), 100);\n  };\n\n  const handleCancel = () => {\n    setCapturedImage(null);\n    setIsReviewing(false);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  if (isReviewing && capturedImage) {\n    return (\n      <Card className=\"bg-card border-border\">\n        <CardContent className=\"p-4 space-y-4\">\n          <div className=\"relative aspect-video bg-black rounded-lg overflow-hidden\">\n            <img\n              src={capturedImage}\n              alt=\"Captured preview\"\n              className=\"w-full h-full object-contain\"\n            />\n          </div>\n          \n          <div className=\"grid grid-cols-3 gap-2\">\n            <Button\n              data-testid=\"button-cancel-photo\"\n              variant=\"outline\"\n              onClick={handleCancel}\n              className=\"touch-target\"\n            >\n              <X className=\"h-4 w-4 mr-2\" />\n              Cancel\n            </Button>\n            \n            <Button\n              data-testid=\"button-retake-photo\"\n              variant=\"outline\"\n              onClick={handleRetake}\n              className=\"touch-target\"\n            >\n              <RotateCw className=\"h-4 w-4 mr-2\" />\n              Retake\n            </Button>\n            \n            <Button\n              data-testid=\"button-confirm-photo\"\n              onClick={handleConfirm}\n              className=\"bg-green-600 hover:bg-green-700 text-white touch-target\"\n            >\n              <Check className=\"h-4 w-4 mr-2\" />\n              Use\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <>\n      {/* Web fallback file input */}\n      {!isNative && (\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\"image/*\"\n          capture=\"environment\"\n          onChange={handleFileChange}\n          className=\"hidden\"\n          aria-label=\"Camera input\"\n        />\n      )}\n      \n      <Button\n        data-testid={`button-camera-${captureType}`}\n        onClick={handleCameraClick}\n        variant=\"outline\"\n        className={`touch-target ${className}`}\n      >\n        <CameraIcon className=\"h-4 w-4 mr-2\" />\n        {buttonLabel}\n      </Button>\n    </>\n  );\n}\n","path":null,"size_bytes":5644,"size_tokens":null},"android/app/src/test/java/com/getcapacitor/myapp/ExampleUnitTest.java":{"content":"package com.getcapacitor.myapp;\n\nimport static org.junit.Assert.*;\n\nimport org.junit.Test;\n\n/**\n * Example local unit test, which will execute on the development machine (host).\n *\n * @see <a href=\"http://d.android.com/tools/testing\">Testing documentation</a>\n */\npublic class ExampleUnitTest {\n\n    @Test\n    public void addition_isCorrect() throws Exception {\n        assertEquals(4, 2 + 2);\n    }\n}\n","path":null,"size_bytes":402,"size_tokens":null},"capacitor.config.ts":{"content":"import type { CapacitorConfig } from '@capacitor/cli';\n\nconst config: CapacitorConfig = {\n  appId: 'com.winnstorm.inspector',\n  appName: 'WinnStorm',\n  webDir: 'dist/public',\n  server: {\n    url: 'https://winnstorm.com',\n    cleartext: false,\n    androidScheme: 'https'\n  },\n  plugins: {\n    Camera: {\n      presentationStyle: 'fullscreen',\n      saveToGallery: true,\n      quality: 90,\n      allowEditing: false,\n      resultType: 'base64',\n      source: 'camera'\n    },\n    SplashScreen: {\n      launchShowDuration: 2000,\n      launchAutoHide: true,\n      backgroundColor: '#1E293B',\n      androidSplashResourceName: 'splash',\n      androidScaleType: 'CENTER_CROP',\n      showSpinner: false,\n      spinnerColor: '#F97316'\n    },\n    Geolocation: {\n      enableHighAccuracy: true,\n      timeout: 10000,\n      maximumAge: 0\n    },\n    Preferences: {\n      group: 'WinnStormSettings'\n    }\n  },\n  ios: {\n    contentInset: 'always',\n    backgroundColor: '#1E293B',\n    preferredContentMode: 'mobile',\n    scheme: 'winnstorm'\n  },\n  android: {\n    backgroundColor: '#1E293B',\n    allowMixedContent: true,\n    captureInput: true,\n    webContentsDebuggingEnabled: false,\n    buildOptions: {\n      keystorePath: undefined,\n      keystoreAlias: undefined\n    }\n  }\n};\n\nexport default config;\n","path":null,"size_bytes":1285,"size_tokens":null},"client/src/components/educational-tooltip.tsx":{"content":"import {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport { HelpCircle } from 'lucide-react';\n\ninterface EducationalTooltipProps {\n  content: string;\n  learnMore?: string;\n}\n\nexport function EducationalTooltip({ content, learnMore }: EducationalTooltipProps) {\n  return (\n    <Tooltip delayDuration={200}>\n      <TooltipTrigger asChild>\n        <span\n          role=\"button\"\n          tabIndex={0}\n          className=\"inline-flex items-center justify-center touch-target ml-1 cursor-pointer\"\n          aria-label=\"Learn more\"\n          data-testid=\"tooltip-help\"\n        >\n          <HelpCircle className=\"h-4 w-4 text-muted-foreground hover:text-primary transition-colors\" />\n        </span>\n      </TooltipTrigger>\n      <TooltipContent\n        side=\"top\"\n        className=\"max-w-xs p-3 bg-popover text-popover-foreground\"\n      >\n        <div className=\"space-y-2\">\n          <p className=\"text-sm font-medium\">Why This Matters</p>\n          <p className=\"text-sm\">{content}</p>\n          {learnMore && (\n            <p className=\"text-xs text-muted-foreground italic border-t pt-2\">\n              {learnMore}\n            </p>\n          )}\n        </div>\n      </TooltipContent>\n    </Tooltip>\n  );\n}\n","path":null,"size_bytes":1245,"size_tokens":null},"android/app/src/androidTest/java/com/getcapacitor/myapp/ExampleInstrumentedTest.java":{"content":"package com.getcapacitor.myapp;\n\nimport static org.junit.Assert.*;\n\nimport android.content.Context;\nimport androidx.test.ext.junit.runners.AndroidJUnit4;\nimport androidx.test.platform.app.InstrumentationRegistry;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\n\n/**\n * Instrumented test, which will execute on an Android device.\n *\n * @see <a href=\"http://d.android.com/tools/testing\">Testing documentation</a>\n */\n@RunWith(AndroidJUnit4.class)\npublic class ExampleInstrumentedTest {\n\n    @Test\n    public void useAppContext() throws Exception {\n        // Context of the app under test.\n        Context appContext = InstrumentationRegistry.getInstrumentation().getTargetContext();\n\n        assertEquals(\"com.getcapacitor.app\", appContext.getPackageName());\n    }\n}\n","path":null,"size_bytes":774,"size_tokens":null},"client/src/lib/stormy-guidance.ts":{"content":"/**\n * Stormy AI Guidance System - Context-Aware Educational Prompts\n * Adapts guidance based on workflow step, user experience level, and collected data\n */\n\nexport type UserExperienceLevel = 'beginner' | 'intermediate' | 'expert';\n\nexport interface StormyContext {\n  currentStep: string;\n  userLevel: UserExperienceLevel;\n  propertyData?: any;\n  thermalData?: any;\n  roofSections?: any[];\n  weatherData?: any[];\n  issues?: any[];\n  components?: any[];\n}\n\n/**\n * Step-specific educational content for \"Why This Matters\" guidance\n */\nexport const STEP_EDUCATION = {\n  'building-info': {\n    purpose: 'Establishing property context and baseline information',\n    importance: 'Accurate building information forms the foundation of the entire assessment. It affects material calculations, code compliance, and insurance claim validity.',\n    keyPoints: [\n      'Property type determines applicable building codes and standards',\n      'Square footage drives material estimates and cost projections',\n      'Year built indicates potential material types and construction methods',\n      'Owner information is critical for legal authorization'\n    ],\n    commonMistakes: [\n      'Estimating square footage instead of measuring accurately',\n      'Forgetting to document access points and site conditions',\n      'Not verifying property ownership before conducting inspection'\n    ]\n  },\n  'roof-system': {\n    purpose: 'Documenting existing roof system configuration and history',\n    importance: 'Understanding the current roof system helps identify vulnerabilities, predict failure patterns, and plan appropriate repairs.',\n    keyPoints: [\n      'Roof type affects water drainage and damage patterns',\n      'Material age determines expected lifespan and degradation',\n      'Previous repairs indicate problem areas and maintenance history',\n      'Warranty information impacts repair recommendations'\n    ],\n    commonMistakes: [\n      'Not documenting all roof layers and components',\n      'Overlooking previous patch repairs that may hide damage',\n      'Failing to check warranty status before recommending replacement'\n    ]\n  },\n  'weather': {\n    purpose: 'Correlating damage with specific weather events',\n    importance: 'Weather verification is essential for insurance claims and proving that damage resulted from a covered peril.',\n    keyPoints: [\n      'Temperature affects thermal imaging interpretation',\n      'Humidity impacts moisture detection accuracy',\n      'Wind speed correlates with debris and uplift damage',\n      'Precipitation timing helps determine water intrusion sources'\n    ],\n    commonMistakes: [\n      'Not recording weather at time of inspection (affects thermal data)',\n      'Failing to research historical weather for damage dating',\n      'Ignoring seasonal temperature variations in analysis'\n    ]\n  },\n  'thermal': {\n    purpose: 'Non-invasive detection of moisture, insulation gaps, and temperature anomalies',\n    importance: 'Thermal imaging reveals hidden problems invisible to the naked eye, making it a cornerstone of the Winn Methodology.',\n    keyPoints: [\n      'Temperature differentials indicate moisture intrusion',\n      'Insulation gaps show as distinct thermal patterns',\n      'Ambient conditions must be documented for accurate interpretation',\n      'Multiple readings validate findings and rule out false positives'\n    ],\n    commonMistakes: [\n      'Taking thermal images in direct sunlight (solar loading)',\n      'Not allowing roof surface to normalize after weather changes',\n      'Misinterpreting reflection as moisture',\n      'Forgetting to calibrate camera for ambient conditions'\n    ]\n  },\n  'components': {\n    purpose: 'Systematic evaluation of every roof system component',\n    importance: 'Comprehensive component assessment ensures nothing is missed and supports thorough damage documentation.',\n    keyPoints: [\n      'Each component has different lifespan and failure modes',\n      'Component condition affects overall system performance',\n      'Detailed notes support repair vs replacement decisions',\n      'Photo documentation proves existing conditions'\n    ],\n    commonMistakes: [\n      'Focusing only on obvious damage and missing systemic issues',\n      'Not documenting good conditions (important for insurance)',\n      'Overlooking penetrations, flashings, and drainage components',\n      'Failing to note manufacturer and installation dates'\n    ]\n  },\n  'issues': {\n    purpose: 'Documenting discovered deficiencies with severity classification',\n    importance: 'Properly categorized issues drive repair priorities and support claim values.',\n    keyPoints: [\n      'Severity classification guides urgency of repairs',\n      'Location specificity enables accurate cost estimates',\n      'Photo evidence supports findings and prevents disputes',\n      'Recommended actions demonstrate professional expertise'\n    ],\n    commonMistakes: [\n      'Under-rating severity to avoid difficult conversations',\n      'Vague location descriptions that can\\'t be found later',\n      'Not linking issues to supporting thermal or photo evidence',\n      'Recommending repairs without considering warranty implications'\n    ]\n  },\n  'cost-estimates': {\n    purpose: 'Translating findings into actionable repair cost projections',\n    importance: 'Accurate cost estimates support insurance negotiations and help property owners plan budgets.',\n    keyPoints: [\n      'Material quantities must align with measured areas',\n      'Labor costs vary by region and complexity',\n      'Permit and code compliance costs must be included',\n      'Contingencies account for hidden conditions'\n    ],\n    commonMistakes: [\n      'Using outdated material pricing',\n      'Underestimating labor for complex repairs',\n      'Forgetting overhead, profit, and contingency',\n      'Not separating immediate vs deferred maintenance costs'\n    ]\n  },\n  'review': {\n    purpose: 'Final quality check before report generation',\n    importance: 'This is your last chance to catch errors or omissions. A thorough review reflects professional standards.',\n    keyPoints: [\n      'Verify all critical data fields are populated',\n      'Ensure photos are properly labeled and oriented',\n      'Check that findings match evidence',\n      'Confirm cost estimates are reasonable and complete'\n    ],\n    commonMistakes: [\n      'Rushing through review to finish quickly',\n      'Not checking basic data like owner name and address',\n      'Missing obvious calculation errors',\n      'Failing to ensure photo quality is acceptable'\n    ]\n  }\n};\n\n/**\n * Generate context-aware system prompt for Stormy based on current workflow state\n */\nexport function getStormySystemPrompt(context: StormyContext): string {\n  const { currentStep, userLevel, propertyData, thermalData, roofSections, weatherData, issues, components } = context;\n  \n  const stepEducation = STEP_EDUCATION[currentStep as keyof typeof STEP_EDUCATION] || STEP_EDUCATION['building-info'];\n  \n  let prompt = `You are Stormy, an AI inspection coach trained on Eric Winn's comprehensive damage assessment methodology. You're helping a ${userLevel} inspector complete a professional roof inspection report.\n\n**Current Step**: ${stepEducation.purpose}\n\n**Why This Step Matters**: ${stepEducation.importance}\n\n**Key Principles for This Step**:\n${stepEducation.keyPoints.map((point, i) => `${i + 1}. ${point}`).join('\\n')}\n\n**Common Mistakes to Avoid**:\n${stepEducation.commonMistakes.map((mistake, i) => `- ${mistake}`).join('\\n')}\n\n`;\n\n  // Add user level-specific guidance style\n  if (userLevel === 'beginner') {\n    prompt += `\\n**Guidance Style**: You're working with a BEGINNER inspector. Provide detailed explanations with step-by-step instructions. Include the \"why\" behind each action. Use simple language and offer encouragement. Anticipate questions and proactively address common confusion points. Suggest specific actions rather than general advice.`;\n  } else if (userLevel === 'intermediate') {\n    prompt += `\\n**Guidance Style**: You're working with an INTERMEDIATE inspector. Provide concise reminders of key principles and best practices. They understand basics but benefit from expert tips and efficiency suggestions. Focus on quality checkpoints and common oversights. Answer questions with depth but assume foundational knowledge.`;\n  } else {\n    prompt += `\\n**Guidance Style**: You're working with an EXPERT inspector. Provide minimal prompts unless asked. Focus on edge cases, advanced techniques, and quality assurance. Share industry insights and methodology refinements. Respect their expertise while offering Eric Winn's advanced perspectives.`;\n  }\n\n  // Add contextual data awareness\n  if (propertyData?.address) {\n    prompt += `\\n\\n**Property Context**: Inspecting ${propertyData.propertyType || 'property'} at ${propertyData.address}`;\n    if (propertyData.squareFootage) {\n      prompt += ` (${propertyData.squareFootage} sq ft)`;\n    }\n  }\n\n  if (roofSections && roofSections.length > 0) {\n    prompt += `\\n**Roof Sections Marked**: ${roofSections.length} sections have been mapped on satellite imagery.`;\n  }\n\n  if (weatherData && weatherData.length > 0) {\n    const latest = weatherData[weatherData.length - 1];\n    prompt += `\\n**Current Conditions**: ${latest.temperature}°F, ${latest.humidity}% humidity, ${latest.windSpeed} mph wind`;\n  }\n\n  if (thermalData && thermalData.length > 0) {\n    prompt += `\\n**Thermal Data**: ${thermalData.length} thermal readings have been captured. Be ready to help interpret anomalies.`;\n  }\n\n  if (components && components.length > 0) {\n    prompt += `\\n**Components Documented**: ${components.length} roof components have been assessed.`;\n  }\n\n  if (issues && issues.length > 0) {\n    const critical = issues.filter(i => i.severity === 'critical').length;\n    const major = issues.filter(i => i.severity === 'major').length;\n    prompt += `\\n**Issues Found**: ${critical} critical, ${major} major issues documented so far.`;\n  }\n\n  prompt += `\\n\\n**Winn Methodology Core Principles**:\n1. Comprehensive data collection through thermal imaging, terrestrial walks, test squares\n2. Systematic documentation with precise measurements and photographic evidence\n3. Weather verification and meteorological correlation\n4. Structured analysis of core samples and moisture testing\n5. Detailed damage assessment with impact density calculations\n6. Professional reporting with supporting evidence and compliance documentation\n\n**Your Role**: Guide this inspector through the current step with appropriate detail for their experience level. Provide specific, actionable advice based on the Winn Methodology. When asked questions, draw from the educational context above. Be supportive, clear, and professional.`;\n\n  return prompt;\n}\n\n/**\n * Generate quick action prompts tailored to current step\n */\nexport function getQuickActionsForStep(step: string, userLevel: UserExperienceLevel): Array<{label: string; message: string}> {\n  const baseActions: Record<string, Array<{label: string; message: string}>> = {\n    'building-info': [\n      { label: 'Property Info Checklist', message: 'What are the essential property details I need to collect?' },\n      { label: 'Square Footage Tips', message: 'How do I accurately measure and verify total roof square footage?' },\n      { label: 'Owner Documentation', message: 'What owner information is required for a valid inspection report?' }\n    ],\n    'roof-system': [\n      { label: 'System Assessment Guide', message: 'Walk me through a complete roof system evaluation.' },\n      { label: 'Material Identification', message: 'How do I identify and document different roofing materials?' },\n      { label: 'Warranty Check', message: 'What should I look for when checking warranty status?' }\n    ],\n    'weather': [\n      { label: 'Weather Correlation', message: 'How do I correlate damage with specific weather events?' },\n      { label: 'Thermal Conditions', message: 'What weather conditions are ideal for thermal imaging?' },\n      { label: 'Historical Data', message: 'Where can I find historical weather data for damage dating?' }\n    ],\n    'thermal': [\n      { label: 'Thermal Best Practices', message: 'What are the best practices for thermal imaging in the field?' },\n      { label: 'Reading Interpretation', message: 'How do I interpret temperature differentials and identify moisture?' },\n      { label: 'False Positive Check', message: 'What causes false positives in thermal imaging?' }\n    ],\n    'components': [\n      { label: 'Component Checklist', message: 'What roof components must I document in every inspection?' },\n      { label: 'Condition Rating Guide', message: 'How do I rate component conditions consistently?' },\n      { label: 'Photo Documentation', message: 'What photo angles best document component conditions?' }\n    ],\n    'issues': [\n      { label: 'Severity Classification', message: 'How do I correctly classify issue severity levels?' },\n      { label: 'Evidence Linking', message: 'How should I link issues to thermal and photo evidence?' },\n      { label: 'Repair Recommendations', message: 'What factors determine repair vs replacement recommendations?' }\n    ],\n    'cost-estimates': [\n      { label: 'Estimating Methodology', message: 'Walk me through the Winn methodology for cost estimation.' },\n      { label: 'Material Quantities', message: 'How do I calculate accurate material quantities from measurements?' },\n      { label: 'Regional Pricing', message: 'How do I account for regional variations in labor and materials?' }\n    ],\n    'review': [\n      { label: 'Quality Checklist', message: 'What should I review before generating the final report?' },\n      { label: 'Common Oversights', message: 'What are the most common things inspectors miss in reports?' },\n      { label: 'Photo Quality Check', message: 'How do I ensure my photos meet professional standards?' }\n    ]\n  };\n\n  const actions = baseActions[step] || baseActions['building-info'];\n  \n  // Add level-specific quick actions\n  if (userLevel === 'beginner') {\n    actions.push({ label: 'Step-by-Step Guide', message: 'Give me detailed step-by-step instructions for this section.' });\n  } else if (userLevel === 'expert') {\n    actions.push({ label: 'Advanced Techniques', message: 'What advanced techniques can improve this part of the inspection?' });\n  }\n\n  return actions;\n}\n\n/**\n * Generate proactive guidance messages when user enters a new step\n */\nexport function getStepWelcomeMessage(step: string, userLevel: UserExperienceLevel): string {\n  const education = STEP_EDUCATION[step as keyof typeof STEP_EDUCATION];\n  if (!education) return '';\n\n  if (userLevel === 'beginner') {\n    return `Welcome to ${education.purpose}! ${education.importance}\\n\\nI'll guide you through each field. Don't hesitate to ask questions - there are no silly questions when learning the Winn Methodology!`;\n  } else if (userLevel === 'intermediate') {\n    return `${education.purpose}. Key focus: ${education.keyPoints[0]}. Let me know if you need any clarification!`;\n  } else {\n    return `${education.purpose}. I'm here if you need me.`;\n  }\n}\n","path":null,"size_bytes":15160,"size_tokens":null},"client/src/pages/subscription-success.tsx":{"content":"import { useEffect } from 'react';\nimport { useLocation } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { CheckCircle, ArrowRight } from 'lucide-react';\nimport { motion } from 'framer-motion';\nimport { SEO } from '@/components/seo';\n\nexport default function SubscriptionSuccess() {\n  const [, navigate] = useLocation();\n\n  useEffect(() => {\n    // Clear any test user data and ensure fresh login after subscription\n    localStorage.removeItem('testUser');\n    localStorage.removeItem('testUserRole');\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-6\">\n      <SEO\n        title=\"Welcome to WinnStorm - Subscription Activated\"\n        description=\"Your WinnStorm subscription is now active. Access AI-powered thermal analysis, Winn Reports, and certification training.\"\n        canonical=\"/subscription-success\"\n        noindex={true}\n      />\n      <motion.div\n        initial={{ opacity: 0, scale: 0.95 }}\n        animate={{ opacity: 1, scale: 1 }}\n        transition={{ duration: 0.5 }}\n        className=\"w-full max-w-2xl\"\n      >\n        <Card className=\"border-primary/20 shadow-xl\">\n          <CardHeader className=\"text-center pb-4\">\n            <motion.div\n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              transition={{ delay: 0.2, type: \"spring\", stiffness: 200 }}\n              className=\"mx-auto mb-6\"\n            >\n              <div className=\"h-20 w-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto\">\n                <CheckCircle className=\"h-12 w-12 text-primary\" />\n              </div>\n            </motion.div>\n            <CardTitle className=\"text-3xl font-bold text-foreground\">\n              Welcome to WinnStorm! 🎉\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"text-center space-y-4\">\n              <p className=\"text-lg text-muted-foreground\">\n                Your subscription has been activated successfully!\n              </p>\n              <p className=\"text-sm text-muted-foreground max-w-md mx-auto\">\n                You now have full access to AI-powered thermal analysis, comprehensive Winn Reports, \n                certification training, and all premium features.\n              </p>\n            </div>\n\n            <div className=\"bg-muted/30 rounded-lg p-6 space-y-3\">\n              <h3 className=\"font-semibold text-foreground\">What's Next?</h3>\n              <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                <li className=\"flex items-start gap-2\">\n                  <CheckCircle className=\"h-4 w-4 text-primary mt-0.5 flex-shrink-0\" />\n                  <span>Complete your profile and upload your first thermal scan</span>\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <CheckCircle className=\"h-4 w-4 text-primary mt-0.5 flex-shrink-0\" />\n                  <span>Explore the training portal to start your certification journey</span>\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <CheckCircle className=\"h-4 w-4 text-primary mt-0.5 flex-shrink-0\" />\n                  <span>Meet Stormy, your AI-powered inspection assistant</span>\n                </li>\n              </ul>\n            </div>\n\n            <div className=\"flex flex-col sm:flex-row gap-4\">\n              <Button\n                onClick={() => navigate('/dashboard')}\n                className=\"flex-1 h-12 text-lg bg-gradient-to-r from-primary to-cyan-500 hover:from-primary/90 hover:to-cyan-500/90\"\n                data-testid=\"button-go-to-dashboard\"\n              >\n                Go to Dashboard\n                <ArrowRight className=\"ml-2 h-5 w-5\" />\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={() => navigate('/training')}\n                className=\"flex-1 h-12\"\n              >\n                Start Training\n              </Button>\n            </div>\n\n            <p className=\"text-xs text-center text-muted-foreground mt-6\">\n              A confirmation email has been sent to your registered email address.\n            </p>\n          </CardContent>\n        </Card>\n      </motion.div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4407,"size_tokens":null},"client/src/pages/subscribe.tsx":{"content":"// Stripe subscription checkout - referenced from javascript_stripe blueprint\nimport { useStripe, Elements, PaymentElement, useElements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { useEffect, useState } from 'react';\nimport { useLocation, useRoute } from 'wouter';\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Loader2, CheckCircle, ArrowLeft, AlertCircle } from 'lucide-react';\nimport { SEO } from '@/components/seo';\n\n// Conditionally load Stripe - prefer testing key for development\nconst stripePublicKey = import.meta.env.TESTING_VITE_STRIPE_PUBLIC_KEY || import.meta.env.VITE_STRIPE_PUBLIC_KEY;\nconst stripePromise = stripePublicKey\n  ? loadStripe(stripePublicKey)\n  : null;\n\nconst SubscribeForm = ({ planName, isSetupMode }: { planName: string; isSetupMode: boolean }) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [isElementReady, setIsElementReady] = useState(false);\n  const [, navigate] = useLocation();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!stripe || !elements || !isElementReady) {\n      toast({\n        title: \"Please wait\",\n        description: \"Payment form is still loading...\",\n        variant: \"default\",\n      });\n      return;\n    }\n\n    setIsProcessing(true);\n\n    try {\n      let result;\n      if (isSetupMode) {\n        // For setup intents, use confirmSetup\n        result = await stripe.confirmSetup({\n          elements,\n          confirmParams: {\n            return_url: `${window.location.origin}/subscription-success`,\n          },\n        });\n      } else {\n        // For payment intents, use confirmPayment\n        result = await stripe.confirmPayment({\n          elements,\n          confirmParams: {\n            return_url: `${window.location.origin}/subscription-success`,\n          },\n        });\n      }\n\n      if (result.error) {\n        toast({\n          title: \"Payment Failed\",\n          description: result.error.message,\n          variant: \"destructive\",\n        });\n        setIsProcessing(false);\n      }\n    } catch (err: any) {\n      toast({\n        title: \"Payment Error\",\n        description: err.message || \"An unexpected error occurred\",\n        variant: \"destructive\",\n      });\n      setIsProcessing(false);\n    }\n  };\n\n  const isButtonDisabled = !stripe || !isElementReady || isProcessing;\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div className=\"bg-muted/30 rounded-lg p-4 mb-6\">\n        <p className=\"text-sm text-muted-foreground\">\n          You're subscribing to <span className=\"font-semibold text-foreground\">{planName}</span>\n        </p>\n      </div>\n      \n      <div className=\"min-h-[200px]\">\n        <PaymentElement \n          onReady={() => setIsElementReady(true)}\n          onLoadError={(error) => {\n            console.error('PaymentElement load error:', error);\n            toast({\n              title: \"Payment Form Error\",\n              description: \"Failed to load payment form. Please refresh the page.\",\n              variant: \"destructive\",\n            });\n          }}\n        />\n        {!isElementReady && (\n          <div className=\"flex items-center justify-center py-8\">\n            <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n            <span className=\"ml-2 text-sm text-muted-foreground\">Loading payment form...</span>\n          </div>\n        )}\n      </div>\n      \n      <Button \n        type=\"submit\" \n        disabled={isButtonDisabled}\n        className=\"w-full h-12 text-lg\"\n        data-testid=\"button-confirm-subscription\"\n      >\n        {isProcessing ? (\n          <>\n            <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n            Processing...\n          </>\n        ) : !isElementReady ? (\n          <>\n            <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n            Loading...\n          </>\n        ) : (\n          'Confirm Subscription'\n        )}\n      </Button>\n\n      <p className=\"text-xs text-center text-muted-foreground\">\n        Your subscription will renew automatically. Cancel anytime from your account settings.\n      </p>\n    </form>\n  );\n};\n\nexport default function Subscribe() {\n  const [match, params] = useRoute('/subscribe/:plan');\n  const [, navigate] = useLocation();\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isSetupMode, setIsSetupMode] = useState(false);\n\n  const planName = params?.plan || 'Professional';\n\n  // Check if Stripe is configured\n  if (!stripePromise) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-6\">\n        <Card className=\"max-w-md w-full\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-amber-600\">\n              <AlertCircle className=\"h-5 w-5\" />\n              Payment System Not Configured\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-muted-foreground\">\n              The payment system is currently being set up. Please check back soon or contact support for assistance.\n            </p>\n            <Button \n              variant=\"outline\" \n              onClick={() => navigate('/')}\n              className=\"w-full\"\n            >\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              Back to Home\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  useEffect(() => {\n    // Create subscription as soon as the page loads\n    apiRequest('/api/create-subscription', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ plan: planName })\n    })\n      .then((data) => {\n        setClientSecret(data.clientSecret);\n        setIsSetupMode(data.setupMode || false);\n        setIsLoading(false);\n      })\n      .catch((err) => {\n        setError(err.message || 'Failed to initialize payment');\n        setIsLoading(false);\n      });\n  }, [planName]);\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-6\">\n        <Card className=\"max-w-md w-full\">\n          <CardHeader>\n            <CardTitle className=\"text-destructive\">Payment Error</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-muted-foreground\">{error}</p>\n            <Button \n              variant=\"outline\" \n              onClick={() => navigate('/')}\n              className=\"w-full\"\n            >\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              Back to Home\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isLoading || !clientSecret) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <Loader2 className=\"h-12 w-12 animate-spin mx-auto text-primary\" />\n          <p className=\"text-muted-foreground\">Setting up your subscription...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background py-12 px-6\">\n      <SEO\n        title={`Subscribe to ${planName} Plan`}\n        description={`Subscribe to WinnStorm™ ${planName} plan. Get access to AI-powered thermal analysis, Winn Reports, certification training, and comprehensive damage assessment tools.`}\n        canonical={`/subscribe/${planName.toLowerCase()}`}\n        noindex={true}\n      />\n      <div className=\"container max-w-2xl mx-auto\">\n        <div className=\"mb-8\">\n          <Button \n            variant=\"ghost\" \n            onClick={() => navigate('/#pricing')}\n            className=\"mb-4\"\n          >\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\n            Back to Pricing\n          </Button>\n          <h1 className=\"text-3xl font-bold text-foreground mb-2\">Complete Your Subscription</h1>\n          <p className=\"text-muted-foreground\">Enter your payment details to get started with WinnStorm</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <CheckCircle className=\"h-5 w-5 text-primary\" />\n              Secure Payment\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Elements stripe={stripePromise} options={{ clientSecret }}>\n              <SubscribeForm planName={planName} isSetupMode={isSetupMode} />\n            </Elements>\n          </CardContent>\n        </Card>\n\n        <div className=\"mt-6 text-center text-sm text-muted-foreground\">\n          <p>🔒 Secured by Stripe • Your payment information is encrypted and secure</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9122,"size_tokens":null},"server/auth.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { initializeApp, cert, getApps, App } from 'firebase-admin/app';\nimport { getAuth, DecodedIdToken } from 'firebase-admin/auth';\nimport { storage } from './storage';\n\nlet firebaseAdminApp: App | null = null;\n\nfunction initializeFirebaseAdmin(): App | null {\n  if (getApps().length > 0) {\n    return getApps()[0];\n  }\n\n  const projectId = process.env.VITE_FIREBASE_PROJECT_ID;\n  \n  if (!projectId) {\n    console.warn('Firebase Admin: Missing VITE_FIREBASE_PROJECT_ID - authentication will be disabled');\n    return null;\n  }\n\n  try {\n    const app = initializeApp({\n      projectId: projectId,\n    });\n    console.log('Firebase Admin SDK initialized successfully');\n    return app;\n  } catch (error) {\n    console.error('Failed to initialize Firebase Admin:', error);\n    return null;\n  }\n}\n\nfirebaseAdminApp = initializeFirebaseAdmin();\n\nexport interface AuthenticatedUser {\n  uid: string;\n  email: string | undefined;\n  name?: string;\n  picture?: string;\n  dbUserId?: number;\n}\n\nexport interface AuthenticatedRequest extends Request {\n  user?: AuthenticatedUser;\n}\n\nexport async function verifyFirebaseToken(idToken: string): Promise<DecodedIdToken | null> {\n  if (!firebaseAdminApp) {\n    console.warn('Firebase Admin not initialized - cannot verify token');\n    return null;\n  }\n\n  try {\n    const decodedToken = await getAuth().verifyIdToken(idToken);\n    return decodedToken;\n  } catch (error: any) {\n    if (error.code === 'auth/id-token-expired') {\n      console.warn('Firebase token expired');\n    } else if (error.code === 'auth/argument-error') {\n      console.warn('Invalid Firebase token format');\n    } else {\n      console.error('Firebase token verification failed:', error.message);\n    }\n    return null;\n  }\n}\n\nexport async function getOrCreateDbUser(firebaseUser: DecodedIdToken): Promise<number | null> {\n  const email = firebaseUser.email;\n  if (!email) {\n    console.warn('Firebase user has no email');\n    return null;\n  }\n\n  let dbUser = await storage.getUserByEmail(email);\n  \n  if (!dbUser) {\n    try {\n      dbUser = await storage.createUser({\n        email: email,\n        firstName: firebaseUser.name?.split(' ')[0] || '',\n        lastName: firebaseUser.name?.split(' ').slice(1).join(' ') || '',\n        role: 'junior_consultant',\n        certificationLevel: 'none',\n      });\n      console.log(`Created new user in database for ${email}`);\n    } catch (error) {\n      console.error('Failed to create user in database:', error);\n      return null;\n    }\n  }\n\n  return dbUser.id;\n}\n\nexport function requireAuth(req: AuthenticatedRequest, res: Response, next: NextFunction): void {\n  const authHeader = req.headers.authorization;\n  \n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    res.status(401).json({ message: 'Authentication required. Please sign in.' });\n    return;\n  }\n\n  const idToken = authHeader.substring(7);\n\n  verifyFirebaseToken(idToken)\n    .then(async (decodedToken) => {\n      if (!decodedToken) {\n        res.status(401).json({ message: 'Invalid or expired authentication token. Please sign in again.' });\n        return;\n      }\n\n      const dbUserId = await getOrCreateDbUser(decodedToken);\n\n      req.user = {\n        uid: decodedToken.uid,\n        email: decodedToken.email,\n        name: decodedToken.name,\n        picture: decodedToken.picture,\n        dbUserId: dbUserId || undefined,\n      };\n\n      next();\n    })\n    .catch((error) => {\n      console.error('Auth middleware error:', error);\n      res.status(500).json({ message: 'Authentication error' });\n    });\n}\n\nexport function optionalAuth(req: AuthenticatedRequest, res: Response, next: NextFunction): void {\n  const authHeader = req.headers.authorization;\n  \n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    next();\n    return;\n  }\n\n  const idToken = authHeader.substring(7);\n\n  verifyFirebaseToken(idToken)\n    .then(async (decodedToken) => {\n      if (decodedToken) {\n        const dbUserId = await getOrCreateDbUser(decodedToken);\n        req.user = {\n          uid: decodedToken.uid,\n          email: decodedToken.email,\n          name: decodedToken.name,\n          picture: decodedToken.picture,\n          dbUserId: dbUserId || undefined,\n        };\n      }\n      next();\n    })\n    .catch((error) => {\n      console.error('Optional auth middleware error:', error);\n      next();\n    });\n}\n\nexport function unauthorizedResponse(res: Response) {\n  return res.status(401).json({ message: 'Unauthorized' });\n}\n","path":null,"size_bytes":4517,"size_tokens":null},"client/src/components/error-boundary.tsx":{"content":"import React, { ReactNode, Component, ErrorInfo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { AlertTriangle, RefreshCw } from 'lucide-react';\n\ninterface ErrorBoundaryProps {\n  children: ReactNode;\n  fallback?: ReactNode;\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n}\n\nexport class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n    };\n  }\n\n  static getDerivedStateFromError(error: Error) {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    this.setState({\n      error,\n      errorInfo,\n    });\n\n    if (this.props.onError) {\n      this.props.onError(error, errorInfo);\n    }\n  }\n\n  resetError = () => {\n    this.setState({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n    });\n  };\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        this.props.fallback || (\n          <div className=\"min-h-screen bg-background flex items-center justify-center p-6\">\n            <Card className=\"max-w-md w-full border-destructive\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-destructive\">\n                  <AlertTriangle className=\"h-5 w-5\" />\n                  Something Went Wrong\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"bg-destructive/5 rounded-lg p-4 text-sm\">\n                  <p className=\"font-mono text-xs text-destructive/70 break-words\">\n                    {this.state.error?.message}\n                  </p>\n                </div>\n                <p className=\"text-sm text-muted-foreground\">\n                  An unexpected error occurred. Try refreshing the page or contact support if the problem persists.\n                </p>\n                <Button\n                  onClick={this.resetError}\n                  className=\"w-full\"\n                  variant=\"outline\"\n                >\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\n                  Try Again\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        )\n      );\n    }\n\n    return this.props.children;\n  }\n}\n","path":null,"size_bytes":2565,"size_tokens":null},"client/src/components/user-onboarding.tsx":{"content":"import { useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { CloudUpload, GraduationCap, FileText, CheckCircle, ChevronRight } from 'lucide-react';\n\ninterface OnboardingProps {\n  isOpen: boolean;\n  onComplete: () => void;\n  userEmail: string;\n}\n\nconst ONBOARDING_STEPS = [\n  {\n    title: 'Welcome to WinnStorm™',\n    description: 'Your professional damage assessment platform using the proven Winn Methodology.',\n    icon: CheckCircle,\n    color: 'text-primary',\n  },\n  {\n    title: 'Upload Your First Scan',\n    description: 'Start by uploading thermal imagery of a property for comprehensive analysis.',\n    icon: CloudUpload,\n    color: 'text-cyan-500',\n    action: {\n      label: 'Upload Scan',\n      path: '/upload',\n    },\n  },\n  {\n    title: 'Get Certified',\n    description: 'Access our training portal to earn your WinnStorm™ certification and advance your career.',\n    icon: GraduationCap,\n    color: 'text-blue-500',\n    action: {\n      label: 'Start Training',\n      path: '/training',\n    },\n  },\n  {\n    title: 'Generate Winn Reports',\n    description: 'Create comprehensive damage assessment reports trusted by insurance professionals.',\n    icon: FileText,\n    color: 'text-primary',\n  },\n];\n\nexport function UserOnboarding({ isOpen, onComplete, userEmail }: OnboardingProps) {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [, navigate] = useLocation();\n  \n  const currentStepData = ONBOARDING_STEPS[currentStep];\n  const isLastStep = currentStep === ONBOARDING_STEPS.length - 1;\n\n  const handleNext = () => {\n    if (isLastStep) {\n      onComplete();\n    } else {\n      setCurrentStep(currentStep + 1);\n    }\n  };\n\n  const handleSkip = () => {\n    onComplete();\n  };\n\n  const handleActionClick = (path: string) => {\n    onComplete();\n    navigate(path);\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={() => {}}>\n      <DialogContent className=\"max-w-2xl\" onPointerDownOutside={(e) => e.preventDefault()}>\n        <DialogHeader>\n          <div className=\"flex items-center justify-center mb-4\">\n            <img src=\"/winnstorm-logo.png\" alt=\"WinnStorm\" className=\"h-16\" />\n          </div>\n          <DialogTitle className=\"text-center text-2xl\">\n            {currentStepData.title}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"py-6\">\n          {/* Progress indicator */}\n          <div className=\"flex justify-center gap-2 mb-8\">\n            {ONBOARDING_STEPS.map((_, index) => (\n              <div\n                key={index}\n                className={`h-2 rounded-full transition-all ${\n                  index === currentStep\n                    ? 'w-8 bg-primary'\n                    : index < currentStep\n                    ? 'w-2 bg-primary/50'\n                    : 'w-2 bg-muted'\n                }`}\n              />\n            ))}\n          </div>\n\n          {/* Content */}\n          <div className=\"text-center mb-8\">\n            <div className=\"flex justify-center mb-6\">\n              <div className={`p-6 rounded-full bg-gradient-to-br from-primary/10 to-cyan-500/10`}>\n                <currentStepData.icon className={`h-16 w-16 ${currentStepData.color}`} />\n              </div>\n            </div>\n            <p className=\"text-lg text-muted-foreground max-w-md mx-auto\">\n              {currentStepData.description}\n            </p>\n          </div>\n\n          {/* Quick start cards */}\n          {currentStep === 0 && (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-8\">\n              <Card \n                className=\"cursor-pointer hover:border-primary transition-colors\"\n                onClick={() => handleActionClick('/upload')}\n                data-testid=\"onboarding-upload-card\"\n              >\n                <CardContent className=\"p-6 text-center\">\n                  <CloudUpload className=\"h-10 w-10 text-cyan-500 mx-auto mb-3\" />\n                  <h3 className=\"font-semibold mb-2\">Upload First Scan</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Start analyzing thermal imagery\n                  </p>\n                </CardContent>\n              </Card>\n              \n              <Card \n                className=\"cursor-pointer hover:border-primary transition-colors\"\n                onClick={() => handleActionClick('/training')}\n                data-testid=\"onboarding-training-card\"\n              >\n                <CardContent className=\"p-6 text-center\">\n                  <GraduationCap className=\"h-10 w-10 text-blue-500 mx-auto mb-3\" />\n                  <h3 className=\"font-semibold mb-2\">Start Training</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Get certified in the Winn Methodology\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n\n          {/* Action button for specific steps */}\n          {currentStep > 0 && currentStepData.action && (\n            <div className=\"flex justify-center mt-6\">\n              <Button\n                onClick={() => handleActionClick(currentStepData.action!.path)}\n                className=\"gap-2\"\n                size=\"lg\"\n                data-testid={`onboarding-action-${currentStep}`}\n              >\n                {currentStepData.action.label}\n                <ChevronRight className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          )}\n        </div>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between items-center pt-4 border-t\">\n          <Button\n            variant=\"ghost\"\n            onClick={handleSkip}\n            data-testid=\"onboarding-skip\"\n          >\n            Skip Tutorial\n          </Button>\n          \n          <div className=\"flex gap-2\">\n            {currentStep > 0 && (\n              <Button\n                variant=\"outline\"\n                onClick={() => setCurrentStep(currentStep - 1)}\n                data-testid=\"onboarding-back\"\n              >\n                Back\n              </Button>\n            )}\n            <Button\n              onClick={handleNext}\n              data-testid=\"onboarding-next\"\n            >\n              {isLastStep ? \"Get Started\" : \"Next\"}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":6498,"size_tokens":null},"server/db.ts":{"content":"// PostgreSQL database connection using Drizzle ORM\n// Reference: blueprint:javascript_database\n\nimport { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":580,"size_tokens":null},"server/seed-training.ts":{"content":"import { storage } from './storage';\nimport { db } from './db';\nimport { trainingCourses, trainingQuizzes } from '@shared/schema';\n\nexport async function seedTrainingCourse() {\n  console.log('📚 Creating \"Hail Damage Identification 101\" training course...\\n');\n\n  try {\n    // Create the training course\n    const [course] = await db.insert(trainingCourses).values({\n      title: 'Hail Damage Identification 101',\n      description: 'Master the fundamentals of identifying hail damage on roofing systems using Eric Winn\\'s proven methodology. Learn to distinguish hail impacts from mechanical damage, understand thermal signatures, and document findings for insurance claims.',\n      day: 'day1',\n      subject: 'inspections',\n      contentType: 'text',\n      contentUrl: null,\n      duration: 45,\n      requiredForCertification: true,\n      certificationLevel: 'junior',\n      orderIndex: 1,\n    }).returning();\n\n    console.log(`✅ Created course: ${course.title} (ID: ${course.id})`);\n\n    // Create the quiz for this course\n    const [quiz] = await db.insert(trainingQuizzes).values({\n      courseId: course.id,\n      title: 'Hail Damage Identification Assessment',\n      description: 'Test your knowledge of hail damage identification, thermal imaging interpretation, and Eric Winn methodology best practices.',\n      passingScore: 85,\n      timeLimit: 30,\n      maxAttempts: 3,\n      questions: [\n        {\n          id: 1,\n          question: 'What is the MINIMUM hail size that typically causes functional damage to architectural shingles?',\n          type: 'multiple_choice',\n          options: [\n            '0.75 inches',\n            '1.0 inch',\n            '1.25 inches',\n            '1.5 inches'\n          ],\n          correctAnswer: 1,\n          explanation: 'According to the Winn Methodology, hail stones of 1.0 inch diameter or larger typically cause measurable functional damage to architectural shingles. Smaller hail may cause cosmetic damage but rarely compromises the shingle\\'s protective function.',\n          points: 10\n        },\n        {\n          id: 2,\n          question: 'When viewing thermal imagery, what do BLUE/COOL spots typically indicate?',\n          type: 'multiple_choice',\n          options: [\n            'Insulation gaps or thermal bridging',\n            'Water infiltration and moisture saturation',\n            'Recent hail impact locations',\n            'Normal roof surface temperature'\n          ],\n          correctAnswer: 1,\n          explanation: 'Blue or cool areas in thermal imaging indicate water infiltration, moisture saturation, or compromised insulation. Water has a higher thermal mass than dry materials and appears cooler in thermal scans.',\n          points: 10\n        },\n        {\n          id: 3,\n          question: 'What is the primary purpose of documenting soft metal damage during an inspection?',\n          type: 'multiple_choice',\n          options: [\n            'To estimate repair costs for metal components',\n            'To provide irrefutable evidence of recent storm impact',\n            'To identify areas requiring immediate repair',\n            'To demonstrate the age of the roof system'\n          ],\n          correctAnswer: 1,\n          explanation: 'Soft metal damage is critical because dents in metal vents, flashings, and gutters cannot be disputed as \"pre-existing.\" Fresh dents provide irrefutable evidence that a recent storm event occurred with sufficient force to damage the roof system.',\n          points: 10\n        },\n        {\n          id: 4,\n          question: 'According to Eric Winn, what distinguishes hail damage from mechanical damage?',\n          type: 'multiple_choice',\n          options: [\n            'Hail damage shows linear patterns while mechanical damage is random',\n            'Hail damage is random while mechanical damage shows concentrated patterns',\n            'Hail damage only occurs on horizontal surfaces',\n            'Mechanical damage always shows oxidation'\n          ],\n          correctAnswer: 1,\n          explanation: 'Hail damage exhibits random distribution patterns (nature is chaotic) while mechanical damage typically shows linear patterns from foot traffic, concentrated damage near accessible areas, or damage only on horizontal surfaces.',\n          points: 15\n        },\n        {\n          id: 5,\n          question: 'What is a \"test square\" in the Winn Methodology?',\n          type: 'multiple_choice',\n          options: [\n            'A 5\\'x5\\' section used to estimate total roof area',\n            'A 10\\'x10\\' (100 sq ft) section where every damage point is documented',\n            'A sample removed from the roof for laboratory testing',\n            'A measurement tool for calculating roof slope'\n          ],\n          correctAnswer: 1,\n          explanation: 'A test square is a measured 10\\'x10\\' (100 square foot) section of roof where you document every piece of damage. This statistical sampling allows you to extrapolate total damage across the entire roof system.',\n          points: 10\n        },\n        {\n          id: 6,\n          question: 'When should you take core samples during an inspection?',\n          type: 'multiple_choice',\n          options: [\n            'On every inspection as standard practice',\n            'Only when other evidence is insufficient or substrate damage is suspected',\n            'Only on roofs newer than 5 years old',\n            'Whenever thermal imaging shows any temperature anomalies'\n          ],\n          correctAnswer: 1,\n          explanation: 'Core samples are DESTRUCTIVE testing and should be used strategically, not routinely. They are warranted when moisture readings exceed 20%, substrate damage is suspected, large claims require forensic evidence, or when other evidence is insufficient.',\n          points: 15\n        },\n        {\n          id: 7,\n          question: 'What best describes the relationship between thermal imaging and damage assessment?',\n          type: 'multiple_choice',\n          options: [\n            'Thermal anomalies ARE the damage and prove the claim',\n            'Thermal anomalies indicate areas requiring terrestrial inspection',\n            'Thermal imaging replaces the need for physical roof inspection',\n            'Thermal imaging is only useful for energy audits'\n          ],\n          correctAnswer: 1,\n          explanation: 'Thermal anomalies are NOT the damage itself - they are INDICATORS guiding you to areas requiring terrestrial inspection. Always explain to clients that thermal imaging reveals where to look, but physical inspection confirms the actual damage.',\n          points: 15\n        },\n        {\n          id: 8,\n          question: 'Why is weather verification the \"foundation\" of every damage assessment report?',\n          type: 'multiple_choice',\n          options: [\n            'It\\'s required by all insurance companies',\n            'It provides scientific proof that damaging conditions occurred',\n            'It helps estimate repair costs',\n            'It determines the property owner\\'s deductible'\n          ],\n          correctAnswer: 1,\n          explanation: 'Weather verification using OFFICIAL sources (NOAA, NWS) provides scientific proof that a storm event with sufficient severity occurred at the property location. Without verified weather data, insurance adjusters will reject the claim regardless of visible damage.',\n          points: 15\n        }\n      ]\n    }).returning();\n\n    console.log(`✅ Created quiz: ${quiz.title} (ID: ${quiz.id})`);\n    console.log(`   - ${quiz.questions.length} questions`);\n    console.log(`   - ${quiz.timeLimit} minute time limit`);\n    console.log(`   - ${quiz.passingScore}% passing score\\n`);\n\n    console.log('🎉 Training course successfully created!');\n    console.log('📖 Available in WinnStorm Training Portal for junior consultant certification\\n');\n\n  } catch (error) {\n    console.error('❌ Error creating training course:', error);\n    throw error;\n  }\n}\n\n// Auto-run when executed directly\nseedTrainingCourse()\n  .then(() => {\n    console.log('✅ Training seeding complete!');\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('❌ Training seeding failed:', error);\n    process.exit(1);\n  });\n","path":null,"size_bytes":8272,"size_tokens":null},"server/seed-demo-data.ts":{"content":"import { storage } from './storage';\nimport { db } from './db';\nimport { users } from '@shared/schema';\n\nexport async function seedDemoData() {\n  console.log('🎯 Creating realistic Kansas City inspection demo data...\\n');\n\n  try {\n    // 1. Create demo user (consultant)\n    console.log('👤 Creating demo user...');\n    const demoUser = await storage.createUser({\n      email: 'demo@example.com',\n      password: 'demo',\n      firstName: 'Sarah',\n      lastName: 'Martinez',\n      role: 'junior_consultant',\n      certificationLevel: 'junior',\n      phone: '816-555-0199',\n      inspectionHours: 42,\n      approvedDARs: 3,\n    });\n    console.log(`✅ Created user: ${demoUser.firstName} ${demoUser.lastName} (ID: ${demoUser.id})\\n`);\n\n    // 2. Create Kansas City property\n    console.log('🏠 Creating Kansas City property...');\n    const property = await storage.createProperty({\n      name: 'Johnson Residence - 4726 Main Street',\n      address: '4726 Main Street, Kansas City, MO 64112',\n      userId: demoUser.id,\n      imageUrl: '',\n      overallCondition: 'fair',\n      buildingInfo: {\n        address: '4726 Main Street, Kansas City, MO 64112',\n        propertyType: 'residential' as const,\n        yearBuilt: 1998,\n        squareFootage: 2850,\n        stories: 2,\n        occupancy: 'Single Family',\n        ownerName: 'Michael & Jennifer Johnson',\n        ownerContact: '816-555-0142',\n        roofSections: [{\n          number: 1,\n          area: 1650,\n          slope: '6/12',\n          material: 'Architectural Shingles - GAF Timberline HDZ',\n          color: 'Charcoal',\n          ageYears: 9,\n          orientation: 'South-facing',\n          notes: 'Primary roof section - showed significant hail impact damage'\n        }]\n      },\n      roofSystemDetails: {\n        material: 'Architectural Shingles',\n        manufacturer: 'GAF',\n        model: 'Timberline HDZ',\n        color: 'Charcoal',\n        installDate: '2016-08-15',\n        warranty: '25-year limited manufacturer warranty',\n        underlayment: 'Synthetic - DeckArmor',\n        ventilation: 'Ridge vent + soffit vents',\n        drainage: 'Standard 5\" K-style gutters',\n        flashings: 'Step flashing at chimney, valley flashing at dormers',\n        estimatedLifespan: 30,\n        condition: 'Functional damage from hail impact - widespread impact marks documented'\n      }\n    });\n    console.log(`✅ Created property: ${property.name} (ID: ${property.id})\\n`);\n\n    // 3. Create thermal scan with realistic damage data\n    console.log('🌡️ Creating thermal scan with damage findings...');\n    const scan = await storage.createScan({\n      propertyId: property.id,\n      userId: demoUser.id,\n      date: new Date('2025-11-10T14:30:00'),\n      scanType: 'drone',\n      deviceType: 'DJI Mavic 3T Thermal',\n      standardImageUrl: '/demo/kc-standard-roof.jpg',\n      thermalImageUrl: '/demo/kc-thermal-roof.jpg',\n      healthScore: 52,\n      notes: 'Thermal scan conducted 14 days post-storm. Multiple temperature anomalies detected indicating moisture intrusion at hail impact points. Cool spots correlate with visible shingle damage observed during terrestrial walk.',\n      metrics: [\n        {\n          label: 'Surface Temperature Range',\n          value: '68°F - 94°F',\n          unit: '',\n          severity: 'info',\n          description: 'Temperature differential indicates potential moisture infiltration'\n        },\n        {\n          label: 'Moisture Anomalies Detected',\n          value: '23',\n          unit: 'locations',\n          severity: 'warning',\n          description: 'Cool spots indicating water penetration through damaged shingles'\n        },\n        {\n          label: 'Thermal Coverage',\n          value: '98',\n          unit: '%',\n          severity: 'info',\n          description: 'Comprehensive thermal imaging of all roof planes completed'\n        }\n      ],\n      issues: [\n        {\n          title: 'Northwest Quadrant Moisture Pattern',\n          description: 'Cluster of 8 cool spots (65-72°F) in northwest roof section indicates water penetration through hail-damaged shingles. Pattern consistent with impact damage allowing moisture intrusion.',\n          severity: 'high',\n          location: 'Northwest roof section, approximately 15ft from ridge',\n          recommendation: 'Correlate with terrestrial walk findings. Document test square in this area to quantify impact density.'\n        },\n        {\n          title: 'South-facing Slope Temperature Differential',\n          description: 'Scattered cool anomalies across south slope correlate with visible hail impact locations. Temperature differential of 15-22°F compared to adjacent undamaged areas.',\n          severity: 'medium',\n          location: 'South-facing primary roof slope',\n          recommendation: 'Multiple test squares recommended to establish damage density for insurance claim'\n        }\n      ]\n    });\n    console.log(`✅ Created thermal scan (ID: ${scan.id})\\n`);\n\n    console.log('📊 Demo data summary:');\n    console.log('  Property: 4726 Main Street, Kansas City, MO');\n    console.log('  Storm Date: October 27, 2025');\n    console.log('  Hail Size: 1.75\" - 2.0\" reported by NWS');\n    console.log('  Consultant: Sarah Martinez (Junior)');\n    console.log('  Thermal Scan: 23 moisture anomalies detected');\n    console.log('  Status: Ready for terrestrial walk and test squares\\n');\n\n    console.log('🎉 Demo data seeding complete!');\n    console.log('💡 Login with demo@example.com to see the Kansas City inspection\\n');\n\n  } catch (error) {\n    console.error('❌ Error seeding demo data:', error);\n    throw error;\n  }\n}\n\n// Auto-run when executed directly\nseedDemoData()\n  .then(() => {\n    console.log('✅ All demo data created successfully!');\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('❌ Demo seeding failed:', error);\n    process.exit(1);\n  });\n","path":null,"size_bytes":5901,"size_tokens":null},"server/seed-knowledge.ts":{"content":"import { storage } from './storage';\nimport { db } from './db';\n\nexport async function seedKnowledgeBase() {\n  console.log('🌱 Seeding Eric Winn Methodology Knowledge Base...');\n\n  const knowledgeEntries = [\n    {\n      category: 'procedure',\n      title: 'Weather Verification - Initial Storm Analysis',\n      content: `ERIC WINN METHODOLOGY: Weather verification is the foundation of every damage assessment report.\n\nSTEP-BY-STEP PROCESS:\n1. **Obtain Event Date** - Get exact date of loss from property owner\n2. **Verify NOAA Records** - Cross-reference with official meteorological data\n3. **Check Hail Size** - Document maximum reported hail diameter (critical for damage correlation)\n4. **Wind Speed Analysis** - Record peak wind gusts and sustained winds\n5. **Storm Path** - Map the storm trajectory over the property location\n\nWHY IT MATTERS:\nWithout verified weather data, insurance adjusters will reject the claim. You're building an evidence-based case that shows the storm event had sufficient severity to cause the documented damage.\n\nCRITICAL POINTS:\n- Use OFFICIAL sources only (NOAA, NWS, local airports)\n- Document the exact time window when damaging conditions occurred\n- Save PDF copies of all meteorological reports\n- If hail size < 1 inch, damage claims become difficult to substantiate\n\nCOMMON MISTAKES TO AVOID:\n❌ Relying on property owner's memory alone\n❌ Using unverified social media weather reports\n❌ Ignoring the storm's path relative to property location\n❌ Failing to document the data source and retrieval date`,\n      tags: ['weather', 'verification', 'NOAA', 'storm', 'hail'],\n      workflowStep: 'weather',\n      difficulty: 'beginner',\n    },\n    {\n      category: 'procedure',\n      title: 'Thermal Imaging - Reading Heat Signatures',\n      content: `ERIC WINN METHODOLOGY: Thermal imaging reveals what the eye cannot see - moisture intrusion and structural anomalies.\n\nSTEP-BY-STEP PROCESS:\n1. **Capture Wide-Angle Shots** - Start with full roof sections for context\n2. **Identify Temperature Differentials** - Look for cooler spots (potential moisture)\n3. **Document Hot Spots** - Areas warmer than surroundings may indicate insulation gaps\n4. **Cross-Reference with Visual** - Every thermal anomaly needs a standard photo\n5. **Record Exact Temperatures** - Use your thermal camera's measurement tools\n\nINTERPRETING THERMAL PATTERNS:\n🔵 **BLUE/COOL AREAS**: Water infiltration, moisture saturation, compromised insulation\n🔴 **RED/HOT AREAS**: Insulation voids, thermal bridging, structural gaps\n⚪ **UNIFORM TEMPERATURE**: Healthy roof system with proper insulation\n\nWHY IT MATTERS:\nThermal imaging provides SCIENTIFIC EVIDENCE of hidden damage. Adjusters cannot dispute temperature differentials captured on calibrated equipment.\n\nHAIL DAMAGE THERMAL SIGNATURES:\n- Fractured shingles allow water penetration → cool spots\n- Compressed insulation from impact → temperature anomalies\n- Multiple impact points create scattered cool patterns\n\nBEST PRACTICES:\n✅ Shoot early morning or late evening (max temperature differential)\n✅ Avoid direct sunlight hours (false hot spots)\n✅ Calibrate camera to local conditions\n✅ Document ambient temperature and weather conditions\n\nCRITICAL: Always explain to clients that thermal anomalies are NOT the damage itself - they're indicators guiding us to areas requiring terrestrial inspection.`,\n      tags: ['thermal', 'imaging', 'moisture', 'temperature', 'infrared'],\n      workflowStep: 'thermal',\n      difficulty: 'intermediate',\n    },\n    {\n      category: 'decision_tree',\n      title: 'When to Take Core Samples - Decision Framework',\n      content: `ERIC WINN METHODOLOGY: Core samples are DESTRUCTIVE testing - use them strategically, not routinely.\n\nDECISION TREE:\n\n🔍 **DO YOU SEE VISIBLE HAIL DAMAGE ON SHINGLES?**\n├── YES → Proceed with test squares first\n└── NO → Continue assessment\n\n🔍 **DO THERMAL IMAGES SHOW MOISTURE INTRUSION?**\n├── YES → Core sample warranted to prove extent of water damage\n└── NO → Document and continue\n\n🔍 **IS THE CLIENT DISPUTING VISIBLE DAMAGE FINDINGS?**\n├── YES → Core sample provides irrefutable evidence\n└── NO → Test squares may be sufficient\n\n🔍 **DOES INSURANCE ADJUSTER DEMAND PROOF OF SUBSTRATE DAMAGE?**\n├── YES → Core sample required for claims over $50K\n└── NO → Proceed with standard documentation\n\nWHEN CORE SAMPLING IS MANDATORY:\n✅ Moisture readings >20% on moisture meter\n✅ Suspected deck deterioration not visible from attic\n✅ Large claims requiring forensic-level evidence\n✅ Disputes over whether damage extends beyond shingles\n\nWHEN TO AVOID CORE SAMPLES:\n❌ First day of inspection (gather other evidence first)\n❌ Without property owner's written consent\n❌ When test squares already prove functional damage\n❌ On brand new roofs (< 2 years old) without clear cause\n\nPROPER CORE SAMPLING PROCEDURE:\n1. Document exact location with GPS and photos\n2. Use 3-4 inch hole saw for clean extraction\n3. Photograph each layer: shingles → underlayment → deck\n4. Bag and label sample with property ID and date\n5. Immediately seal hole with professional patch\n\nPRO TIP: Core samples are your \"ace in the hole\" - use them when other evidence might not be enough, not as your primary inspection tool.`,\n      tags: ['core-sample', 'decision-tree', 'testing', 'evidence'],\n      workflowStep: 'core-samples',\n      difficulty: 'expert',\n    },\n    {\n      category: 'terminology',\n      title: 'Test Square vs. Test Strip - Key Differences',\n      content: `ERIC WINN TERMINOLOGY GUIDE:\n\n**TEST SQUARE**\nDefinition: A measured 10'x10' (100 sq ft) section of roof where you document every piece of damage\nPurpose: Statistical sampling to extrapolate total damage across entire roof\nMethod: Mark with chalk or tape, count every hail hit, measure every bruise\nEvidence: Photos from multiple angles, diagram showing impact locations\nInsurance Standard: Most carriers require minimum 3 test squares per roof slope\n\n**TEST STRIP** \nDefinition: A 3-foot wide strip running from ridge to eave\nPurpose: Verify damage consistency from top to bottom of roof plane\nMethod: Document damage pattern variation by elevation\nEvidence: Continuous photo series showing damage gradient\nWhen Used: Slopes with suspected differential damage\n\nCRITICAL DIFFERENCES:\n📐 Size: Square = 100 sq ft | Strip = varies by slope length\n🎯 Purpose: Square = quantify density | Strip = prove consistency  \n📊 Math: Squares calculate damage per 100 sq ft | Strips show distribution\n🔢 Required: Squares = usually 3+ | Strips = 1-2 per assessment\n\nWINN METHODOLOGY BEST PRACTICE:\nAlways start with test squares. Only add test strips if adjuster questions whether damage is consistent across the entire roof plane.\n\nCOMMON MISCONCEPTION:\n\"More test squares = stronger case\" ❌\nREALITY: Properly documented test squares in representative areas are far more convincing than sloppy coverage of the entire roof.`,\n      tags: ['test-square', 'test-strip', 'terminology', 'methodology'],\n      workflowStep: 'test-squares',\n      difficulty: 'beginner',\n    },\n    {\n      category: 'best_practice',\n      title: 'Soft Metals Inspection - The Smoking Gun',\n      content: `ERIC WINN BEST PRACTICE: Soft metals are often the EASIEST damage to prove, yet beginners frequently overlook them.\n\nWHAT QUALIFIES AS SOFT METALS:\n🔧 Roof vents (turtle vents, ridge vents, gable vents)\n🔧 Plumbing stacks and boot flashings\n🔧 HVAC penetrations and caps\n🔧 Gutters and downspouts\n🔧 Drip edge and flashing\n🔧 Satellite dishes and antenna mounts\n🔧 Skylights (metal frames)\n\nWHY SOFT METALS MATTER:\n1. **Irrefutable Evidence** - Dents in metal cannot be disputed as \"pre-existing\"\n2. **Corroborates Hail Size** - Dent diameter correlates to hail stone size\n3. **Proves Storm Event** - Fresh dents support recent damage claim\n4. **Easy to Photograph** - Visible damage that even non-experts can see\n\nINSPECTION TECHNIQUE:\n📸 **Photograph from Multiple Angles**\n- Direct overhead shot\n- Raking light angle (shows dent depth)\n- Measurement with quarter or scale ruler\n- Wide shot showing location on roof\n\n📏 **Measure and Document**\n- Dent diameter (correlates to hail size)\n- Dent depth (indicates impact force)\n- Number of impacts per vent\n- Pattern of damage (random = hail, linear = mechanical)\n\n🎯 **Strategic Importance**\nSoft metal damage is often the FIRST thing insurance adjusters look for. If you document 15 dents on a single roof vent, it proves:\n✅ Recent weather event occurred\n✅ Hail stones were large enough to dent metal\n✅ Impact force was significant\n✅ Multiple strikes per area (supports widespread roof damage claim)\n\nPHOTO COMPOSITION TIP:\nPlace a quarter next to each dent. Insurance adjusters see hundreds of claims - make yours crystal clear. The quarter provides instant scale reference and looks professional.\n\nCRITICAL REMINDER:\nDocument soft metal damage EVEN IF the shingles look perfect. Sometimes hail causes functional damage to metal components while leaving cosmetic damage less obvious on shingles. This is still a valid claim.`,\n      tags: ['soft-metals', 'inspection', 'evidence', 'hail-damage'],\n      workflowStep: 'soft-metals',\n      difficulty: 'beginner',\n    },\n    {\n      category: 'common_mistake',\n      title: 'Rookie Error: Confusing Hail Damage with Mechanical Damage',\n      content: `ERIC WINN COMMON MISTAKE GUIDE:\n\nTHE PROBLEM:\nNew consultants often misidentify mechanical damage (roof traffic, fallen branches, installation errors) as hail damage. This destroys your credibility with adjusters.\n\nHAIL DAMAGE CHARACTERISTICS:\n✅ Random distribution pattern (nature is chaotic)\n✅ Multiple impacts across large areas\n✅ Consistent with reported storm severity\n✅ Fresh damage (no oxidation, clean edges)\n✅ Impacts on horizontal AND vertical surfaces\n✅ Similar damage density across roof planes\n✅ Soft metal damage correlates with shingle damage\n\nMECHANICAL DAMAGE TELLS:\n❌ Linear patterns (foot traffic paths)\n❌ Damage concentrated near roof edges or valleys\n❌ Only on easily accessible areas\n❌ Different age than claimed storm date\n❌ Only on horizontal surfaces (no vent damage)\n❌ Inconsistent with verified weather severity\n\nREAL-WORLD EXAMPLE:\n🔴 **SCENARIO**: Homeowner claims hail damage. You see dents on shingles near chimney.\n\nWRONG APPROACH: \"I see damage, must be hail!\" → Insurance denies claim\n\nRIGHT APPROACH:\n1. Check soft metals - any dents? No? ⚠️ Suspicious\n2. Check distribution - only near chimney? ⚠️ Red flag  \n3. Check damage age - oxidized edges? ⚠️ Pre-existing\n4. Check weather data - hail size matches dent size? ⚠️ Verify\n5. CONCLUSION: Likely mechanical damage from roof access during chimney repair\n\nHOW TO HANDLE:\nBe honest with client: \"I see damage, but the pattern suggests roof traffic rather than storm impact. Submitting this as hail damage would likely be denied and could hurt future legitimate claims.\"\n\nYOUR REPUTATION IS EVERYTHING:\nOne fraudulent claim identification can blacklist you with insurance carriers. Ten accurate assessments build trust. Be the consultant adjusters respect for telling the truth.\n\nERIC'S RULE: \"If you wouldn't bet your certification on it, don't put it in the report.\"`,\n      tags: ['hail-damage', 'mechanical-damage', 'mistakes', 'identification'],\n      workflowStep: 'terrestrial',\n      difficulty: 'intermediate',\n    },\n  ];\n\n  try {\n    for (const entry of knowledgeEntries) {\n      await storage.createKnowledgeEntry(entry);\n      console.log(`✅ Created: ${entry.title}`);\n    }\n    \n    console.log(`\\n🎉 Successfully seeded ${knowledgeEntries.length} knowledge base entries!`);\n    console.log('📚 Eric Winn Methodology is now available for Stormy AI integration.\\n');\n  } catch (error) {\n    console.error('❌ Error seeding knowledge base:', error);\n    throw error;\n  }\n}\n\n// Auto-run when executed directly\nseedKnowledgeBase()\n  .then(() => {\n    console.log('Seeding complete!');\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('Seeding failed:', error);\n    process.exit(1);\n  });\n","path":null,"size_bytes":12209,"size_tokens":null},"client/src/pages/inspection-wizard.tsx":{"content":"import { useState, useEffect, useCallback } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { useRoute, useLocation } from 'wouter';\nimport { Header, Footer } from '@/components/navbar';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequestRaw, queryClient } from '@/lib/queryClient';\nimport { InspectionSession, EvidenceAsset, Property, WinnMethodologyStep, WINN_METHODOLOGY_STEPS } from '@shared/schema';\nimport { \n  CloudLightning, Thermometer, Footprints, Grid3X3, Droplet, FlaskConical, \n  FileText, Camera, Upload, CheckCircle2, Circle, Lock, AlertTriangle,\n  ChevronLeft, ChevronRight, HelpCircle, Loader2, X, Eye, Brain, \n  MessageCircle, Sparkles, BookOpen, Mic, Image, Target, BarChart3\n} from 'lucide-react';\nimport { StormySidekick } from '@/components/stormy-sidekick';\nimport { validateStepCompletion, getStepRequirements, getStepGuidance, ValidationResult } from '@/lib/step-validation-service';\nimport { inspectionCompletenessService, InspectionCompletenessResult } from '@/lib/inspection-completeness-service';\nimport { cameraService, CapturedPhoto } from '@/lib/camera-service';\nimport { voiceMemoService, VoiceMemo } from '@/lib/voice-memo-service';\n\nconst STEP_CONFIG: Record<WinnMethodologyStep, {\n  title: string;\n  icon: typeof CloudLightning;\n  description: string;\n  color: string;\n}> = {\n  weather_verification: {\n    title: 'Weather Verification',\n    icon: CloudLightning,\n    description: 'Confirm storm occurrence and date correlation',\n    color: 'text-purple-500'\n  },\n  thermal_imaging: {\n    title: 'Thermal Imaging',\n    icon: Thermometer,\n    description: 'Capture thermal scans for moisture detection',\n    color: 'text-red-500'\n  },\n  terrestrial_walk: {\n    title: 'Terrestrial Walk',\n    icon: Footprints,\n    description: 'Document visible damage from ground level',\n    color: 'text-green-500'\n  },\n  test_squares: {\n    title: 'Test Squares',\n    icon: Grid3X3,\n    description: 'Mark and count impacts in test areas',\n    color: 'text-blue-500'\n  },\n  soft_metals: {\n    title: 'Soft Metals',\n    icon: Droplet,\n    description: 'Document dents on gutters, vents, and HVAC',\n    color: 'text-cyan-500'\n  },\n  moisture_testing: {\n    title: 'Moisture Testing',\n    icon: FlaskConical,\n    description: 'Take moisture meter readings',\n    color: 'text-indigo-500'\n  },\n  core_samples: {\n    title: 'Core Samples',\n    icon: FlaskConical,\n    description: 'Extract and document core samples if needed',\n    color: 'text-orange-500'\n  },\n  report_assembly: {\n    title: 'Report Assembly',\n    icon: FileText,\n    description: 'Compile findings into final report',\n    color: 'text-primary'\n  }\n};\n\ninterface SessionResponse {\n  session: InspectionSession;\n  evidence: EvidenceAsset[];\n  property: Property;\n  stepRequirements: Record<WinnMethodologyStep, {\n    minPhotos: number;\n    requiredFields: string[];\n    aiValidationRequired: boolean;\n    canSkip: boolean;\n    skipReasons?: string[];\n  }>;\n}\n\ninterface CoachingContent {\n  welcome: string;\n  objectives: string[];\n  checklist: string[];\n  whyItMatters: string;\n  commonMistakes: string[];\n  tips: string[];\n}\n\ninterface AnalysisResult {\n  validation: {\n    isValid: boolean;\n    confidence: number;\n    findings: string[];\n    recommendations: string[];\n    warnings: string[];\n  };\n  summary: string;\n  detectedElements: {\n    type: string;\n    description: string;\n    severity?: string;\n    confidence: number;\n  }[];\n  coachingTips: string[];\n}\n\nexport default function InspectionWizard() {\n  const [, params] = useRoute('/inspection/:propertyId');\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const propertyId = params?.propertyId ? parseInt(params.propertyId) : null;\n  \n  const [experienceLevel, setExperienceLevel] = useState<'beginner' | 'intermediate' | 'expert'>('beginner');\n  const [showSkipDialog, setShowSkipDialog] = useState(false);\n  const [skipReason, setSkipReason] = useState('');\n  const [showCoaching, setShowCoaching] = useState(true);\n  const [selectedEvidence, setSelectedEvidence] = useState<EvidenceAsset | null>(null);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [analysisResult, setAnalysisResult] = useState<AnalysisResult | null>(null);\n  \n  const [showCaptureDialog, setShowCaptureDialog] = useState(false);\n  const [isCapturing, setIsCapturing] = useState(false);\n  const [isRecordingVoice, setIsRecordingVoice] = useState(false);\n  const [recordingDuration, setRecordingDuration] = useState(0);\n  const [stepValidation, setStepValidation] = useState<ValidationResult | null>(null);\n  const [completenessData, setCompletenessData] = useState<InspectionCompletenessResult | null>(null);\n\n  const { data: sessionData, isLoading, error, refetch } = useQuery<SessionResponse>({\n    queryKey: ['/api/inspection/session/active', propertyId],\n    queryFn: async () => {\n      const response = await fetch(`/api/inspection/session/active?propertyId=${propertyId}`);\n      if (!response.ok) throw new Error('Failed to fetch session');\n      return response.json();\n    },\n    enabled: !!propertyId\n  });\n\n  const currentStep = sessionData?.session.currentStep as WinnMethodologyStep || 'weather_verification';\n  const currentStepIndex = WINN_METHODOLOGY_STEPS.indexOf(currentStep);\n  const progress = ((currentStepIndex + 1) / WINN_METHODOLOGY_STEPS.length) * 100;\n  const stepConfig = STEP_CONFIG[currentStep];\n  const requirements = sessionData?.stepRequirements[currentStep];\n  const currentEvidence = sessionData?.evidence.filter(e => e.step === currentStep) || [];\n\n  const { data: coaching } = useQuery<CoachingContent>({\n    queryKey: ['/api/ai/coaching', currentStep, experienceLevel],\n    queryFn: async () => {\n      const response = await fetch(`/api/ai/coaching/${currentStep}?level=${experienceLevel}`);\n      if (!response.ok) throw new Error('Failed to fetch coaching');\n      return response.json();\n    },\n    enabled: !!currentStep && showCoaching\n  });\n\n  const advanceMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequestRaw('POST', `/api/inspection/session/${sessionData?.session.id}/advance`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Step completed!\",\n        description: data.message || `Moving to ${data.nextStep?.replace(/_/g, ' ') || 'next step'}`,\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/inspection/session/active', propertyId] });\n      setAnalysisResult(null);\n    },\n    onError: (error: any) => {\n      const errorData = error.response?.data || {};\n      toast({\n        title: \"Cannot advance\",\n        description: errorData.message || \"Requirements not met\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const skipMutation = useMutation({\n    mutationFn: async (reason: string) => {\n      const response = await apiRequestRaw('POST', `/api/inspection/session/${sessionData?.session.id}/skip`, { reason });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Step skipped\",\n        description: data.message,\n      });\n      setShowSkipDialog(false);\n      setSkipReason('');\n      queryClient.invalidateQueries({ queryKey: ['/api/inspection/session/active', propertyId] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Cannot skip\",\n        description: error.response?.data?.message || \"Failed to skip step\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const analyzeEvidence = async (evidenceId: number) => {\n    setIsAnalyzing(true);\n    try {\n      const response = await fetch(`/api/inspection/evidence/${evidenceId}/analyze`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' }\n      });\n      const data = await response.json();\n      setAnalysisResult(data.analysis);\n      refetch();\n      toast({\n        title: \"Analysis complete!\",\n        description: data.analysis.summary,\n      });\n    } catch (error) {\n      toast({\n        title: \"Analysis failed\",\n        description: \"Please try again\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsAnalyzing(false);\n    }\n  };\n\n  useEffect(() => {\n    if (!currentStep || !sessionData) return;\n    \n    const evidence = currentEvidence.map(e => ({\n      id: e.id,\n      type: e.assetType,\n      url: e.fileUrl || undefined,\n      aiAnalysis: e.aiAnalysis ? {\n        isValid: e.aiAnalysis.isValid,\n        confidence: e.aiAnalysis.confidence,\n      } : undefined,\n    }));\n    \n    const validation = validateStepCompletion(currentStep, evidence, {});\n    setStepValidation(validation);\n  }, [currentStep, currentEvidence, sessionData]);\n\n  const handleCapturePhoto = async () => {\n    setIsCapturing(true);\n    try {\n      const photo = await cameraService.capturePhoto({\n        quality: 90,\n        includeLocation: true,\n        source: 'camera',\n      });\n\n      if (photo && sessionData?.session.id) {\n        const formData = new FormData();\n        const blob = await (await fetch(photo.dataUrl)).blob();\n        formData.append('file', blob, `photo_${Date.now()}.jpg`);\n        formData.append('sessionId', sessionData.session.id.toString());\n        formData.append('step', currentStep);\n        formData.append('assetType', 'photo');\n        formData.append('latitude', photo.latitude?.toString() || '');\n        formData.append('longitude', photo.longitude?.toString() || '');\n\n        const response = await fetch('/api/inspection/evidence/upload', {\n          method: 'POST',\n          body: formData,\n          credentials: 'include',\n        });\n\n        if (response.ok) {\n          refetch();\n          toast({\n            title: \"Photo captured!\",\n            description: \"Evidence added to this step\",\n          });\n        }\n      }\n    } catch (error) {\n      console.error('Failed to capture photo:', error);\n      toast({\n        title: \"Capture failed\",\n        description: \"Could not capture photo\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsCapturing(false);\n    }\n  };\n\n  const handleImportThermal = async () => {\n    setIsCapturing(true);\n    try {\n      const photo = await cameraService.importThermalImage();\n\n      if (photo && sessionData?.session.id) {\n        const formData = new FormData();\n        const blob = await (await fetch(photo.dataUrl)).blob();\n        formData.append('file', blob, `thermal_${Date.now()}.jpg`);\n        formData.append('sessionId', sessionData.session.id.toString());\n        formData.append('step', currentStep);\n        formData.append('assetType', 'thermal');\n        formData.append('latitude', photo.latitude?.toString() || '');\n        formData.append('longitude', photo.longitude?.toString() || '');\n\n        const response = await fetch('/api/inspection/evidence/upload', {\n          method: 'POST',\n          body: formData,\n          credentials: 'include',\n        });\n\n        if (response.ok) {\n          refetch();\n          toast({\n            title: \"Thermal image imported!\",\n            description: \"Evidence added to this step\",\n          });\n        }\n      }\n    } catch (error) {\n      console.error('Failed to import thermal:', error);\n      toast({\n        title: \"Import failed\",\n        description: \"Could not import thermal image\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsCapturing(false);\n    }\n  };\n\n  const handleStartVoiceRecording = async () => {\n    const started = await voiceMemoService.startRecording();\n    if (started) {\n      setIsRecordingVoice(true);\n      const interval = setInterval(() => {\n        setRecordingDuration(voiceMemoService.getRecordingDuration());\n      }, 100);\n      (window as any).__voiceRecordingInterval = interval;\n    }\n  };\n\n  const handleStopVoiceRecording = async () => {\n    if ((window as any).__voiceRecordingInterval) {\n      clearInterval((window as any).__voiceRecordingInterval);\n    }\n    setIsRecordingVoice(false);\n    setRecordingDuration(0);\n\n    const memo = await voiceMemoService.stopRecording();\n    if (memo) {\n      const result = await voiceMemoService.transcribeAudio(memo, stepConfig.title);\n      \n      if (result.transcription) {\n        toast({\n          title: \"Voice memo recorded\",\n          description: result.status === 'success' ? 'Transcribed and saved' : 'Saved for playback',\n        });\n      }\n    }\n  };\n\n  if (!propertyId) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <Card className=\"p-6\">\n          <CardTitle className=\"text-destructive\">No Property Selected</CardTitle>\n          <CardDescription className=\"mt-2\">Please select a property to start inspection</CardDescription>\n          <Button className=\"mt-4 touch-target h-12\" onClick={() => navigate('/dashboard')}>Go to Dashboard</Button>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <Card className=\"p-6\">\n          <CardTitle className=\"text-destructive\">Error Loading Session</CardTitle>\n          <CardDescription className=\"mt-2\">Failed to load inspection session</CardDescription>\n          <Button className=\"mt-4 touch-target h-12\" onClick={() => refetch()}>Retry</Button>\n        </Card>\n      </div>\n    );\n  }\n\n  const canAdvance = () => {\n    if (!requirements) return false;\n    if (currentEvidence.length < requirements.minPhotos) return false;\n    if (requirements.aiValidationRequired) {\n      return currentEvidence.some(e => e.aiAnalysis?.isValid);\n    }\n    return true;\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background text-foreground\" data-testid=\"inspection-wizard\">\n      <Header />\n      \n      <main className=\"flex-grow pb-32\">\n        <div className=\"max-w-4xl mx-auto px-4 py-6\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <div>\n              <h1 className=\"text-2xl font-bold\" data-testid=\"property-title\">\n                {sessionData?.property?.name || 'Inspection'}\n              </h1>\n              <p className=\"text-muted-foreground text-sm\">\n                {sessionData?.property?.address}\n              </p>\n            </div>\n            <Badge variant=\"outline\" className=\"text-primary border-primary\">\n              Step {currentStepIndex + 1} of {WINN_METHODOLOGY_STEPS.length}\n            </Badge>\n          </div>\n\n          <div className=\"mb-6\">\n            <div className=\"flex justify-between text-sm mb-2\">\n              <span className=\"text-muted-foreground\">Progress</span>\n              <span className=\"text-primary font-medium\">{Math.round(progress)}%</span>\n            </div>\n            <Progress value={progress} className=\"h-2\" data-testid=\"progress-bar\" />\n          </div>\n\n          <div className=\"flex overflow-x-auto pb-4 mb-6 gap-2\" data-testid=\"step-indicators\">\n            {WINN_METHODOLOGY_STEPS.map((step, index) => {\n              const config = STEP_CONFIG[step];\n              const isCompleted = sessionData?.session.stepsCompleted?.includes(step);\n              const isCurrent = step === currentStep;\n              const isLocked = index > currentStepIndex;\n              const StepIcon = config.icon;\n\n              return (\n                <div \n                  key={step}\n                  className={`flex-shrink-0 flex flex-col items-center p-2 rounded-lg transition-all ${\n                    isCurrent ? 'bg-primary/10 ring-2 ring-primary' :\n                    isCompleted ? 'bg-green-500/10' :\n                    isLocked ? 'opacity-50' : ''\n                  }`}\n                  data-testid={`step-indicator-${step}`}\n                >\n                  <div className={`p-2 rounded-full ${\n                    isCompleted ? 'bg-green-500/20' :\n                    isCurrent ? 'bg-primary/20' :\n                    'bg-muted'\n                  }`}>\n                    {isCompleted ? (\n                      <CheckCircle2 className=\"h-5 w-5 text-green-500\" />\n                    ) : isLocked ? (\n                      <Lock className=\"h-5 w-5 text-muted-foreground\" />\n                    ) : (\n                      <StepIcon className={`h-5 w-5 ${isCurrent ? config.color : 'text-muted-foreground'}`} />\n                    )}\n                  </div>\n                  <span className={`text-xs mt-1 text-center w-16 truncate ${\n                    isCurrent ? 'font-medium text-foreground' : 'text-muted-foreground'\n                  }`}>\n                    {config.title.split(' ')[0]}\n                  </span>\n                </div>\n              );\n            })}\n          </div>\n\n          <Card className=\"mb-6\" data-testid=\"current-step-card\">\n            <CardHeader className=\"pb-4\">\n              <div className=\"flex items-center gap-3\">\n                {(() => {\n                  const StepIcon = stepConfig.icon;\n                  return (\n                    <div className={`p-3 rounded-xl bg-gradient-to-br from-primary/20 to-cyan-500/20`}>\n                      <StepIcon className={`h-6 w-6 ${stepConfig.color}`} />\n                    </div>\n                  );\n                })()}\n                <div>\n                  <CardTitle className=\"text-xl\" data-testid=\"step-title\">{stepConfig.title}</CardTitle>\n                  <CardDescription>{stepConfig.description}</CardDescription>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {showCoaching && coaching && (\n                <Alert className=\"mb-6 bg-gradient-to-r from-primary/5 to-cyan-500/5 border-primary/20\">\n                  <Sparkles className=\"h-4 w-4 text-primary\" />\n                  <AlertTitle className=\"text-primary\">Stormy's Guidance</AlertTitle>\n                  <AlertDescription className=\"mt-2\">\n                    <p className=\"mb-3\">{coaching.welcome}</p>\n                    <div className=\"space-y-2\">\n                      <p className=\"font-medium text-sm text-foreground\">Why This Matters:</p>\n                      <p className=\"text-sm text-muted-foreground\">{coaching.whyItMatters}</p>\n                    </div>\n                    {coaching.tips.length > 0 && (\n                      <div className=\"mt-3 flex flex-wrap gap-2\">\n                        {coaching.tips.map((tip, i) => (\n                          <Badge key={i} variant=\"secondary\" className=\"text-xs\">\n                            <BookOpen className=\"h-3 w-3 mr-1\" />\n                            {tip}\n                          </Badge>\n                        ))}\n                      </div>\n                    )}\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              <div className=\"grid gap-4 mb-6\">\n                <div className=\"flex items-center justify-between p-4 rounded-lg bg-muted/50\">\n                  <div className=\"flex items-center gap-2\">\n                    <Camera className=\"h-5 w-5 text-muted-foreground\" />\n                    <span>Evidence Captured</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className={`font-bold ${\n                      currentEvidence.length >= (requirements?.minPhotos || 0) \n                        ? 'text-green-500' \n                        : 'text-amber-500'\n                    }`}>\n                      {currentEvidence.length}\n                    </span>\n                    <span className=\"text-muted-foreground\">\n                      / {requirements?.minPhotos || 0} required\n                    </span>\n                  </div>\n                </div>\n\n                {requirements?.aiValidationRequired && (\n                  <div className=\"flex items-center justify-between p-4 rounded-lg bg-muted/50\">\n                    <div className=\"flex items-center gap-2\">\n                      <Brain className=\"h-5 w-5 text-muted-foreground\" />\n                      <span>AI Validation</span>\n                    </div>\n                    <div>\n                      {currentEvidence.some(e => e.aiAnalysis?.isValid) ? (\n                        <Badge className=\"bg-green-500\">\n                          <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                          Validated\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\" className=\"text-amber-500 border-amber-500\">\n                          Required\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {currentEvidence.length > 0 && (\n                <div className=\"mb-6\">\n                  <h4 className=\"text-sm font-medium mb-3\">Captured Evidence</h4>\n                  <div className=\"grid grid-cols-3 gap-3\">\n                    {currentEvidence.map((evidence) => (\n                      <div \n                        key={evidence.id} \n                        className=\"relative rounded-lg overflow-hidden border bg-muted aspect-square cursor-pointer hover:ring-2 ring-primary transition-all\"\n                        onClick={() => setSelectedEvidence(evidence)}\n                        data-testid={`evidence-${evidence.id}`}\n                      >\n                        {evidence.fileUrl ? (\n                          <img \n                            src={evidence.fileUrl} \n                            alt={evidence.caption || 'Evidence'}\n                            className=\"w-full h-full object-cover\"\n                          />\n                        ) : (\n                          <div className=\"w-full h-full flex items-center justify-center\">\n                            <Camera className=\"h-8 w-8 text-muted-foreground\" />\n                          </div>\n                        )}\n                        {evidence.aiAnalysis?.isValid !== undefined && (\n                          <div className={`absolute top-1 right-1 p-1 rounded-full ${\n                            evidence.aiAnalysis.isValid ? 'bg-green-500' : 'bg-amber-500'\n                          }`}>\n                            {evidence.aiAnalysis.isValid ? (\n                              <CheckCircle2 className=\"h-3 w-3 text-white\" />\n                            ) : (\n                              <AlertTriangle className=\"h-3 w-3 text-white\" />\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {stepValidation && !stepValidation.canAdvance && stepValidation.blockers.length > 0 && (\n                <Alert className=\"mb-4 border-amber-500/50 bg-amber-500/10\">\n                  <AlertTriangle className=\"h-4 w-4 text-amber-500\" />\n                  <AlertTitle className=\"text-amber-500\">Requirements</AlertTitle>\n                  <AlertDescription className=\"text-sm\">\n                    {stepValidation.blockers.map((b, i) => (\n                      <p key={i} className=\"text-muted-foreground\">{b.message}</p>\n                    ))}\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4\">\n                <Button \n                  variant=\"outline\" \n                  className=\"h-16 touch-target flex-col gap-1\"\n                  onClick={handleCapturePhoto}\n                  disabled={isCapturing}\n                  data-testid=\"button-capture-photo\"\n                >\n                  {isCapturing ? (\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\n                  ) : (\n                    <Camera className=\"h-5 w-5\" />\n                  )}\n                  <span className=\"text-xs\">Photo</span>\n                </Button>\n                \n                <Button \n                  variant=\"outline\" \n                  className=\"h-16 touch-target flex-col gap-1\"\n                  onClick={handleImportThermal}\n                  disabled={isCapturing}\n                  data-testid=\"button-import-thermal\"\n                >\n                  <Thermometer className=\"h-5 w-5 text-red-500\" />\n                  <span className=\"text-xs\">Thermal</span>\n                </Button>\n                \n                <Button \n                  variant={isRecordingVoice ? \"destructive\" : \"outline\"}\n                  className={`h-16 touch-target flex-col gap-1 ${isRecordingVoice ? 'animate-pulse' : ''}`}\n                  onClick={isRecordingVoice ? handleStopVoiceRecording : handleStartVoiceRecording}\n                  data-testid=\"button-voice-memo\"\n                >\n                  <Mic className={`h-5 w-5 ${isRecordingVoice ? 'text-white' : ''}`} />\n                  <span className=\"text-xs\">\n                    {isRecordingVoice ? `${Math.floor(recordingDuration)}s` : 'Voice'}\n                  </span>\n                </Button>\n                \n                <Button \n                  variant=\"outline\" \n                  className=\"h-16 touch-target flex-col gap-1\"\n                  onClick={() => navigate(`/upload?propertyId=${propertyId}&step=${currentStep}`)}\n                  data-testid=\"button-upload-files\"\n                >\n                  <Upload className=\"h-5 w-5\" />\n                  <span className=\"text-xs\">Upload</span>\n                </Button>\n              </div>\n              \n              <div className=\"flex gap-3\">\n                {currentEvidence.length > 0 && !currentEvidence.some(e => e.aiAnalysis) && (\n                  <Button \n                    className=\"flex-1 h-14 touch-target bg-gradient-to-r from-primary to-cyan-500\"\n                    onClick={() => currentEvidence[0] && analyzeEvidence(currentEvidence[0].id)}\n                    disabled={isAnalyzing}\n                    data-testid=\"button-analyze\"\n                  >\n                    {isAnalyzing ? (\n                      <Loader2 className=\"h-5 w-5 mr-2 animate-spin\" />\n                    ) : (\n                      <Brain className=\"h-5 w-5 mr-2\" />\n                    )}\n                    Analyze with Stormy\n                  </Button>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          {analysisResult && (\n            <Card className=\"mb-6 border-primary/30\" data-testid=\"analysis-result\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"flex items-center gap-2 text-lg\">\n                  <Sparkles className=\"h-5 w-5 text-primary\" />\n                  Stormy's Analysis\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm mb-4\">{analysisResult.summary}</p>\n                \n                <div className=\"flex items-center gap-2 mb-4\">\n                  <span className=\"text-sm text-muted-foreground\">Validation:</span>\n                  {analysisResult.validation.isValid ? (\n                    <Badge className=\"bg-green-500\">\n                      <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                      Valid ({analysisResult.validation.confidence}% confidence)\n                    </Badge>\n                  ) : (\n                    <Badge variant=\"destructive\">\n                      <AlertTriangle className=\"h-3 w-3 mr-1\" />\n                      Needs Review\n                    </Badge>\n                  )}\n                </div>\n\n                {analysisResult.validation.findings.length > 0 && (\n                  <div className=\"mb-4\">\n                    <p className=\"text-sm font-medium mb-2\">Key Findings:</p>\n                    <ul className=\"text-sm text-muted-foreground space-y-1\">\n                      {analysisResult.validation.findings.map((finding, i) => (\n                        <li key={i} className=\"flex items-start gap-2\">\n                          <CheckCircle2 className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\n                          {finding}\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n\n                {analysisResult.coachingTips.length > 0 && (\n                  <div className=\"p-3 rounded-lg bg-primary/5 border border-primary/20\">\n                    <p className=\"text-sm font-medium text-primary mb-2\">Pro Tips:</p>\n                    <ul className=\"text-sm text-muted-foreground space-y-1\">\n                      {analysisResult.coachingTips.map((tip, i) => (\n                        <li key={i}>{tip}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      </main>\n\n      <div className=\"fixed bottom-0 left-0 right-0 p-4 bg-background/95 backdrop-blur border-t\" data-testid=\"navigation-footer\">\n        <div className=\"max-w-4xl mx-auto flex items-center justify-between gap-4\">\n          <Button \n            variant=\"outline\"\n            className=\"h-14 px-6 touch-target\"\n            onClick={() => navigate('/dashboard')}\n            data-testid=\"button-back\"\n          >\n            <ChevronLeft className=\"h-5 w-5 mr-1\" />\n            Back\n          </Button>\n\n          <div className=\"flex items-center gap-3\">\n            <Select \n              value={experienceLevel} \n              onValueChange={(v) => setExperienceLevel(v as typeof experienceLevel)}\n            >\n              <SelectTrigger className=\"w-32 h-10\" data-testid=\"select-experience\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"beginner\">Beginner</SelectItem>\n                <SelectItem value=\"intermediate\">Intermediate</SelectItem>\n                <SelectItem value=\"expert\">Expert</SelectItem>\n              </SelectContent>\n            </Select>\n            \n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-10 w-10\"\n              onClick={() => setShowCoaching(!showCoaching)}\n              data-testid=\"toggle-coaching\"\n            >\n              <HelpCircle className={`h-5 w-5 ${showCoaching ? 'text-primary' : 'text-muted-foreground'}`} />\n            </Button>\n          </div>\n\n          <div className=\"flex gap-2\">\n            {requirements?.canSkip && (\n              <Dialog open={showSkipDialog} onOpenChange={setShowSkipDialog}>\n                <DialogTrigger asChild>\n                  <Button \n                    variant=\"outline\" \n                    className=\"h-14 px-4 touch-target text-amber-500 border-amber-500/50\"\n                    data-testid=\"button-skip\"\n                  >\n                    Skip\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>Skip {stepConfig.title}?</DialogTitle>\n                    <DialogDescription>\n                      Skipping affects your compliance score. Select a valid reason:\n                    </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-3 py-4\">\n                    {requirements.skipReasons?.map((reason) => (\n                      <Button\n                        key={reason}\n                        variant={skipReason === reason ? \"default\" : \"outline\"}\n                        className=\"w-full justify-start h-12 touch-target\"\n                        onClick={() => setSkipReason(reason)}\n                      >\n                        {reason}\n                      </Button>\n                    ))}\n                  </div>\n                  <DialogFooter>\n                    <Button variant=\"outline\" className=\"touch-target h-12\" onClick={() => setShowSkipDialog(false)}>Cancel</Button>\n                    <Button \n                      variant=\"destructive\"\n                      className=\"touch-target h-12\"\n                      disabled={!skipReason || skipMutation.isPending}\n                      onClick={() => skipMutation.mutate(skipReason)}\n                    >\n                      {skipMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                      Confirm Skip\n                    </Button>\n                  </DialogFooter>\n                </DialogContent>\n              </Dialog>\n            )}\n\n            <Button \n              className=\"h-14 px-6 touch-target bg-gradient-to-r from-primary to-cyan-500\"\n              disabled={!canAdvance() || advanceMutation.isPending}\n              onClick={() => advanceMutation.mutate()}\n              data-testid=\"button-next\"\n            >\n              {advanceMutation.isPending ? (\n                <Loader2 className=\"h-5 w-5 mr-2 animate-spin\" />\n              ) : currentStepIndex === WINN_METHODOLOGY_STEPS.length - 1 ? (\n                <>\n                  Complete\n                  <CheckCircle2 className=\"h-5 w-5 ml-2\" />\n                </>\n              ) : (\n                <>\n                  Next Step\n                  <ChevronRight className=\"h-5 w-5 ml-1\" />\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <Dialog open={!!selectedEvidence} onOpenChange={() => setSelectedEvidence(null)}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Evidence Details</DialogTitle>\n          </DialogHeader>\n          {selectedEvidence && (\n            <div className=\"space-y-4\">\n              {selectedEvidence.fileUrl && (\n                <img \n                  src={selectedEvidence.fileUrl} \n                  alt=\"Evidence\" \n                  className=\"w-full rounded-lg\"\n                />\n              )}\n              <div className=\"flex gap-2\">\n                <Button \n                  className=\"flex-1 touch-target h-12\"\n                  onClick={() => {\n                    analyzeEvidence(selectedEvidence.id);\n                    setSelectedEvidence(null);\n                  }}\n                  disabled={isAnalyzing}\n                >\n                  <Brain className=\"h-4 w-4 mr-2\" />\n                  Analyze\n                </Button>\n                <Button variant=\"outline\" className=\"touch-target h-12\" onClick={() => setSelectedEvidence(null)}>\n                  Close\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <StormySidekick\n        currentStep={currentStep}\n        experienceLevel={experienceLevel}\n        propertyId={propertyId}\n        sessionId={sessionData?.session.id}\n        evidenceCount={currentEvidence.length}\n        onLevelChange={setExperienceLevel}\n        isFloating={true}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":35786,"size_tokens":null},"client/src/pages/transcripts.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { useLocation } from 'wouter';\nimport { Header, Footer } from '@/components/navbar';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Progress } from '@/components/ui/progress';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequestRaw, queryClient } from '@/lib/queryClient';\nimport { LimitlessTranscript, ExtractedKnowledge, TranscriptSegment, WinnMethodologyStep } from '@shared/schema';\nimport { \n  Upload, FileText, Clock, CheckCircle2, AlertCircle, XCircle, \n  Brain, Loader2, ChevronRight, Play, Pause, Volume2, Tag,\n  BookOpen, Plus, Trash2, Edit2, Search, Filter\n} from 'lucide-react';\n\nconst STATUS_CONFIG: Record<string, { label: string; color: string; icon: typeof CheckCircle2 }> = {\n  pending: { label: 'Pending', color: 'bg-gray-500', icon: Clock },\n  processing: { label: 'Processing', color: 'bg-blue-500', icon: Loader2 },\n  reviewed: { label: 'Reviewed', color: 'bg-amber-500', icon: AlertCircle },\n  approved: { label: 'Approved', color: 'bg-green-500', icon: CheckCircle2 },\n  rejected: { label: 'Rejected', color: 'bg-red-500', icon: XCircle },\n};\n\nconst STEP_LABELS: Record<WinnMethodologyStep, string> = {\n  weather_verification: 'Weather Verification',\n  thermal_imaging: 'Thermal Imaging',\n  terrestrial_walk: 'Terrestrial Walk',\n  test_squares: 'Test Squares',\n  soft_metals: 'Soft Metals',\n  moisture_testing: 'Moisture Testing',\n  core_samples: 'Core Samples',\n  report_assembly: 'Report Assembly',\n};\n\nexport default function TranscriptsPage() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const [showUpload, setShowUpload] = useState(false);\n  const [selectedTranscript, setSelectedTranscript] = useState<LimitlessTranscript | null>(null);\n  const [uploadForm, setUploadForm] = useState({\n    title: '',\n    rawTranscript: '',\n    duration: 0,\n    recordingDate: new Date().toISOString().split('T')[0],\n  });\n\n  const { data: transcripts, isLoading } = useQuery<LimitlessTranscript[]>({\n    queryKey: ['/api/transcripts'],\n  });\n\n  const uploadMutation = useMutation({\n    mutationFn: async (data: typeof uploadForm) => {\n      const response = await apiRequestRaw('POST', '/api/transcripts', {\n        ...data,\n        recordingDate: new Date(data.recordingDate),\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: 'Transcript uploaded', description: 'Ready for AI processing' });\n      queryClient.invalidateQueries({ queryKey: ['/api/transcripts'] });\n      setShowUpload(false);\n      setUploadForm({ title: '', rawTranscript: '', duration: 0, recordingDate: new Date().toISOString().split('T')[0] });\n    },\n    onError: (error) => {\n      toast({ title: 'Upload failed', description: error.message, variant: 'destructive' });\n    }\n  });\n\n  const processMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const transcript = transcripts?.find(t => t.id === id);\n      if (!transcript) throw new Error('Transcript not found');\n      \n      await apiRequestRaw('PATCH', `/api/transcripts/${id}`, { status: 'processing' });\n      \n      const parseResponse = await apiRequestRaw('POST', '/api/ai/parse-transcript', {\n        rawTranscript: transcript.rawTranscript,\n        title: transcript.title,\n      });\n      const parseResult = await parseResponse.json();\n      \n      await apiRequestRaw('PATCH', `/api/transcripts/${id}`, {\n        status: 'reviewed',\n        parsedSegments: parseResult.segments,\n        extractedKnowledge: parseResult.knowledge,\n      });\n      \n      return parseResult;\n    },\n    onSuccess: () => {\n      toast({ title: 'Processing complete', description: 'Knowledge extracted and ready for review' });\n      queryClient.invalidateQueries({ queryKey: ['/api/transcripts'] });\n    },\n    onError: (error) => {\n      toast({ title: 'Processing failed', description: error.message, variant: 'destructive' });\n    }\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: async ({ transcriptId, knowledgeIndex, approved }: { transcriptId: number; knowledgeIndex: number; approved: boolean }) => {\n      const transcript = transcripts?.find(t => t.id === transcriptId);\n      if (!transcript?.extractedKnowledge) throw new Error('No knowledge to approve');\n      \n      const updatedKnowledge = [...transcript.extractedKnowledge];\n      updatedKnowledge[knowledgeIndex] = { ...updatedKnowledge[knowledgeIndex], approved };\n      \n      await apiRequestRaw('PATCH', `/api/transcripts/${transcriptId}`, {\n        extractedKnowledge: updatedKnowledge,\n      });\n      \n      return { transcriptId, knowledgeIndex, approved };\n    },\n    onSuccess: ({ approved }) => {\n      toast({ \n        title: approved ? 'Knowledge approved' : 'Knowledge rejected',\n        description: approved ? 'Will be added to knowledge base' : 'Marked for review'\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/transcripts'] });\n    }\n  });\n\n  const finalizeTranscriptMutation = useMutation({\n    mutationFn: async (transcriptId: number) => {\n      const transcript = transcripts?.find(t => t.id === transcriptId);\n      if (!transcript?.extractedKnowledge) throw new Error('No knowledge to finalize');\n      \n      const approvedKnowledge = transcript.extractedKnowledge.filter(k => k.approved);\n      \n      const knowledgeIds: number[] = [];\n      for (const knowledge of approvedKnowledge) {\n        const response = await apiRequestRaw('POST', '/api/knowledge', {\n          title: knowledge.title,\n          content: knowledge.content,\n          category: 'procedure',\n          tags: knowledge.suggestedTags,\n          relatedSteps: [knowledge.suggestedStep],\n          source: 'transcript',\n          sourceId: transcriptId.toString(),\n          verified: true,\n        });\n        const created = await response.json();\n        knowledgeIds.push(created.id);\n      }\n      \n      await apiRequestRaw('PATCH', `/api/transcripts/${transcriptId}`, {\n        status: 'approved',\n        knowledgeEntriesCreated: knowledgeIds,\n      });\n      \n      return { count: knowledgeIds.length };\n    },\n    onSuccess: ({ count }) => {\n      toast({ \n        title: 'Transcript finalized', \n        description: `${count} knowledge entries added to knowledge base` \n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/transcripts'] });\n      setSelectedTranscript(null);\n    }\n  });\n\n  const formatDuration = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Header />\n      \n      <main className=\"flex-grow p-4 pb-24\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">Limitless Transcripts</h1>\n            <p className=\"text-muted-foreground\">Import Eric Winn's field recordings for knowledge extraction</p>\n          </div>\n          <Dialog open={showUpload} onOpenChange={setShowUpload}>\n            <DialogTrigger asChild>\n              <Button className=\"bg-gradient-to-r from-primary to-cyan-500\" data-testid=\"button-upload-transcript\">\n                <Upload className=\"h-4 w-4 mr-2\" />\n                Upload Transcript\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl\">\n              <DialogHeader>\n                <DialogTitle>Upload Limitless Transcript</DialogTitle>\n                <DialogDescription>\n                  Paste the raw transcript from a Limitless Pin recording for AI processing\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4 py-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"title\">Recording Title</Label>\n                  <Input\n                    id=\"title\"\n                    placeholder=\"e.g., Kansas City Site Visit - Day 1\"\n                    value={uploadForm.title}\n                    onChange={(e) => setUploadForm(prev => ({ ...prev, title: e.target.value }))}\n                    data-testid=\"input-transcript-title\"\n                  />\n                </div>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"date\">Recording Date</Label>\n                    <Input\n                      id=\"date\"\n                      type=\"date\"\n                      value={uploadForm.recordingDate}\n                      onChange={(e) => setUploadForm(prev => ({ ...prev, recordingDate: e.target.value }))}\n                      data-testid=\"input-recording-date\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"duration\">Duration (minutes)</Label>\n                    <Input\n                      id=\"duration\"\n                      type=\"number\"\n                      placeholder=\"0\"\n                      value={uploadForm.duration ? uploadForm.duration / 60 : ''}\n                      onChange={(e) => setUploadForm(prev => ({ ...prev, duration: parseInt(e.target.value || '0') * 60 }))}\n                      data-testid=\"input-duration\"\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"transcript\">Raw Transcript</Label>\n                  <Textarea\n                    id=\"transcript\"\n                    placeholder=\"Paste the full transcript text here...\"\n                    className=\"min-h-[200px]\"\n                    value={uploadForm.rawTranscript}\n                    onChange={(e) => setUploadForm(prev => ({ ...prev, rawTranscript: e.target.value }))}\n                    data-testid=\"textarea-transcript\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    {uploadForm.rawTranscript.split(/\\s+/).filter(Boolean).length} words\n                  </p>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setShowUpload(false)}>Cancel</Button>\n                <Button \n                  onClick={() => uploadMutation.mutate(uploadForm)}\n                  disabled={!uploadForm.title || !uploadForm.rawTranscript || uploadMutation.isPending}\n                  data-testid=\"button-submit-transcript\"\n                >\n                  {uploadMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                  Upload & Save\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          </div>\n        ) : !transcripts || transcripts.length === 0 ? (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n              <FileText className=\"h-16 w-16 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-medium mb-2\">No transcripts yet</h3>\n              <p className=\"text-muted-foreground text-center mb-4\">\n                Upload Limitless Pin recordings to extract Eric Winn's expertise into the knowledge base\n              </p>\n              <Button onClick={() => setShowUpload(true)}>\n                <Upload className=\"h-4 w-4 mr-2\" />\n                Upload First Transcript\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-4\">\n            {transcripts.map((transcript) => {\n              const StatusIcon = STATUS_CONFIG[transcript.status]?.icon || Clock;\n              const statusConfig = STATUS_CONFIG[transcript.status] || STATUS_CONFIG.pending;\n              const approvedCount = transcript.extractedKnowledge?.filter(k => k.approved).length || 0;\n              const totalKnowledge = transcript.extractedKnowledge?.length || 0;\n              \n              return (\n                <Card \n                  key={transcript.id} \n                  className=\"cursor-pointer hover:border-primary/50 transition-colors\"\n                  onClick={() => setSelectedTranscript(transcript)}\n                  data-testid={`transcript-card-${transcript.id}`}\n                >\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <h3 className=\"font-medium\">{transcript.title}</h3>\n                          <Badge className={statusConfig.color}>\n                            <StatusIcon className={`h-3 w-3 mr-1 ${transcript.status === 'processing' ? 'animate-spin' : ''}`} />\n                            {statusConfig.label}\n                          </Badge>\n                        </div>\n                        <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                          {transcript.recordingDate && (\n                            <span>{new Date(transcript.recordingDate).toLocaleDateString()}</span>\n                          )}\n                          {transcript.duration && (\n                            <span className=\"flex items-center gap-1\">\n                              <Clock className=\"h-3 w-3\" />\n                              {formatDuration(transcript.duration)}\n                            </span>\n                          )}\n                          <span>{transcript.rawTranscript.split(/\\s+/).length} words</span>\n                        </div>\n                      </div>\n                      \n                      <div className=\"flex items-center gap-2\">\n                        {transcript.status === 'pending' && (\n                          <Button\n                            size=\"sm\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              processMutation.mutate(transcript.id);\n                            }}\n                            disabled={processMutation.isPending}\n                            className=\"bg-gradient-to-r from-primary to-cyan-500\"\n                            data-testid={`button-process-${transcript.id}`}\n                          >\n                            {processMutation.isPending ? (\n                              <Loader2 className=\"h-4 w-4 mr-1 animate-spin\" />\n                            ) : (\n                              <Brain className=\"h-4 w-4 mr-1\" />\n                            )}\n                            Process with AI\n                          </Button>\n                        )}\n                        {totalKnowledge > 0 && (\n                          <div className=\"text-sm text-right\">\n                            <span className=\"text-green-500 font-medium\">{approvedCount}</span>\n                            <span className=\"text-muted-foreground\">/{totalKnowledge} approved</span>\n                          </div>\n                        )}\n                        <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n                      </div>\n                    </div>\n                    \n                    {totalKnowledge > 0 && (\n                      <div className=\"mt-3\">\n                        <Progress value={(approvedCount / totalKnowledge) * 100} className=\"h-1\" />\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n      </main>\n\n      {selectedTranscript && (\n        <Dialog open={!!selectedTranscript} onOpenChange={() => setSelectedTranscript(null)}>\n          <DialogContent className=\"max-w-4xl max-h-[90vh]\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5\" />\n                {selectedTranscript.title}\n              </DialogTitle>\n              <DialogDescription>\n                Review extracted knowledge and approve for knowledge base integration\n              </DialogDescription>\n            </DialogHeader>\n            \n            <Tabs defaultValue=\"knowledge\" className=\"flex-1\">\n              <TabsList className=\"grid w-full grid-cols-2\">\n                <TabsTrigger value=\"knowledge\">\n                  <BookOpen className=\"h-4 w-4 mr-2\" />\n                  Extracted Knowledge ({selectedTranscript.extractedKnowledge?.length || 0})\n                </TabsTrigger>\n                <TabsTrigger value=\"transcript\">\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  Raw Transcript\n                </TabsTrigger>\n              </TabsList>\n              \n              <TabsContent value=\"knowledge\" className=\"mt-4\">\n                <ScrollArea className=\"h-[400px] pr-4\">\n                  {selectedTranscript.extractedKnowledge && selectedTranscript.extractedKnowledge.length > 0 ? (\n                    <div className=\"space-y-4\">\n                      {selectedTranscript.extractedKnowledge.map((knowledge, index) => (\n                        <Card \n                          key={index} \n                          className={`${knowledge.approved === true ? 'border-green-500/50' : knowledge.approved === false ? 'border-red-500/50' : 'border-border'}`}\n                          data-testid={`knowledge-item-${index}`}\n                        >\n                          <CardContent className=\"p-4\">\n                            <div className=\"flex items-start justify-between mb-2\">\n                              <div>\n                                <h4 className=\"font-medium\">{knowledge.title}</h4>\n                                <div className=\"flex items-center gap-2 mt-1\">\n                                  <Badge variant=\"outline\" className=\"text-xs\">\n                                    {knowledge.category.replace(/_/g, ' ')}\n                                  </Badge>\n                                  <Badge variant=\"outline\" className=\"text-xs\">\n                                    {STEP_LABELS[knowledge.suggestedStep] || knowledge.suggestedStep}\n                                  </Badge>\n                                  <span className=\"text-xs text-muted-foreground\">\n                                    {Math.round(knowledge.confidence * 100)}% confidence\n                                  </span>\n                                </div>\n                              </div>\n                              <div className=\"flex gap-2\">\n                                <Button\n                                  size=\"sm\"\n                                  variant={knowledge.approved === true ? \"default\" : \"outline\"}\n                                  className={knowledge.approved === true ? \"bg-green-500 hover:bg-green-600\" : \"\"}\n                                  onClick={() => approveMutation.mutate({\n                                    transcriptId: selectedTranscript.id,\n                                    knowledgeIndex: index,\n                                    approved: true\n                                  })}\n                                  data-testid={`button-approve-${index}`}\n                                >\n                                  <CheckCircle2 className=\"h-4 w-4\" />\n                                </Button>\n                                <Button\n                                  size=\"sm\"\n                                  variant={knowledge.approved === false ? \"default\" : \"outline\"}\n                                  className={knowledge.approved === false ? \"bg-red-500 hover:bg-red-600\" : \"\"}\n                                  onClick={() => approveMutation.mutate({\n                                    transcriptId: selectedTranscript.id,\n                                    knowledgeIndex: index,\n                                    approved: false\n                                  })}\n                                  data-testid={`button-reject-${index}`}\n                                >\n                                  <XCircle className=\"h-4 w-4\" />\n                                </Button>\n                              </div>\n                            </div>\n                            <p className=\"text-sm text-muted-foreground mb-2\">{knowledge.content}</p>\n                            <div className=\"flex flex-wrap gap-1\">\n                              {knowledge.suggestedTags.map((tag, i) => (\n                                <Badge key={i} variant=\"secondary\" className=\"text-xs\">\n                                  <Tag className=\"h-2 w-2 mr-1\" />\n                                  {tag}\n                                </Badge>\n                              ))}\n                            </div>\n                          </CardContent>\n                        </Card>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"flex flex-col items-center justify-center py-12\">\n                      <Brain className=\"h-12 w-12 text-muted-foreground mb-4\" />\n                      <p className=\"text-muted-foreground\">\n                        {selectedTranscript.status === 'pending' \n                          ? 'Click \"Process with AI\" to extract knowledge'\n                          : 'No knowledge extracted yet'}\n                      </p>\n                    </div>\n                  )}\n                </ScrollArea>\n              </TabsContent>\n              \n              <TabsContent value=\"transcript\" className=\"mt-4\">\n                <ScrollArea className=\"h-[400px]\">\n                  <div className=\"prose prose-sm dark:prose-invert max-w-none\">\n                    <pre className=\"whitespace-pre-wrap text-sm font-mono bg-muted p-4 rounded-lg\">\n                      {selectedTranscript.rawTranscript}\n                    </pre>\n                  </div>\n                </ScrollArea>\n              </TabsContent>\n            </Tabs>\n\n            <DialogFooter className=\"gap-2\">\n              <Button variant=\"outline\" onClick={() => setSelectedTranscript(null)}>\n                Close\n              </Button>\n              {selectedTranscript.status === 'reviewed' && (\n                <Button\n                  onClick={() => finalizeTranscriptMutation.mutate(selectedTranscript.id)}\n                  disabled={finalizeTranscriptMutation.isPending || !selectedTranscript.extractedKnowledge?.some(k => k.approved)}\n                  className=\"bg-gradient-to-r from-primary to-cyan-500\"\n                  data-testid=\"button-finalize\"\n                >\n                  {finalizeTranscriptMutation.isPending ? (\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                  )}\n                  Add to Knowledge Base\n                </Button>\n              )}\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":23862,"size_tokens":null},"client/src/components/stormy-sidekick.tsx":{"content":"import { useState, useRef, useEffect } from 'react';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';\nimport { apiRequestRaw, apiRequest } from '@/lib/queryClient';\nimport { WinnMethodologyStep } from '@shared/schema';\nimport { \n  MessageCircle, X, Send, Sparkles, HelpCircle, BookOpen, \n  CheckCircle2, AlertTriangle, ChevronUp, ChevronDown, Loader2,\n  GraduationCap, Lightbulb, Target, Bot\n} from 'lucide-react';\nimport stormyAvatar from '@assets/ChatGPT Image Jul 31, 2025, 03_42_36 PM_1753998186905.png';\n\ninterface Message {\n  id: string;\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: Date;\n}\n\ninterface StormySidekickProps {\n  currentStep?: WinnMethodologyStep | null;\n  experienceLevel?: 'beginner' | 'intermediate' | 'expert';\n  propertyId?: number | null;\n  sessionId?: number | null;\n  evidenceCount?: number;\n  onLevelChange?: (level: 'beginner' | 'intermediate' | 'expert') => void;\n  isFloating?: boolean;\n  className?: string;\n}\n\nconst STEP_QUICK_QUESTIONS: Record<WinnMethodologyStep, string[]> = {\n  weather_verification: [\n    \"What weather data sources should I check?\",\n    \"How do I verify a hail event date?\",\n    \"What size hail causes significant damage?\"\n  ],\n  thermal_imaging: [\n    \"What temperature anomalies indicate damage?\",\n    \"How do I interpret thermal patterns?\",\n    \"When is the best time for thermal scans?\"\n  ],\n  terrestrial_walk: [\n    \"What ground-level damage should I document?\",\n    \"How do I identify soft metal damage?\",\n    \"What photos are essential from ground level?\"\n  ],\n  test_squares: [\n    \"How large should test squares be?\",\n    \"How many impacts indicate significant damage?\",\n    \"Where should I place test squares?\"\n  ],\n  soft_metals: [\n    \"What qualifies as soft metal damage?\",\n    \"How do I photograph dents properly?\",\n    \"What's the significance of soft metal patterns?\"\n  ],\n  moisture_testing: [\n    \"What moisture levels indicate problems?\",\n    \"Where should I take moisture readings?\",\n    \"How often should I calibrate the meter?\"\n  ],\n  core_samples: [\n    \"When are core samples necessary?\",\n    \"How do I extract samples safely?\",\n    \"What should I look for in core samples?\"\n  ],\n  report_assembly: [\n    \"What sections are required in the report?\",\n    \"How do I organize the evidence?\",\n    \"What conclusions should I include?\"\n  ]\n};\n\nexport function StormySidekick({\n  currentStep,\n  experienceLevel = 'beginner',\n  propertyId,\n  sessionId,\n  evidenceCount = 0,\n  onLevelChange,\n  isFloating = true,\n  className = ''\n}: StormySidekickProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [message, setMessage] = useState('');\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [showQuickQuestions, setShowQuickQuestions] = useState(true);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  useEffect(() => {\n    if (isOpen && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isOpen]);\n\n  interface CoachingContent {\n    welcome: string;\n    objectives: string[];\n    checklist: string[];\n    whyItMatters: string;\n    commonMistakes: string[];\n    tips: string[];\n  }\n\n  const { data: coaching, isLoading: isLoadingCoaching } = useQuery<CoachingContent | null>({\n    queryKey: ['/api/inspection/coaching', currentStep, experienceLevel],\n    queryFn: async (): Promise<CoachingContent | null> => {\n      if (!currentStep) return null;\n      const response = await apiRequestRaw(\n        'GET',\n        `/api/inspection/coaching?step=${currentStep}&level=${experienceLevel}`\n      );\n      return response.json();\n    },\n    enabled: !!currentStep\n  });\n\n  const chatMutation = useMutation({\n    mutationFn: async (userMessage: string) => {\n      const context = {\n        currentStep,\n        experienceLevel,\n        propertyId,\n        sessionId,\n        evidenceCount,\n        recentMessages: messages.slice(-5).map(m => ({\n          role: m.role,\n          content: m.content\n        }))\n      };\n      \n      const response = await apiRequestRaw('POST', '/api/ai/chat', {\n        message: userMessage,\n        context\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setMessages(prev => [...prev, {\n        id: Date.now().toString(),\n        role: 'assistant',\n        content: data.response,\n        timestamp: new Date()\n      }]);\n    },\n    onError: (error) => {\n      setMessages(prev => [...prev, {\n        id: Date.now().toString(),\n        role: 'assistant',\n        content: \"I'm having trouble connecting right now. Please try again in a moment.\",\n        timestamp: new Date()\n      }]);\n    }\n  });\n\n  const handleSendMessage = (text?: string) => {\n    const messageText = text || message.trim();\n    if (!messageText) return;\n    \n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: 'user',\n      content: messageText,\n      timestamp: new Date()\n    };\n    \n    setMessages(prev => [...prev, userMessage]);\n    setMessage('');\n    setShowQuickQuestions(false);\n    chatMutation.mutate(messageText);\n  };\n\n  const handleQuickQuestion = (question: string) => {\n    handleSendMessage(question);\n  };\n\n  if (!isFloating) {\n    return (\n      <Card className={`border-primary/30 ${className}`}>\n        <CardHeader className=\"pb-2\">\n          <CardTitle className=\"flex items-center gap-2 text-lg\">\n            <div className=\"relative\">\n              <img \n                src={stormyAvatar} \n                alt=\"Stormy\" \n                className=\"w-8 h-8 rounded-full object-cover\"\n              />\n              <div className=\"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-background\" />\n            </div>\n            Stormy's Guidance\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoadingCoaching ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n            </div>\n          ) : coaching ? (\n            <div className=\"space-y-4\">\n              <p className=\"text-sm\">{coaching.welcome}</p>\n              \n              {coaching.objectives.length > 0 && (\n                <div>\n                  <p className=\"text-sm font-medium flex items-center gap-2 mb-2\">\n                    <Target className=\"h-4 w-4 text-primary\" />\n                    Objectives\n                  </p>\n                  <ul className=\"text-sm text-muted-foreground space-y-1 ml-6\">\n                    {coaching.objectives.map((obj, i) => (\n                      <li key={i} className=\"list-disc\">{obj}</li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n\n              {coaching.whyItMatters && (\n                <div className=\"p-3 rounded-lg bg-amber-500/10 border border-amber-500/20\">\n                  <p className=\"text-sm font-medium flex items-center gap-2 mb-1\">\n                    <Lightbulb className=\"h-4 w-4 text-amber-500\" />\n                    Why This Matters\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">{coaching.whyItMatters}</p>\n                </div>\n              )}\n            </div>\n          ) : (\n            <p className=\"text-sm text-muted-foreground\">\n              Start an inspection to get personalized guidance from Stormy!\n            </p>\n          )}\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <>\n      {!isOpen && (\n        <Button\n          onClick={() => setIsOpen(true)}\n          className=\"fixed bottom-24 right-4 z-50 h-14 w-14 rounded-full shadow-lg bg-gradient-to-r from-primary to-cyan-500 hover:from-primary/90 hover:to-cyan-500/90\"\n          data-testid=\"button-stormy-chat\"\n        >\n          <div className=\"relative\">\n            <img \n              src={stormyAvatar} \n              alt=\"Stormy\" \n              className=\"w-10 h-10 rounded-full object-cover\"\n            />\n            <div className=\"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-background flex items-center justify-center\">\n              <MessageCircle className=\"h-2 w-2 text-white\" />\n            </div>\n          </div>\n        </Button>\n      )}\n\n      {isOpen && (\n        <Card \n          className=\"fixed bottom-24 right-4 z-50 w-[90vw] max-w-[380px] shadow-2xl border-primary/30 flex flex-col max-h-[70vh]\"\n          data-testid=\"stormy-chat-panel\"\n        >\n          <CardHeader className=\"pb-2 flex-shrink-0\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"flex items-center gap-2 text-lg\">\n                <div className=\"relative\">\n                  <img \n                    src={stormyAvatar} \n                    alt=\"Stormy\" \n                    className=\"w-8 h-8 rounded-full object-cover\"\n                  />\n                  <div className=\"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-background\" />\n                </div>\n                Stormy\n              </CardTitle>\n              <div className=\"flex items-center gap-2\">\n                {onLevelChange && (\n                  <Badge \n                    variant=\"outline\" \n                    className=\"cursor-pointer hover:bg-primary/10\"\n                    onClick={() => {\n                      const levels: ('beginner' | 'intermediate' | 'expert')[] = ['beginner', 'intermediate', 'expert'];\n                      const currentIndex = levels.indexOf(experienceLevel);\n                      const nextLevel = levels[(currentIndex + 1) % 3];\n                      onLevelChange(nextLevel);\n                    }}\n                    data-testid=\"badge-experience-level\"\n                  >\n                    <GraduationCap className=\"h-3 w-3 mr-1\" />\n                    {experienceLevel}\n                  </Badge>\n                )}\n                <Button \n                  variant=\"ghost\" \n                  size=\"icon\" \n                  onClick={() => setIsOpen(false)}\n                  className=\"h-8 w-8\"\n                  data-testid=\"button-close-chat\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n            {currentStep && (\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Helping with: {currentStep.replace(/_/g, ' ')}\n              </p>\n            )}\n          </CardHeader>\n\n          <CardContent className=\"flex-1 flex flex-col min-h-0 p-0\">\n            <ScrollArea className=\"flex-1 px-4\">\n              <div className=\"space-y-4 py-4\">\n                {messages.length === 0 && coaching && (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex gap-3\">\n                      <div className=\"flex-shrink-0\">\n                        <img \n                          src={stormyAvatar} \n                          alt=\"Stormy\" \n                          className=\"w-8 h-8 rounded-full object-cover\"\n                        />\n                      </div>\n                      <div className=\"bg-muted rounded-lg p-3 text-sm max-w-[85%]\">\n                        <p>{coaching.welcome}</p>\n                        {coaching.tips.length > 0 && (\n                          <div className=\"mt-2 flex flex-wrap gap-1\">\n                            {coaching.tips.slice(0, 2).map((tip, i) => (\n                              <Badge key={i} variant=\"outline\" className=\"text-xs\">\n                                <Lightbulb className=\"h-2 w-2 mr-1\" />\n                                {tip}\n                              </Badge>\n                            ))}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {messages.map((msg) => (\n                  <div \n                    key={msg.id} \n                    className={`flex gap-3 ${msg.role === 'user' ? 'flex-row-reverse' : ''}`}\n                  >\n                    {msg.role === 'assistant' && (\n                      <div className=\"flex-shrink-0\">\n                        <img \n                          src={stormyAvatar} \n                          alt=\"Stormy\" \n                          className=\"w-8 h-8 rounded-full object-cover\"\n                        />\n                      </div>\n                    )}\n                    <div \n                      className={`rounded-lg p-3 text-sm max-w-[85%] ${\n                        msg.role === 'user' \n                          ? 'bg-primary text-primary-foreground ml-auto' \n                          : 'bg-muted'\n                      }`}\n                    >\n                      <p className=\"whitespace-pre-wrap\">{msg.content}</p>\n                    </div>\n                  </div>\n                ))}\n\n                {chatMutation.isPending && (\n                  <div className=\"flex gap-3\">\n                    <div className=\"flex-shrink-0\">\n                      <img \n                        src={stormyAvatar} \n                        alt=\"Stormy\" \n                        className=\"w-8 h-8 rounded-full object-cover\"\n                      />\n                    </div>\n                    <div className=\"bg-muted rounded-lg p-3\">\n                      <Loader2 className=\"h-4 w-4 animate-spin text-primary\" />\n                    </div>\n                  </div>\n                )}\n\n                <div ref={messagesEndRef} />\n              </div>\n            </ScrollArea>\n\n            {showQuickQuestions && currentStep && STEP_QUICK_QUESTIONS[currentStep] && messages.length < 2 && (\n              <div className=\"px-4 pb-2 flex-shrink-0\">\n                <Collapsible defaultOpen>\n                  <CollapsibleTrigger asChild>\n                    <Button variant=\"ghost\" size=\"sm\" className=\"w-full justify-between text-xs text-muted-foreground\">\n                      <span className=\"flex items-center gap-1\">\n                        <HelpCircle className=\"h-3 w-3\" />\n                        Quick Questions\n                      </span>\n                      <ChevronDown className=\"h-3 w-3\" />\n                    </Button>\n                  </CollapsibleTrigger>\n                  <CollapsibleContent>\n                    <div className=\"flex flex-wrap gap-1 mt-2\">\n                      {STEP_QUICK_QUESTIONS[currentStep].map((q, i) => (\n                        <Button\n                          key={i}\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"text-xs h-auto py-1 px-2\"\n                          onClick={() => handleQuickQuestion(q)}\n                          data-testid={`quick-question-${i}`}\n                        >\n                          {q}\n                        </Button>\n                      ))}\n                    </div>\n                  </CollapsibleContent>\n                </Collapsible>\n              </div>\n            )}\n\n            <div className=\"p-4 border-t flex-shrink-0\">\n              <form \n                onSubmit={(e) => {\n                  e.preventDefault();\n                  handleSendMessage();\n                }}\n                className=\"flex gap-2\"\n              >\n                <Input\n                  ref={inputRef}\n                  value={message}\n                  onChange={(e) => setMessage(e.target.value)}\n                  placeholder=\"Ask Stormy anything...\"\n                  className=\"flex-1\"\n                  disabled={chatMutation.isPending}\n                  data-testid=\"input-stormy-message\"\n                />\n                <Button \n                  type=\"submit\" \n                  size=\"icon\"\n                  disabled={chatMutation.isPending || !message.trim()}\n                  className=\"bg-gradient-to-r from-primary to-cyan-500\"\n                  data-testid=\"button-send-message\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </form>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </>\n  );\n}\n","path":null,"size_bytes":16691,"size_tokens":null},"client/src/pages/careers.tsx":{"content":"import { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { SEO } from '@/components/seo';\nimport { \n  Briefcase, \n  MapPin, \n  Clock, \n  Users, \n  Zap, \n  Heart,\n  Coffee,\n  Laptop,\n  TrendingUp,\n  ArrowRight,\n  Home,\n  Building,\n  Globe,\n  DollarSign\n} from 'lucide-react';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\nconst Careers = () => {\n  const openPositions = [\n    {\n      title: \"Senior Full-Stack Engineer\",\n      department: \"Engineering\",\n      location: \"Remote (US)\",\n      type: \"Full-time\",\n      salary: \"$150K - $200K\",\n      description: \"Build and scale our damage assessment platform using React, Node.js, and PostgreSQL.\",\n      requirements: [\"5+ years experience\", \"React/TypeScript\", \"Node.js\", \"PostgreSQL\"]\n    },\n    {\n      title: \"AI/ML Engineer\",\n      department: \"Engineering\",\n      location: \"Remote (US)\",\n      type: \"Full-time\",\n      salary: \"$160K - $220K\",\n      description: \"Enhance Stormy AI's thermal analysis and damage detection capabilities using GPT and computer vision.\",\n      requirements: [\"3+ years ML experience\", \"Python\", \"Computer Vision\", \"LLMs\"]\n    },\n    {\n      title: \"Senior Damage Assessment Consultant\",\n      department: \"Operations\",\n      location: \"Dallas, TX\",\n      type: \"Full-time\",\n      salary: \"$80K - $120K + Commission\",\n      description: \"Lead field inspections and train junior consultants in the Winn Methodology.\",\n      requirements: [\"5+ years roofing/claims\", \"Winn Certification\", \"Travel 50%\"]\n    },\n    {\n      title: \"Customer Success Manager\",\n      department: \"Customer Success\",\n      location: \"Remote (US)\",\n      type: \"Full-time\",\n      salary: \"$70K - $90K\",\n      description: \"Ensure our customers achieve their goals with WinnStorm platform adoption and training.\",\n      requirements: [\"3+ years B2B SaaS\", \"Insurance/Construction industry\", \"CRM experience\"]\n    },\n    {\n      title: \"Product Marketing Manager\",\n      department: \"Marketing\",\n      location: \"Remote (US)\",\n      type: \"Full-time\",\n      salary: \"$100K - $140K\",\n      description: \"Drive go-to-market strategy and positioning for our damage assessment platform.\",\n      requirements: [\"5+ years product marketing\", \"B2B SaaS\", \"Content creation\"]\n    },\n    {\n      title: \"Training Content Developer\",\n      department: \"Training\",\n      location: \"Remote (US)\",\n      type: \"Contract\",\n      salary: \"$50 - $75/hour\",\n      description: \"Create video courses and educational content for the Winn Methodology certification program.\",\n      requirements: [\"Video production\", \"Instructional design\", \"Insurance/Construction knowledge\"]\n    }\n  ];\n\n  const benefits = [\n    { icon: Laptop, title: \"Remote-First\", description: \"Work from anywhere in the US\" },\n    { icon: Heart, title: \"Health & Wellness\", description: \"Medical, dental, vision + wellness stipend\" },\n    { icon: TrendingUp, title: \"401(k) Match\", description: \"4% employer match, immediate vesting\" },\n    { icon: Coffee, title: \"Unlimited PTO\", description: \"Take the time you need\" },\n    { icon: Zap, title: \"Learning Budget\", description: \"$2,000/year for professional development\" },\n    { icon: DollarSign, title: \"Equity\", description: \"Stock options for all full-time employees\" }\n  ];\n\n  const values = [\n    {\n      title: \"Customer Obsession\",\n      description: \"We exist to solve real problems for consultants and property owners.\"\n    },\n    {\n      title: \"Continuous Improvement\",\n      description: \"We're always learning, iterating, and raising the bar.\"\n    },\n    {\n      title: \"Transparency\",\n      description: \"Open communication and honest feedback drive our success.\"\n    },\n    {\n      title: \"Impact Over Activity\",\n      description: \"We focus on outcomes, not just staying busy.\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"Careers at WinnStorm - Join Our Team\"\n        description=\"Join WinnStorm and help transform the property damage assessment industry. View open positions in engineering, operations, marketing, and more. Remote-friendly roles available.\"\n        canonical=\"/careers\"\n        keywords={['WinnStorm careers', 'damage assessment jobs', 'property tech jobs', 'remote engineering jobs', 'insurance technology careers']}\n      />\n\n      {/* Navigation */}\n      <nav className=\"sticky top-0 z-50 bg-background/95 backdrop-blur-md border-b border-border\">\n        <div className=\"container mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <Link href=\"/\">\n              <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-10 w-auto cursor-pointer\" />\n            </Link>\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <Home className=\"h-4 w-4 mr-2\" />\n                  Home\n                </Button>\n              </Link>\n              <Link href=\"/about\">\n                <Button variant=\"ghost\" size=\"sm\">About Us</Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-b from-primary/10 to-background relative overflow-hidden\">\n        <div className=\"absolute inset-0 opacity-20\">\n          <div className=\"absolute top-20 left-[10%] w-72 h-72 bg-gradient-to-r from-primary/40 to-cyan-500/40 rounded-full blur-3xl\"></div>\n          <div className=\"absolute bottom-20 right-[15%] w-96 h-96 bg-gradient-to-r from-cyan-500/30 to-blue-500/30 rounded-full blur-3xl\"></div>\n        </div>\n        \n        <div className=\"container mx-auto px-6 relative z-10\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <Badge className=\"mb-6 bg-primary/10 text-primary border-primary/30\">We're Hiring</Badge>\n            <h1 className=\"text-4xl md:text-6xl font-bold mb-6\">\n              Build the Future of <span className=\"bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent\">Property Assessment</span>\n            </h1>\n            <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto mb-8\">\n              Join a team that's revolutionizing how damage assessments are conducted. \n              We're looking for passionate people who want to make a real impact.\n            </p>\n            <Button size=\"lg\" className=\"bg-gradient-to-r from-primary to-cyan-500\" asChild>\n              <a href=\"#positions\">\n                View Open Positions\n                <ArrowRight className=\"h-5 w-5 ml-2\" />\n              </a>\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* Stats */}\n      <section className=\"py-12 border-b border-border\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-8 max-w-4xl mx-auto text-center\">\n            <div>\n              <div className=\"text-4xl font-bold text-primary mb-2\">35+</div>\n              <div className=\"text-sm text-muted-foreground\">Team Members</div>\n            </div>\n            <div>\n              <div className=\"text-4xl font-bold text-primary mb-2\">15</div>\n              <div className=\"text-sm text-muted-foreground\">States Represented</div>\n            </div>\n            <div>\n              <div className=\"text-4xl font-bold text-primary mb-2\">100%</div>\n              <div className=\"text-sm text-muted-foreground\">Remote-Friendly</div>\n            </div>\n            <div>\n              <div className=\"text-4xl font-bold text-primary mb-2\">4.8</div>\n              <div className=\"text-sm text-muted-foreground\">Glassdoor Rating</div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Benefits */}\n      <section className=\"py-20\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl font-bold mb-4\">Why Join WinnStorm?</h2>\n            <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n              We offer competitive compensation and benefits designed to support your whole life.\n            </p>\n          </div>\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6 max-w-5xl mx-auto\">\n            {benefits.map((benefit, index) => {\n              const Icon = benefit.icon;\n              return (\n                <Card key={index} className=\"border-border/50 text-center hover:shadow-lg transition-shadow\">\n                  <CardContent className=\"p-4\">\n                    <Icon className=\"h-8 w-8 text-primary mx-auto mb-3\" />\n                    <h3 className=\"font-semibold text-sm mb-1\">{benefit.title}</h3>\n                    <p className=\"text-xs text-muted-foreground\">{benefit.description}</p>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n      </section>\n\n      {/* Values */}\n      <section className=\"py-20 bg-muted/30\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto\">\n            <div className=\"text-center mb-12\">\n              <h2 className=\"text-3xl font-bold mb-4\">Our Values</h2>\n              <p className=\"text-muted-foreground\">The principles that guide how we work together</p>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {values.map((value, index) => (\n                <Card key={index} className=\"border-border/50\">\n                  <CardContent className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold mb-2\">{value.title}</h3>\n                    <p className=\"text-muted-foreground\">{value.description}</p>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Open Positions */}\n      <section id=\"positions\" className=\"py-20\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl font-bold mb-4\">Open Positions</h2>\n            <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n              Find your next opportunity and help us transform property damage assessment.\n            </p>\n          </div>\n          \n          <div className=\"max-w-4xl mx-auto space-y-6\">\n            {openPositions.map((position, index) => (\n              <Card key={index} className=\"border-border/50 hover:shadow-lg transition-shadow\">\n                <CardHeader>\n                  <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n                    <div>\n                      <CardTitle className=\"text-xl mb-2\">{position.title}</CardTitle>\n                      <div className=\"flex flex-wrap gap-3 text-sm text-muted-foreground\">\n                        <span className=\"flex items-center gap-1\">\n                          <Building className=\"h-4 w-4\" />\n                          {position.department}\n                        </span>\n                        <span className=\"flex items-center gap-1\">\n                          <MapPin className=\"h-4 w-4\" />\n                          {position.location}\n                        </span>\n                        <span className=\"flex items-center gap-1\">\n                          <Clock className=\"h-4 w-4\" />\n                          {position.type}\n                        </span>\n                        <span className=\"flex items-center gap-1\">\n                          <DollarSign className=\"h-4 w-4\" />\n                          {position.salary}\n                        </span>\n                      </div>\n                    </div>\n                    <Button \n                      className=\"bg-gradient-to-r from-primary to-cyan-500 shrink-0\"\n                      onClick={() => window.location.href = `mailto:careers@winnstorm.com?subject=Application: ${position.title}`}\n                    >\n                      Apply Now\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-muted-foreground mb-4\">{position.description}</p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {position.requirements.map((req, reqIndex) => (\n                      <Badge key={reqIndex} variant=\"outline\" className=\"text-xs\">\n                        {req}\n                      </Badge>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"py-20 bg-gradient-to-r from-primary to-cyan-500 text-white\">\n        <div className=\"container mx-auto px-6 text-center\">\n          <Users className=\"h-16 w-16 mx-auto mb-6 opacity-80\" />\n          <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">Don't See Your Role?</h2>\n          <p className=\"text-xl opacity-90 mb-8 max-w-3xl mx-auto\">\n            We're always looking for talented people. Send us your resume and tell us how you can contribute.\n          </p>\n          <Button \n            size=\"lg\" \n            variant=\"secondary\"\n            onClick={() => window.location.href = 'mailto:careers@winnstorm.com?subject=General Application'}\n          >\n            Send Your Resume\n            <ArrowRight className=\"h-5 w-5 ml-2\" />\n          </Button>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"py-8 border-t border-border\">\n        <div className=\"container mx-auto px-6 text-center text-muted-foreground\">\n          <p>&copy; 2025 WinnStorm™. All rights reserved. Equal Opportunity Employer.</p>\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport default Careers;\n","path":null,"size_bytes":13999,"size_tokens":null},"client/src/pages/about.tsx":{"content":"import { Link } from 'wouter';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { SEO, organizationSchema } from '@/components/seo';\nimport { \n  Target, \n  Users, \n  Award, \n  Shield, \n  Heart,\n  Zap,\n  Globe,\n  ArrowRight,\n  Home,\n  CheckCircle,\n  Building,\n  TrendingUp\n} from 'lucide-react';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\nconst About = () => {\n  const values = [\n    {\n      icon: Target,\n      title: \"Precision\",\n      description: \"Every assessment is conducted with meticulous attention to detail, ensuring accurate and reliable results.\"\n    },\n    {\n      icon: Shield,\n      title: \"Integrity\",\n      description: \"We uphold the highest ethical standards in all our work, providing honest and unbiased assessments.\"\n    },\n    {\n      icon: Heart,\n      title: \"Service\",\n      description: \"We're committed to helping property owners and consultants navigate the claims process with confidence.\"\n    },\n    {\n      icon: Zap,\n      title: \"Innovation\",\n      description: \"We continuously improve our technology and methodology to stay at the forefront of the industry.\"\n    }\n  ];\n\n  const stats = [\n    { value: \"10,000+\", label: \"Properties Assessed\" },\n    { value: \"750+\", label: \"Certified Consultants\" },\n    { value: \"98.7%\", label: \"Accuracy Rate\" },\n    { value: \"50\", label: \"States Covered\" }\n  ];\n\n  const milestones = [\n    { year: \"2010\", event: \"Eric Winn develops the foundational damage assessment methodology\" },\n    { year: \"2015\", event: \"First formal certification program launched\" },\n    { year: \"2018\", event: \"Thermal analysis integration and AI development begins\" },\n    { year: \"2022\", event: \"WinnStorm platform launched with Stormy AI assistant\" },\n    { year: \"2024\", event: \"Mobile-first redesign and nationwide expansion\" },\n    { year: \"2025\", event: \"GPT-5.1 integration for advanced AI guidance\" }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"About WinnStorm - Our Mission & Story\"\n        description=\"Learn about WinnStorm and our mission to revolutionize property damage assessment. Founded on Eric Winn's proven methodology, we combine decades of expertise with cutting-edge AI technology.\"\n        canonical=\"/about\"\n        keywords={['WinnStorm company', 'about WinnStorm', 'Eric Winn methodology', 'damage assessment company', 'property inspection platform']}\n        structuredData={[organizationSchema]}\n      />\n\n      {/* Navigation */}\n      <nav className=\"sticky top-0 z-50 bg-background/95 backdrop-blur-md border-b border-border\">\n        <div className=\"container mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <Link href=\"/\">\n              <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-10 w-auto cursor-pointer\" />\n            </Link>\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <Home className=\"h-4 w-4 mr-2\" />\n                  Home\n                </Button>\n              </Link>\n              <Link href=\"/auth\">\n                <Button size=\"sm\" className=\"bg-gradient-to-r from-primary to-cyan-500\">Get Started</Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-b from-primary/10 to-background relative overflow-hidden\">\n        <div className=\"absolute inset-0 opacity-20\">\n          <div className=\"absolute top-20 left-[10%] w-72 h-72 bg-gradient-to-r from-primary/40 to-cyan-500/40 rounded-full blur-3xl\"></div>\n          <div className=\"absolute bottom-20 right-[15%] w-96 h-96 bg-gradient-to-r from-cyan-500/30 to-blue-500/30 rounded-full blur-3xl\"></div>\n        </div>\n        \n        <div className=\"container mx-auto px-6 relative z-10\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <Badge className=\"mb-6 bg-primary/10 text-primary border-primary/30\">About Us</Badge>\n            <h1 className=\"text-4xl md:text-6xl font-bold mb-6\">\n              Transforming Damage Assessment Through <span className=\"bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent\">Expertise & Technology</span>\n            </h1>\n            <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto\">\n              WinnStorm combines decades of field expertise with cutting-edge AI to help consultants \n              deliver accurate, comprehensive damage assessments that stand up to scrutiny.\n            </p>\n          </div>\n        </div>\n      </section>\n\n      {/* Stats */}\n      <section className=\"py-12 border-b border-border\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-8 max-w-4xl mx-auto\">\n            {stats.map((stat, index) => (\n              <div key={index} className=\"text-center\">\n                <div className=\"text-4xl font-bold bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent mb-2\">\n                  {stat.value}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">{stat.label}</div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Mission Section */}\n      <section className=\"py-20\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-5xl mx-auto\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-16 items-center\">\n              <div>\n                <Badge className=\"mb-4 bg-green-500/10 text-green-500 border-green-500/30\">Our Mission</Badge>\n                <h2 className=\"text-3xl font-bold mb-6\">Empowering Consultants to Deliver Excellence</h2>\n                <p className=\"text-muted-foreground mb-4\">\n                  Our mission is to democratize access to professional-grade damage assessment tools and training. \n                  We believe that every property owner deserves an accurate, fair assessment of storm damage, \n                  and every consultant deserves the tools to deliver that.\n                </p>\n                <p className=\"text-muted-foreground mb-6\">\n                  By combining Eric Winn's proven methodology with advanced AI technology, we're making \n                  expert-level assessments accessible to consultants at every stage of their career.\n                </p>\n                <ul className=\"space-y-3\">\n                  <li className=\"flex items-center gap-3\">\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                    <span>Standardized methodology for consistent results</span>\n                  </li>\n                  <li className=\"flex items-center gap-3\">\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                    <span>AI-powered guidance for every inspection</span>\n                  </li>\n                  <li className=\"flex items-center gap-3\">\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                    <span>Comprehensive training and certification</span>\n                  </li>\n                </ul>\n              </div>\n              <div className=\"bg-gradient-to-br from-primary/10 to-cyan-500/10 rounded-2xl p-8 border border-primary/20\">\n                <div className=\"grid grid-cols-2 gap-6\">\n                  {values.map((value, index) => {\n                    const Icon = value.icon;\n                    return (\n                      <div key={index} className=\"text-center\">\n                        <div className=\"bg-background rounded-full p-4 w-16 h-16 mx-auto mb-3 flex items-center justify-center shadow-lg\">\n                          <Icon className=\"h-7 w-7 text-primary\" />\n                        </div>\n                        <h3 className=\"font-semibold mb-1\">{value.title}</h3>\n                        <p className=\"text-xs text-muted-foreground\">{value.description}</p>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Story Section */}\n      <section className=\"py-20 bg-muted/30\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto\">\n            <div className=\"text-center mb-12\">\n              <Badge className=\"mb-4 bg-primary/10 text-primary border-primary/30\">Our Story</Badge>\n              <h2 className=\"text-3xl font-bold mb-4\">From Field Experience to Industry Standard</h2>\n              <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n                WinnStorm was born from Eric Winn's decades of experience in property damage assessment \n                and his vision to share that expertise with the next generation of consultants.\n              </p>\n            </div>\n\n            <div className=\"relative\">\n              <div className=\"absolute left-8 top-0 bottom-0 w-0.5 bg-gradient-to-b from-primary to-cyan-500\"></div>\n              <div className=\"space-y-8\">\n                {milestones.map((milestone, index) => (\n                  <div key={index} className=\"relative pl-20\">\n                    <div className=\"absolute left-5 top-1 w-6 h-6 bg-gradient-to-r from-primary to-cyan-500 rounded-full flex items-center justify-center\">\n                      <div className=\"w-2 h-2 bg-white rounded-full\"></div>\n                    </div>\n                    <div className=\"bg-card border border-border/50 rounded-lg p-4\">\n                      <div className=\"text-sm text-primary font-semibold mb-1\">{milestone.year}</div>\n                      <div className=\"text-muted-foreground\">{milestone.event}</div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Team Vision */}\n      <section className=\"py-20\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-5xl mx-auto\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n              <Card className=\"border-border/50 hover:shadow-lg transition-shadow\">\n                <CardContent className=\"p-6 text-center\">\n                  <Building className=\"h-12 w-12 text-primary mx-auto mb-4\" />\n                  <h3 className=\"text-xl font-semibold mb-3\">Industry Leadership</h3>\n                  <p className=\"text-muted-foreground\">\n                    Setting the standard for property damage assessment methodology and certification.\n                  </p>\n                </CardContent>\n              </Card>\n              <Card className=\"border-border/50 hover:shadow-lg transition-shadow\">\n                <CardContent className=\"p-6 text-center\">\n                  <TrendingUp className=\"h-12 w-12 text-primary mx-auto mb-4\" />\n                  <h3 className=\"text-xl font-semibold mb-3\">Continuous Innovation</h3>\n                  <p className=\"text-muted-foreground\">\n                    Investing in AI and technology to keep our platform at the cutting edge.\n                  </p>\n                </CardContent>\n              </Card>\n              <Card className=\"border-border/50 hover:shadow-lg transition-shadow\">\n                <CardContent className=\"p-6 text-center\">\n                  <Globe className=\"h-12 w-12 text-primary mx-auto mb-4\" />\n                  <h3 className=\"text-xl font-semibold mb-3\">Nationwide Reach</h3>\n                  <p className=\"text-muted-foreground\">\n                    Supporting consultants and property owners across all 50 states.\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"py-20 bg-gradient-to-r from-primary to-cyan-500 text-white\">\n        <div className=\"container mx-auto px-6 text-center\">\n          <Users className=\"h-16 w-16 mx-auto mb-6 opacity-80\" />\n          <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">Join the WinnStorm Community</h2>\n          <p className=\"text-xl opacity-90 mb-8 max-w-3xl mx-auto\">\n            Whether you're starting your career or a seasoned professional, WinnStorm has the tools \n            and training to help you succeed.\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n            <Button size=\"lg\" variant=\"secondary\" asChild>\n              <Link href=\"/auth\">\n                Start Free Trial\n                <ArrowRight className=\"h-5 w-5 ml-2\" />\n              </Link>\n            </Button>\n            <Button size=\"lg\" variant=\"outline\" className=\"border-white text-white hover:bg-white hover:text-primary\" asChild>\n              <Link href=\"/careers\">\n                View Careers\n              </Link>\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"py-8 border-t border-border\">\n        <div className=\"container mx-auto px-6 text-center text-muted-foreground\">\n          <p>&copy; 2025 WinnStorm™. All rights reserved.</p>\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport default About;\n","path":null,"size_bytes":13375,"size_tokens":null},"client/src/pages/docs.tsx":{"content":"import { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { SEO } from '@/components/seo';\nimport { \n  Book, \n  FileText, \n  Video, \n  Code, \n  Thermometer, \n  Camera, \n  MapPin, \n  Cloud,\n  Search,\n  ArrowRight,\n  Clock,\n  CheckCircle,\n  Star,\n  Download,\n  ExternalLink,\n  Home\n} from 'lucide-react';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\nconst Docs = () => {\n  const categories = [\n    {\n      title: \"Getting Started\",\n      icon: Book,\n      description: \"Learn the basics of WinnStorm and set up your first inspection\",\n      articles: [\n        { title: \"Quick Start Guide\", time: \"5 min read\", popular: true },\n        { title: \"Account Setup & Configuration\", time: \"3 min read\" },\n        { title: \"Understanding the Dashboard\", time: \"4 min read\" },\n        { title: \"Your First Damage Assessment\", time: \"10 min read\", popular: true }\n      ]\n    },\n    {\n      title: \"Thermal Analysis\",\n      icon: Thermometer,\n      description: \"Master thermal imaging techniques with AI-powered analysis\",\n      articles: [\n        { title: \"Introduction to Thermal Imaging\", time: \"8 min read\", popular: true },\n        { title: \"Interpreting Temperature Differentials\", time: \"6 min read\" },\n        { title: \"Moisture Detection Patterns\", time: \"7 min read\" },\n        { title: \"Working with Stormy AI Analysis\", time: \"5 min read\" }\n      ]\n    },\n    {\n      title: \"Photo Documentation\",\n      icon: Camera,\n      description: \"Best practices for capturing evidence during inspections\",\n      articles: [\n        { title: \"Photo Standards for Insurance Claims\", time: \"6 min read\", popular: true },\n        { title: \"Documenting Hail Damage\", time: \"8 min read\" },\n        { title: \"Before & After Comparison Shots\", time: \"4 min read\" },\n        { title: \"Mobile Camera Tips for Field Use\", time: \"5 min read\" }\n      ]\n    },\n    {\n      title: \"Winn Reports\",\n      icon: FileText,\n      description: \"Generate comprehensive damage assessment reports\",\n      articles: [\n        { title: \"Anatomy of a Winn Report\", time: \"10 min read\", popular: true },\n        { title: \"Adding Evidence to Reports\", time: \"5 min read\" },\n        { title: \"Report Customization Options\", time: \"6 min read\" },\n        { title: \"Exporting & Sharing Reports\", time: \"4 min read\" }\n      ]\n    },\n    {\n      title: \"Weather Verification\",\n      icon: Cloud,\n      description: \"Access historical weather data for claim support\",\n      articles: [\n        { title: \"Understanding Weather Data Sources\", time: \"5 min read\" },\n        { title: \"Hail Storm Verification\", time: \"7 min read\", popular: true },\n        { title: \"Wind Damage Correlation\", time: \"6 min read\" },\n        { title: \"Integrating Weather Reports\", time: \"4 min read\" }\n      ]\n    },\n    {\n      title: \"Property Mapping\",\n      icon: MapPin,\n      description: \"Use satellite imagery and drawing tools effectively\",\n      articles: [\n        { title: \"Google Maps Integration Guide\", time: \"6 min read\" },\n        { title: \"Marking Roof Sections\", time: \"5 min read\", popular: true },\n        { title: \"Measuring Affected Areas\", time: \"4 min read\" },\n        { title: \"Saving & Exporting Maps\", time: \"3 min read\" }\n      ]\n    }\n  ];\n\n  const videoTutorials = [\n    { title: \"Complete Platform Walkthrough\", duration: \"15:32\", views: \"12.5K\" },\n    { title: \"Thermal Analysis Deep Dive\", duration: \"22:18\", views: \"8.3K\" },\n    { title: \"Creating Your First Winn Report\", duration: \"18:45\", views: \"10.1K\" },\n    { title: \"Field Inspection Best Practices\", duration: \"25:00\", views: \"7.8K\" }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"Documentation - WinnStorm Platform Guides\"\n        description=\"Comprehensive documentation for WinnStorm damage assessment platform. Learn thermal analysis, report generation, weather verification, and the Winn Methodology with step-by-step guides.\"\n        canonical=\"/docs\"\n        keywords={['WinnStorm documentation', 'damage assessment guide', 'thermal imaging tutorial', 'property inspection training', 'Winn Report guide']}\n      />\n\n      {/* Navigation */}\n      <nav className=\"sticky top-0 z-50 bg-background/95 backdrop-blur-md border-b border-border\">\n        <div className=\"container mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <Link href=\"/\">\n              <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-10 w-auto cursor-pointer\" />\n            </Link>\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <Home className=\"h-4 w-4 mr-2\" />\n                  Home\n                </Button>\n              </Link>\n              <Link href=\"/auth\">\n                <Button size=\"sm\" className=\"bg-gradient-to-r from-primary to-cyan-500\">Sign In</Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <section className=\"py-16 bg-gradient-to-b from-primary/5 to-background\">\n        <div className=\"container mx-auto px-6 text-center\">\n          <Badge className=\"mb-4 bg-primary/10 text-primary border-primary/30\">Documentation</Badge>\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-6\">\n            WinnStorm <span className=\"bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent\">Documentation</span>\n          </h1>\n          <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto mb-8\">\n            Everything you need to master damage assessment with WinnStorm. From getting started to advanced techniques, we've got you covered.\n          </p>\n          \n          {/* Search Bar */}\n          <div className=\"max-w-2xl mx-auto relative\">\n            <Search className=\"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n            <Input \n              placeholder=\"Search documentation...\" \n              className=\"pl-12 h-14 text-lg bg-card border-border\"\n              data-testid=\"input-docs-search\"\n            />\n          </div>\n        </div>\n      </section>\n\n      {/* Quick Links */}\n      <section className=\"py-8 border-b border-border\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"flex flex-wrap justify-center gap-4\">\n            <Button variant=\"outline\" size=\"sm\" asChild>\n              <Link href=\"/methodology\">\n                <Book className=\"h-4 w-4 mr-2\" />\n                Winn Methodology\n              </Link>\n            </Button>\n            <Button variant=\"outline\" size=\"sm\" asChild>\n              <Link href=\"/api-docs\">\n                <Code className=\"h-4 w-4 mr-2\" />\n                API Reference\n              </Link>\n            </Button>\n            <Button variant=\"outline\" size=\"sm\" asChild>\n              <Link href=\"/support\">\n                <FileText className=\"h-4 w-4 mr-2\" />\n                Support Center\n              </Link>\n            </Button>\n            <Button variant=\"outline\" size=\"sm\" asChild>\n              <Link href=\"/training\">\n                <Video className=\"h-4 w-4 mr-2\" />\n                Training Portal\n              </Link>\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* Documentation Categories */}\n      <section className=\"py-16\">\n        <div className=\"container mx-auto px-6\">\n          <h2 className=\"text-2xl font-bold mb-8\">Browse by Topic</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {categories.map((category, index) => {\n              const Icon = category.icon;\n              return (\n                <Card key={index} className=\"hover:shadow-lg transition-shadow border-border/50 h-full\">\n                  <CardHeader>\n                    <div className=\"flex items-center gap-3 mb-2\">\n                      <div className=\"bg-primary/10 p-2 rounded-lg\">\n                        <Icon className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <CardTitle className=\"text-lg\">{category.title}</CardTitle>\n                    </div>\n                    <CardDescription>{category.description}</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <ul className=\"space-y-3\">\n                      {category.articles.map((article, artIndex) => (\n                        <li key={artIndex}>\n                          <a \n                            href=\"#\" \n                            className=\"flex items-center justify-between text-sm hover:text-primary transition-colors group\"\n                          >\n                            <span className=\"flex items-center gap-2\">\n                              {article.title}\n                              {article.popular && (\n                                <Star className=\"h-3 w-3 text-yellow-500 fill-yellow-500\" />\n                              )}\n                            </span>\n                            <span className=\"flex items-center gap-2 text-muted-foreground\">\n                              <Clock className=\"h-3 w-3\" />\n                              {article.time}\n                            </span>\n                          </a>\n                        </li>\n                      ))}\n                    </ul>\n                    <Button variant=\"ghost\" size=\"sm\" className=\"mt-4 w-full\">\n                      View All Articles\n                      <ArrowRight className=\"h-4 w-4 ml-2\" />\n                    </Button>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n      </section>\n\n      {/* Video Tutorials */}\n      <section className=\"py-16 bg-muted/30\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"flex items-center justify-between mb-8\">\n            <div>\n              <h2 className=\"text-2xl font-bold\">Video Tutorials</h2>\n              <p className=\"text-muted-foreground\">Learn visually with our expert-led tutorials</p>\n            </div>\n            <Button variant=\"outline\" asChild>\n              <Link href=\"/training\">\n                View All\n                <ExternalLink className=\"h-4 w-4 ml-2\" />\n              </Link>\n            </Button>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n            {videoTutorials.map((video, index) => (\n              <Card key={index} className=\"hover:shadow-lg transition-shadow cursor-pointer group\">\n                <CardContent className=\"p-4\">\n                  <div className=\"aspect-video bg-gradient-to-br from-primary/20 to-cyan-500/20 rounded-lg mb-4 flex items-center justify-center group-hover:from-primary/30 group-hover:to-cyan-500/30 transition-colors\">\n                    <Video className=\"h-12 w-12 text-primary/60\" />\n                  </div>\n                  <h3 className=\"font-semibold mb-2 group-hover:text-primary transition-colors\">{video.title}</h3>\n                  <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n                    <span>{video.duration}</span>\n                    <span>{video.views} views</span>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Downloads Section */}\n      <section className=\"py-16\">\n        <div className=\"container mx-auto px-6\">\n          <h2 className=\"text-2xl font-bold mb-8\">Downloadable Resources</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <Card className=\"border-border/50\">\n              <CardContent className=\"p-6\">\n                <Download className=\"h-8 w-8 text-primary mb-4\" />\n                <h3 className=\"font-semibold mb-2\">Inspection Checklist</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">Complete checklist for comprehensive property inspections</p>\n                <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                  Download PDF\n                </Button>\n              </CardContent>\n            </Card>\n            <Card className=\"border-border/50\">\n              <CardContent className=\"p-6\">\n                <Download className=\"h-8 w-8 text-primary mb-4\" />\n                <h3 className=\"font-semibold mb-2\">Report Templates</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">Pre-formatted templates for various damage types</p>\n                <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                  Download Pack\n                </Button>\n              </CardContent>\n            </Card>\n            <Card className=\"border-border/50\">\n              <CardContent className=\"p-6\">\n                <Download className=\"h-8 w-8 text-primary mb-4\" />\n                <h3 className=\"font-semibold mb-2\">Quick Reference Card</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">Pocket-sized guide for field use</p>\n                <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                  Download PDF\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"py-16 bg-gradient-to-r from-primary to-cyan-500 text-white\">\n        <div className=\"container mx-auto px-6 text-center\">\n          <h2 className=\"text-3xl font-bold mb-4\">Need More Help?</h2>\n          <p className=\"text-xl opacity-90 mb-8 max-w-2xl mx-auto\">\n            Can't find what you're looking for? Our support team is ready to assist you.\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n            <Button size=\"lg\" variant=\"secondary\" asChild>\n              <Link href=\"/support\">\n                Contact Support\n              </Link>\n            </Button>\n            <Button size=\"lg\" variant=\"outline\" className=\"border-white text-white hover:bg-white hover:text-primary\" asChild>\n              <Link href=\"/training\">\n                Start Training\n              </Link>\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"py-8 border-t border-border\">\n        <div className=\"container mx-auto px-6 text-center text-muted-foreground\">\n          <p>&copy; 2025 WinnStorm™. All rights reserved.</p>\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport default Docs;\n","path":null,"size_bytes":14773,"size_tokens":null},"client/src/pages/api-docs.tsx":{"content":"import { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { SEO } from '@/components/seo';\nimport { \n  Code, \n  Terminal, \n  Key, \n  Zap, \n  Shield,\n  FileJson,\n  Copy,\n  Check,\n  Home,\n  ExternalLink\n} from 'lucide-react';\nimport { useState } from 'react';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\nconst ApiDocs = () => {\n  const [copiedEndpoint, setCopiedEndpoint] = useState<string | null>(null);\n\n  const copyToClipboard = (text: string, endpoint: string) => {\n    navigator.clipboard.writeText(text);\n    setCopiedEndpoint(endpoint);\n    setTimeout(() => setCopiedEndpoint(null), 2000);\n  };\n\n  const endpoints = [\n    {\n      category: \"Authentication\",\n      endpoints: [\n        {\n          method: \"POST\",\n          path: \"/api/auth/login\",\n          description: \"Authenticate user and receive access token\",\n          requestBody: `{\n  \"email\": \"user@example.com\",\n  \"password\": \"securepassword\"\n}`,\n          responseBody: `{\n  \"token\": \"eyJhbGciOiJIUzI1NiIs...\",\n  \"user\": {\n    \"id\": \"123\",\n    \"email\": \"user@example.com\",\n    \"role\": \"consultant\"\n  }\n}`\n        },\n        {\n          method: \"POST\",\n          path: \"/api/auth/refresh\",\n          description: \"Refresh authentication token\",\n          requestBody: `{\n  \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\"\n}`,\n          responseBody: `{\n  \"token\": \"eyJhbGciOiJIUzI1NiIs...\",\n  \"expiresIn\": 3600\n}`\n        }\n      ]\n    },\n    {\n      category: \"Inspections\",\n      endpoints: [\n        {\n          method: \"POST\",\n          path: \"/api/inspections\",\n          description: \"Create a new inspection session\",\n          requestBody: `{\n  \"propertyId\": \"prop_123\",\n  \"type\": \"hail_damage\",\n  \"scheduledDate\": \"2025-01-15T10:00:00Z\"\n}`,\n          responseBody: `{\n  \"id\": \"insp_456\",\n  \"status\": \"pending\",\n  \"createdAt\": \"2025-01-10T08:30:00Z\"\n}`\n        },\n        {\n          method: \"GET\",\n          path: \"/api/inspections/:id\",\n          description: \"Retrieve inspection details\",\n          responseBody: `{\n  \"id\": \"insp_456\",\n  \"propertyId\": \"prop_123\",\n  \"status\": \"in_progress\",\n  \"steps\": {\n    \"weatherVerification\": \"complete\",\n    \"thermalAnalysis\": \"in_progress\"\n  }\n}`\n        },\n        {\n          method: \"PATCH\",\n          path: \"/api/inspections/:id/step\",\n          description: \"Update inspection step status\",\n          requestBody: `{\n  \"step\": \"thermalAnalysis\",\n  \"status\": \"complete\",\n  \"data\": { ... }\n}`,\n          responseBody: `{\n  \"success\": true,\n  \"nextStep\": \"photoDocumentation\"\n}`\n        }\n      ]\n    },\n    {\n      category: \"AI Analysis\",\n      endpoints: [\n        {\n          method: \"POST\",\n          path: \"/api/ai/thermal-analysis\",\n          description: \"Analyze thermal image for damage patterns\",\n          requestBody: `{\n  \"imageUrl\": \"https://storage.example.com/thermal-001.jpg\",\n  \"inspectionId\": \"insp_456\"\n}`,\n          responseBody: `{\n  \"analysis\": {\n    \"anomalies\": [...],\n    \"temperatureDifferential\": 8.5,\n    \"moistureIndicators\": true,\n    \"recommendations\": [...]\n  }\n}`\n        },\n        {\n          method: \"POST\",\n          path: \"/api/ai/assistant\",\n          description: \"Get AI-powered inspection guidance\",\n          requestBody: `{\n  \"message\": \"What should I look for next?\",\n  \"context\": {\n    \"currentStep\": \"thermalAnalysis\",\n    \"inspectionId\": \"insp_456\"\n  }\n}`,\n          responseBody: `{\n  \"response\": \"Based on the thermal scan...\",\n  \"suggestions\": [...]\n}`\n        }\n      ]\n    },\n    {\n      category: \"Reports\",\n      endpoints: [\n        {\n          method: \"POST\",\n          path: \"/api/reports\",\n          description: \"Generate a Winn Report\",\n          requestBody: `{\n  \"inspectionId\": \"insp_456\",\n  \"template\": \"comprehensive\",\n  \"includeEvidence\": true\n}`,\n          responseBody: `{\n  \"reportId\": \"rpt_789\",\n  \"status\": \"generating\",\n  \"estimatedTime\": 30\n}`\n        },\n        {\n          method: \"GET\",\n          path: \"/api/reports/:id/download\",\n          description: \"Download generated report\",\n          responseBody: `// Returns PDF binary`\n        }\n      ]\n    }\n  ];\n\n  const getMethodColor = (method: string) => {\n    switch (method) {\n      case 'GET': return 'bg-green-500/10 text-green-500 border-green-500/30';\n      case 'POST': return 'bg-blue-500/10 text-blue-500 border-blue-500/30';\n      case 'PATCH': return 'bg-yellow-500/10 text-yellow-500 border-yellow-500/30';\n      case 'DELETE': return 'bg-red-500/10 text-red-500 border-red-500/30';\n      default: return 'bg-gray-500/10 text-gray-500 border-gray-500/30';\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"API Reference - WinnStorm Developer Documentation\"\n        description=\"Complete API documentation for WinnStorm damage assessment platform. RESTful endpoints for inspections, AI analysis, reports, and integrations with code examples.\"\n        canonical=\"/api-docs\"\n        keywords={['WinnStorm API', 'damage assessment API', 'inspection API', 'thermal analysis API', 'developer documentation']}\n      />\n\n      {/* Navigation */}\n      <nav className=\"sticky top-0 z-50 bg-background/95 backdrop-blur-md border-b border-border\">\n        <div className=\"container mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <Link href=\"/\">\n              <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-10 w-auto cursor-pointer\" />\n            </Link>\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <Home className=\"h-4 w-4 mr-2\" />\n                  Home\n                </Button>\n              </Link>\n              <Link href=\"/docs\">\n                <Button variant=\"ghost\" size=\"sm\">Documentation</Button>\n              </Link>\n              <Link href=\"/auth\">\n                <Button size=\"sm\" className=\"bg-gradient-to-r from-primary to-cyan-500\">Sign In</Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <section className=\"py-16 bg-gradient-to-b from-primary/5 to-background\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl\">\n            <Badge className=\"mb-4 bg-primary/10 text-primary border-primary/30\">API Reference</Badge>\n            <h1 className=\"text-4xl md:text-5xl font-bold mb-6\">\n              WinnStorm <span className=\"bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent\">API</span>\n            </h1>\n            <p className=\"text-xl text-muted-foreground mb-8\">\n              Integrate WinnStorm's powerful damage assessment capabilities into your applications. \n              RESTful API with comprehensive endpoints for inspections, AI analysis, and report generation.\n            </p>\n            <div className=\"flex flex-wrap gap-4\">\n              <Card className=\"border-border/50 bg-card/50\">\n                <CardContent className=\"p-4 flex items-center gap-3\">\n                  <Shield className=\"h-5 w-5 text-green-500\" />\n                  <div>\n                    <div className=\"font-semibold\">OAuth 2.0</div>\n                    <div className=\"text-sm text-muted-foreground\">Secure authentication</div>\n                  </div>\n                </CardContent>\n              </Card>\n              <Card className=\"border-border/50 bg-card/50\">\n                <CardContent className=\"p-4 flex items-center gap-3\">\n                  <Zap className=\"h-5 w-5 text-yellow-500\" />\n                  <div>\n                    <div className=\"font-semibold\">Rate Limited</div>\n                    <div className=\"text-sm text-muted-foreground\">1000 req/min</div>\n                  </div>\n                </CardContent>\n              </Card>\n              <Card className=\"border-border/50 bg-card/50\">\n                <CardContent className=\"p-4 flex items-center gap-3\">\n                  <FileJson className=\"h-5 w-5 text-blue-500\" />\n                  <div>\n                    <div className=\"font-semibold\">JSON Response</div>\n                    <div className=\"text-sm text-muted-foreground\">Standard format</div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Base URL */}\n      <section className=\"py-8 border-b border-border\">\n        <div className=\"container mx-auto px-6\">\n          <h2 className=\"text-lg font-semibold mb-4\">Base URL</h2>\n          <div className=\"bg-muted/50 rounded-lg p-4 font-mono text-sm flex items-center justify-between\">\n            <span>https://api.winnstorm.com/v1</span>\n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              onClick={() => copyToClipboard('https://api.winnstorm.com/v1', 'base')}\n            >\n              {copiedEndpoint === 'base' ? <Check className=\"h-4 w-4\" /> : <Copy className=\"h-4 w-4\" />}\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* API Endpoints */}\n      <section className=\"py-16\">\n        <div className=\"container mx-auto px-6\">\n          <h2 className=\"text-2xl font-bold mb-8\">Endpoints</h2>\n          \n          {endpoints.map((category, catIndex) => (\n            <div key={catIndex} className=\"mb-12\">\n              <h3 className=\"text-xl font-semibold mb-6 flex items-center gap-2\">\n                <Terminal className=\"h-5 w-5 text-primary\" />\n                {category.category}\n              </h3>\n              \n              <div className=\"space-y-6\">\n                {category.endpoints.map((endpoint, endIndex) => (\n                  <Card key={endIndex} className=\"border-border/50 overflow-hidden\">\n                    <CardHeader className=\"bg-muted/30 border-b border-border/50 py-4\">\n                      <div className=\"flex items-center gap-4\">\n                        <Badge className={`${getMethodColor(endpoint.method)} font-mono`}>\n                          {endpoint.method}\n                        </Badge>\n                        <code className=\"text-sm font-mono\">{endpoint.path}</code>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"ml-auto\"\n                          onClick={() => copyToClipboard(endpoint.path, endpoint.path)}\n                        >\n                          {copiedEndpoint === endpoint.path ? <Check className=\"h-4 w-4\" /> : <Copy className=\"h-4 w-4\" />}\n                        </Button>\n                      </div>\n                      <CardDescription className=\"mt-2\">{endpoint.description}</CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"p-0\">\n                      <Tabs defaultValue=\"request\" className=\"w-full\">\n                        <TabsList className=\"w-full justify-start rounded-none border-b border-border/50 bg-transparent h-auto p-0\">\n                          {endpoint.requestBody && (\n                            <TabsTrigger \n                              value=\"request\" \n                              className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent px-6 py-3\"\n                            >\n                              Request Body\n                            </TabsTrigger>\n                          )}\n                          <TabsTrigger \n                            value=\"response\"\n                            className=\"rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent px-6 py-3\"\n                          >\n                            Response\n                          </TabsTrigger>\n                        </TabsList>\n                        {endpoint.requestBody && (\n                          <TabsContent value=\"request\" className=\"m-0\">\n                            <pre className=\"p-4 bg-zinc-950 text-zinc-100 text-sm overflow-x-auto\">\n                              <code>{endpoint.requestBody}</code>\n                            </pre>\n                          </TabsContent>\n                        )}\n                        <TabsContent value=\"response\" className=\"m-0\">\n                          <pre className=\"p-4 bg-zinc-950 text-zinc-100 text-sm overflow-x-auto\">\n                            <code>{endpoint.responseBody}</code>\n                          </pre>\n                        </TabsContent>\n                      </Tabs>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          ))}\n        </div>\n      </section>\n\n      {/* Authentication Section */}\n      <section className=\"py-16 bg-muted/30\">\n        <div className=\"container mx-auto px-6\">\n          <h2 className=\"text-2xl font-bold mb-8 flex items-center gap-2\">\n            <Key className=\"h-6 w-6 text-primary\" />\n            Authentication\n          </h2>\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            <Card className=\"border-border/50\">\n              <CardHeader>\n                <CardTitle>API Key Authentication</CardTitle>\n                <CardDescription>Include your API key in the request header</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <pre className=\"p-4 bg-zinc-950 text-zinc-100 text-sm rounded-lg overflow-x-auto\">\n{`curl -X GET https://api.winnstorm.com/v1/inspections \\\\\n  -H \"Authorization: Bearer YOUR_API_KEY\" \\\\\n  -H \"Content-Type: application/json\"`}\n                </pre>\n              </CardContent>\n            </Card>\n            <Card className=\"border-border/50\">\n              <CardHeader>\n                <CardTitle>Getting Your API Key</CardTitle>\n                <CardDescription>Generate keys from your dashboard</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <p className=\"text-muted-foreground\">\n                  1. Sign in to your WinnStorm account<br/>\n                  2. Navigate to Settings → API Keys<br/>\n                  3. Click \"Generate New Key\"<br/>\n                  4. Copy and securely store your key\n                </p>\n                <Button asChild>\n                  <Link href=\"/dashboard\">\n                    Go to Dashboard\n                    <ExternalLink className=\"h-4 w-4 ml-2\" />\n                  </Link>\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* SDKs Section */}\n      <section className=\"py-16\">\n        <div className=\"container mx-auto px-6\">\n          <h2 className=\"text-2xl font-bold mb-8\">SDKs & Libraries</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <Card className=\"border-border/50 hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-6\">\n                <Code className=\"h-8 w-8 text-yellow-500 mb-4\" />\n                <h3 className=\"font-semibold mb-2\">JavaScript / TypeScript</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">npm install @winnstorm/sdk</p>\n                <Badge variant=\"outline\">Coming Soon</Badge>\n              </CardContent>\n            </Card>\n            <Card className=\"border-border/50 hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-6\">\n                <Code className=\"h-8 w-8 text-blue-500 mb-4\" />\n                <h3 className=\"font-semibold mb-2\">Python</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">pip install winnstorm</p>\n                <Badge variant=\"outline\">Coming Soon</Badge>\n              </CardContent>\n            </Card>\n            <Card className=\"border-border/50 hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-6\">\n                <Code className=\"h-8 w-8 text-cyan-500 mb-4\" />\n                <h3 className=\"font-semibold mb-2\">REST API</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">Direct HTTP requests</p>\n                <Badge className=\"bg-green-500/10 text-green-500 border-green-500/30\">Available</Badge>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"py-16 bg-gradient-to-r from-primary to-cyan-500 text-white\">\n        <div className=\"container mx-auto px-6 text-center\">\n          <h2 className=\"text-3xl font-bold mb-4\">Ready to Integrate?</h2>\n          <p className=\"text-xl opacity-90 mb-8 max-w-2xl mx-auto\">\n            Start building with the WinnStorm API today. Get your API key and access comprehensive documentation.\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n            <Button size=\"lg\" variant=\"secondary\" asChild>\n              <Link href=\"/auth\">\n                Get API Key\n              </Link>\n            </Button>\n            <Button size=\"lg\" variant=\"outline\" className=\"border-white text-white hover:bg-white hover:text-primary\" asChild>\n              <Link href=\"/support\">\n                Contact Sales\n              </Link>\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"py-8 border-t border-border\">\n        <div className=\"container mx-auto px-6 text-center text-muted-foreground\">\n          <p>&copy; 2025 WinnStorm™. All rights reserved.</p>\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport default ApiDocs;\n","path":null,"size_bytes":17863,"size_tokens":null},"client/src/pages/support.tsx":{"content":"import { useState } from 'react';\nimport { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';\nimport { SEO, faqSchema } from '@/components/seo';\nimport { useToast } from '@/hooks/use-toast';\nimport { \n  MessageCircle, \n  Mail, \n  Phone, \n  FileText, \n  HelpCircle,\n  Search,\n  Clock,\n  CheckCircle,\n  Home,\n  Send,\n  Headphones,\n  Book,\n  Video\n} from 'lucide-react';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\nconst Support = () => {\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    subject: '',\n    message: ''\n  });\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n    \n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    toast({\n      title: \"Message Sent\",\n      description: \"We'll get back to you within 24 hours.\",\n    });\n    \n    setFormData({ name: '', email: '', subject: '', message: '' });\n    setIsSubmitting(false);\n  };\n\n  const faqs = [\n    {\n      question: \"How do I get started with WinnStorm?\",\n      answer: \"Getting started is easy! Sign up for a free trial, complete our quick onboarding tour, and you'll be ready to conduct your first inspection. Our Stormy AI assistant will guide you through each step of the Winn Methodology.\"\n    },\n    {\n      question: \"What equipment do I need for thermal analysis?\",\n      answer: \"WinnStorm works with most FLIR thermal cameras and smartphone thermal attachments. We support FLIR ONE Pro, FLIR E-series, and similar devices. Our platform can analyze thermal images from any standard format (JPEG, PNG, RADIOMETRIC).\"\n    },\n    {\n      question: \"How does the certification program work?\",\n      answer: \"Our certification program consists of two levels: Junior Consultant and Senior Consultant. You'll complete online courses, pass knowledge assessments, and demonstrate practical skills. Certification typically takes 2-4 weeks for Junior level and 6-8 weeks for Senior level.\"\n    },\n    {\n      question: \"Can I use WinnStorm offline in the field?\",\n      answer: \"Yes! Our mobile app includes offline capability. You can capture photos, thermal images, and notes without internet connection. Data syncs automatically when you're back online.\"\n    },\n    {\n      question: \"How accurate is the AI thermal analysis?\",\n      answer: \"Our Stormy AI is trained on thousands of verified thermal images and achieves 98.7% accuracy in identifying moisture intrusion and temperature anomalies. However, it's designed to assist, not replace, professional judgment.\"\n    },\n    {\n      question: \"What's included in a Winn Report?\",\n      answer: \"A comprehensive Winn Report includes property details, weather verification, thermal analysis results, photo documentation, damage assessment findings, repair recommendations, and cost estimates. Reports are formatted for insurance submission.\"\n    },\n    {\n      question: \"How do I cancel my subscription?\",\n      answer: \"You can cancel anytime from your account settings. Your access continues until the end of your billing period. We also offer a 14-day money-back guarantee for new subscribers.\"\n    },\n    {\n      question: \"Is my data secure?\",\n      answer: \"Absolutely. WinnStorm uses enterprise-grade security including 256-bit encryption for all data in transit and at rest, secure Firebase authentication, and PCI-compliant payment processing through Stripe. We never share your inspection data with third parties.\"\n    }\n  ];\n\n  const supportChannels = [\n    {\n      icon: MessageCircle,\n      title: \"Live Chat\",\n      description: \"Chat with our support team in real-time\",\n      availability: \"Mon-Fri, 9AM-6PM EST\",\n      action: \"Start Chat\",\n      color: \"text-green-500\"\n    },\n    {\n      icon: Mail,\n      title: \"Email Support\",\n      description: \"Get detailed responses to complex questions\",\n      availability: \"Response within 24 hours\",\n      action: \"Send Email\",\n      href: \"mailto:support@winnstorm.com\",\n      color: \"text-blue-500\"\n    },\n    {\n      icon: Phone,\n      title: \"Phone Support\",\n      description: \"Speak directly with a support specialist\",\n      availability: \"Professional & Enterprise plans\",\n      action: \"Call Now\",\n      href: \"tel:+15551234966\",\n      color: \"text-purple-500\"\n    }\n  ];\n\n  const resources = [\n    {\n      icon: Book,\n      title: \"Documentation\",\n      description: \"Comprehensive guides and tutorials\",\n      href: \"/docs\"\n    },\n    {\n      icon: Video,\n      title: \"Video Tutorials\",\n      description: \"Step-by-step visual guides\",\n      href: \"/training\"\n    },\n    {\n      icon: FileText,\n      title: \"API Reference\",\n      description: \"Developer documentation\",\n      href: \"/api-docs\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"Support Center - WinnStorm Help & FAQs\"\n        description=\"Get help with WinnStorm damage assessment platform. Access FAQs, contact support, find documentation, and get answers to your questions about thermal analysis, reports, and certifications.\"\n        canonical=\"/support\"\n        keywords={['WinnStorm support', 'damage assessment help', 'thermal analysis support', 'customer service', 'FAQ']}\n        structuredData={[faqSchema(faqs)]}\n      />\n\n      {/* Navigation */}\n      <nav className=\"sticky top-0 z-50 bg-background/95 backdrop-blur-md border-b border-border\">\n        <div className=\"container mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <Link href=\"/\">\n              <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-10 w-auto cursor-pointer\" />\n            </Link>\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <Home className=\"h-4 w-4 mr-2\" />\n                  Home\n                </Button>\n              </Link>\n              <Link href=\"/auth\">\n                <Button size=\"sm\" className=\"bg-gradient-to-r from-primary to-cyan-500\">Sign In</Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <section className=\"py-16 bg-gradient-to-b from-primary/5 to-background\">\n        <div className=\"container mx-auto px-6 text-center\">\n          <Badge className=\"mb-4 bg-primary/10 text-primary border-primary/30\">Support Center</Badge>\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-6\">\n            How Can We <span className=\"bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent\">Help You?</span>\n          </h1>\n          <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto mb-8\">\n            Find answers to common questions, access resources, or get in touch with our support team.\n          </p>\n          \n          {/* Search Bar */}\n          <div className=\"max-w-2xl mx-auto relative\">\n            <Search className=\"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n            <Input \n              placeholder=\"Search for help...\" \n              className=\"pl-12 h-14 text-lg bg-card border-border\"\n              data-testid=\"input-support-search\"\n            />\n          </div>\n        </div>\n      </section>\n\n      {/* Support Channels */}\n      <section className=\"py-16\">\n        <div className=\"container mx-auto px-6\">\n          <h2 className=\"text-2xl font-bold mb-8 text-center\">Contact Support</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto\">\n            {supportChannels.map((channel, index) => {\n              const Icon = channel.icon;\n              return (\n                <Card key={index} className=\"hover:shadow-lg transition-shadow border-border/50 text-center\">\n                  <CardContent className=\"p-6\">\n                    <div className={`inline-flex p-3 rounded-full bg-muted mb-4`}>\n                      <Icon className={`h-6 w-6 ${channel.color}`} />\n                    </div>\n                    <h3 className=\"font-semibold text-lg mb-2\">{channel.title}</h3>\n                    <p className=\"text-muted-foreground text-sm mb-3\">{channel.description}</p>\n                    <div className=\"flex items-center justify-center gap-2 text-xs text-muted-foreground mb-4\">\n                      <Clock className=\"h-3 w-3\" />\n                      {channel.availability}\n                    </div>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full\"\n                      onClick={() => {\n                        if (channel.href) {\n                          window.location.href = channel.href;\n                        } else {\n                          toast({ title: \"Chat Coming Soon\", description: \"Live chat will be available shortly.\" });\n                        }\n                      }}\n                    >\n                      {channel.action}\n                    </Button>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n      </section>\n\n      {/* FAQs */}\n      <section className=\"py-16 bg-muted/30\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto\">\n            <h2 className=\"text-2xl font-bold mb-2 text-center\">Frequently Asked Questions</h2>\n            <p className=\"text-muted-foreground text-center mb-8\">Quick answers to common questions</p>\n            \n            <Accordion type=\"single\" collapsible className=\"space-y-4\">\n              {faqs.map((faq, index) => (\n                <AccordionItem \n                  key={index} \n                  value={`faq-${index}`}\n                  className=\"bg-card border border-border/50 rounded-lg px-6\"\n                >\n                  <AccordionTrigger className=\"hover:no-underline py-4\">\n                    <span className=\"flex items-center gap-3 text-left\">\n                      <HelpCircle className=\"h-5 w-5 text-primary flex-shrink-0\" />\n                      {faq.question}\n                    </span>\n                  </AccordionTrigger>\n                  <AccordionContent className=\"pb-4 text-muted-foreground pl-8\">\n                    {faq.answer}\n                  </AccordionContent>\n                </AccordionItem>\n              ))}\n            </Accordion>\n          </div>\n        </div>\n      </section>\n\n      {/* Resources */}\n      <section className=\"py-16\">\n        <div className=\"container mx-auto px-6\">\n          <h2 className=\"text-2xl font-bold mb-8 text-center\">Self-Service Resources</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto\">\n            {resources.map((resource, index) => {\n              const Icon = resource.icon;\n              return (\n                <Link key={index} href={resource.href}>\n                  <Card className=\"hover:shadow-lg transition-all hover:border-primary/50 cursor-pointer h-full\">\n                    <CardContent className=\"p-6 text-center\">\n                      <Icon className=\"h-8 w-8 text-primary mx-auto mb-4\" />\n                      <h3 className=\"font-semibold mb-2\">{resource.title}</h3>\n                      <p className=\"text-sm text-muted-foreground\">{resource.description}</p>\n                    </CardContent>\n                  </Card>\n                </Link>\n              );\n            })}\n          </div>\n        </div>\n      </section>\n\n      {/* Contact Form */}\n      <section className=\"py-16 bg-muted/30\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-2xl mx-auto\">\n            <h2 className=\"text-2xl font-bold mb-2 text-center\">Send Us a Message</h2>\n            <p className=\"text-muted-foreground text-center mb-8\">Can't find what you're looking for? We're here to help.</p>\n            \n            <Card className=\"border-border/50\">\n              <CardContent className=\"p-6\">\n                <form onSubmit={handleSubmit} className=\"space-y-6\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <Label htmlFor=\"name\">Name</Label>\n                      <Input \n                        id=\"name\" \n                        value={formData.name}\n                        onChange={(e) => setFormData({...formData, name: e.target.value})}\n                        placeholder=\"Your name\"\n                        required\n                        data-testid=\"input-support-name\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"email\">Email</Label>\n                      <Input \n                        id=\"email\" \n                        type=\"email\"\n                        value={formData.email}\n                        onChange={(e) => setFormData({...formData, email: e.target.value})}\n                        placeholder=\"your@email.com\"\n                        required\n                        data-testid=\"input-support-email\"\n                      />\n                    </div>\n                  </div>\n                  <div>\n                    <Label htmlFor=\"subject\">Subject</Label>\n                    <Input \n                      id=\"subject\" \n                      value={formData.subject}\n                      onChange={(e) => setFormData({...formData, subject: e.target.value})}\n                      placeholder=\"How can we help?\"\n                      required\n                      data-testid=\"input-support-subject\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"message\">Message</Label>\n                    <Textarea \n                      id=\"message\" \n                      value={formData.message}\n                      onChange={(e) => setFormData({...formData, message: e.target.value})}\n                      placeholder=\"Describe your issue or question...\"\n                      rows={5}\n                      required\n                      data-testid=\"input-support-message\"\n                    />\n                  </div>\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full bg-gradient-to-r from-primary to-cyan-500\"\n                    disabled={isSubmitting}\n                    data-testid=\"button-support-submit\"\n                  >\n                    {isSubmitting ? (\n                      \"Sending...\"\n                    ) : (\n                      <>\n                        Send Message\n                        <Send className=\"h-4 w-4 ml-2\" />\n                      </>\n                    )}\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Status Badges */}\n      <section className=\"py-8 border-t border-border\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"flex flex-wrap justify-center gap-6 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <CheckCircle className=\"h-4 w-4 text-green-500\" />\n              <span className=\"text-muted-foreground\">All Systems Operational</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Headphones className=\"h-4 w-4 text-primary\" />\n              <span className=\"text-muted-foreground\">Average response: 2 hours</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <CheckCircle className=\"h-4 w-4 text-green-500\" />\n              <span className=\"text-muted-foreground\">98% satisfaction rate</span>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"py-8 border-t border-border\">\n        <div className=\"container mx-auto px-6 text-center text-muted-foreground\">\n          <p>&copy; 2025 WinnStorm™. All rights reserved.</p>\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport default Support;\n","path":null,"size_bytes":16528,"size_tokens":null},"client/src/pages/methodology.tsx":{"content":"import { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { SEO } from '@/components/seo';\nimport { \n  CheckCircle, \n  ArrowRight, \n  Cloud, \n  Thermometer, \n  Camera, \n  MapPin,\n  FileText,\n  ClipboardCheck,\n  Ruler,\n  Shield,\n  Home,\n  Award,\n  Target,\n  BookOpen,\n  Zap\n} from 'lucide-react';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\nconst Methodology = () => {\n  const steps = [\n    {\n      number: 1,\n      title: \"Weather Verification\",\n      icon: Cloud,\n      description: \"Establish the foundation of your assessment by verifying historical weather events in the area.\",\n      details: [\n        \"Access NOAA and NWS historical storm data\",\n        \"Document hail size, wind speeds, and precipitation\",\n        \"Correlate weather events with reported damage dates\",\n        \"Generate weather verification certificates\"\n      ],\n      color: \"from-blue-500 to-cyan-500\"\n    },\n    {\n      number: 2,\n      title: \"Thermal Analysis\",\n      icon: Thermometer,\n      description: \"Use thermal imaging to identify hidden moisture intrusion and insulation deficiencies.\",\n      details: [\n        \"Capture thermal images during optimal conditions\",\n        \"Identify temperature differentials indicating damage\",\n        \"Detect moisture patterns invisible to naked eye\",\n        \"AI-assisted anomaly detection with Stormy\"\n      ],\n      color: \"from-red-500 to-orange-500\"\n    },\n    {\n      number: 3,\n      title: \"Terrestrial Documentation\",\n      icon: Camera,\n      description: \"Comprehensive ground-level photo documentation of visible damage indicators.\",\n      details: [\n        \"Systematic photo capture of all affected areas\",\n        \"Document soft metal damage (gutters, vents, AC units)\",\n        \"Before and after comparison photography\",\n        \"GPS-tagged evidence collection\"\n      ],\n      color: \"from-green-500 to-emerald-500\"\n    },\n    {\n      number: 4,\n      title: \"Roof Section Mapping\",\n      icon: MapPin,\n      description: \"Create detailed maps of roof sections to organize and track damage assessment.\",\n      details: [\n        \"Satellite imagery integration via Google Maps\",\n        \"Define and label distinct roof sections\",\n        \"Mark areas of concern for detailed inspection\",\n        \"Calculate affected square footage\"\n      ],\n      color: \"from-purple-500 to-pink-500\"\n    },\n    {\n      number: 5,\n      title: \"Test Square Analysis\",\n      icon: Ruler,\n      description: \"Perform standardized test square measurements to quantify damage density.\",\n      details: [\n        \"10x10 foot test square methodology\",\n        \"Count and measure hail impacts per square\",\n        \"Statistical extrapolation to full roof area\",\n        \"Industry-standard damage density calculations\"\n      ],\n      color: \"from-yellow-500 to-amber-500\"\n    },\n    {\n      number: 6,\n      title: \"Core Sample Collection\",\n      icon: ClipboardCheck,\n      description: \"When applicable, collect physical samples to verify material condition and age.\",\n      details: [\n        \"Strategic sample location selection\",\n        \"Proper extraction and preservation techniques\",\n        \"Chain of custody documentation\",\n        \"Laboratory analysis coordination\"\n      ],\n      color: \"from-teal-500 to-cyan-500\"\n    },\n    {\n      number: 7,\n      title: \"Damage Quantification\",\n      icon: Target,\n      description: \"Compile all findings into quantified damage assessments with repair estimates.\",\n      details: [\n        \"Aggregate data from all assessment steps\",\n        \"Calculate repair and replacement costs\",\n        \"Apply depreciation where applicable\",\n        \"Generate line-item damage schedules\"\n      ],\n      color: \"from-indigo-500 to-blue-500\"\n    },\n    {\n      number: 8,\n      title: \"Winn Report Generation\",\n      icon: FileText,\n      description: \"Produce comprehensive, defensible reports formatted for insurance submission.\",\n      details: [\n        \"Automated report assembly from collected data\",\n        \"Professional formatting and branding\",\n        \"Evidence appendix compilation\",\n        \"Executive summary generation\"\n      ],\n      color: \"from-primary to-cyan-500\"\n    }\n  ];\n\n  const benefits = [\n    {\n      icon: Shield,\n      title: \"Defensible Reports\",\n      description: \"Reports that stand up to scrutiny from insurance adjusters, engineers, and legal review.\"\n    },\n    {\n      icon: Target,\n      title: \"Consistent Results\",\n      description: \"Standardized methodology ensures reliable, repeatable outcomes across all inspections.\"\n    },\n    {\n      icon: Zap,\n      title: \"Faster Settlements\",\n      description: \"Comprehensive documentation accelerates the claims process and approval rates.\"\n    },\n    {\n      icon: Award,\n      title: \"Professional Credibility\",\n      description: \"Certification in the Winn Methodology establishes you as an industry expert.\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"Winn Methodology Guide - 8-Step Damage Assessment Process\"\n        description=\"Learn the industry-leading Winn Methodology for property damage assessment. Our comprehensive 8-step process covers weather verification, thermal analysis, documentation, and professional reporting.\"\n        canonical=\"/methodology\"\n        keywords={['Winn Methodology', 'damage assessment process', 'property inspection methodology', 'hail damage assessment steps', 'thermal analysis methodology']}\n      />\n\n      {/* Navigation */}\n      <nav className=\"sticky top-0 z-50 bg-background/95 backdrop-blur-md border-b border-border\">\n        <div className=\"container mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <Link href=\"/\">\n              <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-10 w-auto cursor-pointer\" />\n            </Link>\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <Home className=\"h-4 w-4 mr-2\" />\n                  Home\n                </Button>\n              </Link>\n              <Link href=\"/training\">\n                <Button variant=\"ghost\" size=\"sm\">Training</Button>\n              </Link>\n              <Link href=\"/auth\">\n                <Button size=\"sm\" className=\"bg-gradient-to-r from-primary to-cyan-500\">Get Certified</Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-b from-primary/10 to-background relative overflow-hidden\">\n        <div className=\"absolute inset-0 opacity-30\">\n          <div className=\"absolute top-20 left-[10%] w-72 h-72 bg-gradient-to-r from-primary/30 to-cyan-500/30 rounded-full blur-3xl\"></div>\n          <div className=\"absolute bottom-20 right-[15%] w-96 h-96 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded-full blur-3xl\"></div>\n        </div>\n        \n        <div className=\"container mx-auto px-6 relative z-10\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <Badge className=\"mb-6 bg-primary/10 text-primary border-primary/30\">Industry Standard</Badge>\n            <h1 className=\"text-4xl md:text-6xl font-bold mb-6\">\n              The <span className=\"bg-gradient-to-r from-primary to-cyan-500 bg-clip-text text-transparent\">Winn Methodology</span>\n            </h1>\n            <p className=\"text-xl text-muted-foreground mb-8 max-w-3xl mx-auto\">\n              A comprehensive 8-step process for property damage assessment developed by Eric Winn. \n              The gold standard for creating accurate, defensible, and professional damage reports.\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n              <Button size=\"lg\" className=\"bg-gradient-to-r from-primary to-cyan-500\" asChild>\n                <Link href=\"/training\">\n                  <BookOpen className=\"h-5 w-5 mr-2\" />\n                  Start Learning\n                </Link>\n              </Button>\n              <Button size=\"lg\" variant=\"outline\" asChild>\n                <Link href=\"/auth\">\n                  Get Certified\n                </Link>\n              </Button>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Introduction */}\n      <section className=\"py-16 border-b border-border\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-12 items-center\">\n              <div>\n                <h2 className=\"text-3xl font-bold mb-6\">Why the Winn Methodology?</h2>\n                <p className=\"text-muted-foreground mb-4\">\n                  Developed over decades of field experience by Eric Winn, this methodology has become the \n                  industry benchmark for professional damage assessment. It provides a systematic, repeatable \n                  approach that ensures no detail is overlooked.\n                </p>\n                <p className=\"text-muted-foreground\">\n                  Whether you're assessing hail damage, wind damage, or water intrusion, the Winn Methodology \n                  gives you the framework to produce comprehensive reports that insurance companies trust and respect.\n                </p>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                {benefits.map((benefit, index) => {\n                  const Icon = benefit.icon;\n                  return (\n                    <Card key={index} className=\"border-border/50\">\n                      <CardContent className=\"p-4\">\n                        <Icon className=\"h-8 w-8 text-primary mb-3\" />\n                        <h3 className=\"font-semibold mb-1\">{benefit.title}</h3>\n                        <p className=\"text-xs text-muted-foreground\">{benefit.description}</p>\n                      </CardContent>\n                    </Card>\n                  );\n                })}\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* 8 Steps */}\n      <section className=\"py-20\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">The 8-Step Process</h2>\n            <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n              Each step builds upon the previous, creating a comprehensive body of evidence for your assessment.\n            </p>\n          </div>\n\n          <div className=\"max-w-5xl mx-auto space-y-8\">\n            {steps.map((step, index) => {\n              const Icon = step.icon;\n              return (\n                <Card \n                  key={index} \n                  className=\"border-border/50 overflow-hidden hover:shadow-lg transition-shadow\"\n                >\n                  <div className=\"grid grid-cols-1 lg:grid-cols-3\">\n                    <div className={`p-6 bg-gradient-to-br ${step.color} text-white flex flex-col justify-center`}>\n                      <div className=\"flex items-center gap-4 mb-4\">\n                        <div className=\"bg-white/20 rounded-full p-3\">\n                          <Icon className=\"h-8 w-8\" />\n                        </div>\n                        <div className=\"text-5xl font-bold opacity-50\">0{step.number}</div>\n                      </div>\n                      <h3 className=\"text-2xl font-bold\">{step.title}</h3>\n                    </div>\n                    <div className=\"lg:col-span-2 p-6\">\n                      <p className=\"text-muted-foreground mb-4\">{step.description}</p>\n                      <ul className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                        {step.details.map((detail, detailIndex) => (\n                          <li key={detailIndex} className=\"flex items-start gap-2\">\n                            <CheckCircle className=\"h-4 w-4 text-green-500 mt-1 flex-shrink-0\" />\n                            <span className=\"text-sm\">{detail}</span>\n                          </li>\n                        ))}\n                      </ul>\n                    </div>\n                  </div>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n      </section>\n\n      {/* Certification CTA */}\n      <section className=\"py-20 bg-gradient-to-r from-primary to-cyan-500 text-white\">\n        <div className=\"container mx-auto px-6 text-center\">\n          <Award className=\"h-16 w-16 mx-auto mb-6 opacity-80\" />\n          <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">Get Certified in the Winn Methodology</h2>\n          <p className=\"text-xl opacity-90 mb-8 max-w-3xl mx-auto\">\n            Join hundreds of certified professionals who have mastered the Winn Methodology. \n            Our comprehensive training program takes you from fundamentals to expert-level assessments.\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n            <Button size=\"lg\" variant=\"secondary\" asChild>\n              <Link href=\"/training\">\n                View Training Courses\n                <ArrowRight className=\"h-5 w-5 ml-2\" />\n              </Link>\n            </Button>\n            <Button size=\"lg\" variant=\"outline\" className=\"border-white text-white hover:bg-white hover:text-primary\" asChild>\n              <Link href=\"/auth\">\n                Start Free Trial\n              </Link>\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* Additional Resources */}\n      <section className=\"py-16\">\n        <div className=\"container mx-auto px-6\">\n          <h2 className=\"text-2xl font-bold mb-8 text-center\">Continue Learning</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto\">\n            <Card className=\"hover:shadow-lg transition-shadow border-border/50\">\n              <CardContent className=\"p-6 text-center\">\n                <BookOpen className=\"h-8 w-8 text-primary mx-auto mb-4\" />\n                <h3 className=\"font-semibold mb-2\">Documentation</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">Detailed guides for each methodology step</p>\n                <Button variant=\"outline\" size=\"sm\" asChild>\n                  <Link href=\"/docs\">Read Docs</Link>\n                </Button>\n              </CardContent>\n            </Card>\n            <Card className=\"hover:shadow-lg transition-shadow border-border/50\">\n              <CardContent className=\"p-6 text-center\">\n                <Award className=\"h-8 w-8 text-primary mx-auto mb-4\" />\n                <h3 className=\"font-semibold mb-2\">Training Portal</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">Video courses and certification exams</p>\n                <Button variant=\"outline\" size=\"sm\" asChild>\n                  <Link href=\"/training\">Start Training</Link>\n                </Button>\n              </CardContent>\n            </Card>\n            <Card className=\"hover:shadow-lg transition-shadow border-border/50\">\n              <CardContent className=\"p-6 text-center\">\n                <FileText className=\"h-8 w-8 text-primary mx-auto mb-4\" />\n                <h3 className=\"font-semibold mb-2\">Sample Reports</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">See real Winn Reports in action</p>\n                <Button variant=\"outline\" size=\"sm\" asChild>\n                  <Link href=\"/reports\">View Reports</Link>\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"py-8 border-t border-border\">\n        <div className=\"container mx-auto px-6 text-center text-muted-foreground\">\n          <p>&copy; 2025 WinnStorm™. All rights reserved. The Winn Methodology is a trademark of Eric Winn.</p>\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport default Methodology;\n","path":null,"size_bytes":16142,"size_tokens":null},"client/src/pages/privacy.tsx":{"content":"import { Link } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { SEO } from '@/components/seo';\nimport { Home, Shield, Mail } from 'lucide-react';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\nconst Privacy = () => {\n  const lastUpdated = \"December 1, 2025\";\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"Privacy Policy - WinnStorm Data Protection\"\n        description=\"WinnStorm Privacy Policy explains how we collect, use, and protect your personal information. Learn about our commitment to data security and your privacy rights.\"\n        canonical=\"/privacy\"\n        keywords={['WinnStorm privacy policy', 'data protection', 'user privacy', 'GDPR compliance']}\n      />\n\n      {/* Navigation */}\n      <nav className=\"sticky top-0 z-50 bg-background/95 backdrop-blur-md border-b border-border\">\n        <div className=\"container mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <Link href=\"/\">\n              <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-10 w-auto cursor-pointer\" />\n            </Link>\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <Home className=\"h-4 w-4 mr-2\" />\n                  Home\n                </Button>\n              </Link>\n              <Link href=\"/terms\">\n                <Button variant=\"ghost\" size=\"sm\">Terms of Service</Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Header */}\n      <section className=\"py-16 bg-gradient-to-b from-primary/5 to-background\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto\">\n            <Badge className=\"mb-4 bg-primary/10 text-primary border-primary/30\">Legal</Badge>\n            <h1 className=\"text-4xl font-bold mb-4\">Privacy Policy</h1>\n            <p className=\"text-muted-foreground\">Last updated: {lastUpdated}</p>\n          </div>\n        </div>\n      </section>\n\n      {/* Content */}\n      <section className=\"py-12\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto prose prose-gray dark:prose-invert\">\n            \n            <div className=\"bg-primary/5 border border-primary/20 rounded-lg p-6 mb-8\">\n              <div className=\"flex items-start gap-4\">\n                <Shield className=\"h-8 w-8 text-primary flex-shrink-0\" />\n                <div>\n                  <h3 className=\"text-lg font-semibold mb-2 mt-0\">Our Commitment to Privacy</h3>\n                  <p className=\"text-muted-foreground mb-0\">\n                    WinnStorm is committed to protecting your privacy. This policy explains how we collect, \n                    use, and safeguard your information when you use our damage assessment platform.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <h2>1. Information We Collect</h2>\n            <p>We collect information that you provide directly to us, including:</p>\n            <ul>\n              <li><strong>Account Information:</strong> Name, email address, phone number, company name, and professional credentials when you create an account.</li>\n              <li><strong>Property Data:</strong> Address information, photos, thermal images, and assessment data for properties you inspect.</li>\n              <li><strong>Payment Information:</strong> Billing address and payment method details (processed securely through Stripe).</li>\n              <li><strong>Communications:</strong> Messages you send to our support team or through our platform.</li>\n              <li><strong>Usage Data:</strong> Information about how you interact with our platform, including features used and time spent.</li>\n            </ul>\n\n            <h2>2. How We Use Your Information</h2>\n            <p>We use the information we collect to:</p>\n            <ul>\n              <li>Provide, maintain, and improve our damage assessment platform</li>\n              <li>Process transactions and send related information</li>\n              <li>Send you technical notices, updates, and support messages</li>\n              <li>Respond to your comments, questions, and customer service requests</li>\n              <li>Train and improve our AI systems (Stormy) to provide better guidance</li>\n              <li>Monitor and analyze trends, usage, and activities</li>\n              <li>Detect, investigate, and prevent fraudulent or unauthorized activities</li>\n            </ul>\n\n            <h2>3. Information Sharing</h2>\n            <p>We do not sell your personal information. We may share information:</p>\n            <ul>\n              <li><strong>With Service Providers:</strong> Third parties that help us operate our platform (hosting, analytics, payment processing)</li>\n              <li><strong>For Legal Reasons:</strong> When required by law or to protect rights and safety</li>\n              <li><strong>With Your Consent:</strong> When you explicitly authorize sharing (e.g., submitting reports to insurance companies)</li>\n              <li><strong>Business Transfers:</strong> In connection with a merger, acquisition, or sale of assets</li>\n            </ul>\n\n            <h2>4. Data Security</h2>\n            <p>We implement industry-standard security measures to protect your information:</p>\n            <ul>\n              <li>All data is encrypted in transit (TLS 1.3) and at rest (AES-256)</li>\n              <li>Firebase Authentication with secure session management</li>\n              <li>Role-based access controls and authentication requirements</li>\n              <li>Secure payment processing through PCI-compliant Stripe</li>\n              <li>Regular security reviews and monitoring</li>\n              <li>Cloud infrastructure with built-in security protections</li>\n            </ul>\n\n            <h2>5. Data Retention</h2>\n            <p>\n              We retain your information for as long as your account is active or as needed to provide services. \n              Inspection data and reports are retained for 7 years to support potential insurance claims or legal requirements. \n              You may request deletion of your account and associated data at any time.\n            </p>\n\n            <h2>6. Your Rights</h2>\n            <p>Depending on your location, you may have the following rights:</p>\n            <ul>\n              <li><strong>Access:</strong> Request a copy of your personal information</li>\n              <li><strong>Correction:</strong> Request correction of inaccurate data</li>\n              <li><strong>Deletion:</strong> Request deletion of your personal information</li>\n              <li><strong>Portability:</strong> Request your data in a portable format</li>\n              <li><strong>Opt-out:</strong> Opt out of marketing communications</li>\n              <li><strong>Restrict Processing:</strong> Request limitation of how we use your data</li>\n            </ul>\n\n            <h2>7. Cookies and Tracking</h2>\n            <p>\n              We use cookies and similar technologies to improve your experience, understand usage patterns, \n              and deliver relevant content. You can control cookie preferences through your browser settings.\n            </p>\n\n            <h2>8. Third-Party Services</h2>\n            <p>Our platform may contain links to or integrations with third-party services:</p>\n            <ul>\n              <li><strong>Google Maps:</strong> For property location and satellite imagery</li>\n              <li><strong>Stripe:</strong> For payment processing</li>\n              <li><strong>Firebase:</strong> For authentication services</li>\n              <li><strong>OpenAI:</strong> For AI-powered analysis features</li>\n            </ul>\n            <p>These services have their own privacy policies that govern their use of your information.</p>\n\n            <h2>9. Children's Privacy</h2>\n            <p>\n              WinnStorm is not intended for use by individuals under the age of 18. \n              We do not knowingly collect personal information from children.\n            </p>\n\n            <h2>10. International Data Transfers</h2>\n            <p>\n              Your information may be transferred to and processed in countries other than your own. \n              We ensure appropriate safeguards are in place for international transfers, including \n              Standard Contractual Clauses approved by relevant authorities.\n            </p>\n\n            <h2>11. Changes to This Policy</h2>\n            <p>\n              We may update this privacy policy from time to time. We will notify you of significant \n              changes by posting the new policy on this page and updating the \"Last updated\" date.\n            </p>\n\n            <h2>12. Contact Us</h2>\n            <p>If you have questions about this Privacy Policy or our data practices, please contact us:</p>\n            <div className=\"bg-muted/50 rounded-lg p-4 not-prose\">\n              <p className=\"font-semibold mb-2\">WinnStorm Privacy Team</p>\n              <p className=\"flex items-center gap-2 text-muted-foreground\">\n                <Mail className=\"h-4 w-4\" />\n                privacy@winnstorm.com\n              </p>\n            </div>\n\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"py-8 border-t border-border\">\n        <div className=\"container mx-auto px-6 text-center text-muted-foreground\">\n          <p>&copy; 2025 WinnStorm™. All rights reserved.</p>\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport default Privacy;\n","path":null,"size_bytes":9748,"size_tokens":null},"client/src/components/seo.tsx":{"content":"import { Helmet } from 'react-helmet-async';\n\ninterface SEOProps {\n  title?: string;\n  description?: string;\n  canonical?: string;\n  image?: string;\n  type?: 'website' | 'article' | 'product';\n  structuredData?: object | object[];\n  noindex?: boolean;\n  keywords?: string[];\n}\n\nconst BASE_URL = 'https://winnstorm.com';\nconst DEFAULT_IMAGE = `${BASE_URL}/og-image.png`;\nconst SITE_NAME = 'WinnStorm™';\nconst DEFAULT_DESCRIPTION = 'Professional damage assessment consulting platform implementing the proven Winn Methodology. AI-powered thermal analysis, comprehensive reporting, and consultant certification.';\n\nexport function SEO({\n  title,\n  description = DEFAULT_DESCRIPTION,\n  canonical,\n  image = DEFAULT_IMAGE,\n  type = 'website',\n  structuredData,\n  noindex = false,\n  keywords = [],\n}: SEOProps) {\n  const fullTitle = title ? `${title} | ${SITE_NAME}` : `${SITE_NAME} - Professional Damage Assessment Platform`;\n  const url = canonical ? `${BASE_URL}${canonical}` : BASE_URL;\n  const imageUrl = image.startsWith('http') ? image : `${BASE_URL}${image}`;\n\n  const defaultKeywords = [\n    'damage assessment',\n    'thermal inspection',\n    'hail damage',\n    'storm damage',\n    'Winn Methodology',\n    'property inspection',\n    'insurance claims',\n    'roofing inspection',\n    'AI damage analysis',\n    'consultant certification',\n  ];\n\n  const allKeywords = [...defaultKeywords, ...keywords].join(', ');\n\n  return (\n    <Helmet>\n      <title>{fullTitle}</title>\n      <meta name=\"description\" content={description} />\n      <meta name=\"keywords\" content={allKeywords} />\n      <link rel=\"canonical\" href={url} />\n      \n      {noindex && <meta name=\"robots\" content=\"noindex, nofollow\" />}\n      \n      <meta property=\"og:site_name\" content={SITE_NAME} />\n      <meta property=\"og:title\" content={fullTitle} />\n      <meta property=\"og:description\" content={description} />\n      <meta property=\"og:image\" content={imageUrl} />\n      <meta property=\"og:url\" content={url} />\n      <meta property=\"og:type\" content={type} />\n      <meta property=\"og:locale\" content=\"en_US\" />\n      \n      <meta name=\"twitter:card\" content=\"summary_large_image\" />\n      <meta name=\"twitter:site\" content=\"@winnstorm\" />\n      <meta name=\"twitter:title\" content={fullTitle} />\n      <meta name=\"twitter:description\" content={description} />\n      <meta name=\"twitter:image\" content={imageUrl} />\n      \n      {structuredData && (\n        Array.isArray(structuredData) ? (\n          structuredData.map((data, index) => (\n            <script key={index} type=\"application/ld+json\">\n              {JSON.stringify(data)}\n            </script>\n          ))\n        ) : (\n          <script type=\"application/ld+json\">\n            {JSON.stringify(structuredData)}\n          </script>\n        )\n      )}\n    </Helmet>\n  );\n}\n\nexport const organizationSchema = {\n  \"@context\": \"https://schema.org\",\n  \"@type\": \"Organization\",\n  \"name\": \"WinnStorm™\",\n  \"alternateName\": \"WinnStorm Restoration Pro\",\n  \"url\": BASE_URL,\n  \"logo\": `${BASE_URL}/logo.png`,\n  \"description\": \"Professional damage assessment consulting platform implementing the proven Winn Methodology for weather verification, thermal inspection, and comprehensive property damage reporting.\",\n  \"foundingDate\": \"2025\",\n  \"sameAs\": [\n    \"https://twitter.com/winnstorm\",\n    \"https://linkedin.com/company/winnstorm\"\n  ],\n  \"contactPoint\": {\n    \"@type\": \"ContactPoint\",\n    \"contactType\": \"sales\",\n    \"email\": \"sales@winnstorm.com\"\n  },\n  \"address\": {\n    \"@type\": \"PostalAddress\",\n    \"addressCountry\": \"US\"\n  }\n};\n\nexport const softwareApplicationSchema = {\n  \"@context\": \"https://schema.org\",\n  \"@type\": \"SoftwareApplication\",\n  \"name\": \"WinnStorm™ Damage Assessment Platform\",\n  \"applicationCategory\": \"BusinessApplication\",\n  \"operatingSystem\": \"Web, iOS, Android\",\n  \"description\": \"AI-powered damage assessment platform for property inspectors and damage consultants. Features thermal image analysis, comprehensive reporting using the Winn Methodology, and consultant certification training.\",\n  \"offers\": {\n    \"@type\": \"AggregateOffer\",\n    \"lowPrice\": \"299\",\n    \"highPrice\": \"899\",\n    \"priceCurrency\": \"USD\",\n    \"offerCount\": \"3\"\n  },\n  \"aggregateRating\": {\n    \"@type\": \"AggregateRating\",\n    \"ratingValue\": \"4.9\",\n    \"ratingCount\": \"127\",\n    \"bestRating\": \"5\",\n    \"worstRating\": \"1\"\n  },\n  \"featureList\": [\n    \"AI-Powered Thermal Analysis\",\n    \"Winn Methodology Reports\",\n    \"Consultant Certification Training\",\n    \"Google Maps Integration\",\n    \"Client & Project Management\",\n    \"Weather Verification\",\n    \"Mobile Field Inspector App\"\n  ]\n};\n\nexport const websiteSchema = {\n  \"@context\": \"https://schema.org\",\n  \"@type\": \"WebSite\",\n  \"name\": SITE_NAME,\n  \"url\": BASE_URL,\n  \"description\": DEFAULT_DESCRIPTION,\n  \"potentialAction\": {\n    \"@type\": \"SearchAction\",\n    \"target\": {\n      \"@type\": \"EntryPoint\",\n      \"urlTemplate\": `${BASE_URL}/search?q={search_term_string}`\n    },\n    \"query-input\": \"required name=search_term_string\"\n  }\n};\n\nexport const breadcrumbSchema = (items: Array<{ name: string; url: string }>) => ({\n  \"@context\": \"https://schema.org\",\n  \"@type\": \"BreadcrumbList\",\n  \"itemListElement\": items.map((item, index) => ({\n    \"@type\": \"ListItem\",\n    \"position\": index + 1,\n    \"name\": item.name,\n    \"item\": `${BASE_URL}${item.url}`\n  }))\n});\n\nexport const faqSchema = (faqs: Array<{ question: string; answer: string }>) => ({\n  \"@context\": \"https://schema.org\",\n  \"@type\": \"FAQPage\",\n  \"mainEntity\": faqs.map(faq => ({\n    \"@type\": \"Question\",\n    \"name\": faq.question,\n    \"acceptedAnswer\": {\n      \"@type\": \"Answer\",\n      \"text\": faq.answer\n    }\n  }))\n});\n\nexport const courseSchema = (course: {\n  name: string;\n  description: string;\n  provider?: string;\n}) => ({\n  \"@context\": \"https://schema.org\",\n  \"@type\": \"Course\",\n  \"name\": course.name,\n  \"description\": course.description,\n  \"provider\": {\n    \"@type\": \"Organization\",\n    \"name\": course.provider || SITE_NAME,\n    \"sameAs\": BASE_URL\n  }\n});\n\nexport const professionalServiceSchema = {\n  \"@context\": \"https://schema.org\",\n  \"@type\": \"ProfessionalService\",\n  \"name\": \"WinnStorm™ Damage Assessment Consulting\",\n  \"description\": \"Professional damage assessment services using the industry-leading Winn Methodology. Comprehensive property inspections, thermal analysis, and detailed reporting for insurance claims.\",\n  \"url\": BASE_URL,\n  \"priceRange\": \"$$$\",\n  \"areaServed\": {\n    \"@type\": \"Country\",\n    \"name\": \"United States\"\n  },\n  \"serviceType\": [\n    \"Property Damage Assessment\",\n    \"Hail Damage Inspection\",\n    \"Storm Damage Evaluation\",\n    \"Thermal Imaging Analysis\",\n    \"Insurance Claim Documentation\"\n  ],\n  \"hasOfferCatalog\": {\n    \"@type\": \"OfferCatalog\",\n    \"name\": \"Damage Assessment Services\",\n    \"itemListElement\": [\n      {\n        \"@type\": \"Offer\",\n        \"itemOffered\": {\n          \"@type\": \"Service\",\n          \"name\": \"Comprehensive Damage Assessment\",\n          \"description\": \"Full property inspection using the Winn Methodology\"\n        }\n      },\n      {\n        \"@type\": \"Offer\",\n        \"itemOffered\": {\n          \"@type\": \"Service\",\n          \"name\": \"Thermal Analysis\",\n          \"description\": \"AI-powered thermal imaging for moisture and damage detection\"\n        }\n      }\n    ]\n  }\n};\n\nexport default SEO;\n","path":null,"size_bytes":7303,"size_tokens":null},"client/src/pages/terms.tsx":{"content":"import { Link } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { SEO } from '@/components/seo';\nimport { Home, FileText, Mail } from 'lucide-react';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\n\nconst Terms = () => {\n  const lastUpdated = \"December 1, 2025\";\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"Terms of Service - WinnStorm User Agreement\"\n        description=\"WinnStorm Terms of Service outlines the rules and guidelines for using our damage assessment platform. Read our terms, conditions, and user responsibilities.\"\n        canonical=\"/terms\"\n        keywords={['WinnStorm terms of service', 'user agreement', 'platform terms', 'service conditions']}\n      />\n\n      {/* Navigation */}\n      <nav className=\"sticky top-0 z-50 bg-background/95 backdrop-blur-md border-b border-border\">\n        <div className=\"container mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <Link href=\"/\">\n              <img src={winnstormLogo} alt=\"WinnStorm\" className=\"h-10 w-auto cursor-pointer\" />\n            </Link>\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <Home className=\"h-4 w-4 mr-2\" />\n                  Home\n                </Button>\n              </Link>\n              <Link href=\"/privacy\">\n                <Button variant=\"ghost\" size=\"sm\">Privacy Policy</Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Header */}\n      <section className=\"py-16 bg-gradient-to-b from-primary/5 to-background\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto\">\n            <Badge className=\"mb-4 bg-primary/10 text-primary border-primary/30\">Legal</Badge>\n            <h1 className=\"text-4xl font-bold mb-4\">Terms of Service</h1>\n            <p className=\"text-muted-foreground\">Last updated: {lastUpdated}</p>\n          </div>\n        </div>\n      </section>\n\n      {/* Content */}\n      <section className=\"py-12\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto prose prose-gray dark:prose-invert\">\n            \n            <div className=\"bg-primary/5 border border-primary/20 rounded-lg p-6 mb-8\">\n              <div className=\"flex items-start gap-4\">\n                <FileText className=\"h-8 w-8 text-primary flex-shrink-0\" />\n                <div>\n                  <h3 className=\"text-lg font-semibold mb-2 mt-0\">Agreement to Terms</h3>\n                  <p className=\"text-muted-foreground mb-0\">\n                    By accessing or using WinnStorm's damage assessment platform, you agree to be bound by these \n                    Terms of Service. If you do not agree to these terms, please do not use our services.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <h2>1. Description of Service</h2>\n            <p>\n              WinnStorm provides a cloud-based platform for property damage assessment, including thermal analysis tools, \n              report generation, AI-powered guidance (Stormy), training and certification programs, and related services \n              (collectively, the \"Service\"). The Service is designed to assist damage assessment consultants in conducting \n              inspections and generating reports.\n            </p>\n\n            <h2>2. Account Registration</h2>\n            <p>To use the Service, you must:</p>\n            <ul>\n              <li>Be at least 18 years of age</li>\n              <li>Provide accurate and complete registration information</li>\n              <li>Maintain the security of your account credentials</li>\n              <li>Notify us immediately of any unauthorized use of your account</li>\n              <li>Accept responsibility for all activities under your account</li>\n            </ul>\n\n            <h2>3. Subscription and Payment</h2>\n            <h3>3.1 Subscription Plans</h3>\n            <p>\n              WinnStorm offers various subscription plans with different features and pricing. Plan details and pricing \n              are available on our website and may be updated from time to time.\n            </p>\n            \n            <h3>3.2 Billing</h3>\n            <ul>\n              <li>Subscription fees are billed in advance on a monthly or annual basis</li>\n              <li>All fees are non-refundable except as required by law or as specified in our refund policy</li>\n              <li>You authorize us to charge your payment method for recurring subscription fees</li>\n              <li>Failure to pay may result in suspension or termination of your account</li>\n            </ul>\n\n            <h3>3.3 Free Trial</h3>\n            <p>\n              We may offer a free trial period. At the end of the trial, you will be charged unless you cancel before \n              the trial expires. Trial terms may vary and are subject to change.\n            </p>\n\n            <h2>4. Acceptable Use</h2>\n            <p>You agree not to:</p>\n            <ul>\n              <li>Use the Service for any unlawful purpose</li>\n              <li>Submit false or misleading information in damage assessments</li>\n              <li>Interfere with or disrupt the Service or servers</li>\n              <li>Attempt to gain unauthorized access to any part of the Service</li>\n              <li>Use the Service to transmit malware or harmful code</li>\n              <li>Reverse engineer, decompile, or disassemble the Service</li>\n              <li>Resell or redistribute the Service without authorization</li>\n              <li>Use automated systems to access the Service (except approved APIs)</li>\n            </ul>\n\n            <h2>5. Intellectual Property</h2>\n            <h3>5.1 Our Intellectual Property</h3>\n            <p>\n              The Service, including its content, features, and functionality, is owned by WinnStorm and protected by \n              copyright, trademark, and other intellectual property laws. The Winn Methodology is a trademark of Eric Winn.\n            </p>\n            \n            <h3>5.2 Your Content</h3>\n            <p>\n              You retain ownership of content you upload to the Service (photos, reports, data). By uploading content, \n              you grant WinnStorm a non-exclusive license to use, store, and process that content to provide the Service \n              and improve our AI systems.\n            </p>\n\n            <h2>6. AI Services and Limitations</h2>\n            <p>\n              Our AI assistant (Stormy) provides guidance based on the Winn Methodology and analyzed data. However:\n            </p>\n            <ul>\n              <li>AI recommendations are advisory and do not replace professional judgment</li>\n              <li>Users are responsible for verifying AI-generated analysis</li>\n              <li>We do not guarantee the accuracy of AI predictions or recommendations</li>\n              <li>AI capabilities may vary and are subject to ongoing improvement</li>\n            </ul>\n\n            <h2>7. Professional Responsibility</h2>\n            <p>\n              Users of WinnStorm are responsible for:\n            </p>\n            <ul>\n              <li>Maintaining appropriate professional licenses and certifications</li>\n              <li>Ensuring accuracy of assessments and reports they generate</li>\n              <li>Complying with applicable laws, regulations, and industry standards</li>\n              <li>Exercising independent professional judgment in all assessments</li>\n            </ul>\n\n            <h2>8. Limitation of Liability</h2>\n            <p>\n              TO THE MAXIMUM EXTENT PERMITTED BY LAW:\n            </p>\n            <ul>\n              <li>THE SERVICE IS PROVIDED \"AS IS\" WITHOUT WARRANTIES OF ANY KIND</li>\n              <li>WINNSTORM SHALL NOT BE LIABLE FOR INDIRECT, INCIDENTAL, SPECIAL, OR CONSEQUENTIAL DAMAGES</li>\n              <li>OUR TOTAL LIABILITY SHALL NOT EXCEED THE AMOUNT YOU PAID US IN THE 12 MONTHS PRECEDING THE CLAIM</li>\n              <li>WE DO NOT WARRANT THAT THE SERVICE WILL BE ERROR-FREE OR UNINTERRUPTED</li>\n            </ul>\n\n            <h2>9. Indemnification</h2>\n            <p>\n              You agree to indemnify and hold harmless WinnStorm, its officers, directors, employees, and agents from \n              any claims, damages, losses, or expenses arising from your use of the Service, your violation of these \n              Terms, or your violation of any rights of another.\n            </p>\n\n            <h2>10. Termination</h2>\n            <p>\n              Either party may terminate this agreement at any time. We may suspend or terminate your access if you \n              violate these Terms. Upon termination:\n            </p>\n            <ul>\n              <li>Your right to use the Service immediately ceases</li>\n              <li>You may request export of your data within 30 days</li>\n              <li>We may delete your data after the retention period</li>\n              <li>Sections that by their nature should survive will remain in effect</li>\n            </ul>\n\n            <h2>11. Dispute Resolution</h2>\n            <p>\n              Any disputes arising from these Terms or the Service shall be resolved through binding arbitration in \n              accordance with the American Arbitration Association rules. The arbitration shall take place in Dallas, \n              Texas. You waive any right to participate in a class action lawsuit or class-wide arbitration.\n            </p>\n\n            <h2>12. Changes to Terms</h2>\n            <p>\n              We may modify these Terms at any time. We will notify you of material changes by email or through the \n              Service. Your continued use of the Service after changes constitutes acceptance of the modified Terms.\n            </p>\n\n            <h2>13. General Provisions</h2>\n            <ul>\n              <li><strong>Governing Law:</strong> These Terms are governed by the laws of Texas</li>\n              <li><strong>Entire Agreement:</strong> These Terms constitute the entire agreement between us</li>\n              <li><strong>Severability:</strong> If any provision is found unenforceable, the rest remains in effect</li>\n              <li><strong>No Waiver:</strong> Failure to enforce any right does not waive that right</li>\n              <li><strong>Assignment:</strong> You may not assign these Terms without our consent</li>\n            </ul>\n\n            <h2>14. Contact Information</h2>\n            <p>For questions about these Terms, please contact us:</p>\n            <div className=\"bg-muted/50 rounded-lg p-4 not-prose\">\n              <p className=\"font-semibold mb-2\">WinnStorm Legal Team</p>\n              <p className=\"flex items-center gap-2 text-muted-foreground\">\n                <Mail className=\"h-4 w-4\" />\n                legal@winnstorm.com\n              </p>\n            </div>\n\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"py-8 border-t border-border\">\n        <div className=\"container mx-auto px-6 text-center text-muted-foreground\">\n          <p>&copy; 2025 WinnStorm™. All rights reserved.</p>\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport default Terms;\n","path":null,"size_bytes":11427,"size_tokens":null},"client/src/pages/city-landing.tsx":{"content":"import { Header, Footer } from '@/components/navbar';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { SEO } from '@/components/seo';\nimport { Link } from 'wouter';\nimport { \n  Shield, MapPin, Phone, Clock, Star, CheckCircle, \n  CloudLightning, Thermometer, FileText, Users\n} from 'lucide-react';\n\ninterface CityConfig {\n  name: string;\n  state: string;\n  stateAbbrev: string;\n  slug: string;\n  phone: string;\n  address: string;\n  zipCode: string;\n  serviceArea: string[];\n  commonStorms: string[];\n  lat: number;\n  lng: number;\n  heroImage?: string;\n}\n\ninterface LocalBusinessSchema {\n  \"@context\": string;\n  \"@type\": string;\n  name: string;\n  description: string;\n  url: string;\n  telephone: string;\n  address: {\n    \"@type\": string;\n    streetAddress: string;\n    addressLocality: string;\n    addressRegion: string;\n    postalCode: string;\n    addressCountry: string;\n  };\n  geo: {\n    \"@type\": string;\n    latitude: number;\n    longitude: number;\n  };\n  openingHoursSpecification: {\n    \"@type\": string;\n    dayOfWeek: string[];\n    opens: string;\n    closes: string;\n  };\n  sameAs: string[];\n  areaServed: {\n    \"@type\": string;\n    name: string;\n  }[];\n  priceRange: string;\n  aggregateRating?: {\n    \"@type\": string;\n    ratingValue: string;\n    reviewCount: string;\n  };\n}\n\nconst cityConfigs: Record<string, CityConfig> = {\n  dallas: {\n    name: 'Dallas',\n    state: 'Texas',\n    stateAbbrev: 'TX',\n    slug: 'dallas',\n    phone: '(214) 555-WINN',\n    address: '2001 Ross Ave, Suite 700',\n    zipCode: '75201',\n    lat: 32.7767,\n    lng: -96.7970,\n    serviceArea: ['Dallas', 'Fort Worth', 'Plano', 'Irving', 'Arlington', 'Frisco', 'McKinney', 'Garland'],\n    commonStorms: ['Hail Storms', 'Severe Thunderstorms', 'Tornadoes', 'Wind Damage']\n  },\n  houston: {\n    name: 'Houston',\n    state: 'Texas',\n    stateAbbrev: 'TX',\n    slug: 'houston',\n    phone: '(713) 555-WINN',\n    address: '1000 Louisiana St, Suite 4800',\n    zipCode: '77002',\n    lat: 29.7604,\n    lng: -95.3698,\n    serviceArea: ['Houston', 'Katy', 'Sugar Land', 'The Woodlands', 'Pearland', 'League City', 'Pasadena', 'Baytown'],\n    commonStorms: ['Hurricanes', 'Tropical Storms', 'Flash Flooding', 'Hail Storms']\n  },\n  'kansas-city': {\n    name: 'Kansas City',\n    state: 'Missouri',\n    stateAbbrev: 'MO',\n    slug: 'kansas-city',\n    phone: '(816) 555-WINN',\n    address: '1100 Main St, Suite 2000',\n    zipCode: '64105',\n    lat: 39.0997,\n    lng: -94.5786,\n    serviceArea: ['Kansas City MO', 'Kansas City KS', 'Overland Park', 'Olathe', 'Independence', 'Lee\\'s Summit', 'Shawnee', 'Blue Springs'],\n    commonStorms: ['Tornadoes', 'Hail Storms', 'Severe Thunderstorms', 'Ice Storms']\n  }\n};\n\nconst generateLocalBusinessSchema = (city: CityConfig): LocalBusinessSchema => {\n  return {\n    \"@context\": \"https://schema.org\",\n    \"@type\": \"LocalBusiness\",\n    name: `WinnStorm Damage Assessment - ${city.name}`,\n    description: `Professional roof and property damage assessment services in ${city.name}, ${city.state}. Certified damage consultants using AI-powered thermal imaging and the proven Winn Methodology.`,\n    url: `https://winnstorm.com/${city.slug}`,\n    telephone: city.phone,\n    address: {\n      \"@type\": \"PostalAddress\",\n      streetAddress: city.address,\n      addressLocality: city.name,\n      addressRegion: city.stateAbbrev,\n      postalCode: city.zipCode,\n      addressCountry: \"US\"\n    },\n    geo: {\n      \"@type\": \"GeoCoordinates\",\n      latitude: city.lat,\n      longitude: city.lng\n    },\n    openingHoursSpecification: {\n      \"@type\": \"OpeningHoursSpecification\",\n      dayOfWeek: [\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\"],\n      opens: \"08:00\",\n      closes: \"18:00\"\n    },\n    sameAs: [\n      \"https://www.facebook.com/WinnStorm\",\n      \"https://www.linkedin.com/company/winnstorm\"\n    ],\n    areaServed: city.serviceArea.map(area => ({\n      \"@type\": \"City\",\n      name: area\n    })),\n    priceRange: \"$$\",\n    aggregateRating: {\n      \"@type\": \"AggregateRating\",\n      ratingValue: \"4.9\",\n      reviewCount: \"127\"\n    }\n  };\n};\n\nexport function CityLandingPage({ citySlug }: { citySlug: string }) {\n  const city = cityConfigs[citySlug];\n  \n  if (!city) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <p>City not found</p>\n      </div>\n    );\n  }\n\n  const localBusinessSchema = generateLocalBusinessSchema(city);\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\" data-testid={`city-page-${citySlug}`}>\n      <SEO\n        title={`Storm Damage Assessment in ${city.name}, ${city.state} - WinnStorm`}\n        description={`Professional roof and property damage assessment in ${city.name}. Certified consultants using AI-powered thermal imaging. Free inspections after ${city.commonStorms[0].toLowerCase()}.`}\n        canonical={`/${city.slug}`}\n        keywords={[\n          `${city.name} roof damage assessment`,\n          `${city.name} hail damage inspection`,\n          `storm damage consultant ${city.name}`,\n          `thermal imaging ${city.name}`,\n          `roof inspection ${city.name} ${city.state}`\n        ]}\n      />\n      \n      <script\n        type=\"application/ld+json\"\n        dangerouslySetInnerHTML={{ __html: JSON.stringify(localBusinessSchema) }}\n      />\n      \n      <Header />\n      \n      <main className=\"flex-grow\">\n        <section className=\"section-dark py-20 px-6\">\n          <div className=\"max-w-6xl mx-auto\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <MapPin className=\"h-5 w-5 text-primary\" />\n              <span className=\"text-white/60 font-heading uppercase text-sm tracking-wide\">\n                {city.name}, {city.state}\n              </span>\n            </div>\n            \n            <h1 className=\"headline-xl text-white mb-6\">\n              Storm Damage Assessment<br />\n              <span className=\"text-primary\">in {city.name}</span>\n            </h1>\n            \n            <p className=\"body-lg text-white/70 max-w-2xl mb-8\">\n              Certified damage assessment consultants serving the greater {city.name} area. \n              Using AI-powered thermal imaging and the proven Winn Methodology to document \n              storm damage accurately and professionally.\n            </p>\n\n            <div className=\"flex flex-wrap gap-4 mb-12\">\n              <Link href=\"/auth\">\n                <Button className=\"btn-primary\" data-testid=\"button-get-started\">\n                  Get Free Assessment\n                </Button>\n              </Link>\n              <a href={`tel:${city.phone.replace(/[^0-9]/g, '')}`}>\n                <Button variant=\"outline\" className=\"btn-secondary\">\n                  <Phone className=\"h-4 w-4 mr-2\" />\n                  {city.phone}\n                </Button>\n              </a>\n            </div>\n\n            <div className=\"flex flex-wrap gap-3\">\n              {city.commonStorms.map((storm) => (\n                <Badge \n                  key={storm} \n                  variant=\"outline\" \n                  className=\"border-primary/50 text-primary px-4 py-2\"\n                >\n                  <CloudLightning className=\"h-3 w-3 mr-2\" />\n                  {storm}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-16 px-6 bg-background\">\n          <div className=\"max-w-6xl mx-auto\">\n            <h2 className=\"headline-lg text-center mb-12\">\n              Why {city.name} Property Owners Choose WinnStorm\n            </h2>\n            \n            <div className=\"grid md:grid-cols-3 gap-8\">\n              <Card className=\"card-sharp\">\n                <CardHeader>\n                  <Thermometer className=\"h-10 w-10 text-primary mb-4\" />\n                  <CardTitle>AI-Powered Thermal Imaging</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-muted-foreground\">\n                    Our advanced thermal cameras detect moisture intrusion and hidden damage \n                    invisible to the naked eye, ensuring complete documentation of storm impacts.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"card-sharp\">\n                <CardHeader>\n                  <Shield className=\"h-10 w-10 text-primary mb-4\" />\n                  <CardTitle>Certified Consultants</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-muted-foreground\">\n                    All our {city.name} consultants are trained and certified in the \n                    Winn Methodology, the industry gold standard for damage assessment.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"card-sharp\">\n                <CardHeader>\n                  <FileText className=\"h-10 w-10 text-primary mb-4\" />\n                  <CardTitle>Comprehensive Reports</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-muted-foreground\">\n                    Receive detailed 300+ page Winn Reports with AI-analyzed evidence \n                    that insurance adjusters trust for fair claim settlements.\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-16 px-6 bg-muted/30\">\n          <div className=\"max-w-6xl mx-auto\">\n            <h2 className=\"headline-lg text-center mb-4\">\n              Serving the Greater {city.name} Area\n            </h2>\n            <p className=\"body-lg text-center text-muted-foreground mb-12 max-w-2xl mx-auto\">\n              Our certified consultants provide professional damage assessments throughout \n              the {city.name} metropolitan area.\n            </p>\n            \n            <div className=\"flex flex-wrap justify-center gap-3\">\n              {city.serviceArea.map((area) => (\n                <Badge \n                  key={area} \n                  variant=\"secondary\" \n                  className=\"px-4 py-2 text-sm\"\n                  data-testid={`badge-service-area-${area.toLowerCase().replace(/\\s+/g, '-')}`}\n                >\n                  <MapPin className=\"h-3 w-3 mr-2\" />\n                  {area}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-16 px-6 bg-background\">\n          <div className=\"max-w-6xl mx-auto\">\n            <h2 className=\"headline-lg text-center mb-12\">\n              Our Assessment Process\n            </h2>\n            \n            <div className=\"grid md:grid-cols-4 gap-6\">\n              {[\n                { step: '1', title: 'Schedule', desc: 'Book your free initial consultation' },\n                { step: '2', title: 'Inspect', desc: '8-step Winn Methodology inspection' },\n                { step: '3', title: 'Analyze', desc: 'AI processes thermal and visual data' },\n                { step: '4', title: 'Report', desc: 'Receive your comprehensive Winn Report' }\n              ].map((item) => (\n                <div key={item.step} className=\"text-center\">\n                  <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4\">\n                    <span className=\"text-2xl font-bold text-primary\">{item.step}</span>\n                  </div>\n                  <h3 className=\"font-heading font-bold text-lg mb-2\">{item.title}</h3>\n                  <p className=\"text-sm text-muted-foreground\">{item.desc}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-16 px-6 bg-muted/30\">\n          <div className=\"max-w-6xl mx-auto text-center\">\n            <div className=\"flex justify-center gap-1 mb-4\">\n              {[1, 2, 3, 4, 5].map((star) => (\n                <Star key={star} className=\"h-6 w-6 fill-primary text-primary\" />\n              ))}\n            </div>\n            <p className=\"text-2xl font-heading font-bold mb-2\">4.9 out of 5 stars</p>\n            <p className=\"text-muted-foreground mb-8\">Based on 127 verified reviews</p>\n            \n            <Card className=\"card-sharp max-w-2xl mx-auto\">\n              <CardContent className=\"py-6\">\n                <p className=\"italic text-lg mb-4\">\n                  \"After the hail storm hit {city.name}, WinnStorm's thorough assessment \n                  helped us get our full claim approved. Their thermal imaging found damage \n                  we never would have seen otherwise.\"\n                </p>\n                <p className=\"font-semibold\">— Verified {city.name} Customer</p>\n              </CardContent>\n            </Card>\n          </div>\n        </section>\n\n        <section className=\"section-dark py-16 px-6\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <h2 className=\"headline-lg text-white mb-6\">\n              Ready to Assess Your Storm Damage?\n            </h2>\n            <p className=\"body-lg text-white/70 mb-8\">\n              Schedule your free consultation with a certified WinnStorm damage \n              assessment consultant in {city.name} today.\n            </p>\n            <div className=\"flex flex-wrap justify-center gap-4\">\n              <Link href=\"/auth\">\n                <Button className=\"btn-primary\" size=\"lg\" data-testid=\"button-cta-bottom\">\n                  Get Started Now\n                </Button>\n              </Link>\n              <a href={`tel:${city.phone.replace(/[^0-9]/g, '')}`}>\n                <Button variant=\"outline\" className=\"btn-secondary\" size=\"lg\">\n                  <Phone className=\"h-4 w-4 mr-2\" />\n                  Call {city.phone}\n                </Button>\n              </a>\n            </div>\n            \n            <div className=\"mt-12 flex flex-wrap justify-center gap-8 text-white/60\">\n              <div className=\"flex items-center gap-2\">\n                <Clock className=\"h-4 w-4\" />\n                <span>Mon-Fri 8am-6pm</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <MapPin className=\"h-4 w-4\" />\n                <span>{city.address}, {city.name}, {city.stateAbbrev} {city.zipCode}</span>\n              </div>\n            </div>\n          </div>\n        </section>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}\n\nexport function DallasPage() {\n  return <CityLandingPage citySlug=\"dallas\" />;\n}\n\nexport function HoustonPage() {\n  return <CityLandingPage citySlug=\"houston\" />;\n}\n\nexport function KansasCityPage() {\n  return <CityLandingPage citySlug=\"kansas-city\" />;\n}\n","path":null,"size_bytes":14809,"size_tokens":null},"client/src/pages/pricing.tsx":{"content":"import { useLocation } from 'wouter';\nimport { Helmet } from 'react-helmet-async';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from '@/components/ui/card';\nimport { Check, Shield, Star, Zap } from 'lucide-react';\n\nexport default function PricingPage() {\n  const [, navigate] = useLocation();\n\n  const pricingPlans = [\n    {\n      name: \"Starter\",\n      price: \"$299\",\n      period: \"per month\",\n      description: \"Perfect for independent consultants starting their damage assessment practice\",\n      features: [\n        \"5 Inspections per month\",\n        \"Basic Stormy AI assistance\",\n        \"Standard report templates\",\n        \"Email support\",\n        \"Mobile app access\",\n        \"Basic thermal analysis\"\n      ],\n      highlight: false,\n      icon: Shield\n    },\n    {\n      name: \"Professional\",\n      price: \"$599\",\n      period: \"per month\",\n      description: \"Complete solution for established consulting firms and senior practitioners\",\n      features: [\n        \"Unlimited inspections\",\n        \"Advanced Stormy AI with vision\",\n        \"Custom report branding\",\n        \"Priority phone support\",\n        \"Team collaboration tools\",\n        \"Advanced thermal analysis\",\n        \"Weather data integration\",\n        \"CRM integrations\"\n      ],\n      highlight: true,\n      icon: Star\n    },\n    {\n      name: \"Enterprise\",\n      price: \"Custom\",\n      period: \"contact for pricing\",\n      description: \"Tailored solutions for large organizations with custom requirements\",\n      features: [\n        \"Everything in Professional\",\n        \"Unlimited team members\",\n        \"Custom AI training\",\n        \"Dedicated account manager\",\n        \"SLA guarantees\",\n        \"On-premise deployment option\",\n        \"Custom integrations\",\n        \"Advanced analytics & reporting\"\n      ],\n      highlight: false,\n      icon: Zap\n    }\n  ];\n\n  return (\n    <>\n      <Helmet>\n        <title>Pricing - WinnStorm Damage Assessment Platform</title>\n        <meta name=\"description\" content=\"Choose the right WinnStorm plan for your damage assessment business. Starter, Professional, and Enterprise plans available with AI-powered inspection tools.\" />\n      </Helmet>\n\n      <div className=\"min-h-screen bg-[#1A1A1A]\">\n        <header className=\"bg-[#1A1A1A]/95 backdrop-blur-sm border-b border-white/10 py-4\">\n          <div className=\"container mx-auto px-4 flex justify-between items-center\">\n            <button \n              onClick={() => navigate('/')}\n              className=\"flex items-center gap-2 touch-target\"\n              data-testid=\"button-home\"\n            >\n              <Shield className=\"h-8 w-8 text-[hsl(16,100%,50%)]\" />\n              <span className=\"font-heading font-bold text-xl text-white uppercase tracking-wide\">WinnStorm</span>\n            </button>\n            <div className=\"flex items-center gap-4\">\n              <Button \n                variant=\"outline\" \n                onClick={() => navigate('/auth')} \n                className=\"rounded-none border-white/40 text-white hover:bg-white hover:text-[#1A1A1A] font-heading uppercase tracking-wide touch-target\"\n                data-testid=\"button-sign-in\"\n              >\n                Sign In\n              </Button>\n            </div>\n          </div>\n        </header>\n\n        <main className=\"py-16 md:py-24\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center mb-12\">\n              <h1 className=\"font-heading font-bold text-4xl md:text-5xl text-white uppercase tracking-wide mb-4\">\n                Simple, Transparent Pricing\n              </h1>\n              <p className=\"text-white/60 text-lg max-w-2xl mx-auto\">\n                Choose the plan that fits your damage assessment business. All plans include our proven Winn Methodology and Stormy AI assistant.\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-6xl mx-auto\">\n              {pricingPlans.map((plan) => {\n                const IconComponent = plan.icon;\n                return (\n                  <Card \n                    key={plan.name}\n                    className={`bg-[#2A2A2A] border-0 rounded-none relative overflow-hidden ${\n                      plan.highlight ? 'ring-2 ring-[hsl(16,100%,50%)] scale-105' : ''\n                    }`}\n                    data-testid={`card-pricing-${plan.name.toLowerCase()}`}\n                  >\n                    {plan.highlight && (\n                      <div className=\"absolute top-0 left-0 right-0 bg-[hsl(16,100%,50%)] text-white text-center py-1 text-sm font-heading uppercase tracking-wide\">\n                        Most Popular\n                      </div>\n                    )}\n                    <CardHeader className={plan.highlight ? 'pt-10' : ''}>\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <IconComponent className=\"h-6 w-6 text-[hsl(16,100%,50%)]\" />\n                        <CardTitle className=\"font-heading text-2xl text-white uppercase tracking-wide\">\n                          {plan.name}\n                        </CardTitle>\n                      </div>\n                      <div className=\"flex items-baseline gap-1\">\n                        <span className=\"font-heading font-bold text-4xl text-white\">{plan.price}</span>\n                        <span className=\"text-white/60 text-sm\">/{plan.period}</span>\n                      </div>\n                      <CardDescription className=\"text-white/60 mt-2\">\n                        {plan.description}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      {plan.features.map((feature, idx) => (\n                        <div key={idx} className=\"flex items-center gap-2\">\n                          <Check className=\"h-4 w-4 text-[hsl(16,100%,50%)] flex-shrink-0\" />\n                          <span className=\"text-white/80 text-sm\">{feature}</span>\n                        </div>\n                      ))}\n                    </CardContent>\n                    <CardFooter>\n                      <Button\n                        className={`w-full rounded-none font-heading uppercase tracking-wide touch-target ${\n                          plan.highlight \n                            ? 'bg-[hsl(16,100%,50%)] hover:bg-[hsl(16,100%,40%)] text-white' \n                            : 'bg-white/10 hover:bg-white/20 text-white'\n                        }`}\n                        onClick={() => {\n                          if (plan.name === \"Enterprise\") {\n                            navigate('/#contact');\n                          } else {\n                            navigate(`/subscribe/${plan.name.toLowerCase()}`);\n                          }\n                        }}\n                        data-testid={`button-subscribe-${plan.name.toLowerCase()}`}\n                      >\n                        {plan.name === \"Enterprise\" ? \"Contact Sales\" : \"Get Started\"}\n                      </Button>\n                    </CardFooter>\n                  </Card>\n                );\n              })}\n            </div>\n\n            <div className=\"mt-16 text-center\">\n              <h2 className=\"font-heading font-bold text-2xl text-white uppercase tracking-wide mb-4\">\n                All Plans Include\n              </h2>\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto\">\n                {[\n                  \"14-Day Free Trial\",\n                  \"No Setup Fees\",\n                  \"Cancel Anytime\",\n                  \"Data Export\"\n                ].map((item, idx) => (\n                  <div key={idx} className=\"flex items-center justify-center gap-2\">\n                    <Check className=\"h-5 w-5 text-[hsl(16,100%,50%)]\" />\n                    <span className=\"text-white/80\">{item}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </main>\n\n        <footer className=\"bg-[#1A1A1A] border-t border-white/10 py-8\">\n          <div className=\"container mx-auto px-4 text-center\">\n            <p className=\"text-white/40 text-sm\">\n              &copy; {new Date().getFullYear()} WinnStorm. All rights reserved.\n            </p>\n          </div>\n        </footer>\n      </div>\n    </>\n  );\n}\n","path":null,"size_bytes":8414,"size_tokens":null},"client/src/components/network-status-indicator.tsx":{"content":"import { Wifi, WifiOff, RefreshCw, AlertCircle, Check } from 'lucide-react';\nimport { useNetworkStatus } from '@/hooks/use-network-status';\nimport { useSyncStatus } from '@/hooks/use-offline-database';\nimport { Button } from '@/components/ui/button';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport { cn } from '@/lib/utils';\n\ninterface NetworkStatusIndicatorProps {\n  showDetails?: boolean;\n  className?: string;\n}\n\nexport function NetworkStatusIndicator({ \n  showDetails = false,\n  className \n}: NetworkStatusIndicatorProps) {\n  const { isOnline, status, triggerSync } = useNetworkStatus();\n  const { hasPendingChanges, hasFailedChanges, totalPending } = useSyncStatus();\n\n  const getStatusIcon = () => {\n    if (!isOnline) {\n      return <WifiOff className=\"h-4 w-4 text-red-500\" />;\n    }\n    if (status === 'syncing') {\n      return <RefreshCw className=\"h-4 w-4 text-[hsl(16,100%,50%)] animate-spin\" />;\n    }\n    if (hasFailedChanges) {\n      return <AlertCircle className=\"h-4 w-4 text-yellow-500\" />;\n    }\n    if (hasPendingChanges) {\n      return <RefreshCw className=\"h-4 w-4 text-white/60\" />;\n    }\n    return <Wifi className=\"h-4 w-4 text-green-500\" />;\n  };\n\n  const getStatusText = () => {\n    if (!isOnline) return 'Offline';\n    if (status === 'syncing') return 'Syncing...';\n    if (hasFailedChanges) return 'Sync errors';\n    if (hasPendingChanges) return `${totalPending} pending`;\n    return 'All synced';\n  };\n\n  const getStatusColor = () => {\n    if (!isOnline) return 'bg-red-500/20 border-red-500/50';\n    if (status === 'syncing') return 'bg-[hsl(16,100%,50%)]/20 border-[hsl(16,100%,50%)]/50';\n    if (hasFailedChanges) return 'bg-yellow-500/20 border-yellow-500/50';\n    if (hasPendingChanges) return 'bg-white/10 border-white/30';\n    return 'bg-green-500/20 border-green-500/50';\n  };\n\n  if (showDetails) {\n    return (\n      <div className={cn(\n        'flex items-center gap-2 px-3 py-2 rounded-none border',\n        getStatusColor(),\n        className\n      )}>\n        {getStatusIcon()}\n        <span className=\"text-sm text-white/80\">{getStatusText()}</span>\n        {isOnline && hasPendingChanges && status !== 'syncing' && (\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => triggerSync()}\n            className=\"h-6 px-2 text-xs touch-target\"\n            data-testid=\"button-sync-now\"\n          >\n            Sync Now\n          </Button>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>\n        <button\n          onClick={() => isOnline && hasPendingChanges && triggerSync()}\n          className={cn(\n            'relative flex items-center justify-center w-8 h-8 rounded-none touch-target',\n            getStatusColor(),\n            className\n          )}\n          data-testid=\"button-network-status\"\n        >\n          {getStatusIcon()}\n          {hasPendingChanges && !hasFailedChanges && (\n            <span className=\"absolute -top-1 -right-1 w-3 h-3 bg-[hsl(16,100%,50%)] rounded-full flex items-center justify-center\">\n              <span className=\"text-[8px] text-white font-bold\">\n                {totalPending > 9 ? '9+' : totalPending}\n              </span>\n            </span>\n          )}\n        </button>\n      </TooltipTrigger>\n      <TooltipContent>\n        <p>{getStatusText()}</p>\n        {hasPendingChanges && isOnline && status !== 'syncing' && (\n          <p className=\"text-xs text-white/60\">Click to sync</p>\n        )}\n      </TooltipContent>\n    </Tooltip>\n  );\n}\n\nexport function NetworkStatusBanner() {\n  const { isOnline, status, triggerSync } = useNetworkStatus();\n  const { hasPendingChanges, totalPending } = useSyncStatus();\n\n  if (isOnline && !hasPendingChanges) return null;\n\n  return (\n    <div className={cn(\n      'fixed bottom-safe-area-bottom left-0 right-0 z-50 px-4 py-3 flex items-center justify-between',\n      !isOnline ? 'bg-red-600' : 'bg-[hsl(16,100%,50%)]'\n    )}>\n      <div className=\"flex items-center gap-2\">\n        {!isOnline ? (\n          <>\n            <WifiOff className=\"h-5 w-5 text-white\" />\n            <span className=\"text-white font-medium\">You're offline</span>\n          </>\n        ) : status === 'syncing' ? (\n          <>\n            <RefreshCw className=\"h-5 w-5 text-white animate-spin\" />\n            <span className=\"text-white font-medium\">Syncing changes...</span>\n          </>\n        ) : (\n          <>\n            <RefreshCw className=\"h-5 w-5 text-white\" />\n            <span className=\"text-white font-medium\">{totalPending} changes pending</span>\n          </>\n        )}\n      </div>\n      {isOnline && status !== 'syncing' && (\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => triggerSync()}\n          className=\"text-white hover:bg-white/20 touch-target\"\n          data-testid=\"button-banner-sync\"\n        >\n          <Check className=\"h-4 w-4 mr-1\" />\n          Sync Now\n        </Button>\n      )}\n    </div>\n  );\n}\n\nexport function OfflineIndicator() {\n  const { isOnline } = useNetworkStatus();\n\n  if (isOnline) return null;\n\n  return (\n    <div className=\"fixed top-0 left-0 right-0 z-[60] bg-red-600 text-white text-center py-1 text-sm font-medium\">\n      <WifiOff className=\"h-4 w-4 inline mr-2\" />\n      Working Offline - Changes will sync when connected\n    </div>\n  );\n}\n","path":null,"size_bytes":5384,"size_tokens":null},"client/src/lib/camera-service.ts":{"content":"import { Capacitor } from '@capacitor/core';\nimport { Camera, CameraResultType, CameraSource, Photo } from '@capacitor/camera';\nimport { Filesystem, Directory } from '@capacitor/filesystem';\nimport { Geolocation } from '@capacitor/geolocation';\n\nexport interface CapturedPhoto {\n  id: string;\n  dataUrl: string;\n  filePath?: string;\n  timestamp: string;\n  latitude?: number;\n  longitude?: number;\n  type: 'photo' | 'thermal';\n  metadata: PhotoMetadata;\n}\n\nexport interface PhotoMetadata {\n  width?: number;\n  height?: number;\n  format: string;\n  source: 'camera' | 'gallery' | 'import';\n  deviceInfo?: string;\n  notes?: string;\n}\n\nclass CameraService {\n  private isNative: boolean;\n\n  constructor() {\n    this.isNative = Capacitor.isNativePlatform();\n  }\n\n  async requestPermissions(): Promise<boolean> {\n    try {\n      const cameraPermission = await Camera.checkPermissions();\n      \n      if (cameraPermission.camera !== 'granted') {\n        const result = await Camera.requestPermissions({ permissions: ['camera', 'photos'] });\n        if (result.camera !== 'granted') {\n          return false;\n        }\n      }\n\n      if (this.isNative) {\n        const locationPermission = await Geolocation.checkPermissions();\n        if (locationPermission.location !== 'granted') {\n          await Geolocation.requestPermissions();\n        }\n      }\n\n      return true;\n    } catch (error) {\n      console.error('Failed to request permissions:', error);\n      return false;\n    }\n  }\n\n  async capturePhoto(options?: {\n    quality?: number;\n    includeLocation?: boolean;\n    source?: 'camera' | 'gallery';\n  }): Promise<CapturedPhoto | null> {\n    const { quality = 90, includeLocation = true, source = 'camera' } = options || {};\n\n    try {\n      const hasPermission = await this.requestPermissions();\n      if (!hasPermission) {\n        throw new Error('Camera permissions not granted');\n      }\n\n      const photo = await Camera.getPhoto({\n        quality,\n        allowEditing: false,\n        resultType: CameraResultType.DataUrl,\n        source: source === 'camera' ? CameraSource.Camera : CameraSource.Photos,\n        width: 2048,\n        height: 2048,\n        correctOrientation: true,\n        saveToGallery: false,\n      });\n\n      let latitude: number | undefined;\n      let longitude: number | undefined;\n\n      if (includeLocation && this.isNative) {\n        try {\n          const position = await Geolocation.getCurrentPosition({\n            enableHighAccuracy: true,\n            timeout: 10000,\n          });\n          latitude = position.coords.latitude;\n          longitude = position.coords.longitude;\n        } catch (locationError) {\n          console.warn('Failed to get location:', locationError);\n        }\n      } else if (includeLocation && !this.isNative) {\n        try {\n          const position = await this.getWebLocation();\n          latitude = position.latitude;\n          longitude = position.longitude;\n        } catch (locationError) {\n          console.warn('Failed to get web location:', locationError);\n        }\n      }\n\n      const capturedPhoto: CapturedPhoto = {\n        id: this.generateId(),\n        dataUrl: photo.dataUrl!,\n        timestamp: new Date().toISOString(),\n        latitude,\n        longitude,\n        type: 'photo',\n        metadata: {\n          format: photo.format,\n          source: source === 'camera' ? 'camera' : 'gallery',\n        },\n      };\n\n      if (this.isNative) {\n        const savedPath = await this.saveToFileSystem(capturedPhoto);\n        capturedPhoto.filePath = savedPath;\n      }\n\n      return capturedPhoto;\n    } catch (error) {\n      console.error('Failed to capture photo:', error);\n      return null;\n    }\n  }\n\n  async captureFromGallery(): Promise<CapturedPhoto | null> {\n    return this.capturePhoto({ source: 'gallery' });\n  }\n\n  async importThermalImage(file?: File): Promise<CapturedPhoto | null> {\n    try {\n      let dataUrl: string;\n      let filename: string;\n\n      if (file) {\n        dataUrl = await this.fileToDataUrl(file);\n        filename = file.name;\n      } else {\n        const result = await this.pickFileFromSystem();\n        if (!result) return null;\n        dataUrl = result.dataUrl;\n        filename = result.filename;\n      }\n\n      let latitude: number | undefined;\n      let longitude: number | undefined;\n\n      if (this.isNative) {\n        try {\n          const position = await Geolocation.getCurrentPosition({\n            enableHighAccuracy: true,\n            timeout: 10000,\n          });\n          latitude = position.coords.latitude;\n          longitude = position.coords.longitude;\n        } catch (error) {\n          console.warn('Failed to get location for thermal image:', error);\n        }\n      }\n\n      const isThermal = this.detectThermalImage(filename, dataUrl);\n\n      const capturedPhoto: CapturedPhoto = {\n        id: this.generateId(),\n        dataUrl,\n        timestamp: new Date().toISOString(),\n        latitude,\n        longitude,\n        type: isThermal ? 'thermal' : 'photo',\n        metadata: {\n          format: this.getFileExtension(filename),\n          source: 'import',\n          notes: isThermal ? 'Thermal image imported' : undefined,\n        },\n      };\n\n      if (this.isNative) {\n        const savedPath = await this.saveToFileSystem(capturedPhoto);\n        capturedPhoto.filePath = savedPath;\n      }\n\n      return capturedPhoto;\n    } catch (error) {\n      console.error('Failed to import thermal image:', error);\n      return null;\n    }\n  }\n\n  private detectThermalImage(filename: string, _dataUrl: string): boolean {\n    const thermalPatterns = [\n      /flir/i,\n      /thermal/i,\n      /ir_/i,\n      /_ir\\./i,\n      /radiometric/i,\n      /seek/i,\n      /testo/i,\n    ];\n\n    return thermalPatterns.some(pattern => pattern.test(filename));\n  }\n\n  private async pickFileFromSystem(): Promise<{ dataUrl: string; filename: string } | null> {\n    return new Promise((resolve) => {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = 'image/*,.jpg,.jpeg,.png,.tiff,.tif,.radiometric';\n      \n      input.onchange = async (e) => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (file) {\n          const dataUrl = await this.fileToDataUrl(file);\n          resolve({ dataUrl, filename: file.name });\n        } else {\n          resolve(null);\n        }\n      };\n\n      input.click();\n    });\n  }\n\n  private async fileToDataUrl(file: File): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => resolve(reader.result as string);\n      reader.onerror = reject;\n      reader.readAsDataURL(file);\n    });\n  }\n\n  private async saveToFileSystem(photo: CapturedPhoto): Promise<string> {\n    try {\n      const filename = `winnstorm_${photo.type}_${photo.id}.jpg`;\n      const base64Data = photo.dataUrl.split(',')[1];\n\n      await Filesystem.writeFile({\n        path: `WinnStorm/Evidence/${filename}`,\n        data: base64Data,\n        directory: Directory.Documents,\n        recursive: true,\n      });\n\n      return `WinnStorm/Evidence/${filename}`;\n    } catch (error) {\n      console.error('Failed to save photo to filesystem:', error);\n      return '';\n    }\n  }\n\n  private async getWebLocation(): Promise<{ latitude: number; longitude: number }> {\n    return new Promise((resolve, reject) => {\n      if (!navigator.geolocation) {\n        reject(new Error('Geolocation not supported'));\n        return;\n      }\n\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          resolve({\n            latitude: position.coords.latitude,\n            longitude: position.coords.longitude,\n          });\n        },\n        (error) => {\n          reject(error);\n        },\n        {\n          enableHighAccuracy: true,\n          timeout: 10000,\n          maximumAge: 0,\n        }\n      );\n    });\n  }\n\n  private generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  private getFileExtension(filename: string): string {\n    return filename.split('.').pop()?.toLowerCase() || 'jpg';\n  }\n\n  async getPhotoFromPath(filePath: string): Promise<string | null> {\n    if (!this.isNative) return null;\n\n    try {\n      const result = await Filesystem.readFile({\n        path: filePath,\n        directory: Directory.Documents,\n      });\n\n      return `data:image/jpeg;base64,${result.data}`;\n    } catch (error) {\n      console.error('Failed to read photo from path:', error);\n      return null;\n    }\n  }\n\n  async deletePhoto(filePath: string): Promise<boolean> {\n    if (!this.isNative || !filePath) return true;\n\n    try {\n      await Filesystem.deleteFile({\n        path: filePath,\n        directory: Directory.Documents,\n      });\n      return true;\n    } catch (error) {\n      console.error('Failed to delete photo:', error);\n      return false;\n    }\n  }\n}\n\nexport const cameraService = new CameraService();\n","path":null,"size_bytes":8944,"size_tokens":null},"client/src/lib/voice-memo-service.ts":{"content":"import { Capacitor } from '@capacitor/core';\nimport { Filesystem, Directory } from '@capacitor/filesystem';\n\nexport interface VoiceMemo {\n  id: string;\n  dataUrl: string;\n  filePath?: string;\n  duration: number;\n  timestamp: string;\n  latitude?: number;\n  longitude?: number;\n  transcription?: string;\n  isTranscribing: boolean;\n}\n\nclass VoiceMemoService {\n  private mediaRecorder: MediaRecorder | null = null;\n  private audioChunks: Blob[] = [];\n  private isRecording = false;\n  private recordingStartTime: number = 0;\n  private isNative: boolean;\n\n  constructor() {\n    this.isNative = Capacitor.isNativePlatform();\n  }\n\n  async requestPermissions(): Promise<boolean> {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      stream.getTracks().forEach(track => track.stop());\n      return true;\n    } catch (error) {\n      console.error('Microphone permission denied:', error);\n      return false;\n    }\n  }\n\n  async startRecording(): Promise<boolean> {\n    if (this.isRecording) return false;\n\n    try {\n      const hasPermission = await this.requestPermissions();\n      if (!hasPermission) {\n        throw new Error('Microphone permissions not granted');\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          sampleRate: 44100,\n        }\n      });\n\n      this.audioChunks = [];\n      this.mediaRecorder = new MediaRecorder(stream, {\n        mimeType: this.getSupportedMimeType(),\n      });\n\n      this.mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          this.audioChunks.push(event.data);\n        }\n      };\n\n      this.mediaRecorder.start(100);\n      this.isRecording = true;\n      this.recordingStartTime = Date.now();\n\n      return true;\n    } catch (error) {\n      console.error('Failed to start recording:', error);\n      return false;\n    }\n  }\n\n  async stopRecording(): Promise<VoiceMemo | null> {\n    if (!this.isRecording || !this.mediaRecorder) return null;\n\n    return new Promise((resolve) => {\n      this.mediaRecorder!.onstop = async () => {\n        const duration = (Date.now() - this.recordingStartTime) / 1000;\n        const audioBlob = new Blob(this.audioChunks, { type: this.getSupportedMimeType() });\n        const dataUrl = await this.blobToDataUrl(audioBlob);\n\n        let latitude: number | undefined;\n        let longitude: number | undefined;\n\n        try {\n          const position = await this.getLocation();\n          latitude = position.latitude;\n          longitude = position.longitude;\n        } catch (error) {\n          console.warn('Failed to get location for voice memo:', error);\n        }\n\n        const voiceMemo: VoiceMemo = {\n          id: this.generateId(),\n          dataUrl,\n          duration,\n          timestamp: new Date().toISOString(),\n          latitude,\n          longitude,\n          isTranscribing: false,\n        };\n\n        if (this.isNative) {\n          voiceMemo.filePath = await this.saveToFileSystem(voiceMemo);\n        }\n\n        this.mediaRecorder!.stream.getTracks().forEach(track => track.stop());\n        this.mediaRecorder = null;\n        this.audioChunks = [];\n        this.isRecording = false;\n\n        resolve(voiceMemo);\n      };\n\n      this.mediaRecorder!.stop();\n    });\n  }\n\n  cancelRecording(): void {\n    if (this.mediaRecorder && this.isRecording) {\n      this.mediaRecorder.stream.getTracks().forEach(track => track.stop());\n      this.mediaRecorder = null;\n      this.audioChunks = [];\n      this.isRecording = false;\n    }\n  }\n\n  getIsRecording(): boolean {\n    return this.isRecording;\n  }\n\n  getRecordingDuration(): number {\n    if (!this.isRecording) return 0;\n    return (Date.now() - this.recordingStartTime) / 1000;\n  }\n\n  async transcribeAudio(voiceMemo: VoiceMemo, step?: string): Promise<{\n    transcription: string;\n    rawTranscription?: string;\n    status: 'success' | 'fallback' | 'error';\n  }> {\n    try {\n      const response = await fetch('/api/ai/transcribe', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          audioDataUrl: voiceMemo.dataUrl,\n          duration: voiceMemo.duration,\n          step,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Transcription failed');\n      }\n\n      const result = await response.json();\n      return {\n        transcription: result.transcription || '',\n        rawTranscription: result.rawTranscription,\n        status: result.status || 'error',\n      };\n    } catch (error) {\n      console.error('Failed to transcribe audio:', error);\n      return {\n        transcription: '',\n        status: 'error',\n      };\n    }\n  }\n\n  private getSupportedMimeType(): string {\n    const mimeTypes = [\n      'audio/webm;codecs=opus',\n      'audio/webm',\n      'audio/mp4',\n      'audio/ogg;codecs=opus',\n    ];\n\n    for (const mimeType of mimeTypes) {\n      if (MediaRecorder.isTypeSupported(mimeType)) {\n        return mimeType;\n      }\n    }\n\n    return 'audio/webm';\n  }\n\n  private async blobToDataUrl(blob: Blob): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => resolve(reader.result as string);\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n\n  private async saveToFileSystem(memo: VoiceMemo): Promise<string> {\n    try {\n      const filename = `winnstorm_voice_${memo.id}.webm`;\n      const base64Data = memo.dataUrl.split(',')[1];\n\n      await Filesystem.writeFile({\n        path: `WinnStorm/VoiceMemos/${filename}`,\n        data: base64Data,\n        directory: Directory.Documents,\n        recursive: true,\n      });\n\n      return `WinnStorm/VoiceMemos/${filename}`;\n    } catch (error) {\n      console.error('Failed to save voice memo:', error);\n      return '';\n    }\n  }\n\n  private async getLocation(): Promise<{ latitude: number; longitude: number }> {\n    return new Promise((resolve, reject) => {\n      if (!navigator.geolocation) {\n        reject(new Error('Geolocation not supported'));\n        return;\n      }\n\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          resolve({\n            latitude: position.coords.latitude,\n            longitude: position.coords.longitude,\n          });\n        },\n        (error) => reject(error),\n        { enableHighAccuracy: true, timeout: 10000 }\n      );\n    });\n  }\n\n  private generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  async getAudioFromPath(filePath: string): Promise<string | null> {\n    if (!this.isNative || !filePath) return null;\n\n    try {\n      const result = await Filesystem.readFile({\n        path: filePath,\n        directory: Directory.Documents,\n      });\n\n      return `data:audio/webm;base64,${result.data}`;\n    } catch (error) {\n      console.error('Failed to read voice memo from path:', error);\n      return null;\n    }\n  }\n\n  async deleteMemo(filePath: string): Promise<boolean> {\n    if (!this.isNative || !filePath) return true;\n\n    try {\n      await Filesystem.deleteFile({\n        path: filePath,\n        directory: Directory.Documents,\n      });\n      return true;\n    } catch (error) {\n      console.error('Failed to delete voice memo:', error);\n      return false;\n    }\n  }\n\n  formatDuration(seconds: number): string {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  }\n}\n\nexport const voiceMemoService = new VoiceMemoService();\n","path":null,"size_bytes":7666,"size_tokens":null},"client/src/components/evidence-capture.tsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { Camera, Image, Mic, MicOff, Upload, X, MapPin, Clock, FileImage, Trash2, Play, Pause } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Badge } from '@/components/ui/badge';\nimport { cameraService, CapturedPhoto } from '@/lib/camera-service';\nimport { voiceMemoService, VoiceMemo } from '@/lib/voice-memo-service';\nimport { useOfflineEvidence } from '@/hooks/use-offline-database';\nimport { cn } from '@/lib/utils';\n\ninterface EvidenceCaptureProps {\n  inspectionId: string;\n  step: number;\n  onEvidenceAdded?: (evidence: CapturedPhoto | VoiceMemo) => void;\n  className?: string;\n}\n\nexport function EvidenceCapture({ \n  inspectionId, \n  step, \n  onEvidenceAdded,\n  className \n}: EvidenceCaptureProps) {\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordingDuration, setRecordingDuration] = useState(0);\n  const [capturedPhotos, setCapturedPhotos] = useState<CapturedPhoto[]>([]);\n  const [voiceMemos, setVoiceMemos] = useState<VoiceMemo[]>([]);\n  const [isCapturing, setIsCapturing] = useState(false);\n  const [activeTab, setActiveTab] = useState('photo');\n  const { saveEvidence } = useOfflineEvidence(inspectionId);\n  const recordingInterval = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    if (isRecording) {\n      recordingInterval.current = setInterval(() => {\n        setRecordingDuration(voiceMemoService.getRecordingDuration());\n      }, 100);\n    } else {\n      if (recordingInterval.current) {\n        clearInterval(recordingInterval.current);\n      }\n      setRecordingDuration(0);\n    }\n\n    return () => {\n      if (recordingInterval.current) {\n        clearInterval(recordingInterval.current);\n      }\n    };\n  }, [isRecording]);\n\n  const handleCapturePhoto = async () => {\n    setIsCapturing(true);\n    try {\n      const photo = await cameraService.capturePhoto({\n        quality: 90,\n        includeLocation: true,\n        source: 'camera',\n      });\n\n      if (photo) {\n        setCapturedPhotos(prev => [...prev, photo]);\n        \n        await saveEvidence({\n          inspectionId,\n          step,\n          type: 'photo',\n          localPath: photo.filePath || photo.dataUrl,\n          metadata: JSON.stringify(photo.metadata),\n          capturedAt: photo.timestamp,\n          latitude: photo.latitude,\n          longitude: photo.longitude,\n        });\n\n        onEvidenceAdded?.(photo);\n      }\n    } catch (error) {\n      console.error('Failed to capture photo:', error);\n    } finally {\n      setIsCapturing(false);\n    }\n  };\n\n  const handleSelectFromGallery = async () => {\n    setIsCapturing(true);\n    try {\n      const photo = await cameraService.captureFromGallery();\n\n      if (photo) {\n        setCapturedPhotos(prev => [...prev, photo]);\n        \n        await saveEvidence({\n          inspectionId,\n          step,\n          type: 'photo',\n          localPath: photo.filePath || photo.dataUrl,\n          metadata: JSON.stringify(photo.metadata),\n          capturedAt: photo.timestamp,\n          latitude: photo.latitude,\n          longitude: photo.longitude,\n        });\n\n        onEvidenceAdded?.(photo);\n      }\n    } catch (error) {\n      console.error('Failed to select from gallery:', error);\n    } finally {\n      setIsCapturing(false);\n    }\n  };\n\n  const handleImportThermal = async () => {\n    setIsCapturing(true);\n    try {\n      const photo = await cameraService.importThermalImage();\n\n      if (photo) {\n        setCapturedPhotos(prev => [...prev, photo]);\n        \n        await saveEvidence({\n          inspectionId,\n          step,\n          type: 'thermal',\n          localPath: photo.filePath || photo.dataUrl,\n          metadata: JSON.stringify(photo.metadata),\n          capturedAt: photo.timestamp,\n          latitude: photo.latitude,\n          longitude: photo.longitude,\n        });\n\n        onEvidenceAdded?.(photo);\n      }\n    } catch (error) {\n      console.error('Failed to import thermal image:', error);\n    } finally {\n      setIsCapturing(false);\n    }\n  };\n\n  const handleStartRecording = async () => {\n    const started = await voiceMemoService.startRecording();\n    if (started) {\n      setIsRecording(true);\n    }\n  };\n\n  const handleStopRecording = async () => {\n    const memo = await voiceMemoService.stopRecording();\n    setIsRecording(false);\n\n    if (memo) {\n      setVoiceMemos(prev => [...prev, memo]);\n      \n      await saveEvidence({\n        inspectionId,\n        step,\n        type: 'voice_memo',\n        localPath: memo.filePath || memo.dataUrl,\n        metadata: JSON.stringify({ duration: memo.duration }),\n        capturedAt: memo.timestamp,\n        latitude: memo.latitude,\n        longitude: memo.longitude,\n      });\n\n      onEvidenceAdded?.(memo);\n    }\n  };\n\n  const handleDeletePhoto = (id: string) => {\n    setCapturedPhotos(prev => prev.filter(p => p.id !== id));\n  };\n\n  const handleDeleteMemo = (id: string) => {\n    setVoiceMemos(prev => prev.filter(m => m.id !== id));\n  };\n\n  const totalEvidence = capturedPhotos.length + voiceMemos.length;\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"font-heading text-lg text-white uppercase tracking-wide\">\n          Capture Evidence\n        </h3>\n        {totalEvidence > 0 && (\n          <Badge variant=\"secondary\" className=\"bg-[hsl(16,100%,50%)]/20 text-[hsl(16,100%,50%)]\">\n            {totalEvidence} item{totalEvidence !== 1 ? 's' : ''}\n          </Badge>\n        )}\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3 bg-[#2A2A2A] rounded-none\">\n          <TabsTrigger \n            value=\"photo\" \n            className=\"rounded-none data-[state=active]:bg-[hsl(16,100%,50%)] data-[state=active]:text-white\"\n            data-testid=\"tab-photo\"\n          >\n            <Camera className=\"h-4 w-4 mr-2\" />\n            Photo\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"thermal\" \n            className=\"rounded-none data-[state=active]:bg-[hsl(16,100%,50%)] data-[state=active]:text-white\"\n            data-testid=\"tab-thermal\"\n          >\n            <FileImage className=\"h-4 w-4 mr-2\" />\n            Thermal\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"voice\" \n            className=\"rounded-none data-[state=active]:bg-[hsl(16,100%,50%)] data-[state=active]:text-white\"\n            data-testid=\"tab-voice\"\n          >\n            <Mic className=\"h-4 w-4 mr-2\" />\n            Voice\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"photo\" className=\"mt-4 space-y-4\">\n          <div className=\"grid grid-cols-2 gap-3\">\n            <Button\n              onClick={handleCapturePhoto}\n              disabled={isCapturing}\n              className=\"h-20 flex flex-col items-center justify-center gap-2 bg-[#2A2A2A] hover:bg-[#3A3A3A] text-white rounded-none touch-target\"\n              data-testid=\"button-capture-photo\"\n            >\n              <Camera className=\"h-6 w-6\" />\n              <span className=\"text-sm\">Take Photo</span>\n            </Button>\n            <Button\n              onClick={handleSelectFromGallery}\n              disabled={isCapturing}\n              className=\"h-20 flex flex-col items-center justify-center gap-2 bg-[#2A2A2A] hover:bg-[#3A3A3A] text-white rounded-none touch-target\"\n              data-testid=\"button-select-gallery\"\n            >\n              <Image className=\"h-6 w-6\" />\n              <span className=\"text-sm\">From Gallery</span>\n            </Button>\n          </div>\n\n          {capturedPhotos.filter(p => p.type === 'photo').length > 0 && (\n            <div className=\"grid grid-cols-3 gap-2\">\n              {capturedPhotos.filter(p => p.type === 'photo').map((photo) => (\n                <PhotoThumbnail\n                  key={photo.id}\n                  photo={photo}\n                  onDelete={() => handleDeletePhoto(photo.id)}\n                />\n              ))}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"thermal\" className=\"mt-4 space-y-4\">\n          <Button\n            onClick={handleImportThermal}\n            disabled={isCapturing}\n            className=\"w-full h-20 flex flex-col items-center justify-center gap-2 bg-[#2A2A2A] hover:bg-[#3A3A3A] text-white rounded-none touch-target\"\n            data-testid=\"button-import-thermal\"\n          >\n            <Upload className=\"h-6 w-6\" />\n            <span className=\"text-sm\">Import Thermal Image (FLIR, Seek, etc.)</span>\n          </Button>\n\n          <p className=\"text-sm text-white/60 text-center\">\n            Import radiometric thermal images from FLIR, Seek, or other thermal cameras\n          </p>\n\n          {capturedPhotos.filter(p => p.type === 'thermal').length > 0 && (\n            <div className=\"grid grid-cols-3 gap-2\">\n              {capturedPhotos.filter(p => p.type === 'thermal').map((photo) => (\n                <PhotoThumbnail\n                  key={photo.id}\n                  photo={photo}\n                  onDelete={() => handleDeletePhoto(photo.id)}\n                  isThermal\n                />\n              ))}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"voice\" className=\"mt-4 space-y-4\">\n          <div className=\"flex flex-col items-center justify-center py-6\">\n            {isRecording ? (\n              <>\n                <div className=\"relative mb-4\">\n                  <div className=\"w-20 h-20 rounded-full bg-red-500/20 flex items-center justify-center animate-pulse\">\n                    <Mic className=\"h-10 w-10 text-red-500\" />\n                  </div>\n                  <div className=\"absolute -inset-2 rounded-full border-2 border-red-500/50 animate-ping\" />\n                </div>\n                <p className=\"text-2xl font-mono text-white mb-4\">\n                  {voiceMemoService.formatDuration(recordingDuration)}\n                </p>\n                <Button\n                  onClick={handleStopRecording}\n                  className=\"bg-red-500 hover:bg-red-600 text-white rounded-none touch-target\"\n                  data-testid=\"button-stop-recording\"\n                >\n                  <MicOff className=\"h-5 w-5 mr-2\" />\n                  Stop Recording\n                </Button>\n              </>\n            ) : (\n              <>\n                <Button\n                  onClick={handleStartRecording}\n                  className=\"w-20 h-20 rounded-full bg-[hsl(16,100%,50%)] hover:bg-[hsl(16,100%,40%)] text-white touch-target\"\n                  data-testid=\"button-start-recording\"\n                >\n                  <Mic className=\"h-10 w-10\" />\n                </Button>\n                <p className=\"text-sm text-white/60 mt-4\">Tap to record field notes</p>\n              </>\n            )}\n          </div>\n\n          {voiceMemos.length > 0 && (\n            <div className=\"space-y-2\">\n              {voiceMemos.map((memo) => (\n                <VoiceMemoCard\n                  key={memo.id}\n                  memo={memo}\n                  onDelete={() => handleDeleteMemo(memo.id)}\n                />\n              ))}\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\ninterface PhotoThumbnailProps {\n  photo: CapturedPhoto;\n  onDelete: () => void;\n  isThermal?: boolean;\n}\n\nfunction PhotoThumbnail({ photo, onDelete, isThermal }: PhotoThumbnailProps) {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n\n  return (\n    <>\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogTrigger asChild>\n          <div className=\"relative aspect-square bg-[#2A2A2A] rounded-none overflow-hidden cursor-pointer group\">\n            <img\n              src={photo.dataUrl}\n              alt=\"Captured evidence\"\n              className=\"w-full h-full object-cover\"\n            />\n            {isThermal && (\n              <Badge className=\"absolute top-1 left-1 bg-purple-500/80 text-white text-[10px] px-1 py-0 rounded-none\">\n                THERMAL\n              </Badge>\n            )}\n            {photo.latitude && (\n              <div className=\"absolute bottom-1 left-1 flex items-center gap-1 bg-black/60 px-1 py-0.5 rounded-none\">\n                <MapPin className=\"h-3 w-3 text-white\" />\n              </div>\n            )}\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                onDelete();\n              }}\n              className=\"absolute top-1 right-1 w-6 h-6 bg-red-500/80 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity touch-target\"\n              data-testid={`button-delete-photo-${photo.id}`}\n            >\n              <X className=\"h-4 w-4 text-white\" />\n            </button>\n          </div>\n        </DialogTrigger>\n        <DialogContent className=\"bg-[#1A1A1A] border-white/10 max-w-3xl\">\n          <DialogHeader>\n            <DialogTitle className=\"text-white\">\n              {isThermal ? 'Thermal Image' : 'Photo Evidence'}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <img\n              src={photo.dataUrl}\n              alt=\"Full size evidence\"\n              className=\"w-full max-h-[60vh] object-contain\"\n            />\n            <div className=\"flex flex-wrap gap-4 text-sm text-white/60\">\n              <div className=\"flex items-center gap-1\">\n                <Clock className=\"h-4 w-4\" />\n                {new Date(photo.timestamp).toLocaleString()}\n              </div>\n              {photo.latitude && photo.longitude && (\n                <div className=\"flex items-center gap-1\">\n                  <MapPin className=\"h-4 w-4\" />\n                  {photo.latitude.toFixed(6)}, {photo.longitude.toFixed(6)}\n                </div>\n              )}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n\ninterface VoiceMemoCardProps {\n  memo: VoiceMemo;\n  onDelete: () => void;\n}\n\nfunction VoiceMemoCard({ memo, onDelete }: VoiceMemoCardProps) {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isTranscribing, setIsTranscribing] = useState(false);\n  const [transcription, setTranscription] = useState(memo.transcription || '');\n  const audioRef = useRef<HTMLAudioElement>(null);\n\n  const handlePlayPause = () => {\n    if (audioRef.current) {\n      if (isPlaying) {\n        audioRef.current.pause();\n      } else {\n        audioRef.current.play();\n      }\n      setIsPlaying(!isPlaying);\n    }\n  };\n\n  const handleTranscribe = async () => {\n    setIsTranscribing(true);\n    try {\n      const result = await voiceMemoService.transcribeAudio(memo);\n      setTranscription(result.transcription);\n    } catch (error) {\n      console.error('Transcription failed:', error);\n    } finally {\n      setIsTranscribing(false);\n    }\n  };\n\n  return (\n    <Card className=\"bg-[#2A2A2A] border-0 rounded-none\">\n      <CardContent className=\"p-3\">\n        <div className=\"flex items-center gap-3\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={handlePlayPause}\n            className=\"h-10 w-10 rounded-full bg-[hsl(16,100%,50%)]/20 text-[hsl(16,100%,50%)] hover:bg-[hsl(16,100%,50%)]/30 touch-target\"\n            data-testid={`button-play-memo-${memo.id}`}\n          >\n            {isPlaying ? <Pause className=\"h-5 w-5\" /> : <Play className=\"h-5 w-5\" />}\n          </Button>\n\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 text-sm text-white\">\n              <span className=\"font-mono\">{voiceMemoService.formatDuration(memo.duration)}</span>\n              <span className=\"text-white/40\">•</span>\n              <span className=\"text-white/60 truncate\">\n                {new Date(memo.timestamp).toLocaleTimeString()}\n              </span>\n            </div>\n            {transcription && (\n              <p className=\"text-sm text-white/80 mt-1 line-clamp-2\">{transcription}</p>\n            )}\n          </div>\n\n          <div className=\"flex items-center gap-1\">\n            {!transcription && !isTranscribing && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleTranscribe}\n                className=\"text-xs text-white/60 hover:text-white touch-target\"\n                data-testid={`button-transcribe-${memo.id}`}\n              >\n                Transcribe\n              </Button>\n            )}\n            {isTranscribing && (\n              <span className=\"text-xs text-[hsl(16,100%,50%)] animate-pulse\">Transcribing...</span>\n            )}\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={onDelete}\n              className=\"h-8 w-8 text-red-500 hover:bg-red-500/20 touch-target\"\n              data-testid={`button-delete-memo-${memo.id}`}\n            >\n              <Trash2 className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <audio\n          ref={audioRef}\n          src={memo.dataUrl}\n          onEnded={() => setIsPlaying(false)}\n          className=\"hidden\"\n        />\n\n        {memo.latitude && (\n          <div className=\"flex items-center gap-1 mt-2 text-xs text-white/40\">\n            <MapPin className=\"h-3 w-3\" />\n            {memo.latitude.toFixed(4)}, {memo.longitude?.toFixed(4)}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":17733,"size_tokens":null},"client/src/hooks/use-network-status.ts":{"content":"import { useState, useEffect, useCallback } from 'react';\nimport { syncService } from '@/lib/sync-service';\n\nexport type NetworkStatus = 'online' | 'offline' | 'syncing';\n\nexport function useNetworkStatus() {\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n  const [syncStatus, setSyncStatus] = useState<'idle' | 'syncing' | 'error' | 'offline'>('idle');\n\n  useEffect(() => {\n    const handleOnline = () => setIsOnline(true);\n    const handleOffline = () => setIsOnline(false);\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    const unsubscribe = syncService.addStatusListener((status) => {\n      setSyncStatus(status);\n    });\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n      unsubscribe();\n    };\n  }, []);\n\n  const triggerSync = useCallback(async () => {\n    return await syncService.triggerSync();\n  }, []);\n\n  const getStatus = useCallback((): NetworkStatus => {\n    if (!isOnline) return 'offline';\n    if (syncStatus === 'syncing') return 'syncing';\n    return 'online';\n  }, [isOnline, syncStatus]);\n\n  return {\n    isOnline,\n    syncStatus,\n    status: getStatus(),\n    triggerSync,\n    startAutoSync: (interval?: number) => syncService.startAutoSync(interval),\n    stopAutoSync: () => syncService.stopAutoSync(),\n  };\n}\n","path":null,"size_bytes":1404,"size_tokens":null},"client/src/hooks/use-offline-database.ts":{"content":"import { useState, useEffect, useCallback } from 'react';\nimport { offlineDb, OfflineProperty, OfflineInspection, OfflineEvidence } from '@/lib/offline-database';\n\nexport function useOfflineDatabase() {\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [isInitializing, setIsInitializing] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  useEffect(() => {\n    const init = async () => {\n      if (isInitialized || isInitializing) return;\n      \n      setIsInitializing(true);\n      try {\n        await offlineDb.initialize();\n        setIsInitialized(true);\n        setError(null);\n      } catch (err) {\n        console.error('Failed to initialize offline database:', err);\n        setError(err instanceof Error ? err : new Error('Database initialization failed'));\n      } finally {\n        setIsInitializing(false);\n      }\n    };\n\n    init();\n  }, [isInitialized, isInitializing]);\n\n  return {\n    isInitialized,\n    isInitializing,\n    error,\n    db: offlineDb,\n  };\n}\n\nexport function useOfflineProperties() {\n  const { db, isInitialized } = useOfflineDatabase();\n  const [properties, setProperties] = useState<OfflineProperty[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const refresh = useCallback(async () => {\n    if (!isInitialized) return;\n    \n    setIsLoading(true);\n    try {\n      const allProperties = await db.getAllProperties();\n      setProperties(allProperties);\n    } catch (error) {\n      console.error('Failed to load properties:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [db, isInitialized]);\n\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  const saveProperty = useCallback(async (\n    property: Omit<OfflineProperty, 'id' | 'localUpdatedAt' | 'syncStatus'>\n  ) => {\n    const saved = await db.saveProperty(property);\n    await refresh();\n    return saved;\n  }, [db, refresh]);\n\n  const updateProperty = useCallback(async (id: string, updates: Partial<OfflineProperty>) => {\n    await db.updateProperty(id, updates);\n    await refresh();\n  }, [db, refresh]);\n\n  return {\n    properties,\n    isLoading,\n    refresh,\n    saveProperty,\n    updateProperty,\n  };\n}\n\nexport function useOfflineInspections(propertyId?: string) {\n  const { db, isInitialized } = useOfflineDatabase();\n  const [inspections, setInspections] = useState<OfflineInspection[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const refresh = useCallback(async () => {\n    if (!isInitialized) return;\n    \n    setIsLoading(true);\n    try {\n      if (propertyId) {\n        const propertyInspections = await db.getInspectionsByProperty(propertyId);\n        setInspections(propertyInspections);\n      }\n    } catch (error) {\n      console.error('Failed to load inspections:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [db, isInitialized, propertyId]);\n\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  const startInspection = useCallback(async (propertyId: string, propertyServerId?: number) => {\n    const inspection = await db.saveInspection({\n      propertyId,\n      propertyServerId,\n      currentStep: 0,\n      stepData: '{}',\n      evidenceIds: '[]',\n      status: 'in_progress',\n      startedAt: new Date().toISOString(),\n    });\n    await refresh();\n    return inspection;\n  }, [db, refresh]);\n\n  const updateInspection = useCallback(async (id: string, updates: Partial<OfflineInspection>) => {\n    await db.updateInspection(id, updates);\n    await refresh();\n  }, [db, refresh]);\n\n  return {\n    inspections,\n    isLoading,\n    refresh,\n    startInspection,\n    updateInspection,\n  };\n}\n\nexport function useOfflineEvidence(inspectionId?: string) {\n  const { db, isInitialized } = useOfflineDatabase();\n  const [evidence, setEvidence] = useState<OfflineEvidence[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const refresh = useCallback(async () => {\n    if (!isInitialized || !inspectionId) return;\n    \n    setIsLoading(true);\n    try {\n      const inspectionEvidence = await db.getEvidenceByInspection(inspectionId);\n      setEvidence(inspectionEvidence);\n    } catch (error) {\n      console.error('Failed to load evidence:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [db, isInitialized, inspectionId]);\n\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  const saveEvidence = useCallback(async (\n    data: Omit<OfflineEvidence, 'id' | 'localUpdatedAt' | 'syncStatus' | 'uploadAttempts'>\n  ) => {\n    const saved = await db.saveEvidence(data);\n    await refresh();\n    return saved;\n  }, [db, refresh]);\n\n  return {\n    evidence,\n    isLoading,\n    refresh,\n    saveEvidence,\n  };\n}\n\nexport function useSyncStatus() {\n  const { db, isInitialized } = useOfflineDatabase();\n  const [stats, setStats] = useState({\n    pendingProperties: 0,\n    pendingInspections: 0,\n    pendingEvidence: 0,\n    pendingQueueItems: 0,\n    failedQueueItems: 0,\n  });\n  const [isLoading, setIsLoading] = useState(true);\n\n  const refresh = useCallback(async () => {\n    if (!isInitialized) return;\n    \n    setIsLoading(true);\n    try {\n      const syncStats = await db.getSyncStats();\n      setStats(syncStats);\n    } catch (error) {\n      console.error('Failed to get sync stats:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [db, isInitialized]);\n\n  useEffect(() => {\n    refresh();\n    const interval = setInterval(refresh, 10000);\n    return () => clearInterval(interval);\n  }, [refresh]);\n\n  const hasPendingChanges = stats.pendingProperties > 0 || \n    stats.pendingInspections > 0 || \n    stats.pendingEvidence > 0 || \n    stats.pendingQueueItems > 0;\n\n  const hasFailedChanges = stats.failedQueueItems > 0;\n\n  const totalPending = stats.pendingQueueItems;\n\n  return {\n    stats,\n    isLoading,\n    refresh,\n    hasPendingChanges,\n    hasFailedChanges,\n    totalPending,\n  };\n}\n","path":null,"size_bytes":5855,"size_tokens":null},"client/src/lib/sync-service.ts":{"content":"import { Capacitor } from '@capacitor/core';\nimport { offlineDb, OfflineSyncQueue, OfflineProperty, OfflineInspection, OfflineEvidence } from './offline-database';\n\ntype SyncStatus = 'idle' | 'syncing' | 'error' | 'offline';\n\ninterface SyncResult {\n  success: boolean;\n  syncedItems: number;\n  failedItems: number;\n  errors: string[];\n}\n\ninterface ConflictResolution {\n  entityType: 'property' | 'inspection' | 'evidence';\n  entityId: string;\n  localData: any;\n  serverData: any;\n  resolution: 'keep_local' | 'keep_server' | 'merge';\n  resolvedData?: any;\n}\n\nclass SyncService {\n  private isOnline: boolean = true;\n  private isSyncing: boolean = false;\n  private syncStatus: SyncStatus = 'idle';\n  private listeners: Set<(status: SyncStatus) => void> = new Set();\n  private syncInterval: number | null = null;\n  private baseUrl: string = '';\n\n  constructor() {\n    this.setupNetworkListener();\n    this.baseUrl = window.location.origin;\n  }\n\n  private setupNetworkListener(): void {\n    if (typeof window !== 'undefined') {\n      window.addEventListener('online', () => {\n        this.isOnline = true;\n        this.notifyListeners('idle');\n        this.triggerSync();\n      });\n\n      window.addEventListener('offline', () => {\n        this.isOnline = false;\n        this.notifyListeners('offline');\n      });\n\n      this.isOnline = navigator.onLine;\n    }\n  }\n\n  addStatusListener(listener: (status: SyncStatus) => void): () => void {\n    this.listeners.add(listener);\n    listener(this.syncStatus);\n    return () => this.listeners.delete(listener);\n  }\n\n  private notifyListeners(status: SyncStatus): void {\n    this.syncStatus = status;\n    this.listeners.forEach(listener => listener(status));\n  }\n\n  getStatus(): SyncStatus {\n    return this.syncStatus;\n  }\n\n  isNetworkAvailable(): boolean {\n    return this.isOnline;\n  }\n\n  startAutoSync(intervalMs: number = 30000): void {\n    if (this.syncInterval) {\n      clearInterval(this.syncInterval);\n    }\n\n    this.syncInterval = window.setInterval(() => {\n      if (this.isOnline && !this.isSyncing) {\n        this.triggerSync();\n      }\n    }, intervalMs);\n\n    if (this.isOnline) {\n      this.triggerSync();\n    }\n  }\n\n  stopAutoSync(): void {\n    if (this.syncInterval) {\n      clearInterval(this.syncInterval);\n      this.syncInterval = null;\n    }\n  }\n\n  async triggerSync(): Promise<SyncResult> {\n    if (!this.isOnline) {\n      return { success: false, syncedItems: 0, failedItems: 0, errors: ['Network unavailable'] };\n    }\n\n    if (this.isSyncing) {\n      return { success: false, syncedItems: 0, failedItems: 0, errors: ['Sync already in progress'] };\n    }\n\n    this.isSyncing = true;\n    this.notifyListeners('syncing');\n\n    const result: SyncResult = {\n      success: true,\n      syncedItems: 0,\n      failedItems: 0,\n      errors: [],\n    };\n\n    try {\n      const pendingItems = await offlineDb.getPendingSyncItems();\n\n      for (const item of pendingItems) {\n        try {\n          await this.processSyncItem(item);\n          await offlineDb.markSyncItemCompleted(item.id);\n          result.syncedItems++;\n        } catch (error) {\n          const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n          await offlineDb.markSyncItemFailed(item.id, errorMessage);\n          result.failedItems++;\n          result.errors.push(`${item.entityType}/${item.entityId}: ${errorMessage}`);\n        }\n      }\n\n      await this.uploadPendingEvidence();\n\n      this.notifyListeners('idle');\n    } catch (error) {\n      result.success = false;\n      result.errors.push(error instanceof Error ? error.message : 'Sync failed');\n      this.notifyListeners('error');\n    } finally {\n      this.isSyncing = false;\n    }\n\n    return result;\n  }\n\n  private async processSyncItem(item: OfflineSyncQueue): Promise<void> {\n    const payload = JSON.parse(item.payload);\n\n    switch (item.entityType) {\n      case 'property':\n        await this.syncProperty(item.action, item.entityId, payload);\n        break;\n      case 'inspection':\n        await this.syncInspection(item.action, item.entityId, payload);\n        break;\n      case 'evidence':\n        break;\n    }\n  }\n\n  private async syncProperty(\n    action: 'create' | 'update' | 'delete',\n    entityId: string,\n    payload: any\n  ): Promise<void> {\n    const property = await offlineDb.getProperty(entityId);\n    if (!property) return;\n\n    if (action === 'create') {\n      const response = await fetch(`${this.baseUrl}/api/properties`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          name: property.name,\n          address: property.address,\n          buildingInfo: property.buildingInfo ? JSON.parse(property.buildingInfo) : null,\n          roofSystemDetails: property.roofSystemDetails ? JSON.parse(property.roofSystemDetails) : null,\n          overallCondition: property.overallCondition,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to create property: ${response.statusText}`);\n      }\n\n      const serverProperty = await response.json();\n      await offlineDb.updateProperty(entityId, {\n        serverId: serverProperty.id,\n        syncStatus: 'synced',\n        serverUpdatedAt: new Date().toISOString(),\n      });\n    } else if (action === 'update' && property.serverId) {\n      const serverResponse = await fetch(`${this.baseUrl}/api/properties/${property.serverId}`, {\n        method: 'GET',\n        credentials: 'include',\n      });\n\n      if (serverResponse.ok) {\n        const serverData = await serverResponse.json();\n        \n        if (serverData.updatedAt && property.serverUpdatedAt) {\n          const serverUpdated = new Date(serverData.updatedAt).getTime();\n          const localServerUpdated = new Date(property.serverUpdatedAt).getTime();\n          \n          if (serverUpdated > localServerUpdated) {\n            const conflict = await this.resolveConflict('property', entityId, property, serverData);\n            if (conflict.resolution === 'keep_server') {\n              await offlineDb.updateProperty(entityId, {\n                ...serverData,\n                syncStatus: 'synced',\n                serverUpdatedAt: serverData.updatedAt,\n              });\n              return;\n            }\n          }\n        }\n      }\n\n      const response = await fetch(`${this.baseUrl}/api/properties/${property.serverId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to update property: ${response.statusText}`);\n      }\n\n      await offlineDb.updateProperty(entityId, {\n        syncStatus: 'synced',\n        serverUpdatedAt: new Date().toISOString(),\n      });\n    }\n  }\n\n  private async syncInspection(\n    action: 'create' | 'update' | 'delete',\n    entityId: string,\n    payload: any\n  ): Promise<void> {\n    const inspection = await offlineDb.getInspection(entityId);\n    if (!inspection) return;\n\n    if (action === 'create') {\n      const response = await fetch(`${this.baseUrl}/api/inspections`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          propertyId: inspection.propertyServerId,\n          currentStep: inspection.currentStep,\n          stepData: JSON.parse(inspection.stepData),\n          status: inspection.status,\n          startedAt: inspection.startedAt,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to create inspection: ${response.statusText}`);\n      }\n\n      const serverInspection = await response.json();\n      await offlineDb.updateInspection(entityId, {\n        serverId: serverInspection.id,\n        syncStatus: 'synced',\n        serverUpdatedAt: new Date().toISOString(),\n      });\n    } else if (action === 'update' && inspection.serverId) {\n      const response = await fetch(`${this.baseUrl}/api/inspections/${inspection.serverId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          currentStep: inspection.currentStep,\n          stepData: JSON.parse(inspection.stepData),\n          status: inspection.status,\n          completedAt: inspection.completedAt,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to update inspection: ${response.statusText}`);\n      }\n\n      await offlineDb.updateInspection(entityId, {\n        syncStatus: 'synced',\n        serverUpdatedAt: new Date().toISOString(),\n      });\n    }\n  }\n\n  private async uploadPendingEvidence(): Promise<void> {\n    const pendingEvidence = await offlineDb.getPendingEvidence();\n\n    for (const evidence of pendingEvidence) {\n      try {\n        if (Capacitor.isNativePlatform()) {\n          const formData = new FormData();\n          \n          const response = await fetch(evidence.localPath);\n          const blob = await response.blob();\n          const filename = evidence.localPath.split('/').pop() || 'evidence.jpg';\n          formData.append('file', blob, filename);\n          formData.append('inspectionId', evidence.inspectionServerId?.toString() || '');\n          formData.append('step', evidence.step.toString());\n          formData.append('type', evidence.type);\n          formData.append('metadata', evidence.metadata);\n          if (evidence.latitude) formData.append('latitude', evidence.latitude.toString());\n          if (evidence.longitude) formData.append('longitude', evidence.longitude.toString());\n\n          const uploadResponse = await fetch(`${this.baseUrl}/api/evidence/upload`, {\n            method: 'POST',\n            credentials: 'include',\n            body: formData,\n          });\n\n          if (!uploadResponse.ok) {\n            throw new Error(`Upload failed: ${uploadResponse.statusText}`);\n          }\n\n          const result = await uploadResponse.json();\n          await offlineDb.markEvidenceSynced(evidence.id, result.url, result.id);\n        } else {\n          if (evidence.localPath.startsWith('data:') || evidence.localPath.startsWith('blob:')) {\n            const formData = new FormData();\n            \n            const response = await fetch(evidence.localPath);\n            const blob = await response.blob();\n            formData.append('file', blob, `evidence-${evidence.id}.jpg`);\n            formData.append('inspectionId', evidence.inspectionServerId?.toString() || '');\n            formData.append('step', evidence.step.toString());\n            formData.append('type', evidence.type);\n            formData.append('metadata', evidence.metadata);\n\n            const uploadResponse = await fetch(`${this.baseUrl}/api/evidence/upload`, {\n              method: 'POST',\n              credentials: 'include',\n              body: formData,\n            });\n\n            if (uploadResponse.ok) {\n              const result = await uploadResponse.json();\n              await offlineDb.markEvidenceSynced(evidence.id, result.url, result.id);\n            }\n          }\n        }\n      } catch (error) {\n        await offlineDb.incrementEvidenceUploadAttempts(\n          evidence.id,\n          error instanceof Error ? error.message : 'Upload failed'\n        );\n      }\n    }\n  }\n\n  private async resolveConflict(\n    entityType: 'property' | 'inspection' | 'evidence',\n    entityId: string,\n    localData: any,\n    serverData: any\n  ): Promise<ConflictResolution> {\n    const localTime = new Date(localData.localUpdatedAt).getTime();\n    const serverTime = new Date(serverData.updatedAt || serverData.createdAt).getTime();\n\n    if (localTime > serverTime) {\n      return {\n        entityType,\n        entityId,\n        localData,\n        serverData,\n        resolution: 'keep_local',\n      };\n    }\n\n    return {\n      entityType,\n      entityId,\n      localData,\n      serverData,\n      resolution: 'keep_server',\n    };\n  }\n\n  async pullServerData(userId: number): Promise<void> {\n    if (!this.isOnline) return;\n\n    try {\n      const propertiesResponse = await fetch(`${this.baseUrl}/api/properties?userId=${userId}`, {\n        credentials: 'include',\n      });\n\n      if (propertiesResponse.ok) {\n        const serverProperties = await propertiesResponse.json();\n        \n        for (const serverProp of serverProperties) {\n          const existingProps = await offlineDb.getAllProperties();\n          const existing = existingProps.find(p => p.serverId === serverProp.id);\n          \n          if (!existing) {\n            await offlineDb.saveProperty({\n              serverId: serverProp.id,\n              projectId: serverProp.projectId,\n              name: serverProp.name,\n              address: serverProp.address,\n              buildingInfo: serverProp.buildingInfo ? JSON.stringify(serverProp.buildingInfo) : undefined,\n              roofSystemDetails: serverProp.roofSystemDetails ? JSON.stringify(serverProp.roofSystemDetails) : undefined,\n              imageUrl: serverProp.imageUrl,\n              overallCondition: serverProp.overallCondition,\n              lastInspectionDate: serverProp.lastInspectionDate,\n              userId: serverProp.userId,\n            });\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Failed to pull server data:', error);\n    }\n  }\n}\n\nexport const syncService = new SyncService();\n","path":null,"size_bytes":13440,"size_tokens":null},"client/src/lib/offline-database.ts":{"content":"import { Capacitor } from '@capacitor/core';\nimport { CapacitorSQLite, SQLiteConnection, SQLiteDBConnection } from '@capacitor-community/sqlite';\n\nexport interface OfflineProperty {\n  id: string;\n  serverId?: number;\n  projectId?: number;\n  name: string;\n  address: string;\n  buildingInfo?: string;\n  roofSystemDetails?: string;\n  imageUrl?: string;\n  overallCondition?: string;\n  lastInspectionDate?: string;\n  userId?: number;\n  syncStatus: 'pending' | 'synced' | 'conflict';\n  localUpdatedAt: string;\n  serverUpdatedAt?: string;\n}\n\nexport interface OfflineInspection {\n  id: string;\n  serverId?: number;\n  propertyId: string;\n  propertyServerId?: number;\n  currentStep: number;\n  stepData: string;\n  evidenceIds: string;\n  status: 'in_progress' | 'completed' | 'submitted';\n  startedAt: string;\n  completedAt?: string;\n  syncStatus: 'pending' | 'synced' | 'conflict';\n  localUpdatedAt: string;\n  serverUpdatedAt?: string;\n}\n\nexport interface OfflineEvidence {\n  id: string;\n  serverId?: number;\n  inspectionId: string;\n  inspectionServerId?: number;\n  step: number;\n  type: 'photo' | 'thermal' | 'document' | 'voice_memo';\n  localPath: string;\n  remoteUrl?: string;\n  metadata: string;\n  capturedAt: string;\n  latitude?: number;\n  longitude?: number;\n  syncStatus: 'pending' | 'synced' | 'failed';\n  uploadAttempts: number;\n  localUpdatedAt: string;\n}\n\nexport interface OfflineSyncQueue {\n  id: string;\n  entityType: 'property' | 'inspection' | 'evidence';\n  entityId: string;\n  action: 'create' | 'update' | 'delete';\n  payload: string;\n  createdAt: string;\n  attempts: number;\n  lastAttemptAt?: string;\n  errorMessage?: string;\n  status: 'pending' | 'processing' | 'completed' | 'failed';\n}\n\nconst DB_NAME = 'winnstorm_offline';\nconst DB_VERSION = 1;\n\nconst CREATE_TABLES_SQL = `\nCREATE TABLE IF NOT EXISTS properties (\n  id TEXT PRIMARY KEY,\n  serverId INTEGER,\n  projectId INTEGER,\n  name TEXT NOT NULL,\n  address TEXT NOT NULL,\n  buildingInfo TEXT,\n  roofSystemDetails TEXT,\n  imageUrl TEXT,\n  overallCondition TEXT,\n  lastInspectionDate TEXT,\n  userId INTEGER,\n  syncStatus TEXT DEFAULT 'pending',\n  localUpdatedAt TEXT NOT NULL,\n  serverUpdatedAt TEXT\n);\n\nCREATE TABLE IF NOT EXISTS inspections (\n  id TEXT PRIMARY KEY,\n  serverId INTEGER,\n  propertyId TEXT NOT NULL,\n  propertyServerId INTEGER,\n  currentStep INTEGER DEFAULT 0,\n  stepData TEXT DEFAULT '{}',\n  evidenceIds TEXT DEFAULT '[]',\n  status TEXT DEFAULT 'in_progress',\n  startedAt TEXT NOT NULL,\n  completedAt TEXT,\n  syncStatus TEXT DEFAULT 'pending',\n  localUpdatedAt TEXT NOT NULL,\n  serverUpdatedAt TEXT\n);\n\nCREATE TABLE IF NOT EXISTS evidence (\n  id TEXT PRIMARY KEY,\n  serverId INTEGER,\n  inspectionId TEXT NOT NULL,\n  inspectionServerId INTEGER,\n  step INTEGER NOT NULL,\n  type TEXT NOT NULL,\n  localPath TEXT NOT NULL,\n  remoteUrl TEXT,\n  metadata TEXT DEFAULT '{}',\n  capturedAt TEXT NOT NULL,\n  latitude REAL,\n  longitude REAL,\n  syncStatus TEXT DEFAULT 'pending',\n  uploadAttempts INTEGER DEFAULT 0,\n  localUpdatedAt TEXT NOT NULL\n);\n\nCREATE TABLE IF NOT EXISTS sync_queue (\n  id TEXT PRIMARY KEY,\n  entityType TEXT NOT NULL,\n  entityId TEXT NOT NULL,\n  action TEXT NOT NULL,\n  payload TEXT NOT NULL,\n  createdAt TEXT NOT NULL,\n  attempts INTEGER DEFAULT 0,\n  lastAttemptAt TEXT,\n  errorMessage TEXT,\n  status TEXT DEFAULT 'pending'\n);\n\nCREATE TABLE IF NOT EXISTS app_state (\n  key TEXT PRIMARY KEY,\n  value TEXT NOT NULL,\n  updatedAt TEXT NOT NULL\n);\n\nCREATE INDEX IF NOT EXISTS idx_properties_sync ON properties(syncStatus);\nCREATE INDEX IF NOT EXISTS idx_inspections_sync ON inspections(syncStatus);\nCREATE INDEX IF NOT EXISTS idx_inspections_property ON inspections(propertyId);\nCREATE INDEX IF NOT EXISTS idx_evidence_sync ON evidence(syncStatus);\nCREATE INDEX IF NOT EXISTS idx_evidence_inspection ON evidence(inspectionId);\nCREATE INDEX IF NOT EXISTS idx_sync_queue_status ON sync_queue(status);\n`;\n\nclass OfflineDatabase {\n  private sqlite: SQLiteConnection;\n  private db: SQLiteDBConnection | null = null;\n  private initialized = false;\n  private isNative: boolean;\n\n  constructor() {\n    this.sqlite = new SQLiteConnection(CapacitorSQLite);\n    this.isNative = Capacitor.isNativePlatform();\n  }\n\n  async initialize(): Promise<void> {\n    if (this.initialized) return;\n\n    try {\n      if (this.isNative) {\n        const retCC = await this.sqlite.checkConnectionsConsistency();\n        const isConn = (await this.sqlite.isConnection(DB_NAME, false)).result;\n\n        if (retCC.result && isConn) {\n          this.db = await this.sqlite.retrieveConnection(DB_NAME, false);\n        } else {\n          this.db = await this.sqlite.createConnection(\n            DB_NAME,\n            false,\n            'no-encryption',\n            DB_VERSION,\n            false\n          );\n        }\n\n        await this.db.open();\n        await this.db.execute(CREATE_TABLES_SQL);\n      } else {\n        console.log('OfflineDatabase: Running in web mode - using IndexedDB fallback');\n        await this.initWebFallback();\n      }\n\n      this.initialized = true;\n      console.log('OfflineDatabase: Initialized successfully');\n    } catch (error) {\n      console.error('OfflineDatabase: Initialization failed', error);\n      throw error;\n    }\n  }\n\n  private async initWebFallback(): Promise<void> {\n    if (typeof window !== 'undefined' && 'indexedDB' in window) {\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(DB_NAME, DB_VERSION);\n        \n        request.onerror = () => reject(request.error);\n        request.onsuccess = () => {\n          (this as any).indexedDB = request.result;\n          resolve();\n        };\n        \n        request.onupgradeneeded = (event) => {\n          const db = (event.target as IDBOpenDBRequest).result;\n          \n          if (!db.objectStoreNames.contains('properties')) {\n            const propertiesStore = db.createObjectStore('properties', { keyPath: 'id' });\n            propertiesStore.createIndex('syncStatus', 'syncStatus', { unique: false });\n          }\n          \n          if (!db.objectStoreNames.contains('inspections')) {\n            const inspectionsStore = db.createObjectStore('inspections', { keyPath: 'id' });\n            inspectionsStore.createIndex('propertyId', 'propertyId', { unique: false });\n            inspectionsStore.createIndex('syncStatus', 'syncStatus', { unique: false });\n          }\n          \n          if (!db.objectStoreNames.contains('evidence')) {\n            const evidenceStore = db.createObjectStore('evidence', { keyPath: 'id' });\n            evidenceStore.createIndex('inspectionId', 'inspectionId', { unique: false });\n            evidenceStore.createIndex('syncStatus', 'syncStatus', { unique: false });\n          }\n          \n          if (!db.objectStoreNames.contains('sync_queue')) {\n            const syncStore = db.createObjectStore('sync_queue', { keyPath: 'id' });\n            syncStore.createIndex('status', 'status', { unique: false });\n          }\n\n          if (!db.objectStoreNames.contains('app_state')) {\n            db.createObjectStore('app_state', { keyPath: 'key' });\n          }\n        };\n      });\n    }\n  }\n\n  generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  async saveProperty(property: Omit<OfflineProperty, 'id' | 'localUpdatedAt' | 'syncStatus'>): Promise<OfflineProperty> {\n    const id = this.generateId();\n    const now = new Date().toISOString();\n    \n    const newProperty: OfflineProperty = {\n      ...property,\n      id,\n      syncStatus: 'pending',\n      localUpdatedAt: now,\n    };\n\n    if (this.isNative && this.db) {\n      await this.db.run(\n        `INSERT INTO properties (id, serverId, projectId, name, address, buildingInfo, roofSystemDetails, imageUrl, overallCondition, lastInspectionDate, userId, syncStatus, localUpdatedAt, serverUpdatedAt)\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,\n        [\n          newProperty.id,\n          newProperty.serverId || null,\n          newProperty.projectId || null,\n          newProperty.name,\n          newProperty.address,\n          newProperty.buildingInfo || null,\n          newProperty.roofSystemDetails || null,\n          newProperty.imageUrl || null,\n          newProperty.overallCondition || null,\n          newProperty.lastInspectionDate || null,\n          newProperty.userId || null,\n          newProperty.syncStatus,\n          newProperty.localUpdatedAt,\n          newProperty.serverUpdatedAt || null,\n        ]\n      );\n    } else {\n      await this.webSave('properties', newProperty);\n    }\n\n    await this.addToSyncQueue('property', id, 'create', newProperty);\n    return newProperty;\n  }\n\n  async updateProperty(id: string, updates: Partial<OfflineProperty>): Promise<void> {\n    const now = new Date().toISOString();\n    \n    if (this.isNative && this.db) {\n      const setClauses: string[] = [];\n      const values: any[] = [];\n      \n      Object.entries(updates).forEach(([key, value]) => {\n        if (key !== 'id') {\n          setClauses.push(`${key} = ?`);\n          values.push(value);\n        }\n      });\n      \n      setClauses.push('localUpdatedAt = ?');\n      values.push(now);\n      setClauses.push('syncStatus = ?');\n      values.push('pending');\n      values.push(id);\n      \n      await this.db.run(\n        `UPDATE properties SET ${setClauses.join(', ')} WHERE id = ?`,\n        values\n      );\n    } else {\n      const existing = await this.webGet('properties', id);\n      if (existing) {\n        await this.webSave('properties', {\n          ...existing,\n          ...updates,\n          localUpdatedAt: now,\n          syncStatus: 'pending',\n        });\n      }\n    }\n\n    await this.addToSyncQueue('property', id, 'update', updates);\n  }\n\n  async getProperty(id: string): Promise<OfflineProperty | null> {\n    if (this.isNative && this.db) {\n      const result = await this.db.query(`SELECT * FROM properties WHERE id = ?`, [id]);\n      return result.values?.[0] || null;\n    } else {\n      return await this.webGet('properties', id);\n    }\n  }\n\n  async getAllProperties(): Promise<OfflineProperty[]> {\n    if (this.isNative && this.db) {\n      const result = await this.db.query(`SELECT * FROM properties ORDER BY localUpdatedAt DESC`);\n      return result.values || [];\n    } else {\n      return await this.webGetAll('properties');\n    }\n  }\n\n  async getPendingProperties(): Promise<OfflineProperty[]> {\n    if (this.isNative && this.db) {\n      const result = await this.db.query(`SELECT * FROM properties WHERE syncStatus = 'pending'`);\n      return result.values || [];\n    } else {\n      return await this.webGetByIndex('properties', 'syncStatus', 'pending');\n    }\n  }\n\n  async saveInspection(inspection: Omit<OfflineInspection, 'id' | 'localUpdatedAt' | 'syncStatus'>): Promise<OfflineInspection> {\n    const id = this.generateId();\n    const now = new Date().toISOString();\n    \n    const newInspection: OfflineInspection = {\n      ...inspection,\n      id,\n      syncStatus: 'pending',\n      localUpdatedAt: now,\n    };\n\n    if (this.isNative && this.db) {\n      await this.db.run(\n        `INSERT INTO inspections (id, serverId, propertyId, propertyServerId, currentStep, stepData, evidenceIds, status, startedAt, completedAt, syncStatus, localUpdatedAt, serverUpdatedAt)\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,\n        [\n          newInspection.id,\n          newInspection.serverId || null,\n          newInspection.propertyId,\n          newInspection.propertyServerId || null,\n          newInspection.currentStep,\n          newInspection.stepData,\n          newInspection.evidenceIds,\n          newInspection.status,\n          newInspection.startedAt,\n          newInspection.completedAt || null,\n          newInspection.syncStatus,\n          newInspection.localUpdatedAt,\n          newInspection.serverUpdatedAt || null,\n        ]\n      );\n    } else {\n      await this.webSave('inspections', newInspection);\n    }\n\n    await this.addToSyncQueue('inspection', id, 'create', newInspection);\n    return newInspection;\n  }\n\n  async updateInspection(id: string, updates: Partial<OfflineInspection>): Promise<void> {\n    const now = new Date().toISOString();\n    \n    if (this.isNative && this.db) {\n      const setClauses: string[] = [];\n      const values: any[] = [];\n      \n      Object.entries(updates).forEach(([key, value]) => {\n        if (key !== 'id') {\n          setClauses.push(`${key} = ?`);\n          values.push(value);\n        }\n      });\n      \n      setClauses.push('localUpdatedAt = ?');\n      values.push(now);\n      setClauses.push('syncStatus = ?');\n      values.push('pending');\n      values.push(id);\n      \n      await this.db.run(\n        `UPDATE inspections SET ${setClauses.join(', ')} WHERE id = ?`,\n        values\n      );\n    } else {\n      const existing = await this.webGet('inspections', id);\n      if (existing) {\n        await this.webSave('inspections', {\n          ...existing,\n          ...updates,\n          localUpdatedAt: now,\n          syncStatus: 'pending',\n        });\n      }\n    }\n\n    await this.addToSyncQueue('inspection', id, 'update', updates);\n  }\n\n  async getInspection(id: string): Promise<OfflineInspection | null> {\n    if (this.isNative && this.db) {\n      const result = await this.db.query(`SELECT * FROM inspections WHERE id = ?`, [id]);\n      return result.values?.[0] || null;\n    } else {\n      return await this.webGet('inspections', id);\n    }\n  }\n\n  async getInspectionsByProperty(propertyId: string): Promise<OfflineInspection[]> {\n    if (this.isNative && this.db) {\n      const result = await this.db.query(`SELECT * FROM inspections WHERE propertyId = ? ORDER BY startedAt DESC`, [propertyId]);\n      return result.values || [];\n    } else {\n      return await this.webGetByIndex('inspections', 'propertyId', propertyId);\n    }\n  }\n\n  async saveEvidence(evidence: Omit<OfflineEvidence, 'id' | 'localUpdatedAt' | 'syncStatus' | 'uploadAttempts'>): Promise<OfflineEvidence> {\n    const id = this.generateId();\n    const now = new Date().toISOString();\n    \n    const newEvidence: OfflineEvidence = {\n      ...evidence,\n      id,\n      syncStatus: 'pending',\n      uploadAttempts: 0,\n      localUpdatedAt: now,\n    };\n\n    if (this.isNative && this.db) {\n      await this.db.run(\n        `INSERT INTO evidence (id, serverId, inspectionId, inspectionServerId, step, type, localPath, remoteUrl, metadata, capturedAt, latitude, longitude, syncStatus, uploadAttempts, localUpdatedAt)\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,\n        [\n          newEvidence.id,\n          newEvidence.serverId || null,\n          newEvidence.inspectionId,\n          newEvidence.inspectionServerId || null,\n          newEvidence.step,\n          newEvidence.type,\n          newEvidence.localPath,\n          newEvidence.remoteUrl || null,\n          newEvidence.metadata,\n          newEvidence.capturedAt,\n          newEvidence.latitude || null,\n          newEvidence.longitude || null,\n          newEvidence.syncStatus,\n          newEvidence.uploadAttempts,\n          newEvidence.localUpdatedAt,\n        ]\n      );\n    } else {\n      await this.webSave('evidence', newEvidence);\n    }\n\n    await this.addToSyncQueue('evidence', id, 'create', newEvidence);\n    return newEvidence;\n  }\n\n  async getEvidenceByInspection(inspectionId: string): Promise<OfflineEvidence[]> {\n    if (this.isNative && this.db) {\n      const result = await this.db.query(`SELECT * FROM evidence WHERE inspectionId = ? ORDER BY capturedAt ASC`, [inspectionId]);\n      return result.values || [];\n    } else {\n      return await this.webGetByIndex('evidence', 'inspectionId', inspectionId);\n    }\n  }\n\n  async getPendingEvidence(): Promise<OfflineEvidence[]> {\n    if (this.isNative && this.db) {\n      const result = await this.db.query(`SELECT * FROM evidence WHERE syncStatus = 'pending' ORDER BY capturedAt ASC`);\n      return result.values || [];\n    } else {\n      return await this.webGetByIndex('evidence', 'syncStatus', 'pending');\n    }\n  }\n\n  async markEvidenceSynced(id: string, remoteUrl: string, serverId: number): Promise<void> {\n    const now = new Date().toISOString();\n    \n    if (this.isNative && this.db) {\n      await this.db.run(\n        `UPDATE evidence SET syncStatus = 'synced', remoteUrl = ?, serverId = ?, localUpdatedAt = ? WHERE id = ?`,\n        [remoteUrl, serverId, now, id]\n      );\n    } else {\n      const existing = await this.webGet('evidence', id);\n      if (existing) {\n        await this.webSave('evidence', {\n          ...existing,\n          syncStatus: 'synced',\n          remoteUrl,\n          serverId,\n          localUpdatedAt: now,\n        });\n      }\n    }\n  }\n\n  async incrementEvidenceUploadAttempts(id: string, errorMessage?: string): Promise<void> {\n    const now = new Date().toISOString();\n    \n    if (this.isNative && this.db) {\n      await this.db.run(\n        `UPDATE evidence SET uploadAttempts = uploadAttempts + 1, syncStatus = CASE WHEN uploadAttempts >= 3 THEN 'failed' ELSE 'pending' END, localUpdatedAt = ? WHERE id = ?`,\n        [now, id]\n      );\n    } else {\n      const existing = await this.webGet('evidence', id) as OfflineEvidence | null;\n      if (existing) {\n        const newAttempts = existing.uploadAttempts + 1;\n        await this.webSave('evidence', {\n          ...existing,\n          uploadAttempts: newAttempts,\n          syncStatus: newAttempts >= 3 ? 'failed' : 'pending',\n          localUpdatedAt: now,\n        });\n      }\n    }\n  }\n\n  private async addToSyncQueue(\n    entityType: 'property' | 'inspection' | 'evidence',\n    entityId: string,\n    action: 'create' | 'update' | 'delete',\n    payload: any\n  ): Promise<void> {\n    const queueItem: OfflineSyncQueue = {\n      id: this.generateId(),\n      entityType,\n      entityId,\n      action,\n      payload: JSON.stringify(payload),\n      createdAt: new Date().toISOString(),\n      attempts: 0,\n      status: 'pending',\n    };\n\n    if (this.isNative && this.db) {\n      await this.db.run(\n        `INSERT INTO sync_queue (id, entityType, entityId, action, payload, createdAt, attempts, lastAttemptAt, errorMessage, status)\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,\n        [\n          queueItem.id,\n          queueItem.entityType,\n          queueItem.entityId,\n          queueItem.action,\n          queueItem.payload,\n          queueItem.createdAt,\n          queueItem.attempts,\n          null,\n          null,\n          queueItem.status,\n        ]\n      );\n    } else {\n      await this.webSave('sync_queue', queueItem);\n    }\n  }\n\n  async getPendingSyncItems(): Promise<OfflineSyncQueue[]> {\n    if (this.isNative && this.db) {\n      const result = await this.db.query(\n        `SELECT * FROM sync_queue WHERE status = 'pending' ORDER BY createdAt ASC`\n      );\n      return result.values || [];\n    } else {\n      return await this.webGetByIndex('sync_queue', 'status', 'pending');\n    }\n  }\n\n  async markSyncItemCompleted(id: string): Promise<void> {\n    if (this.isNative && this.db) {\n      await this.db.run(`UPDATE sync_queue SET status = 'completed' WHERE id = ?`, [id]);\n    } else {\n      const existing = await this.webGet('sync_queue', id);\n      if (existing) {\n        await this.webSave('sync_queue', { ...existing, status: 'completed' });\n      }\n    }\n  }\n\n  async markSyncItemFailed(id: string, errorMessage: string): Promise<void> {\n    const now = new Date().toISOString();\n    \n    if (this.isNative && this.db) {\n      await this.db.run(\n        `UPDATE sync_queue SET attempts = attempts + 1, lastAttemptAt = ?, errorMessage = ?, status = CASE WHEN attempts >= 3 THEN 'failed' ELSE 'pending' END WHERE id = ?`,\n        [now, errorMessage, id]\n      );\n    } else {\n      const existing = await this.webGet('sync_queue', id) as OfflineSyncQueue | null;\n      if (existing) {\n        const newAttempts = existing.attempts + 1;\n        await this.webSave('sync_queue', {\n          ...existing,\n          attempts: newAttempts,\n          lastAttemptAt: now,\n          errorMessage,\n          status: newAttempts >= 3 ? 'failed' : 'pending',\n        });\n      }\n    }\n  }\n\n  async getAppState(key: string): Promise<string | null> {\n    if (this.isNative && this.db) {\n      const result = await this.db.query(`SELECT value FROM app_state WHERE key = ?`, [key]);\n      return result.values?.[0]?.value || null;\n    } else {\n      const item = await this.webGet('app_state', key);\n      return item?.value || null;\n    }\n  }\n\n  async setAppState(key: string, value: string): Promise<void> {\n    const now = new Date().toISOString();\n    \n    if (this.isNative && this.db) {\n      await this.db.run(\n        `INSERT OR REPLACE INTO app_state (key, value, updatedAt) VALUES (?, ?, ?)`,\n        [key, value, now]\n      );\n    } else {\n      await this.webSave('app_state', { key, value, updatedAt: now });\n    }\n  }\n\n  async getSyncStats(): Promise<{\n    pendingProperties: number;\n    pendingInspections: number;\n    pendingEvidence: number;\n    pendingQueueItems: number;\n    failedQueueItems: number;\n  }> {\n    if (this.isNative && this.db) {\n      const [props, insp, evid, pending, failed] = await Promise.all([\n        this.db.query(`SELECT COUNT(*) as count FROM properties WHERE syncStatus = 'pending'`),\n        this.db.query(`SELECT COUNT(*) as count FROM inspections WHERE syncStatus = 'pending'`),\n        this.db.query(`SELECT COUNT(*) as count FROM evidence WHERE syncStatus = 'pending'`),\n        this.db.query(`SELECT COUNT(*) as count FROM sync_queue WHERE status = 'pending'`),\n        this.db.query(`SELECT COUNT(*) as count FROM sync_queue WHERE status = 'failed'`),\n      ]);\n\n      return {\n        pendingProperties: props.values?.[0]?.count || 0,\n        pendingInspections: insp.values?.[0]?.count || 0,\n        pendingEvidence: evid.values?.[0]?.count || 0,\n        pendingQueueItems: pending.values?.[0]?.count || 0,\n        failedQueueItems: failed.values?.[0]?.count || 0,\n      };\n    } else {\n      const [pendingProps, pendingInsp, pendingEvid, pendingQueue, failedQueue] = await Promise.all([\n        this.webGetByIndex('properties', 'syncStatus', 'pending'),\n        this.webGetByIndex('inspections', 'syncStatus', 'pending'),\n        this.webGetByIndex('evidence', 'syncStatus', 'pending'),\n        this.webGetByIndex('sync_queue', 'status', 'pending'),\n        this.webGetByIndex('sync_queue', 'status', 'failed'),\n      ]);\n\n      return {\n        pendingProperties: pendingProps.length,\n        pendingInspections: pendingInsp.length,\n        pendingEvidence: pendingEvid.length,\n        pendingQueueItems: pendingQueue.length,\n        failedQueueItems: failedQueue.length,\n      };\n    }\n  }\n\n  async clearAllData(): Promise<void> {\n    if (this.isNative && this.db) {\n      await this.db.execute(`DELETE FROM evidence`);\n      await this.db.execute(`DELETE FROM inspections`);\n      await this.db.execute(`DELETE FROM properties`);\n      await this.db.execute(`DELETE FROM sync_queue`);\n      await this.db.execute(`DELETE FROM app_state`);\n    } else {\n      const db = (this as any).indexedDB as IDBDatabase;\n      if (db) {\n        const stores = ['properties', 'inspections', 'evidence', 'sync_queue', 'app_state'];\n        for (const storeName of stores) {\n          const transaction = db.transaction(storeName, 'readwrite');\n          transaction.objectStore(storeName).clear();\n        }\n      }\n    }\n  }\n\n  private async webSave(storeName: string, data: any): Promise<void> {\n    const db = (this as any).indexedDB as IDBDatabase;\n    if (!db) return;\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readwrite');\n      const store = transaction.objectStore(storeName);\n      const request = store.put(data);\n      request.onsuccess = () => resolve();\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  private async webGet(storeName: string, id: string): Promise<any> {\n    const db = (this as any).indexedDB as IDBDatabase;\n    if (!db) return null;\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readonly');\n      const store = transaction.objectStore(storeName);\n      const request = store.get(id);\n      request.onsuccess = () => resolve(request.result || null);\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  private async webGetAll(storeName: string): Promise<any[]> {\n    const db = (this as any).indexedDB as IDBDatabase;\n    if (!db) return [];\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readonly');\n      const store = transaction.objectStore(storeName);\n      const request = store.getAll();\n      request.onsuccess = () => resolve(request.result || []);\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  private async webGetByIndex(storeName: string, indexName: string, value: string): Promise<any[]> {\n    const db = (this as any).indexedDB as IDBDatabase;\n    if (!db) return [];\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readonly');\n      const store = transaction.objectStore(storeName);\n      const index = store.index(indexName);\n      const request = index.getAll(value);\n      request.onsuccess = () => resolve(request.result || []);\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  async close(): Promise<void> {\n    if (this.isNative && this.db) {\n      await this.sqlite.closeConnection(DB_NAME, false);\n      this.db = null;\n      this.initialized = false;\n    }\n  }\n}\n\nexport const offlineDb = new OfflineDatabase();\n","path":null,"size_bytes":25584,"size_tokens":null},"client/src/lib/inspection-completeness-service.ts":{"content":"import type { WinnMethodologyStep } from '@shared/schema';\nimport { WINN_METHODOLOGY_STEPS } from '@shared/schema';\n\nexport interface StepCompleteness {\n  step: WinnMethodologyStep;\n  status: 'not_started' | 'in_progress' | 'completed' | 'skipped';\n  score: number;\n  photosCount: number;\n  requiredPhotos: number;\n  voiceMemosCount: number;\n  aiValidated: boolean;\n  issues: string[];\n  completionTime?: number;\n}\n\nexport interface InspectionCompletenessResult {\n  overallScore: number;\n  status: 'incomplete' | 'partial' | 'complete' | 'validated';\n  stepScores: StepCompleteness[];\n  totalPhotos: number;\n  totalVoiceMemos: number;\n  estimatedReportQuality: 'basic' | 'standard' | 'professional' | 'premium';\n  readyForReportGeneration: boolean;\n  recommendations: string[];\n  stormyMessage: string;\n}\n\nexport interface InspectionStepData {\n  step: WinnMethodologyStep;\n  photos: number;\n  voiceMemos: number;\n  thermalImages: number;\n  aiValidated: boolean;\n  skipped: boolean;\n  skipReason?: string;\n  completedAt?: string;\n}\n\nconst STEP_WEIGHTS: Record<WinnMethodologyStep, number> = {\n  weather_verification: 10,\n  thermal_imaging: 20,\n  terrestrial_walk: 15,\n  test_squares: 15,\n  soft_metals: 10,\n  moisture_testing: 15,\n  core_samples: 10,\n  report_assembly: 5,\n};\n\nconst STEP_PHOTO_REQUIREMENTS: Record<WinnMethodologyStep, number> = {\n  weather_verification: 0,\n  thermal_imaging: 3,\n  terrestrial_walk: 4,\n  test_squares: 2,\n  soft_metals: 2,\n  moisture_testing: 2,\n  core_samples: 2,\n  report_assembly: 0,\n};\n\nclass InspectionCompletenessService {\n  calculateCompleteness(stepData: InspectionStepData[]): InspectionCompletenessResult {\n    const stepScores: StepCompleteness[] = [];\n    let totalWeight = 0;\n    let earnedWeight = 0;\n    let totalPhotos = 0;\n    let totalVoiceMemos = 0;\n\n    for (const stepName of WINN_METHODOLOGY_STEPS) {\n      const data = stepData.find(s => s.step === stepName);\n      const requiredPhotos = STEP_PHOTO_REQUIREMENTS[stepName];\n      const weight = STEP_WEIGHTS[stepName];\n      totalWeight += weight;\n\n      if (!data) {\n        stepScores.push({\n          step: stepName,\n          status: 'not_started',\n          score: 0,\n          photosCount: 0,\n          requiredPhotos,\n          voiceMemosCount: 0,\n          aiValidated: false,\n          issues: ['Step not started'],\n        });\n        continue;\n      }\n\n      if (data.skipped) {\n        stepScores.push({\n          step: stepName,\n          status: 'skipped',\n          score: 50,\n          photosCount: data.photos,\n          requiredPhotos,\n          voiceMemosCount: data.voiceMemos,\n          aiValidated: false,\n          issues: data.skipReason ? [`Skipped: ${data.skipReason}`] : ['Step was skipped'],\n        });\n        earnedWeight += weight * 0.5;\n        continue;\n      }\n\n      const issues: string[] = [];\n      let stepScore = 0;\n\n      const photoScore = requiredPhotos > 0 \n        ? Math.min(100, (data.photos / requiredPhotos) * 100)\n        : 100;\n      \n      if (data.photos < requiredPhotos) {\n        issues.push(`Need ${requiredPhotos - data.photos} more photos`);\n      }\n\n      const aiBonus = data.aiValidated ? 10 : 0;\n      stepScore = Math.min(100, photoScore + aiBonus);\n\n      if (!data.aiValidated && requiredPhotos > 0) {\n        issues.push('AI validation recommended');\n      }\n\n      const status: StepCompleteness['status'] = \n        stepScore >= 100 ? 'completed' :\n        stepScore > 0 ? 'in_progress' : 'not_started';\n\n      stepScores.push({\n        step: stepName,\n        status,\n        score: Math.round(stepScore),\n        photosCount: data.photos,\n        requiredPhotos,\n        voiceMemosCount: data.voiceMemos,\n        aiValidated: data.aiValidated,\n        issues,\n        completionTime: data.completedAt ? Date.parse(data.completedAt) : undefined,\n      });\n\n      earnedWeight += weight * (stepScore / 100);\n      totalPhotos += data.photos;\n      totalVoiceMemos += data.voiceMemos;\n    }\n\n    const overallScore = Math.round((earnedWeight / totalWeight) * 100);\n    \n    const status: InspectionCompletenessResult['status'] = \n      overallScore >= 95 ? 'validated' :\n      overallScore >= 75 ? 'complete' :\n      overallScore >= 25 ? 'partial' : 'incomplete';\n\n    const estimatedReportQuality: InspectionCompletenessResult['estimatedReportQuality'] =\n      overallScore >= 90 && totalPhotos >= 15 ? 'premium' :\n      overallScore >= 75 && totalPhotos >= 10 ? 'professional' :\n      overallScore >= 50 && totalPhotos >= 5 ? 'standard' : 'basic';\n\n    const recommendations = this.generateRecommendations(stepScores, overallScore);\n    const stormyMessage = this.generateStormyMessage(stepScores, overallScore, status);\n\n    return {\n      overallScore,\n      status,\n      stepScores,\n      totalPhotos,\n      totalVoiceMemos,\n      estimatedReportQuality,\n      readyForReportGeneration: overallScore >= 70,\n      recommendations,\n      stormyMessage,\n    };\n  }\n\n  private generateRecommendations(stepScores: StepCompleteness[], overallScore: number): string[] {\n    const recommendations: string[] = [];\n\n    const incompleteSteps = stepScores.filter(s => s.status !== 'completed' && s.status !== 'skipped');\n    if (incompleteSteps.length > 0) {\n      const stepNames = incompleteSteps.slice(0, 3).map(s => this.formatStepName(s.step));\n      recommendations.push(`Complete the following steps: ${stepNames.join(', ')}`);\n    }\n\n    const needsPhotos = stepScores.filter(s => s.photosCount < s.requiredPhotos);\n    if (needsPhotos.length > 0) {\n      const totalNeeded = needsPhotos.reduce((sum, s) => sum + (s.requiredPhotos - s.photosCount), 0);\n      recommendations.push(`Capture ${totalNeeded} more photos across ${needsPhotos.length} steps`);\n    }\n\n    const needsValidation = stepScores.filter(s => !s.aiValidated && s.status === 'completed');\n    if (needsValidation.length > 0) {\n      recommendations.push('Request AI validation for completed steps to improve report quality');\n    }\n\n    if (overallScore < 50) {\n      recommendations.push('Focus on completing thermal imaging and terrestrial walk steps first');\n    }\n\n    return recommendations;\n  }\n\n  private generateStormyMessage(\n    stepScores: StepCompleteness[], \n    overallScore: number,\n    status: InspectionCompletenessResult['status']\n  ): string {\n    if (status === 'validated') {\n      return \"Outstanding work! This inspection is fully validated and ready for a premium-quality report. You've covered all the bases!\";\n    }\n\n    if (status === 'complete') {\n      return \"Great job! The inspection is complete. Consider adding AI validation to a few steps for an even stronger report.\";\n    }\n\n    if (status === 'partial') {\n      const nextStep = stepScores.find(s => s.status !== 'completed' && s.status !== 'skipped');\n      if (nextStep) {\n        return `Good progress! Let's focus on ${this.formatStepName(nextStep.step)} next. ${nextStep.issues[0] || 'Ready to continue?'}`;\n      }\n      return \"Keep going! You're making solid progress on this inspection.\";\n    }\n\n    return \"Let's get started! Begin with weather verification to establish the storm event timeline.\";\n  }\n\n  private formatStepName(step: WinnMethodologyStep): string {\n    return step\n      .split('_')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ');\n  }\n\n  getScoreColor(score: number): string {\n    if (score >= 80) return 'text-green-500';\n    if (score >= 60) return 'text-yellow-500';\n    if (score >= 40) return 'text-orange-500';\n    return 'text-red-500';\n  }\n\n  getStatusBadgeColor(status: InspectionCompletenessResult['status']): string {\n    switch (status) {\n      case 'validated': return 'bg-green-500/20 text-green-500 border-green-500/50';\n      case 'complete': return 'bg-blue-500/20 text-blue-500 border-blue-500/50';\n      case 'partial': return 'bg-yellow-500/20 text-yellow-500 border-yellow-500/50';\n      case 'incomplete': return 'bg-red-500/20 text-red-500 border-red-500/50';\n      default: return 'bg-white/10 text-white/60 border-white/30';\n    }\n  }\n\n  getQualityBadgeColor(quality: InspectionCompletenessResult['estimatedReportQuality']): string {\n    switch (quality) {\n      case 'premium': return 'bg-purple-500/20 text-purple-500 border-purple-500/50';\n      case 'professional': return 'bg-blue-500/20 text-blue-500 border-blue-500/50';\n      case 'standard': return 'bg-yellow-500/20 text-yellow-500 border-yellow-500/50';\n      case 'basic': return 'bg-white/10 text-white/60 border-white/30';\n      default: return 'bg-white/10 text-white/60 border-white/30';\n    }\n  }\n}\n\nexport const inspectionCompletenessService = new InspectionCompletenessService();\n","path":null,"size_bytes":8670,"size_tokens":null},"client/src/lib/thermal-analysis-service.ts":{"content":"export interface ThermalAnomalyResult {\n  anomalies: ThermalAnomaly[];\n  overallScore: number;\n  moistureRisk: 'low' | 'medium' | 'high';\n  recommendations: string[];\n  analysisTimestamp: string;\n}\n\nexport interface ThermalAnomaly {\n  id: string;\n  type: 'moisture' | 'heat_loss' | 'thermal_bridging' | 'air_infiltration' | 'equipment_issue';\n  severity: 'minor' | 'moderate' | 'severe';\n  location: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n  };\n  temperatureDelta: number;\n  description: string;\n  confidence: number;\n}\n\nexport interface ThermalAnalysisRequest {\n  imageDataUrl: string;\n  inspectionStep: string;\n  propertyType?: string;\n  roofType?: string;\n  ambientTemperature?: number;\n  weatherConditions?: string;\n}\n\nclass ThermalAnalysisService {\n  private baseUrl: string = '';\n\n  constructor() {\n    this.baseUrl = typeof window !== 'undefined' ? window.location.origin : '';\n  }\n\n  async analyzeThermalImage(request: ThermalAnalysisRequest): Promise<ThermalAnomalyResult> {\n    try {\n      const response = await fetch(`${this.baseUrl}/api/ai/analyze-thermal`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify(request),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Analysis failed: ${response.statusText}`);\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('Thermal analysis failed:', error);\n      return this.generateFallbackAnalysis();\n    }\n  }\n\n  private generateFallbackAnalysis(): ThermalAnomalyResult {\n    return {\n      anomalies: [],\n      overallScore: 0,\n      moistureRisk: 'low',\n      recommendations: [\n        'Unable to perform thermal analysis. Please retry with a clear thermal image.',\n        'Ensure the thermal image has sufficient temperature differential.',\n      ],\n      analysisTimestamp: new Date().toISOString(),\n    };\n  }\n\n  interpretAnomalyType(type: ThermalAnomaly['type']): {\n    title: string;\n    description: string;\n    actionRequired: string;\n  } {\n    const interpretations = {\n      moisture: {\n        title: 'Potential Moisture Intrusion',\n        description: 'Cooler areas may indicate trapped moisture in the roofing system.',\n        actionRequired: 'Perform moisture testing to confirm water presence.',\n      },\n      heat_loss: {\n        title: 'Heat Loss Detected',\n        description: 'Warmer areas on the exterior may indicate insulation failure.',\n        actionRequired: 'Document for energy efficiency recommendations.',\n      },\n      thermal_bridging: {\n        title: 'Thermal Bridge',\n        description: 'Heat transfer through structural elements bypassing insulation.',\n        actionRequired: 'Note for building envelope assessment.',\n      },\n      air_infiltration: {\n        title: 'Air Infiltration',\n        description: 'Temperature variations suggesting air leakage at seams or penetrations.',\n        actionRequired: 'Check flashings and seals in the affected area.',\n      },\n      equipment_issue: {\n        title: 'Equipment Anomaly',\n        description: 'Unusual heat signature from mechanical equipment.',\n        actionRequired: 'Verify equipment operation and document condition.',\n      },\n    };\n\n    return interpretations[type];\n  }\n\n  getSeverityColor(severity: ThermalAnomaly['severity']): string {\n    switch (severity) {\n      case 'severe': return 'text-red-500';\n      case 'moderate': return 'text-yellow-500';\n      case 'minor': return 'text-blue-500';\n      default: return 'text-white/60';\n    }\n  }\n\n  getSeverityBadgeColor(severity: ThermalAnomaly['severity']): string {\n    switch (severity) {\n      case 'severe': return 'bg-red-500/20 text-red-500 border-red-500/50';\n      case 'moderate': return 'bg-yellow-500/20 text-yellow-500 border-yellow-500/50';\n      case 'minor': return 'bg-blue-500/20 text-blue-500 border-blue-500/50';\n      default: return 'bg-white/10 text-white/60 border-white/30';\n    }\n  }\n\n  getMoistureRiskColor(risk: ThermalAnomalyResult['moistureRisk']): string {\n    switch (risk) {\n      case 'high': return 'text-red-500';\n      case 'medium': return 'text-yellow-500';\n      case 'low': return 'text-green-500';\n      default: return 'text-white/60';\n    }\n  }\n\n  formatTemperatureDelta(delta: number): string {\n    const absValue = Math.abs(delta).toFixed(1);\n    return delta > 0 ? `+${absValue}°F` : `-${absValue}°F`;\n  }\n\n  getConfidenceLabel(confidence: number): string {\n    if (confidence >= 0.9) return 'High';\n    if (confidence >= 0.7) return 'Medium';\n    if (confidence >= 0.5) return 'Low';\n    return 'Very Low';\n  }\n}\n\nexport const thermalAnalysisService = new ThermalAnalysisService();\n","path":null,"size_bytes":4727,"size_tokens":null},"client/src/lib/evidence-quality-service.ts":{"content":"export interface QualityCheckResult {\n  overallScore: number;\n  issues: QualityIssue[];\n  passed: boolean;\n  recommendations: string[];\n}\n\nexport interface QualityIssue {\n  type: 'blur' | 'lighting' | 'framing' | 'resolution' | 'focus' | 'exposure';\n  severity: 'minor' | 'moderate' | 'severe';\n  description: string;\n  suggestion: string;\n}\n\nexport interface EvidenceWithQuality {\n  id: string;\n  type: 'photo' | 'thermal' | 'document' | 'voice_memo';\n  dataUrl?: string;\n  qualityScore?: number;\n  qualityIssues?: QualityIssue[];\n  isValid?: boolean;\n}\n\nclass EvidenceQualityService {\n  private baseUrl: string = '';\n\n  constructor() {\n    this.baseUrl = typeof window !== 'undefined' ? window.location.origin : '';\n  }\n\n  async checkQuality(imageDataUrl: string, type: 'photo' | 'thermal' = 'photo'): Promise<QualityCheckResult> {\n    try {\n      const response = await fetch(`${this.baseUrl}/api/ai/check-quality`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ imageDataUrl, type }),\n      });\n\n      if (!response.ok) {\n        return this.performClientSideCheck(imageDataUrl, type);\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.warn('Server quality check failed, using client-side:', error);\n      return this.performClientSideCheck(imageDataUrl, type);\n    }\n  }\n\n  private async performClientSideCheck(imageDataUrl: string, type: 'photo' | 'thermal'): Promise<QualityCheckResult> {\n    const issues: QualityIssue[] = [];\n    let score = 100;\n\n    try {\n      const img = await this.loadImage(imageDataUrl);\n      \n      if (img.width < 800 || img.height < 600) {\n        issues.push({\n          type: 'resolution',\n          severity: 'moderate',\n          description: 'Image resolution is lower than recommended',\n          suggestion: 'Use higher resolution settings on your camera',\n        });\n        score -= 15;\n      }\n\n      if (img.width < 400 || img.height < 300) {\n        issues.push({\n          type: 'resolution',\n          severity: 'severe',\n          description: 'Image resolution is too low for professional reports',\n          suggestion: 'Recapture at higher resolution',\n        });\n        score -= 25;\n      }\n\n      const aspectRatio = img.width / img.height;\n      if (aspectRatio < 0.5 || aspectRatio > 2) {\n        issues.push({\n          type: 'framing',\n          severity: 'minor',\n          description: 'Unusual aspect ratio detected',\n          suggestion: 'Check camera orientation settings',\n        });\n        score -= 5;\n      }\n\n      const fileSize = this.estimateFileSize(imageDataUrl);\n      if (fileSize < 50000 && type === 'photo') {\n        issues.push({\n          type: 'exposure',\n          severity: 'minor',\n          description: 'File size suggests possible compression or low detail',\n          suggestion: 'Ensure adequate lighting and higher quality settings',\n        });\n        score -= 10;\n      }\n\n    } catch (error) {\n      issues.push({\n        type: 'focus',\n        severity: 'moderate',\n        description: 'Unable to fully analyze image',\n        suggestion: 'Ensure image is not corrupted',\n      });\n      score -= 20;\n    }\n\n    const recommendations: string[] = [];\n    if (issues.some(i => i.type === 'resolution')) {\n      recommendations.push('Consider retaking photos at higher resolution');\n    }\n    if (issues.some(i => i.type === 'lighting' || i.type === 'exposure')) {\n      recommendations.push('Improve lighting conditions for better clarity');\n    }\n    if (issues.some(i => i.type === 'blur' || i.type === 'focus')) {\n      recommendations.push('Hold camera steady and ensure subject is in focus');\n    }\n\n    return {\n      overallScore: Math.max(0, Math.min(100, score)),\n      issues,\n      passed: score >= 60,\n      recommendations,\n    };\n  }\n\n  private loadImage(dataUrl: string): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      img.onload = () => resolve(img);\n      img.onerror = reject;\n      img.src = dataUrl;\n    });\n  }\n\n  private estimateFileSize(dataUrl: string): number {\n    const base64Length = dataUrl.split(',')[1]?.length || 0;\n    return Math.round((base64Length * 3) / 4);\n  }\n\n  async batchCheckQuality(items: EvidenceWithQuality[]): Promise<EvidenceWithQuality[]> {\n    const results = await Promise.all(\n      items.map(async (item) => {\n        if (item.type === 'voice_memo' || !item.dataUrl) {\n          return {\n            ...item,\n            qualityScore: 100,\n            qualityIssues: [],\n            isValid: true,\n          };\n        }\n\n        const result = await this.checkQuality(item.dataUrl, item.type as 'photo' | 'thermal');\n        return {\n          ...item,\n          qualityScore: result.overallScore,\n          qualityIssues: result.issues,\n          isValid: result.passed,\n        };\n      })\n    );\n\n    return results;\n  }\n\n  getScoreColor(score: number): string {\n    if (score >= 80) return 'text-green-500';\n    if (score >= 60) return 'text-yellow-500';\n    return 'text-red-500';\n  }\n\n  getScoreBadgeColor(score: number): string {\n    if (score >= 80) return 'bg-green-500/20 text-green-500 border-green-500/50';\n    if (score >= 60) return 'bg-yellow-500/20 text-yellow-500 border-yellow-500/50';\n    return 'bg-red-500/20 text-red-500 border-red-500/50';\n  }\n\n  getScoreLabel(score: number): string {\n    if (score >= 90) return 'Excellent';\n    if (score >= 80) return 'Good';\n    if (score >= 70) return 'Acceptable';\n    if (score >= 60) return 'Fair';\n    return 'Poor';\n  }\n\n  getSeverityIcon(severity: QualityIssue['severity']): string {\n    switch (severity) {\n      case 'severe': return '⚠️';\n      case 'moderate': return '⚡';\n      case 'minor': return 'ℹ️';\n      default: return '';\n    }\n  }\n\n  formatIssueType(type: QualityIssue['type']): string {\n    const labels: Record<QualityIssue['type'], string> = {\n      blur: 'Motion Blur',\n      lighting: 'Lighting Issue',\n      framing: 'Framing',\n      resolution: 'Resolution',\n      focus: 'Focus',\n      exposure: 'Exposure',\n    };\n    return labels[type];\n  }\n}\n\nexport const evidenceQualityService = new EvidenceQualityService();\n","path":null,"size_bytes":6266,"size_tokens":null},"client/src/lib/step-validation-service.ts":{"content":"import { WinnMethodologyStep } from '@shared/schema';\n\nexport interface StepRequirement {\n  minPhotos: number;\n  requiredFields: string[];\n  aiValidationRequired: boolean;\n  canSkip: boolean;\n  skipReasons?: string[];\n}\n\nexport interface ValidationResult {\n  canAdvance: boolean;\n  blockers: ValidationBlocker[];\n  warnings: string[];\n  completionPercentage: number;\n  stormyMessage: string;\n}\n\nexport interface ValidationBlocker {\n  type: 'photos' | 'ai_validation' | 'required_field' | 'quality' | 'location';\n  message: string;\n  currentValue: number | string | boolean;\n  requiredValue: number | string | boolean;\n  priority: 'critical' | 'high' | 'medium';\n}\n\nexport interface EvidenceItem {\n  id: number | string;\n  type: string;\n  url?: string;\n  localPath?: string;\n  aiAnalysis?: {\n    isValid?: boolean;\n    confidence?: number;\n    anomalies?: string[];\n    qualityScore?: number;\n  };\n  latitude?: number;\n  longitude?: number;\n  metadata?: Record<string, any>;\n}\n\nconst STEP_REQUIREMENTS: Record<WinnMethodologyStep, StepRequirement> = {\n  weather_verification: {\n    minPhotos: 0,\n    requiredFields: ['weatherData'],\n    aiValidationRequired: false,\n    canSkip: false,\n  },\n  thermal_imaging: {\n    minPhotos: 3,\n    requiredFields: [],\n    aiValidationRequired: true,\n    canSkip: false,\n  },\n  terrestrial_walk: {\n    minPhotos: 4,\n    requiredFields: [],\n    aiValidationRequired: false,\n    canSkip: false,\n  },\n  test_squares: {\n    minPhotos: 2,\n    requiredFields: [],\n    aiValidationRequired: true,\n    canSkip: true,\n    skipReasons: ['No test squares needed', 'Property type does not require'],\n  },\n  soft_metals: {\n    minPhotos: 2,\n    requiredFields: [],\n    aiValidationRequired: true,\n    canSkip: true,\n    skipReasons: ['No soft metals present on property', 'Inaccessible areas'],\n  },\n  moisture_testing: {\n    minPhotos: 2,\n    requiredFields: [],\n    aiValidationRequired: true,\n    canSkip: true,\n    skipReasons: ['No moisture issues detected', 'Weather conditions prevent testing'],\n  },\n  core_samples: {\n    minPhotos: 2,\n    requiredFields: [],\n    aiValidationRequired: true,\n    canSkip: true,\n    skipReasons: ['Core samples not authorized', 'Roof system does not require'],\n  },\n  report_assembly: {\n    minPhotos: 0,\n    requiredFields: [],\n    aiValidationRequired: false,\n    canSkip: false,\n  },\n};\n\nconst STORMY_MESSAGES = {\n  ready: [\n    \"Looking great! You've captured everything needed for this step. Ready to move forward!\",\n    \"Excellent work! All requirements met. Let's proceed to the next step!\",\n    \"Perfect documentation! You're following the Winn Methodology precisely.\",\n  ],\n  almost: [\n    \"You're almost there! Just a few more items to complete this step properly.\",\n    \"Good progress! A couple more things and we'll be ready to advance.\",\n    \"Nearly complete! Let's finish strong on this step.\",\n  ],\n  needsWork: [\n    \"Let's focus on getting the essentials captured first. Quality documentation is key!\",\n    \"We need more evidence before moving on. Remember: thorough documentation protects everyone.\",\n    \"Take your time here. The Winn Methodology ensures we don't miss anything important.\",\n  ],\n  qualityIssue: [\n    \"Some of your photos need better quality. Try to ensure good lighting and focus.\",\n    \"The AI detected quality issues. Let's recapture those shots for the report.\",\n    \"Clear, well-lit photos make all the difference in a professional report.\",\n  ],\n};\n\nfunction getRandomMessage(category: keyof typeof STORMY_MESSAGES): string {\n  const messages = STORMY_MESSAGES[category];\n  return messages[Math.floor(Math.random() * messages.length)];\n}\n\nexport function validateStepCompletion(\n  step: WinnMethodologyStep,\n  evidence: EvidenceItem[],\n  stepData?: Record<string, any>\n): ValidationResult {\n  const requirements = STEP_REQUIREMENTS[step];\n  const blockers: ValidationBlocker[] = [];\n  const warnings: string[] = [];\n  let completedChecks = 0;\n  let totalChecks = 0;\n\n  totalChecks++;\n  if (evidence.length >= requirements.minPhotos) {\n    completedChecks++;\n  } else {\n    blockers.push({\n      type: 'photos',\n      message: `Need ${requirements.minPhotos - evidence.length} more photo${requirements.minPhotos - evidence.length === 1 ? '' : 's'}`,\n      currentValue: evidence.length,\n      requiredValue: requirements.minPhotos,\n      priority: 'critical',\n    });\n  }\n\n  if (requirements.aiValidationRequired) {\n    totalChecks++;\n    const validatedEvidence = evidence.filter(e => e.aiAnalysis?.isValid);\n    if (validatedEvidence.length > 0) {\n      completedChecks++;\n    } else if (evidence.length > 0) {\n      blockers.push({\n        type: 'ai_validation',\n        message: 'AI validation required - analyze your photos with Stormy',\n        currentValue: validatedEvidence.length,\n        requiredValue: 1,\n        priority: 'critical',\n      });\n    }\n  }\n\n  for (const field of requirements.requiredFields) {\n    totalChecks++;\n    if (stepData?.[field]) {\n      completedChecks++;\n    } else {\n      blockers.push({\n        type: 'required_field',\n        message: `Missing required: ${field.replace(/([A-Z])/g, ' $1').trim()}`,\n        currentValue: false,\n        requiredValue: true,\n        priority: 'high',\n      });\n    }\n  }\n\n  const lowQualityEvidence = evidence.filter(e => \n    e.aiAnalysis?.qualityScore !== undefined && e.aiAnalysis.qualityScore < 0.6\n  );\n  if (lowQualityEvidence.length > 0) {\n    warnings.push(`${lowQualityEvidence.length} photo${lowQualityEvidence.length === 1 ? '' : 's'} may have quality issues`);\n  }\n\n  const evidenceWithoutLocation = evidence.filter(e => !e.latitude || !e.longitude);\n  if (evidenceWithoutLocation.length > 0 && evidence.length > 0) {\n    warnings.push(`${evidenceWithoutLocation.length} item${evidenceWithoutLocation.length === 1 ? '' : 's'} missing GPS location`);\n  }\n\n  const completionPercentage = totalChecks > 0 \n    ? Math.round((completedChecks / totalChecks) * 100) \n    : 100;\n\n  const canAdvance = blockers.filter(b => b.priority === 'critical').length === 0;\n\n  let stormyMessage: string;\n  if (canAdvance && blockers.length === 0 && warnings.length === 0) {\n    stormyMessage = getRandomMessage('ready');\n  } else if (completionPercentage >= 70) {\n    stormyMessage = getRandomMessage('almost');\n  } else if (lowQualityEvidence.length > 0) {\n    stormyMessage = getRandomMessage('qualityIssue');\n  } else {\n    stormyMessage = getRandomMessage('needsWork');\n  }\n\n  return {\n    canAdvance,\n    blockers,\n    warnings,\n    completionPercentage,\n    stormyMessage,\n  };\n}\n\nexport function getStepRequirements(step: WinnMethodologyStep): StepRequirement {\n  return STEP_REQUIREMENTS[step];\n}\n\nexport function canSkipStep(step: WinnMethodologyStep): { canSkip: boolean; reasons: string[] } {\n  const requirements = STEP_REQUIREMENTS[step];\n  return {\n    canSkip: requirements.canSkip,\n    reasons: requirements.skipReasons || [],\n  };\n}\n\nexport function getStepGuidance(step: WinnMethodologyStep): {\n  tips: string[];\n  commonMistakes: string[];\n  bestPractices: string[];\n} {\n  const guidance: Record<WinnMethodologyStep, { tips: string[]; commonMistakes: string[]; bestPractices: string[] }> = {\n    weather_verification: {\n      tips: [\n        'Verify storm events from multiple weather sources',\n        'Document hail size and wind speed reports',\n        'Note the date(s) of reported weather events',\n      ],\n      commonMistakes: [\n        'Using only one weather data source',\n        'Not correlating weather events with damage patterns',\n      ],\n      bestPractices: [\n        'Include NOAA, local weather stations, and radar data',\n        'Create a timeline of weather events and damage discovery',\n      ],\n    },\n    thermal_imaging: {\n      tips: [\n        'Thermal scans work best with at least 10°F temperature differential',\n        'Morning or evening provides better thermal contrast',\n        'Look for moisture intrusion patterns and thermal bridging',\n      ],\n      commonMistakes: [\n        'Scanning during peak sun hours when surfaces are uniformly hot',\n        'Not allowing the camera to calibrate to ambient temperature',\n      ],\n      bestPractices: [\n        'Always capture a corresponding visual photo for each thermal image',\n        'Document the emissivity settings used',\n      ],\n    },\n    terrestrial_walk: {\n      tips: [\n        'Walk the entire perimeter of the property',\n        'Document all four sides of the building',\n        'Note any visible damage from ground level before going to the roof',\n      ],\n      commonMistakes: [\n        'Forgetting to document the property address in photos',\n        'Missing the overall property context',\n      ],\n      bestPractices: [\n        'Include a timestamp and address marker in your first photo',\n        'Capture the property from multiple angles',\n      ],\n    },\n    test_squares: {\n      tips: [\n        'Select representative areas for test square analysis',\n        'Document the square footage and location of each test area',\n        'Count hail hits or damage per square accurately',\n      ],\n      commonMistakes: [\n        'Selecting only damaged areas without control areas',\n        'Inconsistent square sizing',\n      ],\n      bestPractices: [\n        'Use standardized 10x10 foot test squares',\n        'Document multiple test squares across different roof sections',\n      ],\n    },\n    soft_metals: {\n      tips: [\n        'Check vents, flashings, gutters, and downspouts',\n        'Look for dents, dings, and deformation',\n        'Compare damaged vs undamaged soft metal areas',\n      ],\n      commonMistakes: [\n        'Missing soft metal damage on inaccessible areas',\n        'Confusing manufacturing defects with hail damage',\n      ],\n      bestPractices: [\n        'Photograph with proper scale references',\n        'Document all soft metal locations on the property',\n      ],\n    },\n    moisture_testing: {\n      tips: [\n        'Focus on areas identified as anomalies in thermal scanning',\n        'Check around penetrations, seams, and edge details',\n        'Document moisture meter readings with photos',\n      ],\n      commonMistakes: [\n        'Only testing the visible wet spots',\n        'Not calibrating the moisture meter for material type',\n      ],\n      bestPractices: [\n        'Test in a grid pattern for comprehensive coverage',\n        'Record readings numerically, not just presence/absence',\n      ],\n    },\n    core_samples: {\n      tips: [\n        'Extract cores from representative damaged and undamaged areas',\n        'Document core location precisely',\n        'Measure and photograph each layer of the core',\n      ],\n      commonMistakes: [\n        'Not sealing the core extraction site properly',\n        'Extracting cores without property owner permission',\n      ],\n      bestPractices: [\n        'Label cores immediately with location and date',\n        'Preserve cores for potential laboratory analysis',\n      ],\n    },\n    report_assembly: {\n      tips: [\n        'Review all captured evidence before generating',\n        'Ensure consistent naming and organization',\n        'Verify all required sections are complete',\n      ],\n      commonMistakes: [\n        'Generating report before reviewing evidence quality',\n        'Missing key findings in executive summary',\n      ],\n      bestPractices: [\n        'Use the AI assistant to review completeness',\n        'Preview report before final generation',\n      ],\n    },\n  };\n\n  return guidance[step];\n}\n","path":null,"size_bytes":11503,"size_tokens":null},"client/src/lib/scheduling-service.ts":{"content":"import type { ScheduledInspection, Property } from '@shared/schema';\nimport { format, addDays, startOfDay, endOfDay, isSameDay, isAfter, isBefore } from 'date-fns';\n\nexport interface ScheduleSlot {\n  date: Date;\n  time: string;\n  available: boolean;\n  scheduledInspection?: ScheduledInspection;\n}\n\nexport interface DaySchedule {\n  date: Date;\n  slots: ScheduleSlot[];\n  totalScheduled: number;\n  totalHours: number;\n}\n\nexport interface WeekSchedule {\n  startDate: Date;\n  endDate: Date;\n  days: DaySchedule[];\n  totalInspections: number;\n}\n\nexport interface PropertyWithLocation extends Property {\n  latitude?: number;\n  longitude?: number;\n  distance?: number;\n}\n\nexport interface RouteStop {\n  property: PropertyWithLocation;\n  scheduledInspection?: ScheduledInspection;\n  orderIndex: number;\n  arrivalTime?: string;\n  estimatedDuration: number;\n  travelTimeFromPrevious?: number;\n  distanceFromPrevious?: number;\n}\n\nexport interface OptimizedRoute {\n  stops: RouteStop[];\n  totalDistance: number;\n  totalTravelTime: number;\n  totalInspectionTime: number;\n  estimatedEndTime: string;\n}\n\nconst TIME_SLOTS = [\n  '08:00', '08:30', '09:00', '09:30', '10:00', '10:30',\n  '11:00', '11:30', '12:00', '12:30', '13:00', '13:30',\n  '14:00', '14:30', '15:00', '15:30', '16:00', '16:30',\n  '17:00', '17:30'\n];\n\nclass SchedulingService {\n  private baseUrl: string = '';\n\n  constructor() {\n    this.baseUrl = typeof window !== 'undefined' ? window.location.origin : '';\n  }\n\n  async getScheduledInspections(\n    startDate: Date,\n    endDate: Date,\n    inspectorId?: number\n  ): Promise<ScheduledInspection[]> {\n    const params = new URLSearchParams({\n      startDate: startDate.toISOString(),\n      endDate: endDate.toISOString(),\n    });\n    if (inspectorId) params.append('inspectorId', inspectorId.toString());\n\n    const response = await fetch(`${this.baseUrl}/api/schedule?${params}`, {\n      credentials: 'include',\n    });\n\n    if (!response.ok) throw new Error('Failed to fetch schedule');\n    return response.json();\n  }\n\n  async scheduleInspection(data: {\n    propertyId: number;\n    scheduledDate: Date;\n    scheduledTime?: string;\n    estimatedDuration?: number;\n    priority?: string;\n    notes?: string;\n    accessInstructions?: string;\n    contactName?: string;\n    contactPhone?: string;\n  }): Promise<ScheduledInspection> {\n    const response = await fetch(`${this.baseUrl}/api/schedule`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      credentials: 'include',\n      body: JSON.stringify(data),\n    });\n\n    if (!response.ok) throw new Error('Failed to schedule inspection');\n    return response.json();\n  }\n\n  async updateScheduledInspection(\n    id: number,\n    updates: Partial<ScheduledInspection>\n  ): Promise<ScheduledInspection> {\n    const response = await fetch(`${this.baseUrl}/api/schedule/${id}`, {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      credentials: 'include',\n      body: JSON.stringify(updates),\n    });\n\n    if (!response.ok) throw new Error('Failed to update scheduled inspection');\n    return response.json();\n  }\n\n  async cancelScheduledInspection(id: number, reason: string): Promise<void> {\n    const response = await fetch(`${this.baseUrl}/api/schedule/${id}/cancel`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      credentials: 'include',\n      body: JSON.stringify({ reason }),\n    });\n\n    if (!response.ok) throw new Error('Failed to cancel scheduled inspection');\n  }\n\n  generateWeekSchedule(\n    startDate: Date,\n    scheduledInspections: ScheduledInspection[]\n  ): WeekSchedule {\n    const days: DaySchedule[] = [];\n    let totalInspections = 0;\n\n    for (let i = 0; i < 7; i++) {\n      const date = addDays(startDate, i);\n      const dayInspections = scheduledInspections.filter(si =>\n        isSameDay(new Date(si.scheduledDate), date)\n      );\n\n      const slots: ScheduleSlot[] = TIME_SLOTS.map(time => {\n        const matchingInspection = dayInspections.find(si => si.scheduledTime === time);\n        return {\n          date,\n          time,\n          available: !matchingInspection,\n          scheduledInspection: matchingInspection,\n        };\n      });\n\n      const totalHours = dayInspections.reduce(\n        (sum, si) => sum + (si.estimatedDuration || 60) / 60,\n        0\n      );\n\n      days.push({\n        date,\n        slots,\n        totalScheduled: dayInspections.length,\n        totalHours,\n      });\n\n      totalInspections += dayInspections.length;\n    }\n\n    return {\n      startDate,\n      endDate: addDays(startDate, 6),\n      days,\n      totalInspections,\n    };\n  }\n\n  generateDaySchedule(\n    date: Date,\n    scheduledInspections: ScheduledInspection[]\n  ): DaySchedule {\n    const dayInspections = scheduledInspections.filter(si =>\n      isSameDay(new Date(si.scheduledDate), date)\n    );\n\n    const slots: ScheduleSlot[] = TIME_SLOTS.map(time => {\n      const matchingInspection = dayInspections.find(si => si.scheduledTime === time);\n      return {\n        date,\n        time,\n        available: !matchingInspection,\n        scheduledInspection: matchingInspection,\n      };\n    });\n\n    const totalHours = dayInspections.reduce(\n      (sum, si) => sum + (si.estimatedDuration || 60) / 60,\n      0\n    );\n\n    return {\n      date,\n      slots,\n      totalScheduled: dayInspections.length,\n      totalHours,\n    };\n  }\n\n  calculateDistance(\n    lat1: number,\n    lon1: number,\n    lat2: number,\n    lon2: number\n  ): number {\n    const R = 3959;\n    const dLat = this.toRad(lat2 - lat1);\n    const dLon = this.toRad(lon2 - lon1);\n    const a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(this.toRad(lat1)) *\n        Math.cos(this.toRad(lat2)) *\n        Math.sin(dLon / 2) *\n        Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  }\n\n  private toRad(deg: number): number {\n    return deg * (Math.PI / 180);\n  }\n\n  optimizeRoute(\n    properties: PropertyWithLocation[],\n    startLat?: number,\n    startLon?: number\n  ): OptimizedRoute {\n    if (properties.length === 0) {\n      return {\n        stops: [],\n        totalDistance: 0,\n        totalTravelTime: 0,\n        totalInspectionTime: 0,\n        estimatedEndTime: '',\n      };\n    }\n\n    const validProperties = properties.filter(p => p.latitude && p.longitude);\n    if (validProperties.length === 0) {\n      const stops = properties.map((p, i) => ({\n        property: p,\n        orderIndex: i,\n        estimatedDuration: 60,\n      }));\n      return {\n        stops,\n        totalDistance: 0,\n        totalTravelTime: 0,\n        totalInspectionTime: properties.length * 60,\n        estimatedEndTime: '',\n      };\n    }\n\n    const ordered = this.nearestNeighborRoute(validProperties, startLat, startLon);\n    \n    let totalDistance = 0;\n    let totalTravelTime = 0;\n    const avgSpeed = 30;\n\n    const stops: RouteStop[] = ordered.map((property, index) => {\n      let distanceFromPrevious = 0;\n      let travelTimeFromPrevious = 0;\n\n      if (index === 0 && startLat && startLon && property.latitude && property.longitude) {\n        distanceFromPrevious = this.calculateDistance(\n          startLat, startLon, property.latitude, property.longitude\n        );\n      } else if (index > 0) {\n        const prev = ordered[index - 1];\n        if (prev.latitude && prev.longitude && property.latitude && property.longitude) {\n          distanceFromPrevious = this.calculateDistance(\n            prev.latitude, prev.longitude, property.latitude, property.longitude\n          );\n        }\n      }\n\n      travelTimeFromPrevious = (distanceFromPrevious / avgSpeed) * 60;\n      totalDistance += distanceFromPrevious;\n      totalTravelTime += travelTimeFromPrevious;\n\n      return {\n        property,\n        orderIndex: index,\n        estimatedDuration: 60,\n        distanceFromPrevious: Math.round(distanceFromPrevious * 10) / 10,\n        travelTimeFromPrevious: Math.round(travelTimeFromPrevious),\n      };\n    });\n\n    const totalInspectionTime = stops.length * 60;\n\n    return {\n      stops,\n      totalDistance: Math.round(totalDistance * 10) / 10,\n      totalTravelTime: Math.round(totalTravelTime),\n      totalInspectionTime,\n      estimatedEndTime: '',\n    };\n  }\n\n  private nearestNeighborRoute(\n    properties: PropertyWithLocation[],\n    startLat?: number,\n    startLon?: number\n  ): PropertyWithLocation[] {\n    if (properties.length <= 1) return [...properties];\n\n    const remaining = [...properties];\n    const route: PropertyWithLocation[] = [];\n    \n    let currentLat = startLat ?? 0;\n    let currentLon = startLon ?? 0;\n\n    if (!startLat || !startLon) {\n      const first = remaining.shift()!;\n      route.push(first);\n      currentLat = first.latitude || 0;\n      currentLon = first.longitude || 0;\n    }\n\n    while (remaining.length > 0) {\n      let nearestIndex = 0;\n      let nearestDistance = Infinity;\n\n      for (let i = 0; i < remaining.length; i++) {\n        const p = remaining[i];\n        if (p.latitude && p.longitude) {\n          const distance = this.calculateDistance(\n            currentLat, currentLon, p.latitude, p.longitude\n          );\n          if (distance < nearestDistance) {\n            nearestDistance = distance;\n            nearestIndex = i;\n          }\n        }\n      }\n\n      const next = remaining.splice(nearestIndex, 1)[0];\n      route.push(next);\n      currentLat = next.latitude || currentLat;\n      currentLon = next.longitude || currentLon;\n    }\n\n    return route;\n  }\n\n  getAvailableTimeSlots(): string[] {\n    return [...TIME_SLOTS];\n  }\n\n  formatDuration(minutes: number): string {\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    if (hours === 0) return `${mins}m`;\n    if (mins === 0) return `${hours}h`;\n    return `${hours}h ${mins}m`;\n  }\n\n  getPriorityColor(priority: string): string {\n    switch (priority) {\n      case 'urgent': return 'bg-red-500/20 text-red-500 border-red-500/50';\n      case 'high': return 'bg-orange-500/20 text-orange-500 border-orange-500/50';\n      case 'normal': return 'bg-blue-500/20 text-blue-500 border-blue-500/50';\n      case 'low': return 'bg-white/10 text-white/60 border-white/30';\n      default: return 'bg-white/10 text-white/60 border-white/30';\n    }\n  }\n\n  getStatusColor(status: string): string {\n    switch (status) {\n      case 'completed': return 'bg-green-500/20 text-green-500 border-green-500/50';\n      case 'in_progress': return 'bg-blue-500/20 text-blue-500 border-blue-500/50';\n      case 'scheduled': return 'bg-yellow-500/20 text-yellow-500 border-yellow-500/50';\n      case 'cancelled': return 'bg-red-500/20 text-red-500 border-red-500/50';\n      default: return 'bg-white/10 text-white/60 border-white/30';\n    }\n  }\n}\n\nexport const schedulingService = new SchedulingService();\n","path":null,"size_bytes":10826,"size_tokens":null},"client/src/pages/schedule.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { Helmet } from 'react-helmet-async';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useToast } from '@/hooks/use-toast';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { InspectionCalendar } from '@/components/inspection-calendar';\nimport { PropertyMap, PropertyListItem } from '@/components/property-map';\nimport { schedulingService } from '@/lib/scheduling-service';\nimport { \n  Calendar, \n  MapPin, \n  Plus, \n  Route, \n  Clock, \n  AlertTriangle,\n  ChevronRight,\n  Navigation,\n  RefreshCw\n} from 'lucide-react';\nimport { format, addDays, startOfWeek, endOfWeek } from 'date-fns';\nimport type { Property, ScheduledInspection } from '@shared/schema';\n\ninterface ScheduleWithProperty extends ScheduledInspection {\n  property?: Property;\n}\n\ninterface PropertyWithSchedule extends Property {\n  scheduledInspection?: ScheduledInspection;\n  latitude?: number;\n  longitude?: number;\n}\n\nexport default function SchedulePage() {\n  const { toast } = useToast();\n  const [selectedDate, setSelectedDate] = useState<Date>(new Date());\n  const [selectedProperty, setSelectedProperty] = useState<PropertyWithSchedule | null>(null);\n  const [showAddDialog, setShowAddDialog] = useState(false);\n  const [addDialogDate, setAddDialogDate] = useState<Date>(new Date());\n  const [showRouteOptimization, setShowRouteOptimization] = useState(false);\n  const [viewMode, setViewMode] = useState<'calendar' | 'map'>('calendar');\n\n  const weekStart = startOfWeek(selectedDate, { weekStartsOn: 0 });\n  const weekEnd = endOfWeek(selectedDate, { weekStartsOn: 0 });\n\n  const { data: scheduleData, isLoading: scheduleLoading } = useQuery<ScheduledInspection[]>({\n    queryKey: ['/api/schedule', weekStart.toISOString(), weekEnd.toISOString()],\n  });\n\n  const { data: propertiesData, isLoading: propertiesLoading } = useQuery<Property[]>({\n    queryKey: ['/api/properties'],\n  });\n\n  const createScheduleMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return apiRequest('/api/schedule', {\n        method: 'POST',\n        body: JSON.stringify(data),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/schedule'] });\n      setShowAddDialog(false);\n      toast({\n        title: 'Inspection Scheduled',\n        description: 'The inspection has been added to your schedule.',\n      });\n    },\n    onError: () => {\n      toast({\n        title: 'Error',\n        description: 'Failed to schedule inspection. Please try again.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const inspectionsWithProperties: ScheduleWithProperty[] = (scheduleData || []).map(schedule => ({\n    ...schedule,\n    property: propertiesData?.find(p => p.id === schedule.propertyId),\n  }));\n\n  const propertiesWithSchedules: PropertyWithSchedule[] = (propertiesData || []).map(property => {\n    const schedule = scheduleData?.find(s => s.propertyId === property.id);\n    return {\n      ...property,\n      scheduledInspection: schedule,\n    };\n  });\n\n  const todaysInspections = inspectionsWithProperties.filter(i => {\n    const scheduleDate = new Date(i.scheduledDate);\n    const today = new Date();\n    return scheduleDate.toDateString() === today.toDateString();\n  });\n\n  const optimizedRoute = showRouteOptimization\n    ? schedulingService.optimizeRoute(propertiesWithSchedules.filter(p => p.scheduledInspection))\n    : null;\n\n  const handleAddInspection = (date: Date) => {\n    setAddDialogDate(date);\n    setShowAddDialog(true);\n  };\n\n  const handleInspectionClick = (inspection: ScheduleWithProperty) => {\n    const property = propertiesWithSchedules.find(p => p.id === inspection.propertyId);\n    if (property) {\n      setSelectedProperty(property);\n    }\n  };\n\n  return (\n    <>\n      <Helmet>\n        <title>Schedule - WinnStorm™</title>\n        <meta name=\"description\" content=\"Manage your inspection schedule with multi-property scheduling and route optimization.\" />\n      </Helmet>\n\n      <div className=\"min-h-screen bg-[#121212] pb-safe\">\n        <div className=\"max-w-7xl mx-auto px-4 py-6\">\n          <div className=\"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 mb-6\">\n            <div>\n              <h1 className=\"text-2xl lg:text-3xl font-montserrat font-bold text-white uppercase tracking-wide\">\n                Inspection Schedule\n              </h1>\n              <p className=\"text-white/60 mt-1\">\n                Manage your inspections and optimize routes for field work\n              </p>\n            </div>\n            \n            <div className=\"flex items-center gap-3 w-full lg:w-auto\">\n              <div className=\"flex bg-white/5 p-1\">\n                <Button\n                  variant={viewMode === 'calendar' ? 'default' : 'ghost'}\n                  size=\"sm\"\n                  onClick={() => setViewMode('calendar')}\n                  className={viewMode === 'calendar' \n                    ? 'bg-[hsl(16,100%,50%)] text-white' \n                    : 'text-white/60 hover:text-white'}\n                  data-testid=\"view-calendar\"\n                >\n                  <Calendar className=\"w-4 h-4 mr-2\" />\n                  Calendar\n                </Button>\n                <Button\n                  variant={viewMode === 'map' ? 'default' : 'ghost'}\n                  size=\"sm\"\n                  onClick={() => setViewMode('map')}\n                  className={viewMode === 'map' \n                    ? 'bg-[hsl(16,100%,50%)] text-white' \n                    : 'text-white/60 hover:text-white'}\n                  data-testid=\"view-map\"\n                >\n                  <MapPin className=\"w-4 h-4 mr-2\" />\n                  Map\n                </Button>\n              </div>\n              \n              <Button\n                onClick={() => setShowAddDialog(true)}\n                className=\"bg-[hsl(16,100%,50%)] hover:bg-[hsl(16,100%,45%)] text-white\"\n                data-testid=\"add-inspection-btn\"\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Schedule\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            <div className=\"lg:col-span-2\">\n              {viewMode === 'calendar' ? (\n                <InspectionCalendar\n                  inspections={inspectionsWithProperties}\n                  isLoading={scheduleLoading}\n                  selectedDate={selectedDate}\n                  onDateSelect={setSelectedDate}\n                  onInspectionClick={handleInspectionClick}\n                  onAddInspection={handleAddInspection}\n                />\n              ) : (\n                <PropertyMap\n                  properties={propertiesWithSchedules.filter(p => p.scheduledInspection)}\n                  selectedPropertyId={selectedProperty?.id}\n                  onPropertySelect={setSelectedProperty}\n                  showRoute={showRouteOptimization}\n                />\n              )}\n\n              {viewMode === 'map' && (\n                <Card className=\"mt-4 bg-[#1A1A1A] border-white/10\">\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"flex items-center gap-2 text-lg font-montserrat text-white\">\n                        <Route className=\"w-5 h-5 text-[hsl(16,100%,50%)]\" />\n                        Route Optimization\n                      </CardTitle>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => setShowRouteOptimization(!showRouteOptimization)}\n                        className=\"border-white/20 text-white/60 hover:bg-white/10\"\n                        data-testid=\"toggle-route\"\n                      >\n                        {showRouteOptimization ? 'Hide Route' : 'Show Route'}\n                      </Button>\n                    </div>\n                  </CardHeader>\n                  {showRouteOptimization && optimizedRoute && (\n                    <CardContent>\n                      <div className=\"grid grid-cols-3 gap-4 text-center\">\n                        <div className=\"p-3 bg-white/5\">\n                          <div className=\"text-2xl font-bold text-white\">{optimizedRoute.stops.length}</div>\n                          <div className=\"text-xs text-white/60\">Stops</div>\n                        </div>\n                        <div className=\"p-3 bg-white/5\">\n                          <div className=\"text-2xl font-bold text-white\">{optimizedRoute.totalDistance.toFixed(1)}</div>\n                          <div className=\"text-xs text-white/60\">Miles</div>\n                        </div>\n                        <div className=\"p-3 bg-white/5\">\n                          <div className=\"text-2xl font-bold text-white\">{schedulingService.formatDuration(optimizedRoute.totalTravelTime)}</div>\n                          <div className=\"text-xs text-white/60\">Travel Time</div>\n                        </div>\n                      </div>\n                    </CardContent>\n                  )}\n                </Card>\n              )}\n            </div>\n\n            <div className=\"space-y-4\">\n              <Card className=\"bg-[#1A1A1A] border-white/10\">\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"flex items-center gap-2 text-lg font-montserrat text-white\">\n                    <Clock className=\"w-5 h-5 text-[hsl(16,100%,50%)]\" />\n                    Today's Inspections\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {todaysInspections.length > 0 ? (\n                    <ScrollArea className=\"h-[300px]\">\n                      <div className=\"space-y-2\">\n                        {todaysInspections.map((inspection) => (\n                          <button\n                            key={inspection.id}\n                            onClick={() => handleInspectionClick(inspection)}\n                            className=\"w-full text-left p-3 bg-white/5 hover:bg-white/10 border border-white/10 transition-colors\"\n                            data-testid={`today-inspection-${inspection.id}`}\n                          >\n                            <div className=\"flex items-start justify-between\">\n                              <div>\n                                <h4 className=\"font-medium text-white\">\n                                  {inspection.property?.name || `Property #${inspection.propertyId}`}\n                                </h4>\n                                <p className=\"text-sm text-white/60 mt-1\">{inspection.scheduledTime || 'TBD'}</p>\n                              </div>\n                              <ChevronRight className=\"w-5 h-5 text-white/40\" />\n                            </div>\n                          </button>\n                        ))}\n                      </div>\n                    </ScrollArea>\n                  ) : (\n                    <div className=\"text-center py-8 text-white/40\">\n                      <Calendar className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n                      <p>No inspections scheduled for today</p>\n                      <Button\n                        variant=\"link\"\n                        onClick={() => handleAddInspection(new Date())}\n                        className=\"mt-2 text-[hsl(16,100%,50%)]\"\n                        data-testid=\"add-today-inspection\"\n                      >\n                        Schedule one now\n                      </Button>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-[#1A1A1A] border-white/10\">\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"flex items-center gap-2 text-lg font-montserrat text-white\">\n                    <MapPin className=\"w-5 h-5 text-[hsl(16,100%,50%)]\" />\n                    Properties\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ScrollArea className=\"h-[250px]\">\n                    <div className=\"space-y-2\">\n                      {propertiesWithSchedules.map((property, index) => (\n                        <PropertyListItem\n                          key={property.id}\n                          property={property}\n                          index={showRouteOptimization ? index : undefined}\n                          isSelected={selectedProperty?.id === property.id}\n                          onClick={() => setSelectedProperty(property)}\n                        />\n                      ))}\n                      {propertiesWithSchedules.length === 0 && (\n                        <div className=\"text-center py-4 text-white/40\">\n                          No properties found\n                        </div>\n                      )}\n                    </div>\n                  </ScrollArea>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n        <DialogContent className=\"bg-[#1A1A1A] border-white/10 text-white\">\n          <DialogHeader>\n            <DialogTitle className=\"font-montserrat\">Schedule Inspection</DialogTitle>\n          </DialogHeader>\n          <ScheduleForm\n            date={addDialogDate}\n            properties={propertiesData || []}\n            onSubmit={(data) => createScheduleMutation.mutate(data)}\n            isLoading={createScheduleMutation.isPending}\n          />\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n\ninterface ScheduleFormProps {\n  date: Date;\n  properties: Property[];\n  onSubmit: (data: any) => void;\n  isLoading: boolean;\n}\n\nfunction ScheduleForm({ date, properties, onSubmit, isLoading }: ScheduleFormProps) {\n  const [formData, setFormData] = useState({\n    propertyId: '',\n    scheduledDate: format(date, 'yyyy-MM-dd'),\n    scheduledTime: '09:00',\n    estimatedDuration: '60',\n    priority: 'normal',\n    notes: '',\n    accessInstructions: '',\n    contactName: '',\n    contactPhone: '',\n  });\n\n  const timeSlots = schedulingService.getAvailableTimeSlots();\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSubmit({\n      propertyId: parseInt(formData.propertyId),\n      scheduledDate: new Date(formData.scheduledDate),\n      scheduledTime: formData.scheduledTime,\n      estimatedDuration: parseInt(formData.estimatedDuration),\n      priority: formData.priority,\n      notes: formData.notes || undefined,\n      accessInstructions: formData.accessInstructions || undefined,\n      contactName: formData.contactName || undefined,\n      contactPhone: formData.contactPhone || undefined,\n    });\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label>Property</Label>\n        <Select\n          value={formData.propertyId}\n          onValueChange={(value) => setFormData({ ...formData, propertyId: value })}\n        >\n          <SelectTrigger className=\"bg-white/5 border-white/10\" data-testid=\"select-property\">\n            <SelectValue placeholder=\"Select a property\" />\n          </SelectTrigger>\n          <SelectContent>\n            {properties.map((property) => (\n              <SelectItem key={property.id} value={property.id.toString()}>\n                {property.name}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label>Date</Label>\n          <Input\n            type=\"date\"\n            value={formData.scheduledDate}\n            onChange={(e) => setFormData({ ...formData, scheduledDate: e.target.value })}\n            className=\"bg-white/5 border-white/10\"\n            data-testid=\"input-date\"\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Time</Label>\n          <Select\n            value={formData.scheduledTime}\n            onValueChange={(value) => setFormData({ ...formData, scheduledTime: value })}\n          >\n            <SelectTrigger className=\"bg-white/5 border-white/10\" data-testid=\"select-time\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {timeSlots.map((time) => (\n                <SelectItem key={time} value={time}>\n                  {time}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label>Duration (minutes)</Label>\n          <Select\n            value={formData.estimatedDuration}\n            onValueChange={(value) => setFormData({ ...formData, estimatedDuration: value })}\n          >\n            <SelectTrigger className=\"bg-white/5 border-white/10\" data-testid=\"select-duration\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"30\">30 min</SelectItem>\n              <SelectItem value=\"60\">1 hour</SelectItem>\n              <SelectItem value=\"90\">1.5 hours</SelectItem>\n              <SelectItem value=\"120\">2 hours</SelectItem>\n              <SelectItem value=\"180\">3 hours</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Priority</Label>\n          <Select\n            value={formData.priority}\n            onValueChange={(value) => setFormData({ ...formData, priority: value })}\n          >\n            <SelectTrigger className=\"bg-white/5 border-white/10\" data-testid=\"select-priority\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"low\">Low</SelectItem>\n              <SelectItem value=\"normal\">Normal</SelectItem>\n              <SelectItem value=\"high\">High</SelectItem>\n              <SelectItem value=\"urgent\">Urgent</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label>Notes (optional)</Label>\n        <Textarea\n          value={formData.notes}\n          onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n          className=\"bg-white/5 border-white/10\"\n          placeholder=\"Any additional notes...\"\n          data-testid=\"input-notes\"\n        />\n      </div>\n\n      <Button\n        type=\"submit\"\n        disabled={!formData.propertyId || isLoading}\n        className=\"w-full bg-[hsl(16,100%,50%)] hover:bg-[hsl(16,100%,45%)] text-white\"\n        data-testid=\"submit-schedule\"\n      >\n        {isLoading ? 'Scheduling...' : 'Schedule Inspection'}\n      </Button>\n    </form>\n  );\n}\n","path":null,"size_bytes":19413,"size_tokens":null},"server/limitless-client.ts":{"content":"interface LifelogEntry {\n  id: string;\n  title: string;\n  startTime: string;\n  endTime: string;\n  duration: number;\n  markdown?: string;\n  transcript?: string;\n  actionItems?: string[];\n  summary?: string;\n}\n\ninterface LifelogsResponse {\n  lifelogs: LifelogEntry[];\n  total: number;\n}\n\ninterface LimitlessConfig {\n  apiKey: string;\n  baseUrl?: string;\n}\n\nexport class LimitlessClient {\n  private apiKey: string;\n  private baseUrl: string;\n\n  constructor(config: LimitlessConfig) {\n    this.apiKey = config.apiKey;\n    this.baseUrl = config.baseUrl || 'https://api.limitless.ai';\n  }\n\n  private async request<T>(endpoint: string, params?: Record<string, string>): Promise<T> {\n    const url = new URL(`${this.baseUrl}${endpoint}`);\n    if (params) {\n      Object.entries(params).forEach(([key, value]) => {\n        url.searchParams.append(key, value);\n      });\n    }\n\n    const response = await fetch(url.toString(), {\n      method: 'GET',\n      headers: {\n        'X-API-Key': this.apiKey,\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`Limitless API error: ${response.status} ${response.statusText}`);\n    }\n\n    return response.json();\n  }\n\n  async getLifelogs(options?: {\n    limit?: number;\n    date?: string;\n    dateFrom?: string;\n    dateTo?: string;\n    timezone?: string;\n  }): Promise<LifelogsResponse> {\n    const params: Record<string, string> = {};\n    \n    if (options?.limit) params.limit = options.limit.toString();\n    if (options?.date) params.date = options.date;\n    if (options?.dateFrom) params.date_from = options.dateFrom;\n    if (options?.dateTo) params.date_to = options.dateTo;\n    if (options?.timezone) params.timezone = options.timezone;\n\n    return this.request<LifelogsResponse>('/v1/lifelogs', params);\n  }\n\n  async getLifelogById(id: string): Promise<LifelogEntry> {\n    return this.request<LifelogEntry>(`/v1/lifelogs/${id}`);\n  }\n\n  async downloadAudio(startMs: number, endMs: number): Promise<ArrayBuffer> {\n    const maxDuration = 7200000; // 2 hours max\n    if (endMs - startMs > maxDuration) {\n      throw new Error('Audio download limited to 2 hours max');\n    }\n\n    const url = new URL(`${this.baseUrl}/v1/download-audio`);\n    url.searchParams.append('startMs', startMs.toString());\n    url.searchParams.append('endMs', endMs.toString());\n\n    const response = await fetch(url.toString(), {\n      method: 'GET',\n      headers: {\n        'X-API-Key': this.apiKey,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`Limitless API error: ${response.status} ${response.statusText}`);\n    }\n\n    return response.arrayBuffer();\n  }\n\n  async getChats(options?: {\n    limit?: number;\n    direction?: 'asc' | 'desc';\n  }): Promise<{ chats: any[] }> {\n    const params: Record<string, string> = {};\n    \n    if (options?.limit) params.limit = options.limit.toString();\n    if (options?.direction) params.direction = options.direction;\n\n    return this.request<{ chats: any[] }>('/v1/chats', params);\n  }\n\n  async testConnection(): Promise<boolean> {\n    try {\n      await this.getLifelogs({ limit: 1 });\n      return true;\n    } catch (error) {\n      return false;\n    }\n  }\n}\n\nlet limitlessClient: LimitlessClient | null = null;\n\nexport function getLimitlessClient(): LimitlessClient | null {\n  if (limitlessClient) return limitlessClient;\n  \n  const apiKey = process.env.LIMITLESS_API_KEY;\n  if (!apiKey) return null;\n  \n  limitlessClient = new LimitlessClient({ apiKey });\n  return limitlessClient;\n}\n\nexport function formatLifelogAsTranscript(lifelog: LifelogEntry): string {\n  let transcript = '';\n  \n  if (lifelog.markdown) {\n    transcript = lifelog.markdown;\n  } else if (lifelog.transcript) {\n    transcript = lifelog.transcript;\n  }\n  \n  return transcript;\n}\n\nexport function extractDuration(lifelog: LifelogEntry): number {\n  if (lifelog.duration) return lifelog.duration;\n  \n  const start = new Date(lifelog.startTime).getTime();\n  const end = new Date(lifelog.endTime).getTime();\n  return Math.round((end - start) / 1000);\n}\n","path":null,"size_bytes":4049,"size_tokens":null},"client/src/components/property-map.tsx":{"content":"import { useEffect, useRef, useState } from 'react';\nimport { Loader } from '@googlemaps/js-api-loader';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { MapPin, Navigation, Clock, AlertTriangle, CheckCircle2, Calendar } from 'lucide-react';\nimport type { Property, ScheduledInspection } from '@shared/schema';\n\ninterface PropertyWithSchedule extends Property {\n  scheduledInspection?: ScheduledInspection;\n  latitude?: number;\n  longitude?: number;\n}\n\ninterface PropertyMapProps {\n  properties: PropertyWithSchedule[];\n  selectedPropertyId?: number;\n  onPropertySelect?: (property: PropertyWithSchedule) => void;\n  showRoute?: boolean;\n  centerLat?: number;\n  centerLng?: number;\n  zoom?: number;\n}\n\nexport function PropertyMap({\n  properties,\n  selectedPropertyId,\n  onPropertySelect,\n  showRoute = false,\n  centerLat = 39.8283,\n  centerLng = -98.5795,\n  zoom = 4,\n}: PropertyMapProps) {\n  const mapRef = useRef<HTMLDivElement>(null);\n  const mapInstanceRef = useRef<any>(null);\n  const markersRef = useRef<any[]>([]);\n  const directionsRendererRef = useRef<any>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [mapError, setMapError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const initMap = async () => {\n      if (!mapRef.current) return;\n      \n      const apiKey = import.meta.env.VITE_GOOGLE_MAPS_API_KEY;\n      if (!apiKey) {\n        setMapError('Google Maps API key not configured');\n        setIsLoading(false);\n        return;\n      }\n\n      try {\n        const loader = new Loader({\n          apiKey,\n          version: 'weekly',\n          libraries: ['places', 'geometry'],\n        });\n\n        await loader.load();\n\n        const map = new google.maps.Map(mapRef.current, {\n          center: { lat: centerLat, lng: centerLng },\n          zoom,\n          mapTypeId: 'roadmap',\n          styles: [\n            { elementType: 'geometry', stylers: [{ color: '#242f3e' }] },\n            { elementType: 'labels.text.stroke', stylers: [{ color: '#242f3e' }] },\n            { elementType: 'labels.text.fill', stylers: [{ color: '#746855' }] },\n            { featureType: 'road', elementType: 'geometry', stylers: [{ color: '#38414e' }] },\n            { featureType: 'road', elementType: 'geometry.stroke', stylers: [{ color: '#212a37' }] },\n            { featureType: 'road.highway', elementType: 'geometry', stylers: [{ color: '#746855' }] },\n            { featureType: 'water', elementType: 'geometry', stylers: [{ color: '#17263c' }] },\n          ],\n        });\n\n        mapInstanceRef.current = map;\n        \n        const directionsRenderer = new google.maps.DirectionsRenderer({\n          map,\n          suppressMarkers: true,\n          polylineOptions: {\n            strokeColor: '#FF6B00',\n            strokeWeight: 4,\n            strokeOpacity: 0.8,\n          },\n        });\n        directionsRendererRef.current = directionsRenderer;\n\n        setIsLoading(false);\n      } catch (error) {\n        console.error('Error loading Google Maps:', error);\n        setMapError('Failed to load map');\n        setIsLoading(false);\n      }\n    };\n\n    initMap();\n  }, [centerLat, centerLng, zoom]);\n\n  useEffect(() => {\n    if (!mapInstanceRef.current) return;\n\n    markersRef.current.forEach(marker => marker.setMap(null));\n    markersRef.current = [];\n\n    const bounds = new google.maps.LatLngBounds();\n    let hasValidCoordinates = false;\n\n    properties.forEach((property, index) => {\n      if (!property.latitude || !property.longitude) return;\n\n      hasValidCoordinates = true;\n      const position = { lat: property.latitude, lng: property.longitude };\n      bounds.extend(position);\n\n      const isSelected = property.id === selectedPropertyId;\n      const hasSchedule = !!property.scheduledInspection;\n      const status = property.scheduledInspection?.status;\n\n      let iconColor = '#FF6B00';\n      if (status === 'completed') iconColor = '#22C55E';\n      else if (status === 'in_progress') iconColor = '#3B82F6';\n      else if (status === 'cancelled') iconColor = '#EF4444';\n\n      const marker = new google.maps.Marker({\n        position,\n        map: mapInstanceRef.current!,\n        title: property.name,\n        icon: {\n          path: google.maps.SymbolPath.CIRCLE,\n          fillColor: iconColor,\n          fillOpacity: isSelected ? 1 : 0.8,\n          strokeColor: isSelected ? '#FFFFFF' : iconColor,\n          strokeWeight: isSelected ? 3 : 1,\n          scale: isSelected ? 12 : 10,\n        },\n        label: showRoute ? {\n          text: (index + 1).toString(),\n          color: '#FFFFFF',\n          fontSize: '11px',\n          fontWeight: 'bold',\n        } : undefined,\n        zIndex: isSelected ? 1000 : index,\n      });\n\n      const infoContent = `\n        <div style=\"color: #1A1A1A; padding: 8px; min-width: 200px;\">\n          <h3 style=\"margin: 0 0 4px 0; font-weight: bold;\">${property.name}</h3>\n          <p style=\"margin: 0 0 8px 0; font-size: 12px; color: #666;\">${property.address}</p>\n          ${hasSchedule ? `\n            <div style=\"display: flex; align-items: center; gap: 4px; font-size: 12px;\">\n              <span style=\"width: 8px; height: 8px; border-radius: 50%; background: ${iconColor};\"></span>\n              <span>${status}</span>\n            </div>\n          ` : ''}\n        </div>\n      `;\n\n      const infoWindow = new google.maps.InfoWindow({ content: infoContent });\n\n      marker.addListener('click', () => {\n        if (onPropertySelect) {\n          onPropertySelect(property);\n        }\n        infoWindow.open(mapInstanceRef.current!, marker);\n      });\n\n      markersRef.current.push(marker);\n    });\n\n    if (hasValidCoordinates && properties.length > 1) {\n      mapInstanceRef.current.fitBounds(bounds, { padding: 50 });\n    } else if (hasValidCoordinates && properties.length === 1) {\n      const prop = properties.find(p => p.latitude && p.longitude);\n      if (prop) {\n        mapInstanceRef.current.setCenter({ lat: prop.latitude!, lng: prop.longitude! });\n        mapInstanceRef.current.setZoom(15);\n      }\n    }\n  }, [properties, selectedPropertyId, onPropertySelect, showRoute]);\n\n  useEffect(() => {\n    if (!showRoute || !mapInstanceRef.current || !directionsRendererRef.current) return;\n\n    const propertiesWithCoords = properties.filter(p => p.latitude && p.longitude);\n    if (propertiesWithCoords.length < 2) {\n      directionsRendererRef.current.setDirections({ routes: [] } as any);\n      return;\n    }\n\n    const directionsService = new google.maps.DirectionsService();\n    const origin = { lat: propertiesWithCoords[0].latitude!, lng: propertiesWithCoords[0].longitude! };\n    const destination = { \n      lat: propertiesWithCoords[propertiesWithCoords.length - 1].latitude!, \n      lng: propertiesWithCoords[propertiesWithCoords.length - 1].longitude! \n    };\n\n    const waypoints = propertiesWithCoords.slice(1, -1).map(p => ({\n      location: { lat: p.latitude!, lng: p.longitude! },\n      stopover: true,\n    }));\n\n    directionsService.route(\n      {\n        origin,\n        destination,\n        waypoints,\n        travelMode: google.maps.TravelMode.DRIVING,\n        optimizeWaypoints: false,\n      },\n      (result, status) => {\n        if (status === 'OK' && result) {\n          directionsRendererRef.current?.setDirections(result);\n        }\n      }\n    );\n  }, [properties, showRoute]);\n\n  if (mapError) {\n    return (\n      <Card className=\"bg-[#1A1A1A] border-white/10\">\n        <CardContent className=\"flex items-center justify-center h-64\">\n          <div className=\"text-center text-white/60\">\n            <AlertTriangle className=\"w-8 h-8 mx-auto mb-2 text-yellow-500\" />\n            <p>{mapError}</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"bg-[#1A1A1A] border-white/10 overflow-hidden\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"flex items-center gap-2 text-lg font-montserrat text-white\">\n          <MapPin className=\"w-5 h-5 text-[hsl(16,100%,50%)]\" />\n          Property Locations\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        <div className=\"relative\">\n          {isLoading && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-[#1A1A1A] z-10\">\n              <div className=\"animate-spin w-8 h-8 border-2 border-[hsl(16,100%,50%)] border-t-transparent rounded-full\" />\n            </div>\n          )}\n          <div \n            ref={mapRef} \n            className=\"w-full h-[400px]\"\n            data-testid=\"property-map\"\n          />\n        </div>\n        \n        {showRoute && properties.length > 1 && (\n          <div className=\"p-4 border-t border-white/10\">\n            <div className=\"flex items-center gap-2 text-sm text-white/80\">\n              <Navigation className=\"w-4 h-4 text-[hsl(16,100%,50%)]\" />\n              <span>Optimized route: {properties.length} stops</span>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\ninterface PropertyListItemProps {\n  property: PropertyWithSchedule;\n  index?: number;\n  isSelected?: boolean;\n  onClick?: () => void;\n}\n\nexport function PropertyListItem({ property, index, isSelected, onClick }: PropertyListItemProps) {\n  const status = property.scheduledInspection?.status;\n  \n  const getStatusBadge = () => {\n    switch (status) {\n      case 'completed':\n        return <Badge className=\"bg-green-500/20 text-green-500 border-green-500/50\"><CheckCircle2 className=\"w-3 h-3 mr-1\" />Completed</Badge>;\n      case 'in_progress':\n        return <Badge className=\"bg-blue-500/20 text-blue-500 border-blue-500/50\"><Clock className=\"w-3 h-3 mr-1\" />In Progress</Badge>;\n      case 'scheduled':\n        return <Badge className=\"bg-yellow-500/20 text-yellow-500 border-yellow-500/50\"><Calendar className=\"w-3 h-3 mr-1\" />Scheduled</Badge>;\n      case 'cancelled':\n        return <Badge className=\"bg-red-500/20 text-red-500 border-red-500/50\"><AlertTriangle className=\"w-3 h-3 mr-1\" />Cancelled</Badge>;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <button\n      onClick={onClick}\n      className={`w-full text-left p-3 border transition-colors ${\n        isSelected \n          ? 'bg-[hsl(16,100%,50%)]/10 border-[hsl(16,100%,50%)]/50' \n          : 'bg-white/5 border-white/10 hover:bg-white/10'\n      }`}\n      data-testid={`property-item-${property.id}`}\n    >\n      <div className=\"flex items-start gap-3\">\n        {index !== undefined && (\n          <div className=\"flex-shrink-0 w-6 h-6 bg-[hsl(16,100%,50%)] text-white text-xs font-bold flex items-center justify-center\">\n            {index + 1}\n          </div>\n        )}\n        <div className=\"flex-1 min-w-0\">\n          <h4 className=\"font-medium text-white truncate\">{property.name}</h4>\n          <p className=\"text-sm text-white/60 truncate\">{property.address}</p>\n          {property.scheduledInspection && (\n            <div className=\"mt-2 flex items-center gap-2\">\n              {getStatusBadge()}\n              {property.scheduledInspection.scheduledTime && (\n                <span className=\"text-xs text-white/40\">\n                  {property.scheduledInspection.scheduledTime}\n                </span>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </button>\n  );\n}\n","path":null,"size_bytes":11356,"size_tokens":null},"server/audio-transcription.ts":{"content":"import OpenAI from 'openai';\nimport { Readable } from 'stream';\n\nconst openai = new OpenAI({\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY\n});\n\nexport interface TranscriptionResult {\n  transcription: string;\n  duration: number;\n  status: 'success' | 'fallback' | 'error';\n  language?: string;\n  segments?: { start: number; end: number; text: string }[];\n}\n\nfunction base64ToBuffer(base64DataUrl: string): { buffer: Buffer; mimeType: string } {\n  const matches = base64DataUrl.match(/^data:([^;]+);base64,(.+)$/);\n  if (!matches) {\n    throw new Error('Invalid base64 data URL format');\n  }\n  const mimeType = matches[1];\n  const base64Data = matches[2];\n  const buffer = Buffer.from(base64Data, 'base64');\n  return { buffer, mimeType };\n}\n\nfunction getFileExtension(mimeType: string): string {\n  const mimeToExt: Record<string, string> = {\n    'audio/webm': 'webm',\n    'audio/webm;codecs=opus': 'webm',\n    'audio/mp4': 'm4a',\n    'audio/mpeg': 'mp3',\n    'audio/mpga': 'mp3',\n    'audio/ogg': 'ogg',\n    'audio/ogg;codecs=opus': 'ogg',\n    'audio/wav': 'wav',\n    'audio/x-wav': 'wav',\n  };\n  return mimeToExt[mimeType] || 'webm';\n}\n\nexport async function transcribeAudio(audioDataUrl: string, duration: number): Promise<TranscriptionResult> {\n  try {\n    const { buffer, mimeType } = base64ToBuffer(audioDataUrl);\n    const extension = getFileExtension(mimeType);\n    const filename = `voice_memo_${Date.now()}.${extension}`;\n    \n    const file = new File([buffer], filename, { type: mimeType });\n\n    try {\n      const response = await openai.audio.transcriptions.create({\n        file: file,\n        model: 'whisper-1',\n        response_format: 'verbose_json',\n        language: 'en',\n      });\n\n      return {\n        transcription: response.text || '',\n        duration: response.duration || duration,\n        status: 'success',\n        language: response.language,\n        segments: response.segments?.map(seg => ({\n          start: seg.start,\n          end: seg.end,\n          text: seg.text,\n        })),\n      };\n    } catch (whisperError: any) {\n      console.warn('Whisper API not available via AI Integrations, using fallback:', whisperError.message);\n      \n      return {\n        transcription: `[Voice memo - ${Math.round(duration)} seconds] Automatic transcription is not available. The audio has been saved and can be played back anytime. For field notes, you can manually type your observations or use the notes field.`,\n        duration,\n        status: 'fallback',\n      };\n    }\n  } catch (error: any) {\n    console.error('Transcription error:', error);\n    return {\n      transcription: '',\n      duration,\n      status: 'error',\n    };\n  }\n}\n\nexport async function summarizeVoiceMemo(transcription: string, step?: string): Promise<string> {\n  if (!transcription || transcription.startsWith('[Voice memo')) {\n    return transcription;\n  }\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: 'gpt-5.1',\n      messages: [\n        {\n          role: 'system',\n          content: `You are Stormy, the WinnStorm™ AI Assistant. Summarize the following voice memo transcription into clear, professional field notes suitable for a damage assessment report. ${step ? `This is for the \"${step}\" step of the Winn Methodology.` : ''} Keep the summary concise but include all relevant technical details, measurements, and observations.`\n        },\n        {\n          role: 'user',\n          content: transcription\n        }\n      ],\n      max_tokens: 500,\n      temperature: 0.3,\n    });\n\n    return response.choices[0]?.message?.content || transcription;\n  } catch (error) {\n    console.error('Failed to summarize voice memo:', error);\n    return transcription;\n  }\n}\n","path":null,"size_bytes":3776,"size_tokens":null},"client/src/components/inspection-calendar.tsx":{"content":"import { useState, useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { \n  ChevronLeft, \n  ChevronRight, \n  Calendar as CalendarIcon,\n  Clock,\n  MapPin,\n  Plus,\n  AlertTriangle,\n  CheckCircle2,\n  Loader2\n} from 'lucide-react';\nimport { format, addDays, startOfWeek, endOfWeek, isSameDay, isToday, addWeeks, subWeeks } from 'date-fns';\nimport type { ScheduledInspection, Property } from '@shared/schema';\n\ninterface InspectionWithProperty extends ScheduledInspection {\n  property?: Property;\n}\n\ninterface InspectionCalendarProps {\n  inspections: InspectionWithProperty[];\n  isLoading?: boolean;\n  onDateSelect?: (date: Date) => void;\n  onInspectionClick?: (inspection: InspectionWithProperty) => void;\n  onAddInspection?: (date: Date) => void;\n  selectedDate?: Date;\n}\n\ntype ViewMode = 'week' | 'day';\n\nexport function InspectionCalendar({\n  inspections,\n  isLoading = false,\n  onDateSelect,\n  onInspectionClick,\n  onAddInspection,\n  selectedDate,\n}: InspectionCalendarProps) {\n  const [viewMode, setViewMode] = useState<ViewMode>('week');\n  const [currentDate, setCurrentDate] = useState(new Date());\n\n  const weekStart = useMemo(() => startOfWeek(currentDate, { weekStartsOn: 0 }), [currentDate]);\n  const weekEnd = useMemo(() => endOfWeek(currentDate, { weekStartsOn: 0 }), [currentDate]);\n\n  const weekDays = useMemo(() => {\n    const days = [];\n    for (let i = 0; i < 7; i++) {\n      days.push(addDays(weekStart, i));\n    }\n    return days;\n  }, [weekStart]);\n\n  const getInspectionsForDay = (date: Date) => {\n    return inspections.filter(i => isSameDay(new Date(i.scheduledDate), date));\n  };\n\n  const goToNextWeek = () => setCurrentDate(addWeeks(currentDate, 1));\n  const goToPrevWeek = () => setCurrentDate(subWeeks(currentDate, 1));\n  const goToToday = () => setCurrentDate(new Date());\n\n  const handleDateClick = (date: Date) => {\n    if (viewMode === 'week') {\n      setCurrentDate(date);\n      setViewMode('day');\n    }\n    onDateSelect?.(date);\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'completed': return 'bg-green-500';\n      case 'in_progress': return 'bg-blue-500';\n      case 'scheduled': return 'bg-yellow-500';\n      case 'cancelled': return 'bg-red-500';\n      default: return 'bg-white/30';\n    }\n  };\n\n  const getPriorityBadge = (priority: string) => {\n    switch (priority) {\n      case 'urgent': return <Badge className=\"bg-red-500/20 text-red-400 border-red-500/50 text-[10px]\">Urgent</Badge>;\n      case 'high': return <Badge className=\"bg-orange-500/20 text-orange-400 border-orange-500/50 text-[10px]\">High</Badge>;\n      default: return null;\n    }\n  };\n\n  return (\n    <Card className=\"bg-[#1A1A1A] border-white/10\">\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2 text-lg font-montserrat text-white\">\n            <CalendarIcon className=\"w-5 h-5 text-[hsl(16,100%,50%)]\" />\n            Inspection Schedule\n          </CardTitle>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setViewMode(viewMode === 'week' ? 'day' : 'week')}\n              className=\"text-white/60 hover:text-white hover:bg-white/10\"\n              data-testid=\"toggle-view-mode\"\n            >\n              {viewMode === 'week' ? 'Day View' : 'Week View'}\n            </Button>\n          </div>\n        </div>\n        \n        <div className=\"flex items-center justify-between mt-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={goToPrevWeek}\n            className=\"text-white/60 hover:text-white hover:bg-white/10\"\n            data-testid=\"prev-week\"\n          >\n            <ChevronLeft className=\"w-5 h-5\" />\n          </Button>\n          \n          <div className=\"flex items-center gap-4\">\n            <h3 className=\"text-white font-medium\">\n              {viewMode === 'week' \n                ? `${format(weekStart, 'MMM d')} - ${format(weekEnd, 'MMM d, yyyy')}`\n                : format(currentDate, 'EEEE, MMMM d, yyyy')\n              }\n            </h3>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={goToToday}\n              className=\"text-white/60 border-white/20 hover:bg-white/10\"\n              data-testid=\"go-to-today\"\n            >\n              Today\n            </Button>\n          </div>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={goToNextWeek}\n            className=\"text-white/60 hover:text-white hover:bg-white/10\"\n            data-testid=\"next-week\"\n          >\n            <ChevronRight className=\"w-5 h-5\" />\n          </Button>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"pt-4\">\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-64\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-[hsl(16,100%,50%)]\" />\n          </div>\n        ) : viewMode === 'week' ? (\n          <WeekView\n            weekDays={weekDays}\n            inspections={inspections}\n            selectedDate={selectedDate}\n            onDateClick={handleDateClick}\n            onInspectionClick={onInspectionClick}\n            onAddInspection={onAddInspection}\n            getStatusColor={getStatusColor}\n            getPriorityBadge={getPriorityBadge}\n          />\n        ) : (\n          <DayView\n            date={currentDate}\n            inspections={getInspectionsForDay(currentDate)}\n            onInspectionClick={onInspectionClick}\n            onAddInspection={onAddInspection}\n            getStatusColor={getStatusColor}\n            getPriorityBadge={getPriorityBadge}\n          />\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\ninterface WeekViewProps {\n  weekDays: Date[];\n  inspections: InspectionWithProperty[];\n  selectedDate?: Date;\n  onDateClick: (date: Date) => void;\n  onInspectionClick?: (inspection: InspectionWithProperty) => void;\n  onAddInspection?: (date: Date) => void;\n  getStatusColor: (status: string) => string;\n  getPriorityBadge: (priority: string) => JSX.Element | null;\n}\n\nfunction WeekView({\n  weekDays,\n  inspections,\n  selectedDate,\n  onDateClick,\n  onInspectionClick,\n  onAddInspection,\n  getStatusColor,\n  getPriorityBadge,\n}: WeekViewProps) {\n  const getInspectionsForDay = (date: Date) => {\n    return inspections.filter(i => isSameDay(new Date(i.scheduledDate), date));\n  };\n\n  return (\n    <div className=\"grid grid-cols-7 gap-1\">\n      {weekDays.map((day, i) => {\n        const dayInspections = getInspectionsForDay(day);\n        const isSelected = selectedDate && isSameDay(day, selectedDate);\n        const today = isToday(day);\n        \n        return (\n          <div\n            key={i}\n            className={`min-h-[120px] p-2 border cursor-pointer transition-colors ${\n              isSelected \n                ? 'border-[hsl(16,100%,50%)] bg-[hsl(16,100%,50%)]/10' \n                : today\n                  ? 'border-blue-500/50 bg-blue-500/5'\n                  : 'border-white/10 hover:bg-white/5'\n            }`}\n            onClick={() => onDateClick(day)}\n            data-testid={`calendar-day-${format(day, 'yyyy-MM-dd')}`}\n          >\n            <div className=\"flex items-center justify-between mb-2\">\n              <div className={`text-sm font-medium ${today ? 'text-blue-400' : 'text-white/60'}`}>\n                {format(day, 'EEE')}\n              </div>\n              <div className={`w-6 h-6 flex items-center justify-center text-sm ${\n                today \n                  ? 'bg-blue-500 text-white' \n                  : isSelected \n                    ? 'bg-[hsl(16,100%,50%)] text-white' \n                    : 'text-white'\n              }`}>\n                {format(day, 'd')}\n              </div>\n            </div>\n            \n            <div className=\"space-y-1\">\n              {dayInspections.slice(0, 3).map((inspection) => (\n                <button\n                  key={inspection.id}\n                  className={`w-full text-left p-1 text-xs ${getStatusColor(inspection.status)} bg-opacity-20 hover:bg-opacity-30 transition-colors truncate`}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onInspectionClick?.(inspection);\n                  }}\n                  data-testid={`inspection-item-${inspection.id}`}\n                >\n                  <div className=\"flex items-center gap-1\">\n                    <span className={`w-1.5 h-1.5 ${getStatusColor(inspection.status)}`} />\n                    <span className=\"truncate text-white\">\n                      {inspection.scheduledTime || ''} {inspection.property?.name || `Property #${inspection.propertyId}`}\n                    </span>\n                  </div>\n                </button>\n              ))}\n              {dayInspections.length > 3 && (\n                <div className=\"text-xs text-white/40 pl-1\">\n                  +{dayInspections.length - 3} more\n                </div>\n              )}\n              {dayInspections.length === 0 && onAddInspection && (\n                <button\n                  className=\"w-full p-1 text-xs text-white/30 hover:text-white/50 flex items-center justify-center gap-1\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onAddInspection(day);\n                  }}\n                  data-testid={`add-inspection-${format(day, 'yyyy-MM-dd')}`}\n                >\n                  <Plus className=\"w-3 h-3\" />\n                </button>\n              )}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\ninterface DayViewProps {\n  date: Date;\n  inspections: InspectionWithProperty[];\n  onInspectionClick?: (inspection: InspectionWithProperty) => void;\n  onAddInspection?: (date: Date) => void;\n  getStatusColor: (status: string) => string;\n  getPriorityBadge: (priority: string) => JSX.Element | null;\n}\n\nfunction DayView({\n  date,\n  inspections,\n  onInspectionClick,\n  onAddInspection,\n  getStatusColor,\n  getPriorityBadge,\n}: DayViewProps) {\n  const sortedInspections = [...inspections].sort((a, b) => {\n    if (!a.scheduledTime || !b.scheduledTime) return 0;\n    return a.scheduledTime.localeCompare(b.scheduledTime);\n  });\n\n  const timeSlots = [\n    '08:00', '09:00', '10:00', '11:00', '12:00',\n    '13:00', '14:00', '15:00', '16:00', '17:00'\n  ];\n\n  return (\n    <ScrollArea className=\"h-[400px]\">\n      <div className=\"space-y-2\">\n        {timeSlots.map((time) => {\n          const slotInspections = sortedInspections.filter(i => \n            i.scheduledTime?.startsWith(time.split(':')[0])\n          );\n          \n          return (\n            <div key={time} className=\"flex gap-4\">\n              <div className=\"w-16 text-sm text-white/40 py-2\">\n                {time}\n              </div>\n              <div className=\"flex-1 min-h-[60px] border-l border-white/10 pl-4\">\n                {slotInspections.length > 0 ? (\n                  slotInspections.map((inspection) => (\n                    <button\n                      key={inspection.id}\n                      onClick={() => onInspectionClick?.(inspection)}\n                      className={`w-full text-left p-3 mb-2 border-l-4 ${\n                        inspection.status === 'completed' \n                          ? 'border-l-green-500 bg-green-500/10' \n                          : inspection.status === 'in_progress'\n                            ? 'border-l-blue-500 bg-blue-500/10'\n                            : 'border-l-yellow-500 bg-yellow-500/10'\n                      } hover:bg-white/10 transition-colors`}\n                      data-testid={`day-inspection-${inspection.id}`}\n                    >\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <h4 className=\"font-medium text-white\">\n                            {inspection.property?.name || `Property #${inspection.propertyId}`}\n                          </h4>\n                          <div className=\"flex items-center gap-2 mt-1 text-sm text-white/60\">\n                            <MapPin className=\"w-3 h-3\" />\n                            <span className=\"truncate\">{inspection.property?.address || 'No address'}</span>\n                          </div>\n                          <div className=\"flex items-center gap-2 mt-1 text-sm text-white/60\">\n                            <Clock className=\"w-3 h-3\" />\n                            <span>{inspection.scheduledTime || 'TBD'} - {inspection.estimatedDuration || 60}min</span>\n                          </div>\n                        </div>\n                        <div className=\"flex flex-col items-end gap-1\">\n                          {getPriorityBadge(inspection.priority)}\n                          <Badge className={`${\n                            inspection.status === 'completed' \n                              ? 'bg-green-500/20 text-green-400' \n                              : inspection.status === 'in_progress'\n                                ? 'bg-blue-500/20 text-blue-400'\n                                : 'bg-yellow-500/20 text-yellow-400'\n                          } text-[10px]`}>\n                            {inspection.status}\n                          </Badge>\n                        </div>\n                      </div>\n                    </button>\n                  ))\n                ) : (\n                  <button\n                    onClick={() => onAddInspection?.(date)}\n                    className=\"w-full h-[48px] border border-dashed border-white/10 hover:border-white/30 flex items-center justify-center text-white/30 hover:text-white/50 transition-colors\"\n                    data-testid={`add-inspection-slot-${time}`}\n                  >\n                    <Plus className=\"w-4 h-4\" />\n                  </button>\n                )}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </ScrollArea>\n  );\n}\n","path":null,"size_bytes":14249,"size_tokens":null},"server/pdf-report-service.ts":{"content":"import PDFDocument from 'pdfkit';\nimport { Property, Scan, Metric, Issue } from '@shared/schema';\n\ninterface ReportOptions {\n  includeExecutiveSummary?: boolean;\n  includePhotos?: boolean;\n  includeThermalAnalysis?: boolean;\n  includeRecommendations?: boolean;\n}\n\ninterface ReportData {\n  property: Property;\n  scan: Scan;\n  executiveSummary?: string;\n  thermalAnalysis?: {\n    anomalies: Array<{\n      type: string;\n      severity: string;\n      location: string;\n      description: string;\n    }>;\n    overallAssessment: string;\n  };\n  evidencePhotos?: Array<{\n    url: string;\n    caption: string;\n    timestamp: string;\n  }>;\n  inspectorName?: string;\n  companyName?: string;\n}\n\nconst COLORS = {\n  primary: '#FF5500',\n  secondary: '#1A1A1A',\n  accent: '#00BFFF',\n  text: '#333333',\n  lightGray: '#F5F5F5',\n  white: '#FFFFFF',\n  success: '#22C55E',\n  warning: '#F59E0B',\n  danger: '#EF4444',\n};\n\nfunction getSeverityColor(severity: string): string {\n  switch (severity?.toLowerCase()) {\n    case 'critical':\n    case 'high':\n      return COLORS.danger;\n    case 'medium':\n      return COLORS.warning;\n    case 'low':\n      return COLORS.success;\n    default:\n      return COLORS.text;\n  }\n}\n\nfunction getConditionColor(condition: string): string {\n  switch (condition?.toLowerCase()) {\n    case 'excellent':\n      return COLORS.success;\n    case 'good':\n      return '#4ADE80';\n    case 'fair':\n      return COLORS.warning;\n    case 'poor':\n      return '#F97316';\n    case 'critical':\n      return COLORS.danger;\n    default:\n      return COLORS.text;\n  }\n}\n\nexport async function generateWinnReport(\n  data: ReportData,\n  options: ReportOptions = {}\n): Promise<Buffer> {\n  const {\n    includeExecutiveSummary = true,\n    includePhotos = true,\n    includeThermalAnalysis = true,\n    includeRecommendations = true,\n  } = options;\n\n  return new Promise((resolve, reject) => {\n    try {\n      const doc = new PDFDocument({\n        size: 'LETTER',\n        margins: { top: 50, bottom: 50, left: 50, right: 50 },\n        info: {\n          Title: `Winn Report - ${data.property.name}`,\n          Author: 'WinnStorm™ Damage Assessment Platform',\n          Subject: 'Thermal Roof Assessment Report',\n          Creator: 'WinnStorm™',\n        },\n      });\n\n      const chunks: Buffer[] = [];\n      doc.on('data', (chunk) => chunks.push(chunk));\n      doc.on('end', () => resolve(Buffer.concat(chunks)));\n      doc.on('error', reject);\n\n      addCoverPage(doc, data);\n      doc.addPage();\n      \n      addTableOfContents(doc, options);\n      doc.addPage();\n\n      if (includeExecutiveSummary && data.executiveSummary) {\n        addExecutiveSummary(doc, data.executiveSummary);\n        doc.addPage();\n      }\n\n      addPropertyInformation(doc, data.property);\n      doc.addPage();\n\n      addScanDetails(doc, data.scan);\n      \n      if (data.scan.metrics && data.scan.metrics.length > 0) {\n        doc.addPage();\n        addMetricsSection(doc, data.scan.metrics);\n      }\n\n      if (data.scan.issues && data.scan.issues.length > 0) {\n        doc.addPage();\n        addIssuesSection(doc, data.scan.issues);\n      }\n\n      if (includeThermalAnalysis && data.thermalAnalysis) {\n        doc.addPage();\n        addThermalAnalysisSection(doc, data.thermalAnalysis);\n      }\n\n      if (includeRecommendations) {\n        doc.addPage();\n        addRecommendationsSection(doc, data);\n      }\n\n      addFooter(doc, data);\n      \n      doc.end();\n    } catch (error) {\n      reject(error);\n    }\n  });\n}\n\nfunction addCoverPage(doc: PDFKit.PDFDocument, data: ReportData) {\n  doc.rect(0, 0, 612, 100).fill(COLORS.secondary);\n  \n  doc.fontSize(28)\n    .fillColor(COLORS.primary)\n    .font('Helvetica-Bold')\n    .text('WINNSTORM™', 50, 35, { align: 'left' });\n\n  doc.fontSize(10)\n    .fillColor(COLORS.white)\n    .font('Helvetica')\n    .text('DAMAGE ASSESSMENT PLATFORM', 50, 65);\n\n  doc.fontSize(36)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text('WINN REPORT', 50, 180, { align: 'center' });\n\n  doc.fontSize(14)\n    .fillColor(COLORS.text)\n    .font('Helvetica')\n    .text('Comprehensive Thermal Roof Assessment', 50, 230, { align: 'center' });\n\n  doc.moveTo(200, 270).lineTo(412, 270).stroke(COLORS.primary);\n\n  doc.fontSize(24)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text(data.property.name, 50, 320, { align: 'center' });\n\n  doc.fontSize(14)\n    .fillColor(COLORS.text)\n    .font('Helvetica')\n    .text(data.property.address, 50, 360, { align: 'center' });\n\n  const reportDate = data.scan.date ? new Date(data.scan.date).toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  }) : new Date().toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n\n  doc.fontSize(12)\n    .text(`Report Date: ${reportDate}`, 50, 400, { align: 'center' });\n\n  if (data.scan.healthScore !== null && data.scan.healthScore !== undefined) {\n    const score = data.scan.healthScore;\n    const scoreColor = score >= 80 ? COLORS.success : score >= 60 ? COLORS.warning : COLORS.danger;\n    \n    doc.circle(306, 520, 60).lineWidth(8).stroke(scoreColor);\n    \n    doc.fontSize(36)\n      .fillColor(scoreColor)\n      .font('Helvetica-Bold')\n      .text(`${score}`, 256, 500, { width: 100, align: 'center' });\n    \n    doc.fontSize(12)\n      .fillColor(COLORS.text)\n      .font('Helvetica')\n      .text('Health Score', 256, 545, { width: 100, align: 'center' });\n  }\n\n  if (data.property.overallCondition) {\n    const condition = data.property.overallCondition;\n    const conditionColor = getConditionColor(condition);\n    \n    doc.fontSize(14)\n      .fillColor(conditionColor)\n      .font('Helvetica-Bold')\n      .text(`Overall Condition: ${condition.toUpperCase()}`, 50, 620, { align: 'center' });\n  }\n\n  doc.rect(0, 742, 612, 50).fill(COLORS.secondary);\n  doc.fontSize(8)\n    .fillColor(COLORS.white)\n    .text('Certified to Winn™ | Powered by WinnStorm™ Damage Assessment Platform', 50, 760, { \n      align: 'center',\n      width: 512 \n    });\n}\n\nfunction addTableOfContents(doc: PDFKit.PDFDocument, options: ReportOptions) {\n  doc.fontSize(24)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text('TABLE OF CONTENTS', 50, 50);\n\n  doc.moveTo(50, 85).lineTo(200, 85).stroke(COLORS.primary);\n\n  let yPos = 120;\n  const items = [\n    { title: 'Executive Summary', page: 3, included: options.includeExecutiveSummary !== false },\n    { title: 'Property Information', page: 4, included: true },\n    { title: 'Scan Details & Analysis', page: 5, included: true },\n    { title: 'Performance Metrics', page: 6, included: true },\n    { title: 'Issues & Findings', page: 7, included: true },\n    { title: 'Thermal Analysis', page: 8, included: options.includeThermalAnalysis !== false },\n    { title: 'Recommendations', page: 9, included: options.includeRecommendations !== false },\n  ];\n\n  items.filter(item => item.included).forEach((item, index) => {\n    doc.fontSize(12)\n      .fillColor(COLORS.text)\n      .font('Helvetica')\n      .text(`${index + 1}. ${item.title}`, 70, yPos);\n    \n    const dots = '.'.repeat(50);\n    doc.fontSize(12)\n      .fillColor('#999999')\n      .text(dots, 250, yPos, { width: 250 });\n    \n    doc.fontSize(12)\n      .fillColor(COLORS.text)\n      .text(`${item.page}`, 520, yPos);\n    \n    yPos += 30;\n  });\n}\n\nfunction addExecutiveSummary(doc: PDFKit.PDFDocument, summary: string) {\n  doc.fontSize(24)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text('EXECUTIVE SUMMARY', 50, 50);\n\n  doc.moveTo(50, 85).lineTo(250, 85).stroke(COLORS.primary);\n\n  doc.rect(50, 110, 512, 4).fill(COLORS.primary);\n\n  doc.fontSize(11)\n    .fillColor(COLORS.text)\n    .font('Helvetica')\n    .text(summary, 50, 130, {\n      width: 512,\n      align: 'justify',\n      lineGap: 6,\n    });\n}\n\nfunction addPropertyInformation(doc: PDFKit.PDFDocument, property: Property) {\n  doc.fontSize(24)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text('PROPERTY INFORMATION', 50, 50);\n\n  doc.moveTo(50, 85).lineTo(280, 85).stroke(COLORS.primary);\n\n  let yPos = 110;\n\n  const fields = [\n    { label: 'Property Name', value: property.name },\n    { label: 'Address', value: property.address },\n    { label: 'Overall Condition', value: property.overallCondition || 'Not assessed' },\n    { label: 'Last Inspection', value: property.lastInspectionDate \n      ? new Date(property.lastInspectionDate).toLocaleDateString() \n      : 'N/A' },\n  ];\n\n  fields.forEach(field => {\n    doc.fontSize(10)\n      .fillColor('#666666')\n      .font('Helvetica')\n      .text(field.label, 50, yPos);\n    \n    doc.fontSize(12)\n      .fillColor(COLORS.text)\n      .font('Helvetica-Bold')\n      .text(field.value, 50, yPos + 15);\n    \n    yPos += 50;\n  });\n\n  if (property.buildingInfo) {\n    yPos += 20;\n    doc.fontSize(16)\n      .fillColor(COLORS.secondary)\n      .font('Helvetica-Bold')\n      .text('Building Information', 50, yPos);\n    \n    yPos += 30;\n\n    const buildingInfo = property.buildingInfo;\n    const buildingFields = [\n      { label: 'Property Type', value: buildingInfo.propertyType || 'N/A' },\n      { label: 'Year Built', value: buildingInfo.yearBuilt?.toString() || 'N/A' },\n      { label: 'Square Footage', value: buildingInfo.squareFootage \n        ? `${buildingInfo.squareFootage.toLocaleString()} sq ft` \n        : 'N/A' },\n      { label: 'Number of Stories', value: buildingInfo.stories?.toString() || 'N/A' },\n    ];\n\n    buildingFields.forEach(field => {\n      doc.fontSize(10)\n        .fillColor('#666666')\n        .font('Helvetica')\n        .text(field.label, 50, yPos);\n      \n      doc.fontSize(11)\n        .fillColor(COLORS.text)\n        .font('Helvetica')\n        .text(field.value, 200, yPos);\n      \n      yPos += 25;\n    });\n  }\n\n  if (property.roofSystemDetails) {\n    yPos += 20;\n    doc.fontSize(16)\n      .fillColor(COLORS.secondary)\n      .font('Helvetica-Bold')\n      .text('Roof System Details', 50, yPos);\n    \n    yPos += 30;\n\n    const roofDetails = property.roofSystemDetails;\n    const roofFields = [\n      { label: 'Roof Type', value: roofDetails.roofType || 'N/A' },\n      { label: 'Material', value: roofDetails.primaryMaterial || 'N/A' },\n      { label: 'Age', value: roofDetails.age ? `${roofDetails.age} years` : 'N/A' },\n      { label: 'Condition', value: roofDetails.condition || 'N/A' },\n    ];\n\n    roofFields.forEach(field => {\n      doc.fontSize(10)\n        .fillColor('#666666')\n        .font('Helvetica')\n        .text(field.label, 50, yPos);\n      \n      doc.fontSize(11)\n        .fillColor(COLORS.text)\n        .font('Helvetica')\n        .text(field.value, 200, yPos);\n      \n      yPos += 25;\n    });\n  }\n}\n\nfunction addScanDetails(doc: PDFKit.PDFDocument, scan: Scan) {\n  doc.fontSize(24)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text('SCAN DETAILS & ANALYSIS', 50, 50);\n\n  doc.moveTo(50, 85).lineTo(280, 85).stroke(COLORS.primary);\n\n  let yPos = 110;\n\n  const scanFields = [\n    { label: 'Scan Date', value: scan.date \n      ? new Date(scan.date).toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric',\n          hour: '2-digit',\n          minute: '2-digit',\n        })\n      : 'N/A' },\n    { label: 'Scan Type', value: scan.scanType?.toUpperCase() || 'N/A' },\n    { label: 'Device Used', value: scan.deviceType || 'N/A' },\n    { label: 'Health Score', value: scan.healthScore?.toString() || 'Not calculated' },\n  ];\n\n  scanFields.forEach(field => {\n    doc.fontSize(10)\n      .fillColor('#666666')\n      .font('Helvetica')\n      .text(field.label, 50, yPos);\n    \n    doc.fontSize(12)\n      .fillColor(COLORS.text)\n      .font('Helvetica-Bold')\n      .text(field.value, 200, yPos);\n    \n    yPos += 35;\n  });\n\n  if (scan.notes) {\n    yPos += 20;\n    doc.fontSize(14)\n      .fillColor(COLORS.secondary)\n      .font('Helvetica-Bold')\n      .text('Inspector Notes', 50, yPos);\n    \n    yPos += 25;\n    doc.fontSize(11)\n      .fillColor(COLORS.text)\n      .font('Helvetica')\n      .text(scan.notes, 50, yPos, { width: 512 });\n  }\n}\n\nfunction addMetricsSection(doc: PDFKit.PDFDocument, metrics: Metric[]) {\n  doc.fontSize(24)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text('PERFORMANCE METRICS', 50, 50);\n\n  doc.moveTo(50, 85).lineTo(250, 85).stroke(COLORS.primary);\n\n  let yPos = 120;\n\n  metrics.forEach((metric, index) => {\n    doc.rect(50, yPos, 512, 60).fill(index % 2 === 0 ? COLORS.lightGray : COLORS.white);\n    \n    doc.fontSize(14)\n      .fillColor(COLORS.secondary)\n      .font('Helvetica-Bold')\n      .text(metric.name, 60, yPos + 10);\n    \n    doc.fontSize(20)\n      .fillColor(COLORS.primary)\n      .font('Helvetica-Bold')\n      .text(`${metric.value}`, 60, yPos + 30);\n    \n    yPos += 70;\n    \n    if (yPos > 700) {\n      doc.addPage();\n      yPos = 50;\n    }\n  });\n}\n\nfunction addIssuesSection(doc: PDFKit.PDFDocument, issues: Issue[]) {\n  doc.fontSize(24)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text('ISSUES & FINDINGS', 50, 50);\n\n  doc.moveTo(50, 85).lineTo(220, 85).stroke(COLORS.primary);\n\n  let yPos = 120;\n\n  issues.forEach((issue, index) => {\n    const severityColor = getSeverityColor(issue.severity);\n    \n    doc.rect(50, yPos, 4, 80).fill(severityColor);\n    doc.rect(54, yPos, 508, 80).fill(COLORS.lightGray);\n    \n    doc.fontSize(14)\n      .fillColor(COLORS.secondary)\n      .font('Helvetica-Bold')\n      .text(issue.title, 65, yPos + 10, { width: 400 });\n    \n    doc.fontSize(10)\n      .fillColor(severityColor)\n      .font('Helvetica-Bold')\n      .text(issue.severity?.toUpperCase() || 'UNKNOWN', 480, yPos + 10);\n    \n    doc.fontSize(10)\n      .fillColor(COLORS.text)\n      .font('Helvetica')\n      .text(issue.description || '', 65, yPos + 35, { width: 480, height: 35 });\n    \n    yPos += 95;\n    \n    if (yPos > 650) {\n      doc.addPage();\n      yPos = 50;\n    }\n  });\n}\n\nfunction addThermalAnalysisSection(\n  doc: PDFKit.PDFDocument, \n  analysis: ReportData['thermalAnalysis']\n) {\n  if (!analysis) return;\n\n  doc.fontSize(24)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text('THERMAL ANALYSIS', 50, 50);\n\n  doc.moveTo(50, 85).lineTo(220, 85).stroke(COLORS.primary);\n\n  doc.fontSize(14)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text('Overall Assessment', 50, 110);\n\n  doc.fontSize(11)\n    .fillColor(COLORS.text)\n    .font('Helvetica')\n    .text(analysis.overallAssessment, 50, 130, { width: 512 });\n\n  if (analysis.anomalies && analysis.anomalies.length > 0) {\n    let yPos = 180;\n    \n    doc.fontSize(14)\n      .fillColor(COLORS.secondary)\n      .font('Helvetica-Bold')\n      .text('Detected Anomalies', 50, yPos);\n    \n    yPos += 30;\n\n    analysis.anomalies.forEach((anomaly, index) => {\n      const severityColor = getSeverityColor(anomaly.severity);\n      \n      doc.rect(50, yPos, 512, 70).fill(index % 2 === 0 ? COLORS.lightGray : COLORS.white);\n      doc.rect(50, yPos, 4, 70).fill(severityColor);\n      \n      doc.fontSize(12)\n        .fillColor(COLORS.secondary)\n        .font('Helvetica-Bold')\n        .text(`${anomaly.type}`, 65, yPos + 10);\n      \n      doc.fontSize(10)\n        .fillColor(severityColor)\n        .font('Helvetica-Bold')\n        .text(anomaly.severity.toUpperCase(), 480, yPos + 10);\n      \n      doc.fontSize(10)\n        .fillColor('#666666')\n        .font('Helvetica')\n        .text(`Location: ${anomaly.location}`, 65, yPos + 30);\n      \n      doc.fontSize(10)\n        .fillColor(COLORS.text)\n        .font('Helvetica')\n        .text(anomaly.description, 65, yPos + 45, { width: 480 });\n      \n      yPos += 80;\n      \n      if (yPos > 650) {\n        doc.addPage();\n        yPos = 50;\n      }\n    });\n  }\n}\n\nfunction addRecommendationsSection(doc: PDFKit.PDFDocument, data: ReportData) {\n  doc.fontSize(24)\n    .fillColor(COLORS.secondary)\n    .font('Helvetica-Bold')\n    .text('RECOMMENDATIONS', 50, 50);\n\n  doc.moveTo(50, 85).lineTo(230, 85).stroke(COLORS.primary);\n\n  let yPos = 120;\n\n  const generateRecommendations = () => {\n    const recs: Array<{ priority: string; title: string; description: string }> = [];\n    \n    if (data.scan.issues) {\n      const criticalIssues = data.scan.issues.filter(i => \n        i.severity?.toLowerCase() === 'critical' || i.severity?.toLowerCase() === 'high'\n      );\n      \n      if (criticalIssues.length > 0) {\n        recs.push({\n          priority: 'Immediate',\n          title: 'Address Critical Issues',\n          description: `${criticalIssues.length} critical/high severity issue(s) require immediate attention. These should be addressed within 30 days to prevent further damage.`,\n        });\n      }\n    }\n\n    if (data.scan.healthScore !== null && data.scan.healthScore !== undefined) {\n      if (data.scan.healthScore < 60) {\n        recs.push({\n          priority: 'High',\n          title: 'Schedule Comprehensive Roof Assessment',\n          description: 'Health score indicates significant concerns. Recommend scheduling a detailed physical inspection within 60 days.',\n        });\n      } else if (data.scan.healthScore < 80) {\n        recs.push({\n          priority: 'Medium',\n          title: 'Preventive Maintenance Recommended',\n          description: 'Health score shows moderate wear. Implement preventive maintenance program to extend roof life.',\n        });\n      }\n    }\n\n    recs.push({\n      priority: 'Ongoing',\n      title: 'Regular Thermal Monitoring',\n      description: 'Continue quarterly thermal assessments to track condition changes and identify new issues early.',\n    });\n\n    return recs;\n  };\n\n  const recommendations = generateRecommendations();\n\n  recommendations.forEach((rec, index) => {\n    const priorityColors: Record<string, string> = {\n      'Immediate': COLORS.danger,\n      'High': '#F97316',\n      'Medium': COLORS.warning,\n      'Low': COLORS.success,\n      'Ongoing': COLORS.accent,\n    };\n    \n    const color = priorityColors[rec.priority] || COLORS.text;\n    \n    doc.rect(50, yPos, 4, 70).fill(color);\n    doc.rect(54, yPos, 508, 70).fill(COLORS.lightGray);\n    \n    doc.fontSize(10)\n      .fillColor(color)\n      .font('Helvetica-Bold')\n      .text(rec.priority.toUpperCase(), 65, yPos + 8);\n    \n    doc.fontSize(14)\n      .fillColor(COLORS.secondary)\n      .font('Helvetica-Bold')\n      .text(rec.title, 65, yPos + 24);\n    \n    doc.fontSize(10)\n      .fillColor(COLORS.text)\n      .font('Helvetica')\n      .text(rec.description, 65, yPos + 45, { width: 480 });\n    \n    yPos += 85;\n  });\n}\n\nfunction addFooter(doc: PDFKit.PDFDocument, data: ReportData) {\n  const pageCount = doc.bufferedPageRange().count;\n  \n  for (let i = 0; i < pageCount; i++) {\n    doc.switchToPage(i);\n    \n    if (i > 0) {\n      doc.fontSize(8)\n        .fillColor('#999999')\n        .text(\n          `WinnStorm™ Report - ${data.property.name}`,\n          50,\n          doc.page.height - 30,\n          { align: 'left', width: 200 }\n        );\n      \n      doc.text(\n        `Page ${i + 1} of ${pageCount}`,\n        doc.page.width - 150,\n        doc.page.height - 30,\n        { align: 'right', width: 100 }\n        );\n    }\n  }\n}\n\nexport async function generateExecutiveSummary(data: ReportData): Promise<string> {\n  const healthStatus = data.scan.healthScore \n    ? data.scan.healthScore >= 80 ? 'excellent' \n      : data.scan.healthScore >= 60 ? 'satisfactory' \n      : 'concerning'\n    : 'not yet assessed';\n\n  const issueCount = data.scan.issues?.length || 0;\n  const criticalCount = data.scan.issues?.filter(i => \n    i.severity?.toLowerCase() === 'critical' || i.severity?.toLowerCase() === 'high'\n  ).length || 0;\n\n  return `This thermal roof assessment was conducted on ${data.property.name} located at ${data.property.address}. ` +\n    `The inspection utilized ${data.scan.scanType || 'thermal imaging'} technology with ${data.scan.deviceType || 'professional-grade equipment'}.\\n\\n` +\n    `Overall roof health is ${healthStatus}${data.scan.healthScore ? ` with a score of ${data.scan.healthScore}/100` : ''}. ` +\n    `${issueCount > 0 ? `A total of ${issueCount} issue(s) were identified, ${criticalCount > 0 ? `including ${criticalCount} requiring immediate attention` : 'none requiring immediate action'}.` : 'No significant issues were detected during this assessment.'}\\n\\n` +\n    `${data.property.overallCondition ? `The property's overall condition is rated as ${data.property.overallCondition.toUpperCase()}.` : ''} ` +\n    `Based on the Winn Methodology assessment criteria, ${healthStatus === 'excellent' ? 'the roof system is performing optimally and requires only routine maintenance.' : healthStatus === 'satisfactory' ? 'preventive maintenance is recommended to maintain performance.' : 'immediate attention is advised to address identified concerns and prevent further deterioration.'}`;\n}\n","path":null,"size_bytes":20809,"size_tokens":null},"server/innovation-services.ts":{"content":"import OpenAI from \"openai\";\nimport { db } from \"./db\";\nimport { eq, and, desc, sql, gte, lte } from \"drizzle-orm\";\nimport {\n  claimOutcomes,\n  claimPredictions,\n  insurerPatterns,\n  fieldCopilotSessions,\n  copilotGuidanceEvents,\n  wearableDevices,\n  iotDevices,\n  sensorReadings,\n  sensorAlerts,\n  dronePilots,\n  droneAssets,\n  flightSessions,\n  carrierAccounts,\n  carrierUsers,\n  carrierClaimSubmissions,\n  contractorProfiles,\n  repairJobs,\n  contractorBids,\n  referralFees,\n  riskRegions,\n  riskAssessments,\n  riskDataExports,\n  innovationModules,\n  organizationModules,\n  InsertClaimOutcome,\n  InsertClaimPrediction,\n  InsertInsurerPattern,\n  InsertFieldCopilotSession,\n  InsertCopilotGuidanceEvent,\n  InsertWearableDeviceRecord,\n  InsertIotDevice,\n  InsertSensorReading,\n  InsertSensorAlert,\n  InsertDronePilot,\n  InsertDroneAsset,\n  InsertFlightSession,\n  InsertCarrierAccount,\n  InsertCarrierUser,\n  InsertCarrierClaimSubmission,\n  InsertContractorProfile,\n  InsertRepairJob,\n  InsertContractorBid,\n  InsertReferralFee,\n  InsertRiskRegion,\n  InsertRiskAssessment,\n  InsertRiskDataExport,\n  InsertInnovationModule,\n  InsertOrganizationModule,\n  ClaimOutcomeFactors,\n  PredictionConfidence,\n} from \"@shared/schema\";\n\nconst openai = new OpenAI();\n\n// ============================================================================\n// 1. PREDICTIVE CLAIM OUTCOME ENGINE\n// ============================================================================\n\nexport class PredictiveClaimEngine {\n  \n  async recordClaimOutcome(data: InsertClaimOutcome) {\n    const [outcome] = await db.insert(claimOutcomes).values(data).returning();\n    await this.updateInsurerPatterns(data.insurerName);\n    return outcome;\n  }\n\n  async getClaimOutcomes(filters?: { insurerName?: string; claimType?: string }) {\n    const conditions = [];\n    if (filters?.insurerName) {\n      conditions.push(eq(claimOutcomes.insurerName, filters.insurerName));\n    }\n    if (filters?.claimType) {\n      conditions.push(eq(claimOutcomes.claimType, filters.claimType));\n    }\n    \n    if (conditions.length > 0) {\n      return db.select().from(claimOutcomes)\n        .where(and(...conditions))\n        .orderBy(desc(claimOutcomes.createdAt));\n    }\n    return db.select().from(claimOutcomes).orderBy(desc(claimOutcomes.createdAt));\n  }\n\n  async predictClaimOutcome(projectId: number, insurerName: string, claimData: any) {\n    const patterns = await db.select().from(insurerPatterns)\n      .where(eq(insurerPatterns.insurerName, insurerName));\n    \n    const historicalOutcomes = await db.select().from(claimOutcomes)\n      .where(eq(claimOutcomes.insurerName, insurerName))\n      .limit(100);\n\n    const prompt = `You are an expert insurance claims analyst. Based on the following data, predict the claim outcome.\n\nInsurer: ${insurerName}\nInsurer Historical Patterns: ${JSON.stringify(patterns[0] || {})}\nSimilar Historical Claims: ${historicalOutcomes.length} cases analyzed\nClaim Data: ${JSON.stringify(claimData)}\n\nProvide your prediction in JSON format:\n{\n  \"predictedOutcome\": \"approved\" | \"denied\" | \"partial\",\n  \"confidenceScore\": 0-1,\n  \"predictedAmount\": number or null,\n  \"predictedDaysToResolution\": number,\n  \"recommendations\": [\"action1\", \"action2\"],\n  \"riskFactors\": [\"risk1\", \"risk2\"],\n  \"strengthFactors\": [\"strength1\", \"strength2\"]\n}`;\n\n    try {\n      const response = await openai.chat.completions.create({\n        model: \"gpt-5\",\n        messages: [{ role: \"user\", content: prompt }],\n        response_format: { type: \"json_object\" },\n      });\n\n      const prediction = JSON.parse(response.choices[0].message.content || \"{}\");\n      \n      const confidence: PredictionConfidence = {\n        overall: prediction.confidenceScore || 0.5,\n        dataQuality: historicalOutcomes.length > 50 ? 'high' : historicalOutcomes.length > 10 ? 'medium' : 'low',\n        factorsConsidered: Object.keys(claimData).length,\n        similarCasesAnalyzed: historicalOutcomes.length,\n      };\n\n      const [savedPrediction] = await db.insert(claimPredictions).values({\n        projectId,\n        predictedOutcome: prediction.predictedOutcome || 'unknown',\n        confidenceScore: prediction.confidenceScore || 0.5,\n        confidence,\n        predictedAmount: prediction.predictedAmount,\n        predictedDaysToResolution: prediction.predictedDaysToResolution,\n        recommendations: prediction.recommendations || [],\n        riskFactors: prediction.riskFactors || [],\n        strengthFactors: prediction.strengthFactors || [],\n        modelVersion: 'gpt-4o-v1',\n      }).returning();\n\n      return savedPrediction;\n    } catch (error) {\n      console.error('Prediction error:', error);\n      throw error;\n    }\n  }\n\n  async updateInsurerPatterns(insurerName: string) {\n    const outcomes = await db.select().from(claimOutcomes)\n      .where(eq(claimOutcomes.insurerName, insurerName));\n\n    if (outcomes.length < 5) return;\n\n    const approved = outcomes.filter(o => o.outcome === 'approved');\n    const avgApprovalRate = approved.length / outcomes.length;\n    const avgDays = outcomes.reduce((sum, o) => sum + (o.daysToResolution || 0), 0) / outcomes.length;\n    const avgPayout = approved.reduce((sum, o) => {\n      if (o.approvedAmount && o.claimAmount) {\n        return sum + (o.approvedAmount / o.claimAmount);\n      }\n      return sum;\n    }, 0) / (approved.length || 1);\n\n    const denialReasons = outcomes\n      .filter(o => o.outcome === 'denied' && o.notes)\n      .map(o => o.notes!)\n      .slice(0, 10);\n\n    await db.insert(insurerPatterns).values({\n      insurerName,\n      avgApprovalRate,\n      avgDaysToDecision: avgDays,\n      avgPayoutPercentage: avgPayout,\n      commonDenialReasons: denialReasons,\n      claimVolume: outcomes.length,\n      dataQuality: outcomes.length > 50 ? 'high' : outcomes.length > 20 ? 'medium' : 'low',\n    }).onConflictDoUpdate({\n      target: insurerPatterns.insurerName,\n      set: {\n        avgApprovalRate,\n        avgDaysToDecision: avgDays,\n        avgPayoutPercentage: avgPayout,\n        commonDenialReasons: denialReasons,\n        claimVolume: outcomes.length,\n        lastUpdated: new Date(),\n      },\n    });\n  }\n\n  async getInsurerPatterns(insurerName?: string) {\n    if (insurerName) {\n      return db.select().from(insurerPatterns)\n        .where(eq(insurerPatterns.insurerName, insurerName));\n    }\n    return db.select().from(insurerPatterns).orderBy(desc(insurerPatterns.claimVolume));\n  }\n\n  async getPredictionHistory(projectId: number) {\n    return db.select().from(claimPredictions)\n      .where(eq(claimPredictions.projectId, projectId))\n      .orderBy(desc(claimPredictions.createdAt));\n  }\n}\n\n// ============================================================================\n// 2. STORMY FIELD CO-PILOT SERVICE\n// ============================================================================\n\nexport class FieldCopilotService {\n  \n  async startSession(data: InsertFieldCopilotSession) {\n    const [session] = await db.insert(fieldCopilotSessions).values(data as any).returning();\n    return session;\n  }\n\n  async endSession(sessionId: number) {\n    const [session] = await db.update(fieldCopilotSessions)\n      .set({ status: 'completed', endedAt: new Date() })\n      .where(eq(fieldCopilotSessions.id, sessionId))\n      .returning();\n    return session;\n  }\n\n  async getActiveSession(userId: string) {\n    const sessions = await db.select().from(fieldCopilotSessions)\n      .where(and(\n        eq(fieldCopilotSessions.userId, userId),\n        eq(fieldCopilotSessions.status, 'active')\n      ))\n      .orderBy(desc(fieldCopilotSessions.startedAt))\n      .limit(1);\n    return sessions[0] || null;\n  }\n\n  async recordGuidanceEvent(data: InsertCopilotGuidanceEvent) {\n    const [event] = await db.insert(copilotGuidanceEvents).values(data).returning();\n    \n    await db.update(fieldCopilotSessions)\n      .set({ totalGuidanceEvents: sql`${fieldCopilotSessions.totalGuidanceEvents} + 1` })\n      .where(eq(fieldCopilotSessions.id, data.sessionId));\n    \n    return event;\n  }\n\n  async getGuidanceForContext(sessionId: number, visualContext: string, currentStep: string) {\n    const startTime = Date.now();\n    \n    const prompt = `You are Stormy, an expert field inspection AI co-pilot. Provide real-time guidance for the inspector.\n\nCurrent Inspection Step: ${currentStep}\nVisual Context: ${visualContext}\n\nProvide concise, actionable guidance that helps the inspector:\n1. Complete the current step correctly\n2. Identify any issues or concerns\n3. Know what to document or photograph\n4. Understand what comes next\n\nKeep response under 150 words for voice readability.`;\n\n    try {\n      const response = await openai.chat.completions.create({\n        model: \"gpt-5\",\n        messages: [{ role: \"user\", content: prompt }],\n        max_tokens: 300,\n      });\n\n      const guidance = response.choices[0].message.content || '';\n      const responseTime = Date.now() - startTime;\n\n      await this.recordGuidanceEvent({\n        sessionId,\n        eventType: 'ai_guidance',\n        triggerSource: 'visual_query',\n        guidanceContent: guidance,\n        visualContext,\n        responseTimeMs: responseTime,\n      });\n\n      return { guidance, responseTimeMs: responseTime };\n    } catch (error) {\n      console.error('Guidance error:', error);\n      throw error;\n    }\n  }\n\n  async registerWearableDevice(data: InsertWearableDeviceRecord) {\n    const [device] = await db.insert(wearableDevices).values(data).returning();\n    return device;\n  }\n\n  async getUserWearables(userId: string) {\n    return db.select().from(wearableDevices)\n      .where(and(\n        eq(wearableDevices.userId, userId),\n        eq(wearableDevices.isActive, true)\n      ));\n  }\n\n  async updateWearableConnection(deviceId: string) {\n    await db.update(wearableDevices)\n      .set({ lastConnectedAt: new Date() })\n      .where(eq(wearableDevices.deviceId, deviceId));\n  }\n}\n\n// ============================================================================\n// 3. SMART SENSOR NETWORK (IoT) SERVICE\n// ============================================================================\n\nexport class IoTSensorService {\n  \n  async registerDevice(data: InsertIotDevice) {\n    const [device] = await db.insert(iotDevices).values(data as any).returning();\n    return device;\n  }\n\n  async getPropertyDevices(propertyId: number) {\n    return db.select().from(iotDevices)\n      .where(eq(iotDevices.propertyId, propertyId));\n  }\n\n  async recordReading(data: InsertSensorReading) {\n    const [reading] = await db.insert(sensorReadings).values(data).returning();\n    \n    await db.update(iotDevices)\n      .set({ lastCommunication: new Date() })\n      .where(eq(iotDevices.id, data.deviceId));\n\n    await this.checkAlertThresholds(data.deviceId, data.readingType, data.value);\n    \n    return reading;\n  }\n\n  async checkAlertThresholds(deviceId: number, readingType: string, value: number) {\n    const devices = await db.select().from(iotDevices)\n      .where(eq(iotDevices.id, deviceId));\n    \n    if (!devices[0]?.alertThresholds) return;\n\n    const thresholds = devices[0].alertThresholds;\n    const device = devices[0];\n\n    for (const threshold of thresholds) {\n      if (threshold.metric !== readingType) continue;\n\n      let triggered = false;\n      switch (threshold.operator) {\n        case 'gt': triggered = value > threshold.value; break;\n        case 'lt': triggered = value < threshold.value; break;\n        case 'gte': triggered = value >= threshold.value; break;\n        case 'lte': triggered = value <= threshold.value; break;\n        case 'eq': triggered = value === threshold.value; break;\n      }\n\n      if (triggered) {\n        await db.insert(sensorAlerts).values({\n          deviceId,\n          propertyId: device.propertyId,\n          alertType: readingType,\n          severity: threshold.severity,\n          message: `${readingType} reading of ${value} exceeded threshold of ${threshold.value}`,\n          triggerValue: value,\n          thresholdValue: threshold.value,\n        });\n      }\n    }\n  }\n\n  async getUnacknowledgedAlerts(propertyId?: number) {\n    if (propertyId) {\n      return db.select().from(sensorAlerts)\n        .where(and(\n          eq(sensorAlerts.acknowledged, false),\n          eq(sensorAlerts.propertyId, propertyId)\n        ))\n        .orderBy(desc(sensorAlerts.createdAt));\n    }\n    \n    return db.select().from(sensorAlerts)\n      .where(eq(sensorAlerts.acknowledged, false))\n      .orderBy(desc(sensorAlerts.createdAt));\n  }\n\n  async acknowledgeAlert(alertId: number, acknowledgedBy: string) {\n    const [alert] = await db.update(sensorAlerts)\n      .set({ \n        acknowledged: true, \n        acknowledgedBy, \n        acknowledgedAt: new Date() \n      })\n      .where(eq(sensorAlerts.id, alertId))\n      .returning();\n    return alert;\n  }\n\n  async getDeviceReadings(deviceId: number, hours: number = 24) {\n    const cutoff = new Date(Date.now() - hours * 60 * 60 * 1000);\n    return db.select().from(sensorReadings)\n      .where(and(\n        eq(sensorReadings.deviceId, deviceId),\n        gte(sensorReadings.recordedAt, cutoff)\n      ))\n      .orderBy(desc(sensorReadings.recordedAt));\n  }\n}\n\n// ============================================================================\n// 4. DRONE INTEGRATION SERVICE\n// ============================================================================\n\nexport class DroneIntegrationService {\n  \n  async registerPilot(data: InsertDronePilot) {\n    const [pilot] = await db.insert(dronePilots).values(data).returning();\n    return pilot;\n  }\n\n  async registerDrone(data: InsertDroneAsset) {\n    const [drone] = await db.insert(droneAssets).values(data).returning();\n    return drone;\n  }\n\n  async getAvailableDrones(ownerId?: number) {\n    if (ownerId) {\n      return db.select().from(droneAssets)\n        .where(and(\n          eq(droneAssets.status, 'available'),\n          eq(droneAssets.ownerId, ownerId)\n        ));\n    }\n    \n    return db.select().from(droneAssets)\n      .where(eq(droneAssets.status, 'available'));\n  }\n\n  async planFlightSession(data: InsertFlightSession) {\n    const [session] = await db.insert(flightSessions).values(data as any).returning();\n    \n    await db.update(droneAssets)\n      .set({ status: 'reserved' })\n      .where(eq(droneAssets.id, data.droneId));\n    \n    return session;\n  }\n\n  async startFlight(sessionId: number) {\n    const [session] = await db.update(flightSessions)\n      .set({ status: 'in_progress', startTime: new Date() })\n      .where(eq(flightSessions.id, sessionId))\n      .returning();\n    \n    if (session) {\n      await db.update(droneAssets)\n        .set({ status: 'in_flight' })\n        .where(eq(droneAssets.id, session.droneId));\n    }\n    \n    return session;\n  }\n\n  async completeFlight(sessionId: number, flightData: {\n    endTime: Date;\n    distanceCovered: number;\n    photosCapture: number;\n    thermalMaps?: any[];\n    model3D?: any;\n  }) {\n    const [session] = await db.update(flightSessions)\n      .set({\n        status: 'completed',\n        endTime: flightData.endTime,\n        actualDuration: Math.round((flightData.endTime.getTime() - Date.now()) / 60000),\n        distanceCovered: flightData.distanceCovered,\n        photosCapture: flightData.photosCapture,\n        thermalMaps: flightData.thermalMaps,\n        model3D: flightData.model3D,\n      })\n      .where(eq(flightSessions.id, sessionId))\n      .returning();\n    \n    if (session) {\n      await db.update(droneAssets)\n        .set({ status: 'available' })\n        .where(eq(droneAssets.id, session.droneId));\n      \n      await db.update(dronePilots)\n        .set({ totalFlightHours: sql`${dronePilots.totalFlightHours} + ${(session.actualDuration || 0) / 60}` })\n        .where(eq(dronePilots.id, session.pilotId));\n    }\n    \n    return session;\n  }\n\n  async getFlightHistory(propertyId?: number, pilotId?: number) {\n    let conditions = [];\n    if (propertyId) conditions.push(eq(flightSessions.propertyId, propertyId));\n    if (pilotId) conditions.push(eq(flightSessions.pilotId, pilotId));\n    \n    let query = db.select().from(flightSessions);\n    if (conditions.length > 0) {\n      query = query.where(and(...conditions)) as any;\n    }\n    \n    return query.orderBy(desc(flightSessions.createdAt));\n  }\n}\n\n// ============================================================================\n// 5. INSURANCE CARRIER CONSOLE SERVICE\n// ============================================================================\n\nexport class CarrierConsoleService {\n  \n  async createCarrierAccount(data: InsertCarrierAccount) {\n    const apiKey = `wsc_${Math.random().toString(36).substring(2, 34)}`;\n    const [carrier] = await db.insert(carrierAccounts).values({\n      ...data,\n      apiKey,\n    } as any).returning();\n    return carrier;\n  }\n\n  async getCarrierByApiKey(apiKey: string) {\n    const carriers = await db.select().from(carrierAccounts)\n      .where(eq(carrierAccounts.apiKey, apiKey));\n    return carriers[0] || null;\n  }\n\n  async addCarrierUser(data: InsertCarrierUser) {\n    const [user] = await db.insert(carrierUsers).values(data).returning();\n    return user;\n  }\n\n  async submitClaimToCarrier(data: InsertCarrierClaimSubmission) {\n    const [submission] = await db.insert(carrierClaimSubmissions).values(data).returning();\n    return submission;\n  }\n\n  async getCarrierSubmissions(carrierId: number, status?: string) {\n    if (status) {\n      return db.select().from(carrierClaimSubmissions)\n        .where(and(\n          eq(carrierClaimSubmissions.carrierId, carrierId),\n          eq(carrierClaimSubmissions.adjudicationStatus, status)\n        ))\n        .orderBy(desc(carrierClaimSubmissions.submittedAt));\n    }\n    \n    return db.select().from(carrierClaimSubmissions)\n      .where(eq(carrierClaimSubmissions.carrierId, carrierId))\n      .orderBy(desc(carrierClaimSubmissions.submittedAt));\n  }\n\n  async updateSubmissionStatus(submissionId: number, status: string, decision?: string, approvedAmount?: number) {\n    const updateData: any = { adjudicationStatus: status };\n    if (decision) {\n      updateData.decision = decision;\n      updateData.decidedAt = new Date();\n    }\n    if (approvedAmount !== undefined) {\n      updateData.approvedAmount = approvedAmount;\n    }\n    \n    const [submission] = await db.update(carrierClaimSubmissions)\n      .set(updateData)\n      .where(eq(carrierClaimSubmissions.id, submissionId))\n      .returning();\n    return submission;\n  }\n\n  async generateAISummary(projectData: any) {\n    const prompt = `Generate a concise insurance claim summary for adjusters based on this inspection data:\n${JSON.stringify(projectData)}\n\nProvide a professional 2-3 paragraph summary highlighting:\n1. Damage extent and type\n2. Cause of loss determination\n3. Recommended action`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\",\n      messages: [{ role: \"user\", content: prompt }],\n      max_tokens: 500,\n    });\n\n    return response.choices[0].message.content || '';\n  }\n}\n\n// ============================================================================\n// 6. CONTRACTOR MARKETPLACE SERVICE\n// ============================================================================\n\nexport class ContractorMarketplaceService {\n  \n  async createContractorProfile(data: InsertContractorProfile) {\n    const [profile] = await db.insert(contractorProfiles).values(data as any).returning();\n    return profile;\n  }\n\n  async searchContractors(criteria: {\n    specialties?: string[];\n    serviceArea?: string;\n    minRating?: number;\n  }) {\n    let query = db.select().from(contractorProfiles)\n      .where(and(\n        eq(contractorProfiles.isActive, true),\n        eq(contractorProfiles.verificationStatus, 'verified')\n      ));\n    \n    return query.orderBy(desc(contractorProfiles.createdAt));\n  }\n\n  async createRepairJob(data: InsertRepairJob) {\n    const [job] = await db.insert(repairJobs).values(data).returning();\n    return job;\n  }\n\n  async getOpenJobs(specialties?: string[]) {\n    return db.select().from(repairJobs)\n      .where(eq(repairJobs.status, 'open'))\n      .orderBy(desc(repairJobs.createdAt));\n  }\n\n  async submitBid(data: InsertContractorBid) {\n    const [bid] = await db.insert(contractorBids).values(data).returning();\n    return bid;\n  }\n\n  async getJobBids(jobId: number) {\n    return db.select().from(contractorBids)\n      .where(eq(contractorBids.jobId, jobId))\n      .orderBy(contractorBids.bidAmount);\n  }\n\n  async acceptBid(bidId: number, jobId: number) {\n    await db.update(contractorBids)\n      .set({ isWinningBid: true, status: 'accepted' })\n      .where(eq(contractorBids.id, bidId));\n    \n    const bids = await db.select().from(contractorBids)\n      .where(eq(contractorBids.id, bidId));\n    \n    if (bids[0]) {\n      await db.update(repairJobs)\n        .set({ \n          status: 'assigned', \n          selectedContractorId: bids[0].contractorId \n        })\n        .where(eq(repairJobs.id, jobId));\n    }\n    \n    await db.update(contractorBids)\n      .set({ status: 'rejected' })\n      .where(and(\n        eq(contractorBids.jobId, jobId),\n        sql`${contractorBids.id} != ${bidId}`\n      ));\n  }\n\n  async recordReferralFee(data: InsertReferralFee) {\n    const [fee] = await db.insert(referralFees).values(data).returning();\n    return fee;\n  }\n\n  async getContractorReferrals(contractorId: number) {\n    return db.select().from(referralFees)\n      .where(eq(referralFees.contractorId, contractorId))\n      .orderBy(desc(referralFees.createdAt));\n  }\n}\n\n// ============================================================================\n// 7. REGIONAL RISK INTELLIGENCE SERVICE\n// ============================================================================\n\nexport class RiskIntelligenceService {\n  \n  async createRegion(data: InsertRiskRegion) {\n    const [region] = await db.insert(riskRegions).values(data).returning();\n    return region;\n  }\n\n  async getRegions(state?: string) {\n    let query = db.select().from(riskRegions);\n    if (state) {\n      query = query.where(eq(riskRegions.state, state)) as any;\n    }\n    return query;\n  }\n\n  async calculateRiskAssessment(regionId: number, periodStart: Date, periodEnd: Date) {\n    const outcomes = await db.select().from(claimOutcomes)\n      .where(and(\n        gte(claimOutcomes.createdAt, periodStart),\n        lte(claimOutcomes.createdAt, periodEnd)\n      ));\n\n    if (outcomes.length < 10) {\n      throw new Error('Insufficient data for risk assessment');\n    }\n\n    const totalClaims = outcomes.length;\n    const avgSeverity = outcomes.reduce((sum, o) => sum + (o.claimAmount || 0), 0) / totalClaims;\n    \n    const damageTypes: Record<string, number> = {};\n    outcomes.forEach(o => {\n      damageTypes[o.claimType] = (damageTypes[o.claimType] || 0) + 1;\n    });\n\n    const riskScore = Math.min(100, (totalClaims / 10) * (avgSeverity / 50000) * 100);\n\n    const assessment: InsertRiskAssessment = {\n      regionId,\n      assessmentPeriod: `${periodStart.toISOString().split('T')[0]} to ${periodEnd.toISOString().split('T')[0]}`,\n      metrics: {\n        hailFrequency: damageTypes['hail'] || 0,\n        windDamageFrequency: damageTypes['wind'] || 0,\n        floodRisk: damageTypes['flood'] || 0,\n        avgClaimSeverity: avgSeverity,\n        avgPropertyAge: 0,\n        predominantRoofTypes: {},\n      },\n      riskScore,\n      riskCategory: riskScore < 30 ? 'low' : riskScore < 60 ? 'medium' : 'high',\n      trends: [],\n      sampleSize: totalClaims,\n      confidenceLevel: totalClaims > 50 ? 0.9 : totalClaims > 20 ? 0.7 : 0.5,\n    };\n\n    const [saved] = await db.insert(riskAssessments).values(assessment as any).returning();\n    return saved;\n  }\n\n  async getRegionRiskAssessments(regionId: number) {\n    return db.select().from(riskAssessments)\n      .where(eq(riskAssessments.regionId, regionId))\n      .orderBy(desc(riskAssessments.createdAt));\n  }\n\n  async createDataExport(data: InsertRiskDataExport) {\n    const [exportRecord] = await db.insert(riskDataExports).values(data).returning();\n    return exportRecord;\n  }\n\n  async getCarrierExports(carrierId: number) {\n    return db.select().from(riskDataExports)\n      .where(eq(riskDataExports.carrierId, carrierId))\n      .orderBy(desc(riskDataExports.createdAt));\n  }\n}\n\n// ============================================================================\n// 8. INNOVATION MODULE MANAGEMENT\n// ============================================================================\n\nexport class InnovationModuleService {\n  \n  async getAvailableModules() {\n    return db.select().from(innovationModules)\n      .orderBy(innovationModules.category, innovationModules.moduleName);\n  }\n\n  async getModuleByCode(moduleCode: string) {\n    const modules = await db.select().from(innovationModules)\n      .where(eq(innovationModules.moduleCode, moduleCode));\n    return modules[0] || null;\n  }\n\n  async createModule(data: InsertInnovationModule) {\n    const [module] = await db.insert(innovationModules).values(data as any).returning();\n    return module;\n  }\n\n  async enableModuleForOrg(orgId: number, moduleId: number, enabledBy: string) {\n    const [orgModule] = await db.insert(organizationModules).values({\n      organizationId: orgId,\n      moduleId,\n      enabled: true,\n      enabledBy,\n      enabledAt: new Date(),\n    }).returning();\n    return orgModule;\n  }\n\n  async disableModuleForOrg(orgId: number, moduleId: number) {\n    await db.update(organizationModules)\n      .set({ enabled: false })\n      .where(and(\n        eq(organizationModules.organizationId, orgId),\n        eq(organizationModules.moduleId, moduleId)\n      ));\n  }\n\n  async getOrgEnabledModules(orgId: number) {\n    return db.select({\n      module: innovationModules,\n      orgConfig: organizationModules,\n    })\n    .from(organizationModules)\n    .innerJoin(innovationModules, eq(organizationModules.moduleId, innovationModules.id))\n    .where(and(\n      eq(organizationModules.organizationId, orgId),\n      eq(organizationModules.enabled, true)\n    ));\n  }\n\n  async seedDefaultModules() {\n    const modules = [\n      {\n        moduleCode: 'predictive_claims',\n        moduleName: 'Predictive Claim Outcome Engine',\n        description: 'AI-powered claim success prediction using historical data and insurer patterns',\n        category: 'ai_intelligence',\n        status: 'preview',\n        requiredSubscription: 'enterprise',\n      },\n      {\n        moduleCode: 'field_copilot',\n        moduleName: 'Stormy Field Co-Pilot',\n        description: 'Real-time AI guidance during inspections with wearable integration',\n        category: 'field_operations',\n        status: 'preview',\n        requiredSubscription: 'professional',\n      },\n      {\n        moduleCode: 'iot_sensors',\n        moduleName: 'Smart Sensor Network',\n        description: 'Property monitoring sensors for moisture, impact, and environmental tracking',\n        category: 'iot_hardware',\n        status: 'coming_soon',\n        requiredSubscription: 'enterprise',\n      },\n      {\n        moduleCode: 'drone_integration',\n        moduleName: 'Drone Flight Integration',\n        description: 'Autonomous drone flights with thermal mapping and 3D modeling',\n        category: 'field_operations',\n        status: 'preview',\n        requiredSubscription: 'professional',\n      },\n      {\n        moduleCode: 'carrier_console',\n        moduleName: 'Insurance Carrier Console',\n        description: 'White-label portal for insurance companies to receive structured claims',\n        category: 'enterprise',\n        status: 'preview',\n        requiredSubscription: 'enterprise',\n      },\n      {\n        moduleCode: 'contractor_marketplace',\n        moduleName: 'Contractor Marketplace',\n        description: 'Matching verified contractors with property owners for repairs',\n        category: 'marketplace',\n        status: 'coming_soon',\n        requiredSubscription: 'professional',\n      },\n      {\n        moduleCode: 'risk_intelligence',\n        moduleName: 'Regional Risk Intelligence',\n        description: 'Anonymized data product for insurers and reinsurers',\n        category: 'data_products',\n        status: 'coming_soon',\n        requiredSubscription: 'enterprise',\n      },\n    ];\n\n    for (const mod of modules) {\n      await db.insert(innovationModules).values(mod as any)\n        .onConflictDoNothing();\n    }\n  }\n}\n\n// Export singleton instances\nexport const predictiveClaimEngine = new PredictiveClaimEngine();\nexport const fieldCopilotService = new FieldCopilotService();\nexport const iotSensorService = new IoTSensorService();\nexport const droneIntegrationService = new DroneIntegrationService();\nexport const carrierConsoleService = new CarrierConsoleService();\nexport const contractorMarketplaceService = new ContractorMarketplaceService();\nexport const riskIntelligenceService = new RiskIntelligenceService();\nexport const innovationModuleService = new InnovationModuleService();\n","path":null,"size_bytes":28832,"size_tokens":null},"server/voice-service.ts":{"content":"import OpenAI from \"openai\";\n\nconst openai = new OpenAI();\n\nexport const STORMY_VOICE = \"nova\";\nexport const VOICE_MODEL = \"tts-1\";\nexport const VOICE_MODEL_HD = \"tts-1-hd\";\n\nexport async function textToSpeech(\n  text: string,\n  options: {\n    voice?: \"alloy\" | \"echo\" | \"fable\" | \"onyx\" | \"nova\" | \"shimmer\";\n    model?: \"tts-1\" | \"tts-1-hd\";\n    speed?: number;\n  } = {}\n): Promise<Buffer> {\n  const { voice = STORMY_VOICE, model = VOICE_MODEL, speed = 1.0 } = options;\n\n  try {\n    const response = await openai.audio.speech.create({\n      model,\n      voice,\n      input: text,\n      speed,\n      response_format: \"mp3\",\n    });\n\n    const arrayBuffer = await response.arrayBuffer();\n    return Buffer.from(arrayBuffer);\n  } catch (error: any) {\n    console.error(\"Text-to-speech error:\", error);\n    throw new Error(`Failed to generate speech: ${error.message}`);\n  }\n}\n\nexport async function speechToText(\n  audioBuffer: Buffer,\n  options: {\n    language?: string;\n    prompt?: string;\n  } = {}\n): Promise<{ text: string; language?: string }> {\n  const { language, prompt } = options;\n\n  try {\n    const file = new File([audioBuffer], \"audio.webm\", { type: \"audio/webm\" });\n    \n    const transcription = await openai.audio.transcriptions.create({\n      file,\n      model: \"whisper-1\",\n      language,\n      prompt,\n      response_format: \"json\",\n    });\n\n    return {\n      text: transcription.text,\n    };\n  } catch (error: any) {\n    console.error(\"Speech-to-text error:\", error);\n    throw new Error(`Failed to transcribe audio: ${error.message}`);\n  }\n}\n\nexport async function processVoiceMessage(\n  audioBuffer: Buffer,\n  userId: string,\n  conversationId?: number,\n  imageUrl?: string\n): Promise<{\n  transcription: string;\n  response: string;\n  audioBuffer: Buffer;\n}> {\n  const stormyService = await import(\"./stormy-ai-service\");\n\n  const { text: transcription } = await speechToText(audioBuffer, {\n    prompt: \"This is a damage assessment inspection conversation about roofs, hail damage, thermal imaging, and the Winn Methodology.\",\n  });\n\n  const attachments = imageUrl\n    ? [{ type: \"image\" as const, url: imageUrl }]\n    : undefined;\n\n  const result = await stormyService.sendMessage({\n    userId,\n    message: transcription,\n    conversationId,\n    attachments,\n    contextType: imageUrl ? \"damage\" : \"general\",\n  });\n\n  const audioResponseBuffer = await textToSpeech(result.message.content, {\n    voice: STORMY_VOICE,\n    speed: 1.05,\n  });\n\n  return {\n    transcription,\n    response: result.message.content,\n    audioBuffer: audioResponseBuffer,\n  };\n}\n\nexport async function generateStormyGreeting(): Promise<Buffer> {\n  const greetings = [\n    \"Hey there! I'm Stormy, your AI inspection assistant. How can I help you today?\",\n    \"Hi! Stormy here, ready to help with your damage assessment. What are we looking at?\",\n    \"Hello! I'm Stormy. Show me what you're inspecting and I'll help you analyze it.\",\n  ];\n  \n  const greeting = greetings[Math.floor(Math.random() * greetings.length)];\n  return textToSpeech(greeting, { voice: STORMY_VOICE, speed: 1.0 });\n}\n\nexport async function speakStormyResponse(text: string): Promise<Buffer> {\n  const cleanedText = text\n    .replace(/\\*\\*/g, \"\")\n    .replace(/\\*/g, \"\")\n    .replace(/#{1,6}\\s/g, \"\")\n    .replace(/\\n{2,}/g, \". \")\n    .replace(/\\n/g, \" \")\n    .substring(0, 4096);\n\n  return textToSpeech(cleanedText, {\n    voice: STORMY_VOICE,\n    speed: 1.05,\n  });\n}\n","path":null,"size_bytes":3437,"size_tokens":null},"client/src/components/stormy-chat.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { useVoiceChat, VoiceChatState } from '@/hooks/use-voice-chat';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport {\n  MessageCircle,\n  Send,\n  Camera,\n  Image as ImageIcon,\n  X,\n  Loader2,\n  Sparkles,\n  Cloud,\n  Maximize2,\n  Minimize2,\n  Mic,\n  MicOff,\n  Volume2,\n  VolumeX,\n  Thermometer,\n  Eye,\n  Square\n} from 'lucide-react';\nimport type { AIConversation, AIMessage } from '@shared/schema';\n\ninterface StormyChatProps {\n  propertyId?: number;\n  inspectionId?: number;\n  contextType?: 'general' | 'inspection' | 'thermal' | 'damage';\n  initialOpen?: boolean;\n  position?: 'bottom-right' | 'inline' | 'modal';\n}\n\ninterface MessageAttachment {\n  type: 'image' | 'thermal';\n  url: string;\n  name?: string;\n}\n\ntype ConversationMessage = AIMessage & {\n  processingTime?: number | null;\n};\n\nexport function StormyChat({\n  propertyId,\n  inspectionId,\n  contextType = 'general',\n  initialOpen = false,\n  position = 'bottom-right'\n}: StormyChatProps) {\n  const [isOpen, setIsOpen] = useState(initialOpen);\n  const [isMaximized, setIsMaximized] = useState(false);\n  const [message, setMessage] = useState('');\n  const [attachments, setAttachments] = useState<MessageAttachment[]>([]);\n  const [conversationId, setConversationId] = useState<number | null>(null);\n  const [voiceModeEnabled, setVoiceModeEnabled] = useState(false);\n  const [autoSpeak, setAutoSpeak] = useState(true);\n  const [cameraMode, setCameraMode] = useState(false);\n  const [liveImageUrl, setLiveImageUrl] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const cameraInputRef = useRef<HTMLInputElement>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  const handleVoiceResponse = useCallback((text: string) => {\n    queryClient.invalidateQueries({ queryKey: ['/api/stormy/conversations'] });\n    if (conversationId) {\n      queryClient.invalidateQueries({ queryKey: ['/api/stormy/conversations', conversationId] });\n    }\n  }, [conversationId]);\n\n  const voiceChat = useVoiceChat({\n    conversationId: conversationId || undefined,\n    onResponse: handleVoiceResponse,\n  });\n\n  const { data: conversations, isLoading: loadingConversations } = useQuery<AIConversation[]>({\n    queryKey: ['/api/stormy/conversations'],\n    enabled: isOpen\n  });\n\n  const { data: conversationData, isLoading: loadingMessages } = useQuery<{\n    conversation: AIConversation;\n    messages: ConversationMessage[];\n  }>({\n    queryKey: ['/api/stormy/conversations', conversationId],\n    enabled: !!conversationId\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (data: {\n      message: string;\n      conversationId?: number;\n      attachments?: MessageAttachment[];\n      propertyId?: number;\n      inspectionId?: number;\n      contextType?: string;\n    }) => {\n      return apiRequest('/api/stormy/message', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data)\n      });\n    },\n    onSuccess: (result) => {\n      if (result.conversationId && !conversationId) {\n        setConversationId(result.conversationId);\n      }\n      queryClient.invalidateQueries({ queryKey: ['/api/stormy/conversations'] });\n      if (conversationId) {\n        queryClient.invalidateQueries({ queryKey: ['/api/stormy/conversations', conversationId] });\n      }\n      setMessage('');\n      setAttachments([]);\n    }\n  });\n\n  const analyzeImageMutation = useMutation({\n    mutationFn: async (data: {\n      imageUrl: string;\n      imageType: 'thermal' | 'damage' | 'general';\n      additionalContext?: string;\n    }) => {\n      return apiRequest('/api/stormy/analyze-image', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data)\n      });\n    }\n  });\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [conversationData?.messages]);\n\n  const handleSendMessage = () => {\n    if (!message.trim() && attachments.length === 0) return;\n\n    sendMessageMutation.mutate({\n      message: message.trim(),\n      conversationId: conversationId || undefined,\n      attachments: attachments.length > 0 ? attachments : undefined,\n      propertyId,\n      inspectionId,\n      contextType\n    });\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (!files) return;\n\n    Array.from(files).forEach(file => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const base64 = reader.result as string;\n        const isThermal = file.name.toLowerCase().includes('thermal') || \n                         file.name.toLowerCase().includes('flir') ||\n                         file.name.toLowerCase().includes('ir');\n        setAttachments(prev => [...prev, {\n          type: isThermal ? 'thermal' : 'image',\n          url: base64,\n          name: file.name\n        }]);\n      };\n      reader.readAsDataURL(file);\n    });\n    e.target.value = '';\n  };\n\n  const removeAttachment = (index: number) => {\n    setAttachments(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const startCamera = useCallback(async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }\n      });\n      streamRef.current = stream;\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        videoRef.current.play();\n      }\n      setCameraMode(true);\n    } catch (err) {\n      console.error('Failed to start camera:', err);\n    }\n  }, []);\n\n  const stopCamera = useCallback(() => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n    }\n    if (videoRef.current) {\n      videoRef.current.srcObject = null;\n    }\n    setCameraMode(false);\n    setLiveImageUrl(null);\n  }, []);\n\n  const captureFrame = useCallback(() => {\n    if (!videoRef.current || !canvasRef.current) return null;\n    \n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    \n    const ctx = canvas.getContext('2d');\n    if (!ctx) return null;\n    \n    ctx.drawImage(video, 0, 0);\n    const dataUrl = canvas.toDataURL('image/jpeg', 0.8);\n    setLiveImageUrl(dataUrl);\n    return dataUrl;\n  }, []);\n\n  const handleVoiceRecord = useCallback(async () => {\n    if (voiceChat.isRecording) {\n      let imageUrl: string | undefined;\n      if (cameraMode) {\n        const captured = captureFrame();\n        if (captured) {\n          imageUrl = captured;\n        }\n      }\n      await voiceChat.sendVoiceMessage(imageUrl, autoSpeak);\n    } else {\n      voiceChat.startRecording();\n    }\n  }, [voiceChat, cameraMode, captureFrame, autoSpeak]);\n\n  const handleSpeakLastResponse = useCallback(async () => {\n    const lastMessage = conversationData?.messages?.filter(m => m.role === 'assistant').pop();\n    if (lastMessage) {\n      await voiceChat.speakText(lastMessage.content);\n    }\n  }, [conversationData?.messages, voiceChat]);\n\n  useEffect(() => {\n    return () => {\n      stopCamera();\n    };\n  }, [stopCamera]);\n\n\n  const getVoiceStatusText = () => {\n    switch (voiceChat.state) {\n      case 'recording': return 'Listening...';\n      case 'processing': return 'Thinking...';\n      case 'speaking': return 'Speaking...';\n      default: return voiceModeEnabled ? 'Tap mic to speak' : '';\n    }\n  };\n\n  const getVoiceStatusColor = () => {\n    switch (voiceChat.state) {\n      case 'recording': return 'text-red-500';\n      case 'processing': return 'text-yellow-500';\n      case 'speaking': return 'text-green-500';\n      default: return 'text-muted-foreground';\n    }\n  };\n\n  const renderMessage = (msg: ConversationMessage) => {\n    const isUser = msg.role === 'user';\n\n    return (\n      <div\n        key={msg.id}\n        className={`flex gap-3 ${isUser ? 'flex-row-reverse' : ''}`}\n        data-testid={`stormy-message-${msg.id}`}\n      >\n        <Avatar className={`h-8 w-8 ${isUser ? 'bg-primary' : 'bg-gradient-to-br from-orange-500 to-orange-600'}`}>\n          <AvatarFallback className=\"text-white text-xs\">\n            {isUser ? 'U' : <Cloud className=\"h-4 w-4\" />}\n          </AvatarFallback>\n        </Avatar>\n        <div className={`flex-1 max-w-[80%] ${isUser ? 'text-right' : ''}`}>\n          <div\n            className={`rounded-lg p-3 ${\n              isUser \n                ? 'bg-primary text-primary-foreground ml-auto' \n                : 'bg-muted'\n            }`}\n          >\n            <p className=\"text-sm whitespace-pre-wrap\">{msg.content}</p>\n            {msg.attachments && Array.isArray(msg.attachments) && msg.attachments.length > 0 && (\n              <div className=\"flex flex-wrap gap-2 mt-2\">\n                {(msg.attachments as MessageAttachment[]).map((att, i) => (\n                  <div key={i} className=\"relative\">\n                    <img \n                      src={att.url} \n                      alt={att.name || 'Attachment'} \n                      className=\"h-16 w-16 rounded object-cover\"\n                    />\n                    {att.type === 'thermal' && (\n                      <Badge className=\"absolute -top-1 -right-1 h-5 px-1 text-[10px]\">\n                        <Thermometer className=\"h-3 w-3\" />\n                      </Badge>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n          <span className=\"text-xs text-muted-foreground mt-1 block\">\n            {new Date(msg.createdAt!).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n          </span>\n        </div>\n      </div>\n    );\n  };\n\n  const chatContent = (\n    <div className={`flex flex-col ${isMaximized ? 'h-[80vh]' : 'h-[400px]'}`}>\n      <ScrollArea className=\"flex-1 p-4\">\n        <div className=\"space-y-4\">\n          {!conversationData?.messages?.length && !loadingMessages && (\n            <div className=\"text-center py-8\">\n              <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center\">\n                <Cloud className=\"h-8 w-8 text-white\" />\n              </div>\n              <h3 className=\"font-semibold text-lg mb-2\">Hi, I'm Stormy!</h3>\n              <p className=\"text-muted-foreground text-sm max-w-sm mx-auto\">\n                Your AI inspection assistant. I can help with thermal analysis, \n                damage assessment, and guide you through the Winn Methodology.\n              </p>\n              <div className=\"flex flex-wrap justify-center gap-2 mt-4\">\n                <Badge variant=\"outline\" className=\"cursor-pointer hover:bg-muted\" onClick={() => setMessage(\"What's the Winn Methodology?\")}>\n                  <Sparkles className=\"h-3 w-3 mr-1\" /> Winn Methodology\n                </Badge>\n                <Badge variant=\"outline\" className=\"cursor-pointer hover:bg-muted\" onClick={() => setMessage(\"How do I analyze thermal images?\")}>\n                  <Thermometer className=\"h-3 w-3 mr-1\" /> Thermal Analysis\n                </Badge>\n                <Badge variant=\"outline\" className=\"cursor-pointer hover:bg-muted\" onClick={() => setMessage(\"Help me identify hail damage\")}>\n                  <Cloud className=\"h-3 w-3 mr-1\" /> Damage Types\n                </Badge>\n              </div>\n            </div>\n          )}\n\n          {conversationData?.messages?.map(renderMessage)}\n\n          {sendMessageMutation.isPending && (\n            <div className=\"flex gap-3\">\n              <Avatar className=\"h-8 w-8 bg-gradient-to-br from-orange-500 to-orange-600\">\n                <AvatarFallback className=\"text-white\">\n                  <Cloud className=\"h-4 w-4\" />\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex items-center gap-2 bg-muted rounded-lg px-4 py-3\">\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                <span className=\"text-sm text-muted-foreground\">Stormy is thinking...</span>\n              </div>\n            </div>\n          )}\n\n          <div ref={messagesEndRef} />\n        </div>\n      </ScrollArea>\n\n      {cameraMode && (\n        <div className=\"px-4 py-2 border-t bg-black/5\">\n          <div className=\"relative rounded-lg overflow-hidden\">\n            <video\n              ref={videoRef}\n              autoPlay\n              playsInline\n              muted\n              className=\"w-full h-32 object-cover\"\n              data-testid=\"stormy-camera-preview\"\n            />\n            <canvas ref={canvasRef} className=\"hidden\" />\n            {liveImageUrl && (\n              <div className=\"absolute top-2 right-2\">\n                <Badge className=\"bg-green-500\">Captured</Badge>\n              </div>\n            )}\n            <div className=\"absolute bottom-2 left-2 right-2 flex justify-between\">\n              <Button\n                size=\"sm\"\n                variant=\"secondary\"\n                onClick={captureFrame}\n                data-testid=\"button-capture-frame\"\n              >\n                <Camera className=\"h-3 w-3 mr-1\" /> Capture\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={stopCamera}\n                data-testid=\"button-stop-camera\"\n              >\n                <X className=\"h-3 w-3\" />\n              </Button>\n            </div>\n          </div>\n          <p className=\"text-xs text-muted-foreground mt-2 text-center\">\n            Ask \"What am I looking at?\" while recording\n          </p>\n        </div>\n      )}\n\n      {attachments.length > 0 && (\n        <div className=\"px-4 py-2 border-t\">\n          <div className=\"flex flex-wrap gap-2\">\n            {attachments.map((att, index) => (\n              <div key={index} className=\"relative group\">\n                <img \n                  src={att.url} \n                  alt={att.name || 'Attachment'} \n                  className=\"h-12 w-12 rounded object-cover border\"\n                />\n                <button\n                  onClick={() => removeAttachment(index)}\n                  className=\"absolute -top-1 -right-1 h-4 w-4 bg-destructive text-destructive-foreground rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\n                >\n                  <X className=\"h-3 w-3\" />\n                </button>\n                {att.type === 'thermal' && (\n                  <Badge className=\"absolute -bottom-1 left-1/2 -translate-x-1/2 h-4 px-1 text-[8px]\">\n                    IR\n                  </Badge>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {voiceModeEnabled && voiceChat.state !== 'idle' && (\n        <div className=\"px-4 py-2 border-t bg-muted/50\">\n          <div className=\"flex items-center justify-center gap-2\">\n            {voiceChat.state === 'recording' && (\n              <span className=\"flex items-center gap-2\">\n                <span className=\"h-2 w-2 bg-red-500 rounded-full animate-pulse\" />\n                <span className={`text-sm font-medium ${getVoiceStatusColor()}`}>\n                  {getVoiceStatusText()}\n                </span>\n              </span>\n            )}\n            {voiceChat.state === 'processing' && (\n              <span className=\"flex items-center gap-2\">\n                <Loader2 className=\"h-4 w-4 animate-spin text-yellow-500\" />\n                <span className={`text-sm font-medium ${getVoiceStatusColor()}`}>\n                  {getVoiceStatusText()}\n                </span>\n              </span>\n            )}\n            {voiceChat.state === 'speaking' && (\n              <span className=\"flex items-center gap-2\">\n                <Volume2 className=\"h-4 w-4 text-green-500 animate-pulse\" />\n                <span className={`text-sm font-medium ${getVoiceStatusColor()}`}>\n                  {getVoiceStatusText()}\n                </span>\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={voiceChat.stopSpeaking}\n                  data-testid=\"button-stop-speaking\"\n                >\n                  <Square className=\"h-3 w-3\" />\n                </Button>\n              </span>\n            )}\n          </div>\n        </div>\n      )}\n\n      <div className=\"p-4 border-t\">\n        <div className=\"flex items-center gap-2 mb-3\">\n          <div className=\"flex items-center gap-2\">\n            <Switch\n              id=\"voice-mode\"\n              checked={voiceModeEnabled}\n              onCheckedChange={setVoiceModeEnabled}\n              data-testid=\"switch-voice-mode\"\n            />\n            <Label htmlFor=\"voice-mode\" className=\"text-xs\">Voice</Label>\n          </div>\n          {voiceModeEnabled && (\n            <>\n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  id=\"auto-speak\"\n                  checked={autoSpeak}\n                  onCheckedChange={setAutoSpeak}\n                  data-testid=\"switch-auto-speak\"\n                />\n                <Label htmlFor=\"auto-speak\" className=\"text-xs\">Auto-speak</Label>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={cameraMode ? stopCamera : startCamera}\n                data-testid=\"button-toggle-camera\"\n              >\n                <Eye className=\"h-3 w-3 mr-1\" />\n                {cameraMode ? 'Stop' : 'Camera'}\n              </Button>\n            </>\n          )}\n        </div>\n\n        <div className=\"flex gap-2\">\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/*\"\n            multiple\n            className=\"hidden\"\n            onChange={handleFileSelect}\n            data-testid=\"stormy-file-input\"\n          />\n          \n          {!voiceModeEnabled ? (\n            <>\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={() => fileInputRef.current?.click()}\n                disabled={sendMessageMutation.isPending}\n                data-testid=\"button-attach-image\"\n              >\n                <Camera className=\"h-4 w-4\" />\n              </Button>\n              <Input\n                value={message}\n                onChange={(e) => setMessage(e.target.value)}\n                onKeyPress={handleKeyPress}\n                placeholder=\"Ask Stormy anything...\"\n                disabled={sendMessageMutation.isPending}\n                className=\"flex-1\"\n                data-testid=\"input-stormy-message\"\n              />\n              <Button\n                onClick={handleSendMessage}\n                disabled={(!message.trim() && attachments.length === 0) || sendMessageMutation.isPending}\n                data-testid=\"button-send-message\"\n              >\n                {sendMessageMutation.isPending ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                ) : (\n                  <Send className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </>\n          ) : (\n            <div className=\"flex-1 flex items-center justify-center gap-4\">\n              <Button\n                variant={voiceChat.isRecording ? \"destructive\" : \"default\"}\n                size=\"lg\"\n                className={`h-14 w-14 rounded-full ${voiceChat.isRecording ? 'animate-pulse' : ''}`}\n                onClick={handleVoiceRecord}\n                disabled={voiceChat.isProcessing || voiceChat.isSpeaking}\n                data-testid=\"button-voice-record\"\n              >\n                {voiceChat.isRecording ? (\n                  <MicOff className=\"h-6 w-6\" />\n                ) : voiceChat.isProcessing ? (\n                  <Loader2 className=\"h-6 w-6 animate-spin\" />\n                ) : (\n                  <Mic className=\"h-6 w-6\" />\n                )}\n              </Button>\n              \n              {conversationData?.messages?.some(m => m.role === 'assistant') && (\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  onClick={handleSpeakLastResponse}\n                  disabled={voiceChat.isSpeaking || voiceChat.isProcessing}\n                  data-testid=\"button-speak-last\"\n                >\n                  <Volume2 className=\"h-4 w-4\" />\n                </Button>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n\n  if (position === 'inline') {\n    return (\n      <Card className=\"w-full\" data-testid=\"stormy-chat-inline\">\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"flex items-center gap-2 text-lg\">\n            <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center\">\n              <Cloud className=\"h-4 w-4 text-white\" />\n            </div>\n            Stormy AI Assistant\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          {chatContent}\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (position === 'modal') {\n    return (\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\n        <DialogTrigger asChild>\n          <Button\n            size=\"icon\"\n            className=\"h-12 w-12 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 shadow-lg\"\n            data-testid=\"button-open-stormy-modal\"\n          >\n            <Cloud className=\"h-6 w-6 text-white\" />\n          </Button>\n        </DialogTrigger>\n        <DialogContent className=\"max-w-2xl p-0\">\n          <DialogHeader className=\"p-4 border-b\">\n            <DialogTitle className=\"flex items-center gap-2\">\n              <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center\">\n                <Cloud className=\"h-4 w-4 text-white\" />\n              </div>\n              Stormy AI Assistant\n            </DialogTitle>\n          </DialogHeader>\n          {chatContent}\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  return (\n    <>\n      {!isOpen && (\n        <button\n          onClick={() => setIsOpen(true)}\n          className=\"fixed bottom-6 right-6 h-14 w-14 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 shadow-lg flex items-center justify-center transition-all hover:scale-105 z-50\"\n          data-testid=\"button-open-stormy\"\n        >\n          <Cloud className=\"h-7 w-7 text-white\" />\n          <span className=\"absolute top-0 right-0 h-3 w-3 bg-green-500 rounded-full border-2 border-white\" />\n        </button>\n      )}\n\n      {isOpen && (\n        <div\n          className={`fixed ${isMaximized ? 'inset-4' : 'bottom-6 right-6 w-96'} bg-background border rounded-lg shadow-2xl z-50 transition-all duration-200`}\n          data-testid=\"stormy-chat-panel\"\n        >\n          <div className=\"flex items-center justify-between p-3 border-b bg-gradient-to-r from-orange-500 to-orange-600 rounded-t-lg\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"h-8 w-8 rounded-full bg-white/20 flex items-center justify-center\">\n                <Cloud className=\"h-4 w-4 text-white\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-white text-sm\">Stormy</h3>\n                <p className=\"text-xs text-white/80\">AI Inspection Assistant</p>\n              </div>\n            </div>\n            <div className=\"flex gap-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-8 w-8 text-white hover:bg-white/20\"\n                onClick={() => setIsMaximized(!isMaximized)}\n                data-testid=\"button-toggle-maximize\"\n              >\n                {isMaximized ? <Minimize2 className=\"h-4 w-4\" /> : <Maximize2 className=\"h-4 w-4\" />}\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-8 w-8 text-white hover:bg-white/20\"\n                onClick={() => setIsOpen(false)}\n                data-testid=\"button-close-stormy\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          {chatContent}\n        </div>\n      )}\n    </>\n  );\n}","path":null,"size_bytes":25440,"size_tokens":null},"client/src/pages/service-landing.tsx":{"content":"import { Header, Footer } from '@/components/navbar';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { SEO } from '@/components/seo';\nimport { Link } from 'wouter';\nimport { \n  Shield, CheckCircle, Phone, ArrowRight, Star,\n  Thermometer, CloudLightning, Droplets, Wind,\n  FileText, Camera, Target, Zap, Award, Clock,\n  Building2, Home, Ruler, AlertTriangle\n} from 'lucide-react';\n\ninterface ServiceConfig {\n  id: string;\n  name: string;\n  slug: string;\n  tagline: string;\n  description: string;\n  metaDescription: string;\n  keywords: string[];\n  icon: typeof Thermometer;\n  heroColor: string;\n  benefits: Array<{\n    icon: typeof Shield;\n    title: string;\n    description: string;\n  }>;\n  process: Array<{\n    step: string;\n    title: string;\n    description: string;\n  }>;\n  useCases: string[];\n  faqs: Array<{\n    question: string;\n    answer: string;\n  }>;\n}\n\nconst serviceConfigs: Record<string, ServiceConfig> = {\n  'thermal-inspection': {\n    id: 'thermal-inspection',\n    name: 'Thermal Inspection Services',\n    slug: 'thermal-inspection',\n    tagline: 'See What the Naked Eye Cannot',\n    description: 'Our AI-powered thermal imaging technology detects hidden moisture, insulation deficiencies, and structural damage invisible to standard visual inspections. Using FLIR-certified equipment and the proven Winn Methodology, we provide comprehensive thermal analysis for residential and commercial properties.',\n    metaDescription: 'Professional thermal imaging inspection services for property damage assessment. AI-powered thermal cameras detect hidden moisture, heat loss, and structural issues. FLIR-certified equipment with comprehensive reporting.',\n    keywords: [\n      'thermal inspection services',\n      'thermal imaging property inspection',\n      'infrared building inspection',\n      'moisture detection thermal camera',\n      'FLIR thermal inspection',\n      'thermal roof inspection',\n      'heat loss detection',\n      'thermal imaging for insurance claims'\n    ],\n    icon: Thermometer,\n    heroColor: 'from-red-600 to-orange-500',\n    benefits: [\n      {\n        icon: Droplets,\n        title: 'Hidden Moisture Detection',\n        description: 'Identify water intrusion behind walls, under roofing, and in ceiling cavities before visible damage occurs.'\n      },\n      {\n        icon: Zap,\n        title: 'Energy Loss Identification',\n        description: 'Pinpoint areas of heat loss, thermal bridging, and insulation gaps costing you money.'\n      },\n      {\n        icon: AlertTriangle,\n        title: 'Electrical Hotspot Detection',\n        description: 'Locate overheating electrical components and potential fire hazards in your property.'\n      },\n      {\n        icon: FileText,\n        title: 'Insurance-Ready Reports',\n        description: 'Comprehensive thermal analysis reports formatted for insurance claims with AI-generated insights.'\n      }\n    ],\n    process: [\n      { step: '1', title: 'Pre-Inspection Analysis', description: 'Review property details and identify optimal thermal imaging conditions' },\n      { step: '2', title: 'Thermal Scanning', description: 'Systematic thermal imaging of all exterior and interior surfaces' },\n      { step: '3', title: 'AI Analysis', description: 'Stormy AI processes thermal data to identify anomalies automatically' },\n      { step: '4', title: 'Detailed Reporting', description: 'Receive comprehensive thermal analysis with actionable recommendations' }\n    ],\n    useCases: [\n      'Post-storm moisture intrusion assessment',\n      'Pre-purchase property inspections',\n      'Roof leak detection and tracing',\n      'HVAC efficiency evaluation',\n      'Flat roof membrane inspection',\n      'Electrical system safety audits',\n      'Energy audit and weatherization',\n      'Insurance claim documentation'\n    ],\n    faqs: [\n      {\n        question: 'What can thermal imaging detect that visual inspection cannot?',\n        answer: 'Thermal imaging detects temperature variations that reveal hidden issues: moisture behind walls and ceilings, missing or damaged insulation, thermal bridging, air leaks, electrical hotspots, and plumbing leaks - all before they cause visible damage or become major problems.'\n      },\n      {\n        question: 'How accurate is thermal imaging for detecting roof leaks?',\n        answer: 'When performed under proper conditions (after sunset, minimal wind, recent solar exposure), thermal imaging is extremely accurate for detecting moisture in roofing systems. Our FLIR-certified equipment can detect temperature differentials as small as 0.1°C, pinpointing moisture locations with precision.'\n      },\n      {\n        question: 'Will thermal inspection work for my insurance claim?',\n        answer: 'Yes, our thermal inspection reports are specifically formatted for insurance claims. We follow the Winn Methodology standards and provide AI-analyzed evidence with clear documentation that insurance adjusters recognize and accept.'\n      },\n      {\n        question: 'How long does a thermal inspection take?',\n        answer: 'A typical residential thermal inspection takes 2-4 hours depending on property size. Commercial properties may require 4-8 hours. We schedule inspections during optimal thermal imaging conditions (typically early morning or after sunset) for the most accurate results.'\n      }\n    ]\n  },\n  'hail-damage-assessment': {\n    id: 'hail-damage-assessment',\n    name: 'Hail Damage Assessment',\n    slug: 'hail-damage-assessment',\n    tagline: 'Document Every Impact, Maximize Your Claim',\n    description: 'Hail damage can be subtle yet devastating to your roof and property. Our certified consultants use the 8-step Winn Methodology to systematically document hail impacts, measure damage density, and create comprehensive reports that insurance companies trust for fair settlements.',\n    metaDescription: 'Professional hail damage assessment services using the proven Winn Methodology. Certified consultants document hail impacts with thermal imaging and test square analysis for maximum insurance claim settlements.',\n    keywords: [\n      'hail damage assessment',\n      'hail damage roof inspection',\n      'hail damage consultant',\n      'hail damage insurance claim',\n      'hail impact documentation',\n      'roof hail damage inspection',\n      'certified hail damage assessor',\n      'hail storm property damage'\n    ],\n    icon: CloudLightning,\n    heroColor: 'from-blue-600 to-cyan-500',\n    benefits: [\n      {\n        icon: Target,\n        title: 'Test Square Analysis',\n        description: 'Industry-standard 10x10 test squares to accurately quantify damage density across your entire roof.'\n      },\n      {\n        icon: Camera,\n        title: 'Comprehensive Photo Documentation',\n        description: 'GPS-tagged photography of every impact point, soft metal damage, and affected component.'\n      },\n      {\n        icon: Thermometer,\n        title: 'Thermal Moisture Detection',\n        description: 'Identify moisture intrusion from hail penetration using advanced thermal imaging technology.'\n      },\n      {\n        icon: Shield,\n        title: 'Insurance Advocacy',\n        description: 'Reports designed to support your claim with evidence that adjusters cannot dispute.'\n      }\n    ],\n    process: [\n      { step: '1', title: 'Weather Verification', description: 'Confirm hail event occurred using NOAA and NWS historical data' },\n      { step: '2', title: 'Ground-Level Assessment', description: 'Document soft metal damage to gutters, vents, and AC units' },\n      { step: '3', title: 'Roof Test Squares', description: 'Systematic damage density measurement across all roof sections' },\n      { step: '4', title: 'Winn Report Generation', description: 'Compile all evidence into a comprehensive, defensible report' }\n    ],\n    useCases: [\n      'Recent hail storm damage documentation',\n      'Disputed insurance claims',\n      'Pre-listing roof inspections after storms',\n      'Commercial property hail assessment',\n      'Multi-family dwelling inspections',\n      'Agricultural facility damage assessment',\n      'Vehicle damage correlation',\n      'Historical storm damage claims'\n    ],\n    faqs: [\n      {\n        question: 'How soon after a hail storm should I get an assessment?',\n        answer: 'We recommend getting an assessment within 30-60 days of a hail event. While damage can be documented years later, earlier assessment ensures fresher evidence and easier correlation to specific storm events. Many insurance policies have time limits for filing claims.'\n      },\n      {\n        question: 'What size hail causes roof damage?',\n        answer: 'Hail as small as 1 inch (quarter-sized) can damage asphalt shingles. The Winn Methodology documents damage from hail of all sizes, as cumulative smaller impacts can cause significant deterioration. Our thermal imaging also detects underlying moisture damage from hail penetration.'\n      },\n      {\n        question: 'Will a hail damage assessment help my insurance claim?',\n        answer: 'Absolutely. Our Winn Reports provide the detailed, defensible documentation insurance companies require. We include weather verification, test square measurements, photographic evidence, and damage quantification that has helped thousands of property owners receive fair claim settlements.'\n      },\n      {\n        question: 'What if my insurance company already denied my claim?',\n        answer: 'A professional Winn Report can provide new evidence to support an appeal or appraisal process. Our comprehensive documentation often reveals damage that initial adjuster inspections missed, especially moisture intrusion detected through thermal imaging.'\n      }\n    ]\n  },\n  'storm-damage-consulting': {\n    id: 'storm-damage-consulting',\n    name: 'Storm Damage Consulting',\n    slug: 'storm-damage-consulting',\n    tagline: 'Expert Guidance Through the Claims Process',\n    description: 'From hurricanes to tornadoes, our certified storm damage consultants provide expert assessment and advocacy for all types of weather-related property damage. We combine decades of experience with cutting-edge AI technology to document damage thoroughly and guide you through the insurance claims process.',\n    metaDescription: 'Professional storm damage consulting services for hurricanes, tornadoes, wind, and flood damage. Certified consultants provide expert assessment, documentation, and insurance claim guidance using the Winn Methodology.',\n    keywords: [\n      'storm damage consultant',\n      'hurricane damage assessment',\n      'tornado damage inspection',\n      'wind damage property assessment',\n      'storm damage insurance claim',\n      'property damage consultant',\n      'weather damage expert',\n      'storm restoration consultant'\n    ],\n    icon: Wind,\n    heroColor: 'from-purple-600 to-indigo-500',\n    benefits: [\n      {\n        icon: Award,\n        title: 'Winn Methodology Certified',\n        description: 'Our consultants are trained in the industry gold standard for storm damage assessment and documentation.'\n      },\n      {\n        icon: Building2,\n        title: 'All Property Types',\n        description: 'Residential, commercial, industrial, and multi-family property expertise for comprehensive damage assessment.'\n      },\n      {\n        icon: FileText,\n        title: 'Claims Support',\n        description: 'End-to-end guidance through the insurance claims process with documentation that gets results.'\n      },\n      {\n        icon: Zap,\n        title: 'Rapid Response',\n        description: '24-48 hour deployment for emergency assessments after major storm events.'\n      }\n    ],\n    process: [\n      { step: '1', title: 'Emergency Assessment', description: 'Rapid initial inspection to document immediate damage and safety concerns' },\n      { step: '2', title: 'Comprehensive Inspection', description: 'Full 8-step Winn Methodology assessment with thermal imaging' },\n      { step: '3', title: 'Damage Quantification', description: 'Detailed cost analysis and repair scope development' },\n      { step: '4', title: 'Claims Advocacy', description: 'Support through the insurance process including adjuster meetings' }\n    ],\n    useCases: [\n      'Hurricane and tropical storm damage',\n      'Tornado damage assessment',\n      'Straight-line wind damage',\n      'Flood and water damage documentation',\n      'Lightning strike damage',\n      'Tree and debris impact damage',\n      'Commercial property restoration consulting',\n      'Catastrophic loss documentation'\n    ],\n    faqs: [\n      {\n        question: 'What types of storm damage do you assess?',\n        answer: 'We assess all weather-related damage including: hail, wind (straight-line and tornadic), hurricane, tropical storm, flooding, lightning strikes, ice storms, and any combination of these events. Our consultants are trained to document and differentiate between damage types.'\n      },\n      {\n        question: 'How is storm damage consulting different from a regular inspection?',\n        answer: 'Storm damage consulting goes beyond simple inspection. We provide comprehensive damage documentation, repair scope development, cost analysis, and advocacy throughout the insurance claims process. Our goal is ensuring you receive fair compensation for all storm-related damage.'\n      },\n      {\n        question: 'Can you help with both residential and commercial properties?',\n        answer: 'Yes, our certified consultants have experience with all property types: single-family homes, multi-family dwellings, commercial buildings, industrial facilities, agricultural structures, and institutional properties. We tailor our approach to each property\\'s unique requirements.'\n      },\n      {\n        question: 'What should I do immediately after storm damage occurs?',\n        answer: 'First, ensure safety and document any emergency repairs needed. Take photos and videos of visible damage. Contact your insurance company to report the claim, then schedule a professional assessment. Avoid making permanent repairs until damage is properly documented.'\n      }\n    ]\n  }\n};\n\nconst generateServiceSchema = (service: ServiceConfig) => {\n  return {\n    \"@context\": \"https://schema.org\",\n    \"@type\": \"Service\",\n    \"name\": service.name,\n    \"description\": service.description,\n    \"provider\": {\n      \"@type\": \"Organization\",\n      \"name\": \"WinnStorm™\",\n      \"url\": \"https://winnstorm.com\"\n    },\n    \"serviceType\": service.name,\n    \"areaServed\": {\n      \"@type\": \"Country\",\n      \"name\": \"United States\"\n    },\n    \"hasOfferCatalog\": {\n      \"@type\": \"OfferCatalog\",\n      \"name\": `${service.name} Packages`,\n      \"itemListElement\": [\n        {\n          \"@type\": \"Offer\",\n          \"itemOffered\": {\n            \"@type\": \"Service\",\n            \"name\": `Basic ${service.name}`\n          }\n        },\n        {\n          \"@type\": \"Offer\",\n          \"itemOffered\": {\n            \"@type\": \"Service\",\n            \"name\": `Comprehensive ${service.name}`\n          }\n        }\n      ]\n    }\n  };\n};\n\nconst generateFAQSchema = (faqs: ServiceConfig['faqs']) => {\n  return {\n    \"@context\": \"https://schema.org\",\n    \"@type\": \"FAQPage\",\n    \"mainEntity\": faqs.map(faq => ({\n      \"@type\": \"Question\",\n      \"name\": faq.question,\n      \"acceptedAnswer\": {\n        \"@type\": \"Answer\",\n        \"text\": faq.answer\n      }\n    }))\n  };\n};\n\nexport function ServiceLandingPage({ serviceSlug }: { serviceSlug: string }) {\n  const service = serviceConfigs[serviceSlug];\n  \n  if (!service) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <p>Service not found</p>\n      </div>\n    );\n  }\n\n  const ServiceIcon = service.icon;\n  const serviceSchema = generateServiceSchema(service);\n  const faqSchema = generateFAQSchema(service.faqs);\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\" data-testid={`service-page-${serviceSlug}`}>\n      <SEO\n        title={`${service.name} - Professional Property Assessment | WinnStorm`}\n        description={service.metaDescription}\n        canonical={`/services/${service.slug}`}\n        keywords={service.keywords}\n      />\n      \n      <script\n        type=\"application/ld+json\"\n        dangerouslySetInnerHTML={{ __html: JSON.stringify(serviceSchema) }}\n      />\n      <script\n        type=\"application/ld+json\"\n        dangerouslySetInnerHTML={{ __html: JSON.stringify(faqSchema) }}\n      />\n      \n      <Header />\n      \n      <main className=\"flex-grow\">\n        {/* Hero Section */}\n        <section className={`py-20 px-6 bg-gradient-to-br ${service.heroColor} text-white relative overflow-hidden`}>\n          <div className=\"absolute inset-0 opacity-20\">\n            <div className=\"absolute top-20 left-[10%] w-72 h-72 bg-white/20 rounded-full blur-3xl\"></div>\n            <div className=\"absolute bottom-10 right-[15%] w-96 h-96 bg-white/10 rounded-full blur-3xl\"></div>\n          </div>\n          \n          <div className=\"max-w-6xl mx-auto relative z-10\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <ServiceIcon className=\"h-6 w-6\" />\n              <Badge variant=\"secondary\" className=\"bg-white/20 text-white border-white/30\">\n                Professional Service\n              </Badge>\n            </div>\n            \n            <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold mb-4\">\n              {service.name}\n            </h1>\n            <p className=\"text-2xl opacity-90 mb-6\">{service.tagline}</p>\n            \n            <p className=\"text-lg opacity-80 max-w-3xl mb-8\">\n              {service.description}\n            </p>\n\n            <div className=\"flex flex-wrap gap-4\">\n              <Link href=\"/auth\">\n                <Button size=\"lg\" variant=\"secondary\" className=\"text-gray-900\" data-testid=\"button-get-started\">\n                  Get Free Assessment\n                  <ArrowRight className=\"h-5 w-5 ml-2\" />\n                </Button>\n              </Link>\n              <Link href=\"/methodology\">\n                <Button size=\"lg\" variant=\"outline\" className=\"border-white text-white hover:bg-white hover:text-gray-900\">\n                  Learn the Methodology\n                </Button>\n              </Link>\n            </div>\n          </div>\n        </section>\n\n        {/* Benefits Section */}\n        <section className=\"py-16 px-6 bg-background\">\n          <div className=\"max-w-6xl mx-auto\">\n            <h2 className=\"text-3xl font-bold text-center mb-4\">\n              Why Choose WinnStorm {service.name}\n            </h2>\n            <p className=\"text-muted-foreground text-center mb-12 max-w-2xl mx-auto\">\n              Industry-leading technology combined with certified expertise for accurate, defensible assessments.\n            </p>\n            \n            <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {service.benefits.map((benefit, index) => {\n                const BenefitIcon = benefit.icon;\n                return (\n                  <Card key={index} className=\"border-border/50 hover:shadow-lg transition-shadow\">\n                    <CardHeader>\n                      <BenefitIcon className=\"h-10 w-10 text-primary mb-2\" />\n                      <CardTitle className=\"text-lg\">{benefit.title}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-muted-foreground text-sm\">{benefit.description}</p>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n        </section>\n\n        {/* Process Section */}\n        <section className=\"py-16 px-6 bg-muted/30\">\n          <div className=\"max-w-6xl mx-auto\">\n            <h2 className=\"text-3xl font-bold text-center mb-4\">\n              Our {service.name} Process\n            </h2>\n            <p className=\"text-muted-foreground text-center mb-12 max-w-2xl mx-auto\">\n              A systematic approach using the proven Winn Methodology for thorough, professional results.\n            </p>\n            \n            <div className=\"grid md:grid-cols-4 gap-6\">\n              {service.process.map((step, index) => (\n                <div key={index} className=\"text-center\">\n                  <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4\">\n                    <span className=\"text-2xl font-bold text-primary\">{step.step}</span>\n                  </div>\n                  <h3 className=\"font-bold text-lg mb-2\">{step.title}</h3>\n                  <p className=\"text-sm text-muted-foreground\">{step.description}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Use Cases Section */}\n        <section className=\"py-16 px-6 bg-background\">\n          <div className=\"max-w-6xl mx-auto\">\n            <h2 className=\"text-3xl font-bold text-center mb-4\">\n              When You Need {service.name}\n            </h2>\n            <p className=\"text-muted-foreground text-center mb-12 max-w-2xl mx-auto\">\n              Common situations where professional assessment makes all the difference.\n            </p>\n            \n            <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-4 max-w-5xl mx-auto\">\n              {service.useCases.map((useCase, index) => (\n                <div key={index} className=\"flex items-start gap-3 p-4 bg-muted/30 rounded-lg\">\n                  <CheckCircle className=\"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0\" />\n                  <span className=\"text-sm\">{useCase}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* FAQ Section */}\n        <section className=\"py-16 px-6 bg-muted/30\">\n          <div className=\"max-w-4xl mx-auto\">\n            <h2 className=\"text-3xl font-bold text-center mb-4\">\n              Frequently Asked Questions\n            </h2>\n            <p className=\"text-muted-foreground text-center mb-12\">\n              Get answers to common questions about our {service.name.toLowerCase()}.\n            </p>\n            \n            <div className=\"space-y-6\">\n              {service.faqs.map((faq, index) => (\n                <Card key={index} className=\"border-border/50\">\n                  <CardHeader>\n                    <CardTitle className=\"text-lg font-semibold\">{faq.question}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-muted-foreground\">{faq.answer}</p>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Social Proof */}\n        <section className=\"py-16 px-6 bg-background\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <div className=\"flex justify-center gap-1 mb-4\">\n              {[1, 2, 3, 4, 5].map((star) => (\n                <Star key={star} className=\"h-6 w-6 fill-primary text-primary\" />\n              ))}\n            </div>\n            <p className=\"text-2xl font-bold mb-2\">4.9 out of 5 stars</p>\n            <p className=\"text-muted-foreground mb-8\">Trusted by thousands of property owners nationwide</p>\n            \n            <div className=\"flex flex-wrap justify-center gap-8\">\n              <div className=\"text-center\">\n                <p className=\"text-3xl font-bold text-primary\">15,000+</p>\n                <p className=\"text-sm text-muted-foreground\">Inspections Completed</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"text-3xl font-bold text-primary\">$50M+</p>\n                <p className=\"text-sm text-muted-foreground\">Claims Recovered</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"text-3xl font-bold text-primary\">500+</p>\n                <p className=\"text-sm text-muted-foreground\">Certified Consultants</p>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* CTA Section */}\n        <section className=\"section-dark py-16 px-6\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <h2 className=\"text-3xl font-bold text-white mb-6\">\n              Ready for Your {service.name}?\n            </h2>\n            <p className=\"text-lg text-white/70 mb-8\">\n              Schedule your free consultation with a certified WinnStorm damage assessment consultant today.\n            </p>\n            <div className=\"flex flex-wrap justify-center gap-4\">\n              <Link href=\"/auth\">\n                <Button className=\"btn-primary\" size=\"lg\" data-testid=\"button-cta-bottom\">\n                  Get Started Now\n                  <ArrowRight className=\"h-5 w-5 ml-2\" />\n                </Button>\n              </Link>\n              <Link href=\"/pricing\">\n                <Button variant=\"outline\" className=\"btn-secondary\" size=\"lg\">\n                  View Pricing\n                </Button>\n              </Link>\n            </div>\n            \n            <div className=\"mt-12 flex flex-wrap justify-center gap-8 text-white/60\">\n              <div className=\"flex items-center gap-2\">\n                <Clock className=\"h-4 w-4\" />\n                <span>24-48 Hour Response</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Shield className=\"h-4 w-4\" />\n                <span>Winn Methodology Certified</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Phone className=\"h-4 w-4\" />\n                <span>(800) WINNSTORM</span>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Related Services */}\n        <section className=\"py-16 px-6 bg-background\">\n          <div className=\"max-w-6xl mx-auto\">\n            <h2 className=\"text-2xl font-bold text-center mb-8\">Related Services</h2>\n            <div className=\"grid md:grid-cols-3 gap-6\">\n              {Object.values(serviceConfigs)\n                .filter(s => s.id !== service.id)\n                .map((relatedService) => {\n                  const RelatedIcon = relatedService.icon;\n                  return (\n                    <Link key={relatedService.id} href={`/services/${relatedService.slug}`}>\n                      <Card className=\"border-border/50 hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                        <CardContent className=\"p-6\">\n                          <RelatedIcon className=\"h-8 w-8 text-primary mb-4\" />\n                          <h3 className=\"font-bold mb-2\">{relatedService.name}</h3>\n                          <p className=\"text-sm text-muted-foreground mb-4\">{relatedService.tagline}</p>\n                          <span className=\"text-primary text-sm font-medium flex items-center\">\n                            Learn More <ArrowRight className=\"h-4 w-4 ml-1\" />\n                          </span>\n                        </CardContent>\n                      </Card>\n                    </Link>\n                  );\n                })}\n            </div>\n          </div>\n        </section>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}\n\nexport function ThermalInspectionPage() {\n  return <ServiceLandingPage serviceSlug=\"thermal-inspection\" />;\n}\n\nexport function HailDamageAssessmentPage() {\n  return <ServiceLandingPage serviceSlug=\"hail-damage-assessment\" />;\n}\n\nexport function StormDamageConsultingPage() {\n  return <ServiceLandingPage serviceSlug=\"storm-damage-consulting\" />;\n}\n","path":null,"size_bytes":27663,"size_tokens":null},"server/innovation-routes.ts":{"content":"import { Router, Request, Response } from \"express\";\nimport { z } from \"zod\";\nimport {\n  predictiveClaimEngine,\n  fieldCopilotService,\n  iotSensorService,\n  droneIntegrationService,\n  carrierConsoleService,\n  contractorMarketplaceService,\n  riskIntelligenceService,\n  innovationModuleService,\n} from \"./innovation-services\";\nimport {\n  insertClaimOutcomeSchema,\n  insertFieldCopilotSessionSchema,\n  insertWearableDeviceSchema,\n  insertIotDeviceSchema,\n  insertSensorReadingSchema,\n  insertDronePilotSchema,\n  insertDroneAssetSchema,\n  insertFlightSessionSchema,\n  insertCarrierAccountSchema,\n  insertCarrierUserSchema,\n  insertCarrierClaimSubmissionSchema,\n  insertContractorProfileSchema,\n  insertRepairJobSchema,\n  insertContractorBidSchema,\n  insertReferralFeeSchema,\n  insertRiskRegionSchema,\n  insertRiskDataExportSchema,\n} from \"@shared/schema\";\n\nconst router = Router();\n\n// Validation helper\nfunction validateBody<T>(schema: z.ZodSchema<T>, body: unknown): { success: true; data: T } | { success: false; error: string } {\n  const result = schema.safeParse(body);\n  if (!result.success) {\n    return { success: false, error: result.error.errors.map(e => `${e.path.join('.')}: ${e.message}`).join(', ') };\n  }\n  return { success: true, data: result.data };\n}\n\n// ============================================================================\n// INNOVATION MODULE MANAGEMENT\n// ============================================================================\n\nrouter.get(\"/modules\", async (req: Request, res: Response) => {\n  try {\n    const modules = await innovationModuleService.getAvailableModules();\n    res.json(modules);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/modules/:code\", async (req: Request, res: Response) => {\n  try {\n    const module = await innovationModuleService.getModuleByCode(req.params.code);\n    if (!module) {\n      return res.status(404).json({ error: \"Module not found\" });\n    }\n    res.json(module);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/modules/seed\", async (req: Request, res: Response) => {\n  try {\n    await innovationModuleService.seedDefaultModules();\n    res.json({ message: \"Default modules seeded successfully\" });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/modules/:moduleId/enable\", async (req: Request, res: Response) => {\n  try {\n    const { orgId, enabledBy } = req.body;\n    const result = await innovationModuleService.enableModuleForOrg(\n      orgId,\n      parseInt(req.params.moduleId),\n      enabledBy\n    );\n    res.json(result);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============================================================================\n// PREDICTIVE CLAIM OUTCOME ENGINE\n// ============================================================================\n\nrouter.post(\"/claims/outcomes\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertClaimOutcomeSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const outcome = await predictiveClaimEngine.recordClaimOutcome(validation.data);\n    res.json(outcome);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/claims/outcomes\", async (req: Request, res: Response) => {\n  try {\n    const { insurerName, claimType } = req.query;\n    const outcomes = await predictiveClaimEngine.getClaimOutcomes({\n      insurerName: insurerName as string,\n      claimType: claimType as string,\n    });\n    res.json(outcomes);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/claims/predict\", async (req: Request, res: Response) => {\n  try {\n    const { projectId, insurerName, claimData } = req.body;\n    const prediction = await predictiveClaimEngine.predictClaimOutcome(\n      projectId,\n      insurerName,\n      claimData\n    );\n    res.json(prediction);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/claims/predictions/:projectId\", async (req: Request, res: Response) => {\n  try {\n    const predictions = await predictiveClaimEngine.getPredictionHistory(\n      parseInt(req.params.projectId)\n    );\n    res.json(predictions);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/claims/insurer-patterns\", async (req: Request, res: Response) => {\n  try {\n    const { insurerName } = req.query;\n    const patterns = await predictiveClaimEngine.getInsurerPatterns(\n      insurerName as string\n    );\n    res.json(patterns);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============================================================================\n// STORMY FIELD CO-PILOT\n// ============================================================================\n\nrouter.post(\"/copilot/sessions\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertFieldCopilotSessionSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const session = await fieldCopilotService.startSession(validation.data);\n    res.json(session);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/copilot/sessions/active/:userId\", async (req: Request, res: Response) => {\n  try {\n    const session = await fieldCopilotService.getActiveSession(req.params.userId);\n    res.json(session);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/copilot/sessions/:sessionId/end\", async (req: Request, res: Response) => {\n  try {\n    const session = await fieldCopilotService.endSession(parseInt(req.params.sessionId));\n    res.json(session);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/copilot/guidance\", async (req: Request, res: Response) => {\n  try {\n    const { sessionId, visualContext, currentStep } = req.body;\n    const guidance = await fieldCopilotService.getGuidanceForContext(\n      sessionId,\n      visualContext,\n      currentStep\n    );\n    res.json(guidance);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/copilot/wearables\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertWearableDeviceSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const device = await fieldCopilotService.registerWearableDevice(validation.data);\n    res.json(device);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/copilot/wearables/:userId\", async (req: Request, res: Response) => {\n  try {\n    const devices = await fieldCopilotService.getUserWearables(req.params.userId);\n    res.json(devices);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============================================================================\n// SMART SENSOR NETWORK (IoT)\n// ============================================================================\n\nrouter.post(\"/iot/devices\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertIotDeviceSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const device = await iotSensorService.registerDevice(validation.data);\n    res.json(device);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/iot/devices/property/:propertyId\", async (req: Request, res: Response) => {\n  try {\n    const devices = await iotSensorService.getPropertyDevices(\n      parseInt(req.params.propertyId)\n    );\n    res.json(devices);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/iot/readings\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertSensorReadingSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const reading = await iotSensorService.recordReading(validation.data);\n    res.json(reading);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/iot/readings/:deviceId\", async (req: Request, res: Response) => {\n  try {\n    const hours = parseInt(req.query.hours as string) || 24;\n    const readings = await iotSensorService.getDeviceReadings(\n      parseInt(req.params.deviceId),\n      hours\n    );\n    res.json(readings);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/iot/alerts\", async (req: Request, res: Response) => {\n  try {\n    const propertyId = req.query.propertyId \n      ? parseInt(req.query.propertyId as string) \n      : undefined;\n    const alerts = await iotSensorService.getUnacknowledgedAlerts(propertyId);\n    res.json(alerts);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/iot/alerts/:alertId/acknowledge\", async (req: Request, res: Response) => {\n  try {\n    const { acknowledgedBy } = req.body;\n    const alert = await iotSensorService.acknowledgeAlert(\n      parseInt(req.params.alertId),\n      acknowledgedBy\n    );\n    res.json(alert);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============================================================================\n// DRONE INTEGRATION\n// ============================================================================\n\nrouter.post(\"/drones/pilots\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertDronePilotSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const pilot = await droneIntegrationService.registerPilot(validation.data);\n    res.json(pilot);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/drones/assets\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertDroneAssetSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const drone = await droneIntegrationService.registerDrone(validation.data);\n    res.json(drone);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/drones/assets/available\", async (req: Request, res: Response) => {\n  try {\n    const ownerId = req.query.ownerId \n      ? parseInt(req.query.ownerId as string) \n      : undefined;\n    const drones = await droneIntegrationService.getAvailableDrones(ownerId);\n    res.json(drones);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/drones/flights\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertFlightSessionSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const session = await droneIntegrationService.planFlightSession(validation.data);\n    res.json(session);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/drones/flights/:sessionId/start\", async (req: Request, res: Response) => {\n  try {\n    const session = await droneIntegrationService.startFlight(\n      parseInt(req.params.sessionId)\n    );\n    res.json(session);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/drones/flights/:sessionId/complete\", async (req: Request, res: Response) => {\n  try {\n    const session = await droneIntegrationService.completeFlight(\n      parseInt(req.params.sessionId),\n      req.body\n    );\n    res.json(session);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/drones/flights\", async (req: Request, res: Response) => {\n  try {\n    const propertyId = req.query.propertyId \n      ? parseInt(req.query.propertyId as string) \n      : undefined;\n    const pilotId = req.query.pilotId \n      ? parseInt(req.query.pilotId as string) \n      : undefined;\n    const flights = await droneIntegrationService.getFlightHistory(propertyId, pilotId);\n    res.json(flights);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============================================================================\n// INSURANCE CARRIER CONSOLE\n// ============================================================================\n\nrouter.post(\"/carriers\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertCarrierAccountSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const carrier = await carrierConsoleService.createCarrierAccount(validation.data);\n    res.json(carrier);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/carriers/users\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertCarrierUserSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const user = await carrierConsoleService.addCarrierUser(validation.data);\n    res.json(user);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/carriers/submissions\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertCarrierClaimSubmissionSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const submission = await carrierConsoleService.submitClaimToCarrier(validation.data);\n    res.json(submission);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/carriers/:carrierId/submissions\", async (req: Request, res: Response) => {\n  try {\n    const status = req.query.status as string;\n    const submissions = await carrierConsoleService.getCarrierSubmissions(\n      parseInt(req.params.carrierId),\n      status\n    );\n    res.json(submissions);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.patch(\"/carriers/submissions/:submissionId\", async (req: Request, res: Response) => {\n  try {\n    const { status, decision, approvedAmount } = req.body;\n    const submission = await carrierConsoleService.updateSubmissionStatus(\n      parseInt(req.params.submissionId),\n      status,\n      decision,\n      approvedAmount\n    );\n    res.json(submission);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/carriers/ai-summary\", async (req: Request, res: Response) => {\n  try {\n    const summary = await carrierConsoleService.generateAISummary(req.body.projectData);\n    res.json({ summary });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============================================================================\n// CONTRACTOR MARKETPLACE\n// ============================================================================\n\nrouter.post(\"/contractors\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertContractorProfileSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const profile = await contractorMarketplaceService.createContractorProfile(validation.data);\n    res.json(profile);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/contractors/search\", async (req: Request, res: Response) => {\n  try {\n    const { specialties, serviceArea, minRating } = req.query;\n    const contractors = await contractorMarketplaceService.searchContractors({\n      specialties: specialties ? (specialties as string).split(',') : undefined,\n      serviceArea: serviceArea as string,\n      minRating: minRating ? parseFloat(minRating as string) : undefined,\n    });\n    res.json(contractors);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/contractors/jobs\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertRepairJobSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const job = await contractorMarketplaceService.createRepairJob(validation.data);\n    res.json(job);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/contractors/jobs\", async (req: Request, res: Response) => {\n  try {\n    const jobs = await contractorMarketplaceService.getOpenJobs();\n    res.json(jobs);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/contractors/bids\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertContractorBidSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const bid = await contractorMarketplaceService.submitBid(validation.data);\n    res.json(bid);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/contractors/jobs/:jobId/bids\", async (req: Request, res: Response) => {\n  try {\n    const bids = await contractorMarketplaceService.getJobBids(\n      parseInt(req.params.jobId)\n    );\n    res.json(bids);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/contractors/bids/:bidId/accept\", async (req: Request, res: Response) => {\n  try {\n    const { jobId } = req.body;\n    await contractorMarketplaceService.acceptBid(\n      parseInt(req.params.bidId),\n      jobId\n    );\n    res.json({ message: \"Bid accepted successfully\" });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/contractors/referrals\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertReferralFeeSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const fee = await contractorMarketplaceService.recordReferralFee(validation.data);\n    res.json(fee);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============================================================================\n// REGIONAL RISK INTELLIGENCE\n// ============================================================================\n\nrouter.post(\"/risk/regions\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertRiskRegionSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const region = await riskIntelligenceService.createRegion(validation.data);\n    res.json(region);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/risk/regions\", async (req: Request, res: Response) => {\n  try {\n    const state = req.query.state as string;\n    const regions = await riskIntelligenceService.getRegions(state);\n    res.json(regions);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/risk/assessments\", async (req: Request, res: Response) => {\n  try {\n    const { regionId, periodStart, periodEnd } = req.body;\n    const assessment = await riskIntelligenceService.calculateRiskAssessment(\n      regionId,\n      new Date(periodStart),\n      new Date(periodEnd)\n    );\n    res.json(assessment);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/risk/assessments/:regionId\", async (req: Request, res: Response) => {\n  try {\n    const assessments = await riskIntelligenceService.getRegionRiskAssessments(\n      parseInt(req.params.regionId)\n    );\n    res.json(assessments);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/risk/exports\", async (req: Request, res: Response) => {\n  try {\n    const validation = validateBody(insertRiskDataExportSchema, req.body);\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error });\n    }\n    const exportRecord = await riskIntelligenceService.createDataExport(validation.data);\n    res.json(exportRecord);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/risk/exports/:carrierId\", async (req: Request, res: Response) => {\n  try {\n    const exports = await riskIntelligenceService.getCarrierExports(\n      parseInt(req.params.carrierId)\n    );\n    res.json(exports);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":21281,"size_tokens":null},"client/src/components/damage-template-selector.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { AlertTriangle, CloudRain, Wind, Thermometer, Droplets, CheckCircle, Plus, RefreshCw } from \"lucide-react\";\nimport type { DamageTemplate } from \"@shared/schema\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface DamageTemplateSelectorProps {\n  onSelect: (template: DamageTemplate) => void;\n  selectedTemplateId?: number;\n}\n\nconst categoryIcons: Record<string, any> = {\n  \"Storm Damage\": CloudRain,\n  \"Thermal Issues\": Thermometer,\n  \"Water Damage\": Droplets,\n  \"Material Degradation\": AlertTriangle,\n  \"Penetration Issues\": Wind,\n};\n\nconst severityColors: Record<string, string> = {\n  critical: \"bg-red-500 text-white\",\n  warning: \"bg-amber-500 text-white\",\n  info: \"bg-blue-500 text-white\",\n};\n\nexport function DamageTemplateSelector({ onSelect, selectedTemplateId }: DamageTemplateSelectorProps) {\n  const [activeCategory, setActiveCategory] = useState<string>(\"all\");\n  \n  const { data: templates = [], isLoading, error } = useQuery<DamageTemplate[]>({\n    queryKey: [\"/api/damage-templates\"],\n  });\n\n  const seedMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"/api/damage-templates/seed\", { method: \"POST\" });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/damage-templates\"] });\n    },\n  });\n\n  const categories = [\"all\", ...Array.from(new Set(templates.map(t => t.category).filter(Boolean)))];\n  \n  const filteredTemplates = activeCategory === \"all\" \n    ? templates \n    : templates.filter(t => t.category === activeCategory);\n\n  if (isLoading) {\n    return (\n      <Card className=\"bg-[#1A1A1A] border-gray-800\">\n        <CardHeader>\n          <CardTitle className=\"text-white\">Damage Templates</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {[1, 2, 3].map(i => (\n            <Skeleton key={i} className=\"h-24 w-full bg-gray-800\" />\n          ))}\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (templates.length === 0) {\n    return (\n      <Card className=\"bg-[#1A1A1A] border-gray-800\">\n        <CardHeader>\n          <CardTitle className=\"text-white\">Damage Templates</CardTitle>\n          <CardDescription className=\"text-gray-400\">\n            No templates found. Seed the database with pre-built templates.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Button\n            onClick={() => seedMutation.mutate()}\n            disabled={seedMutation.isPending}\n            className=\"bg-[#FF6B00] hover:bg-[#FF6B00]/90\"\n            data-testid=\"button-seed-templates\"\n          >\n            {seedMutation.isPending ? (\n              <>\n                <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n                Seeding...\n              </>\n            ) : (\n              <>\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Seed Default Templates\n              </>\n            )}\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"bg-[#1A1A1A] border-gray-800\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-white flex items-center gap-2\">\n          <AlertTriangle className=\"h-5 w-5 text-[#FF6B00]\" />\n          Damage Templates\n        </CardTitle>\n        <CardDescription className=\"text-gray-400\">\n          Select a pre-built template to auto-fill damage details\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <Tabs value={activeCategory} onValueChange={setActiveCategory}>\n          <TabsList className=\"bg-gray-900 border border-gray-700 mb-4 w-full flex-wrap h-auto\">\n            {categories.map(cat => (\n              <TabsTrigger \n                key={cat} \n                value={cat}\n                className=\"text-xs data-[state=active]:bg-[#FF6B00] data-[state=active]:text-white\"\n                data-testid={`tab-category-${cat.toLowerCase().replace(/\\s+/g, '-')}`}\n              >\n                {cat === \"all\" ? \"All\" : cat}\n              </TabsTrigger>\n            ))}\n          </TabsList>\n\n          <ScrollArea className=\"h-[320px] pr-4\">\n            <div className=\"space-y-3\">\n              {filteredTemplates.map(template => {\n                const Icon = categoryIcons[template.category || \"\"] || AlertTriangle;\n                const isSelected = selectedTemplateId === template.id;\n                \n                return (\n                  <Card \n                    key={template.id}\n                    className={`cursor-pointer transition-all hover:border-[#FF6B00] ${\n                      isSelected \n                        ? \"border-[#FF6B00] bg-[#FF6B00]/10\" \n                        : \"bg-gray-900/50 border-gray-700\"\n                    }`}\n                    onClick={() => onSelect(template)}\n                    data-testid={`card-template-${template.id}`}\n                  >\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-start justify-between gap-3\">\n                        <div className=\"flex items-start gap-3 flex-1\">\n                          <div className=\"p-2 rounded-lg bg-gray-800\">\n                            <Icon className=\"h-5 w-5 text-[#FF6B00]\" />\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2 flex-wrap\">\n                              <h4 className=\"font-semibold text-white truncate\">\n                                {template.name}\n                              </h4>\n                              {isSelected && (\n                                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                              )}\n                            </div>\n                            <p className=\"text-sm text-gray-400 mt-1 line-clamp-2\">\n                              {template.description}\n                            </p>\n                            <div className=\"flex items-center gap-2 mt-2 flex-wrap\">\n                              <Badge \n                                className={severityColors[template.defaultSeverity || \"info\"]}\n                              >\n                                {template.defaultSeverity}\n                              </Badge>\n                              {template.affectedComponents && (\n                                <span className=\"text-xs text-gray-500\">\n                                  {(template.affectedComponents as string[]).slice(0, 2).join(\", \")}\n                                  {(template.affectedComponents as string[]).length > 2 && \"...\"}\n                                </span>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </ScrollArea>\n        </Tabs>\n      </CardContent>\n    </Card>\n  );\n}\n\ninterface TemplateDetailsProps {\n  template: DamageTemplate;\n}\n\nexport function DamageTemplateDetails({ template }: TemplateDetailsProps) {\n  const Icon = categoryIcons[template.category || \"\"] || AlertTriangle;\n  \n  return (\n    <Card className=\"bg-[#1A1A1A] border-gray-800\">\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"p-2 rounded-lg bg-gray-800\">\n            <Icon className=\"h-6 w-6 text-[#FF6B00]\" />\n          </div>\n          <div>\n            <CardTitle className=\"text-white\">{template.name}</CardTitle>\n            <CardDescription className=\"text-gray-400\">{template.category}</CardDescription>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div>\n          <h4 className=\"text-sm font-medium text-gray-300 mb-2\">Description</h4>\n          <p className=\"text-sm text-gray-400\">{template.description}</p>\n        </div>\n\n        {template.affectedComponents && (template.affectedComponents as string[]).length > 0 && (\n          <div>\n            <h4 className=\"text-sm font-medium text-gray-300 mb-2\">Affected Components</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              {(template.affectedComponents as string[]).map((comp, i) => (\n                <Badge key={i} variant=\"outline\" className=\"border-gray-600 text-gray-300\">\n                  {comp}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {template.typicalCauses && (template.typicalCauses as string[]).length > 0 && (\n          <div>\n            <h4 className=\"text-sm font-medium text-gray-300 mb-2\">Typical Causes</h4>\n            <ul className=\"text-sm text-gray-400 list-disc list-inside\">\n              {(template.typicalCauses as string[]).map((cause, i) => (\n                <li key={i}>{cause}</li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {template.recommendations && (template.recommendations as any[]).length > 0 && (\n          <div>\n            <h4 className=\"text-sm font-medium text-gray-300 mb-2\">Recommendations</h4>\n            <div className=\"space-y-2\">\n              {(template.recommendations as any[]).map((rec, i) => (\n                <div key={i} className=\"flex items-start gap-2 text-sm\">\n                  <Badge \n                    variant=\"outline\" \n                    className={`text-xs shrink-0 ${\n                      rec.priority === 'immediate' \n                        ? 'border-red-500 text-red-400' \n                        : rec.priority === 'short_term'\n                        ? 'border-amber-500 text-amber-400'\n                        : 'border-blue-500 text-blue-400'\n                    }`}\n                  >\n                    {rec.priority?.replace('_', ' ')}\n                  </Badge>\n                  <span className=\"text-gray-400\">{rec.action}</span>\n                  {rec.estimatedCost && (\n                    <span className=\"text-green-400 ml-auto shrink-0\">{rec.estimatedCost}</span>\n                  )}\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {template.inspectionNotes && (\n          <div className=\"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3\">\n            <h4 className=\"text-sm font-medium text-amber-400 mb-1\">Inspection Notes</h4>\n            <p className=\"text-sm text-gray-300\">{template.inspectionNotes}</p>\n          </div>\n        )}\n\n        {template.requiredEvidence && (template.requiredEvidence as string[]).length > 0 && (\n          <div>\n            <h4 className=\"text-sm font-medium text-gray-300 mb-2\">Required Evidence</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              {(template.requiredEvidence as string[]).map((evidence, i) => (\n                <Badge key={i} className=\"bg-[#FF6B00]/20 text-[#FF6B00] border-[#FF6B00]\">\n                  {evidence.replace(/_/g, ' ')}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":11549,"size_tokens":null},"client/src/hooks/use-voice-chat.ts":{"content":"import { useState, useRef, useCallback } from 'react';\nimport { auth } from '@/lib/firebase';\n\nexport type VoiceChatState = 'idle' | 'recording' | 'processing' | 'speaking' | 'error';\n\ninterface VoiceChatOptions {\n  onTranscription?: (text: string) => void;\n  onResponse?: (text: string) => void;\n  onError?: (error: string) => void;\n  conversationId?: number;\n}\n\nexport function useVoiceChat(options: VoiceChatOptions = {}) {\n  const [state, setState] = useState<VoiceChatState>('idle');\n  const [transcription, setTranscription] = useState<string>('');\n  const [response, setResponse] = useState<string>('');\n  const [error, setError] = useState<string | null>(null);\n  \n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const audioElementRef = useRef<HTMLAudioElement | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  const getAuthHeaders = async (): Promise<HeadersInit> => {\n    const currentUser = auth.currentUser;\n    if (currentUser) {\n      try {\n        const idToken = await currentUser.getIdToken();\n        return { 'Authorization': `Bearer ${idToken}` };\n      } catch (e) {\n        console.warn('Failed to get auth token:', e);\n      }\n    }\n    return {};\n  };\n\n  const startRecording = useCallback(async () => {\n    try {\n      setState('recording');\n      setError(null);\n      audioChunksRef.current = [];\n\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          sampleRate: 16000,\n        }\n      });\n      streamRef.current = stream;\n\n      const mimeType = MediaRecorder.isTypeSupported('audio/webm;codecs=opus') \n        ? 'audio/webm;codecs=opus' \n        : 'audio/webm';\n\n      const mediaRecorder = new MediaRecorder(stream, { mimeType });\n      mediaRecorderRef.current = mediaRecorder;\n\n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n        }\n      };\n\n      mediaRecorder.start(100);\n    } catch (err: any) {\n      console.error('Error starting recording:', err);\n      setState('error');\n      setError('Failed to access microphone. Please check permissions.');\n      options.onError?.('Failed to access microphone');\n    }\n  }, [options]);\n\n  const stopRecording = useCallback(async () => {\n    return new Promise<Blob | null>((resolve) => {\n      const mediaRecorder = mediaRecorderRef.current;\n      if (!mediaRecorder || mediaRecorder.state === 'inactive') {\n        resolve(null);\n        return;\n      }\n\n      mediaRecorder.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });\n        \n        if (streamRef.current) {\n          streamRef.current.getTracks().forEach(track => track.stop());\n          streamRef.current = null;\n        }\n        \n        resolve(audioBlob);\n      };\n\n      mediaRecorder.stop();\n    });\n  }, []);\n\n  const playAudioResponse = useCallback(async (base64Audio: string) => {\n    setState('speaking');\n    \n    try {\n      const audioData = atob(base64Audio);\n      const audioArray = new Uint8Array(audioData.length);\n      for (let i = 0; i < audioData.length; i++) {\n        audioArray[i] = audioData.charCodeAt(i);\n      }\n      const audioBlob = new Blob([audioArray], { type: 'audio/mpeg' });\n      const audioUrl = URL.createObjectURL(audioBlob);\n\n      return new Promise<void>((resolve) => {\n        const audio = new Audio(audioUrl);\n        audioElementRef.current = audio;\n        \n        audio.onended = () => {\n          URL.revokeObjectURL(audioUrl);\n          setState('idle');\n          resolve();\n        };\n\n        audio.onerror = () => {\n          URL.revokeObjectURL(audioUrl);\n          setState('idle');\n          resolve();\n        };\n\n        audio.play().catch(() => {\n          setState('idle');\n          resolve();\n        });\n      });\n    } catch (err) {\n      console.error('Error playing audio:', err);\n      setState('idle');\n    }\n  }, []);\n\n  const speakText = useCallback(async (text: string) => {\n    setState('speaking');\n    \n    try {\n      const authHeaders = await getAuthHeaders();\n      const response = await fetch('/api/stormy/voice/speak', {\n        method: 'POST',\n        headers: {\n          ...authHeaders,\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({ text }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to generate speech');\n      }\n\n      const audioBlob = await response.blob();\n      const audioUrl = URL.createObjectURL(audioBlob);\n\n      return new Promise<void>((resolve) => {\n        const audio = new Audio(audioUrl);\n        audioElementRef.current = audio;\n\n        audio.onended = () => {\n          URL.revokeObjectURL(audioUrl);\n          setState('idle');\n          resolve();\n        };\n\n        audio.onerror = () => {\n          URL.revokeObjectURL(audioUrl);\n          setState('idle');\n          resolve();\n        };\n\n        audio.play().catch(() => {\n          setState('idle');\n          resolve();\n        });\n      });\n    } catch (err: any) {\n      console.error('Error speaking text:', err);\n      setState('idle');\n      setError(err.message);\n    }\n  }, []);\n\n  const sendVoiceMessage = useCallback(async (imageUrl?: string, autoSpeak: boolean = true) => {\n    setState('processing');\n\n    const audioBlob = await stopRecording();\n    if (!audioBlob || audioBlob.size < 1000) {\n      setState('idle');\n      setError('Recording too short. Please try again.');\n      return null;\n    }\n\n    try {\n      const authHeaders = await getAuthHeaders();\n      \n      const formData = new FormData();\n      formData.append('audio', audioBlob, 'recording.webm');\n      if (options.conversationId) {\n        formData.append('conversationId', options.conversationId.toString());\n      }\n      if (imageUrl) {\n        formData.append('imageUrl', imageUrl);\n      }\n\n      const response = await fetch('/api/stormy/voice/chat', {\n        method: 'POST',\n        headers: authHeaders,\n        credentials: 'include',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ message: 'Unknown error' }));\n        throw new Error(errorData.message || 'Failed to process voice message');\n      }\n\n      const result = await response.json();\n      \n      setTranscription(result.transcription);\n      setResponse(result.response);\n      options.onTranscription?.(result.transcription);\n      options.onResponse?.(result.response);\n\n      if (result.audio && autoSpeak) {\n        await playAudioResponse(result.audio);\n      } else if (autoSpeak && result.response) {\n        await speakText(result.response);\n      } else {\n        setState('idle');\n      }\n\n      return result;\n    } catch (err: any) {\n      console.error('Error sending voice message:', err);\n      setState('error');\n      setError(err.message || 'Failed to process voice message');\n      options.onError?.(err.message);\n      return null;\n    }\n  }, [options, stopRecording, playAudioResponse, speakText]);\n\n  const cancelRecording = useCallback(() => {\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== 'inactive') {\n      mediaRecorderRef.current.stop();\n    }\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n    }\n    audioChunksRef.current = [];\n    setState('idle');\n  }, []);\n\n  const stopSpeaking = useCallback(() => {\n    if (audioElementRef.current) {\n      audioElementRef.current.pause();\n      audioElementRef.current.currentTime = 0;\n      audioElementRef.current = null;\n    }\n    setState('idle');\n  }, []);\n\n  return {\n    state,\n    transcription,\n    response,\n    error,\n    isRecording: state === 'recording',\n    isProcessing: state === 'processing',\n    isSpeaking: state === 'speaking',\n    startRecording,\n    stopRecording,\n    sendVoiceMessage,\n    speakText,\n    cancelRecording,\n    stopSpeaking,\n    playAudioResponse,\n  };\n}\n","path":null,"size_bytes":8213,"size_tokens":null},"client/src/pages/team-management.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Helmet } from \"react-helmet-async\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  Users, \n  UserPlus, \n  Calendar, \n  MapPin, \n  BarChart3, \n  CheckCircle, \n  Clock, \n  AlertTriangle,\n  Settings\n} from \"lucide-react\";\nimport type { TeamAssignment } from \"@shared/schema\";\n\ninterface WorkloadData {\n  inspectorId: number;\n  inspectorName: string;\n  teamName: string;\n  region: string;\n  maxDaily: number;\n  maxWeekly: number;\n  currentWeekly: number;\n  isAvailable: boolean;\n  unavailableUntil: string | null;\n  specializations: string[];\n  utilizationPercent: number;\n}\n\nexport default function TeamManagement() {\n  const { toast } = useToast();\n  const [isAddingAssignment, setIsAddingAssignment] = useState(false);\n\n  const { data: workload = [], isLoading: workloadLoading } = useQuery<WorkloadData[]>({\n    queryKey: [\"/api/team/workload\"],\n  });\n\n  const { data: assignments = [], isLoading: assignmentsLoading } = useQuery<TeamAssignment[]>({\n    queryKey: [\"/api/team/assignments\"],\n  });\n\n  const createAssignment = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"/api/team/assignments\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/team/assignments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/team/workload\"] });\n      toast({ title: \"Team assignment created\" });\n      setIsAddingAssignment(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to create assignment\", variant: \"destructive\" });\n    },\n  });\n\n  const updateAssignment = useMutation({\n    mutationFn: async ({ id, ...data }: any) => {\n      return await apiRequest(`/api/team/assignments/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/team/assignments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/team/workload\"] });\n      toast({ title: \"Assignment updated\" });\n    },\n  });\n\n  const getUtilizationColor = (percent: number) => {\n    if (percent >= 90) return \"text-red-500\";\n    if (percent >= 70) return \"text-amber-500\";\n    return \"text-green-500\";\n  };\n\n  const getProgressColor = (percent: number) => {\n    if (percent >= 90) return \"bg-red-500\";\n    if (percent >= 70) return \"bg-amber-500\";\n    return \"bg-green-500\";\n  };\n\n  const totalInspectors = workload.length;\n  const availableInspectors = workload.filter(w => w.isAvailable).length;\n  const avgUtilization = workload.length \n    ? Math.round(workload.reduce((acc, w) => acc + w.utilizationPercent, 0) / workload.length)\n    : 0;\n  const overloadedCount = workload.filter(w => w.utilizationPercent >= 90).length;\n\n  if (workloadLoading || assignmentsLoading) {\n    return (\n      <div className=\"min-h-screen bg-[#121212] p-6\">\n        <div className=\"max-w-7xl mx-auto space-y-6\">\n          <Skeleton className=\"h-12 w-64 bg-gray-800\" />\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            {[1, 2, 3, 4].map(i => (\n              <Skeleton key={i} className=\"h-24 bg-gray-800\" />\n            ))}\n          </div>\n          <Skeleton className=\"h-96 bg-gray-800\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#121212] p-6\">\n      <Helmet>\n        <title>Team Management | WinnStorm</title>\n        <meta name=\"description\" content=\"Manage inspector team assignments and monitor workload distribution\" />\n      </Helmet>\n      \n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-white flex items-center gap-3\">\n              <Users className=\"h-8 w-8 text-[#FF6B00]\" />\n              Team Management\n            </h1>\n            <p className=\"text-gray-400 mt-1\">\n              Monitor inspector workloads and manage team assignments\n            </p>\n          </div>\n          \n          <Dialog open={isAddingAssignment} onOpenChange={setIsAddingAssignment}>\n            <DialogTrigger asChild>\n              <Button className=\"bg-[#FF6B00] hover:bg-[#FF6B00]/90\" data-testid=\"button-add-assignment\">\n                <UserPlus className=\"mr-2 h-4 w-4\" />\n                Add Inspector\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"bg-[#1A1A1A] border-gray-800\">\n              <DialogHeader>\n                <DialogTitle className=\"text-white\">Add Team Assignment</DialogTitle>\n              </DialogHeader>\n              <AddAssignmentForm \n                onSubmit={(data) => createAssignment.mutate(data)}\n                isPending={createAssignment.isPending}\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <Card className=\"bg-[#1A1A1A] border-gray-800\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-3 rounded-lg bg-blue-500/20\">\n                  <Users className=\"h-6 w-6 text-blue-400\" />\n                </div>\n                <div>\n                  <p className=\"text-sm text-gray-400\">Total Inspectors</p>\n                  <p className=\"text-2xl font-bold text-white\" data-testid=\"text-total-inspectors\">\n                    {totalInspectors}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-[#1A1A1A] border-gray-800\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-3 rounded-lg bg-green-500/20\">\n                  <CheckCircle className=\"h-6 w-6 text-green-400\" />\n                </div>\n                <div>\n                  <p className=\"text-sm text-gray-400\">Available</p>\n                  <p className=\"text-2xl font-bold text-white\" data-testid=\"text-available-inspectors\">\n                    {availableInspectors}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-[#1A1A1A] border-gray-800\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-3 rounded-lg bg-[#FF6B00]/20\">\n                  <BarChart3 className=\"h-6 w-6 text-[#FF6B00]\" />\n                </div>\n                <div>\n                  <p className=\"text-sm text-gray-400\">Avg Utilization</p>\n                  <p className={`text-2xl font-bold ${getUtilizationColor(avgUtilization)}`} data-testid=\"text-avg-utilization\">\n                    {avgUtilization}%\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-[#1A1A1A] border-gray-800\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-3 rounded-lg bg-red-500/20\">\n                  <AlertTriangle className=\"h-6 w-6 text-red-400\" />\n                </div>\n                <div>\n                  <p className=\"text-sm text-gray-400\">Overloaded</p>\n                  <p className=\"text-2xl font-bold text-red-400\" data-testid=\"text-overloaded-count\">\n                    {overloadedCount}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card className=\"bg-[#1A1A1A] border-gray-800\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Calendar className=\"h-5 w-5 text-[#FF6B00]\" />\n              Weekly Workload\n            </CardTitle>\n            <CardDescription className=\"text-gray-400\">\n              Current week inspection assignments by inspector\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {workload.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <Users className=\"h-12 w-12 text-gray-600 mx-auto mb-4\" />\n                <p className=\"text-gray-400\">No team assignments yet</p>\n                <p className=\"text-sm text-gray-500 mt-2\">\n                  Add inspectors to start tracking workloads\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {workload.map((inspector) => (\n                  <div \n                    key={inspector.inspectorId}\n                    className=\"flex items-center gap-4 p-4 rounded-lg bg-gray-900/50 border border-gray-800\"\n                    data-testid={`card-inspector-${inspector.inspectorId}`}\n                  >\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <h4 className=\"font-medium text-white\">{inspector.inspectorName}</h4>\n                        {!inspector.isAvailable && (\n                          <Badge variant=\"outline\" className=\"border-amber-500 text-amber-400\">\n                            <Clock className=\"h-3 w-3 mr-1\" />\n                            Unavailable\n                          </Badge>\n                        )}\n                        {inspector.utilizationPercent >= 90 && (\n                          <Badge variant=\"outline\" className=\"border-red-500 text-red-400\">\n                            <AlertTriangle className=\"h-3 w-3 mr-1\" />\n                            Overloaded\n                          </Badge>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-4 text-sm text-gray-400\">\n                        {inspector.teamName && (\n                          <span className=\"flex items-center gap-1\">\n                            <Users className=\"h-3 w-3\" />\n                            {inspector.teamName}\n                          </span>\n                        )}\n                        {inspector.region && (\n                          <span className=\"flex items-center gap-1\">\n                            <MapPin className=\"h-3 w-3\" />\n                            {inspector.region}\n                          </span>\n                        )}\n                      </div>\n                      {inspector.specializations && inspector.specializations.length > 0 && (\n                        <div className=\"flex gap-1 mt-2\">\n                          {inspector.specializations.map((spec, i) => (\n                            <Badge key={i} variant=\"secondary\" className=\"text-xs bg-gray-800\">\n                              {spec}\n                            </Badge>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                    \n                    <div className=\"w-48\">\n                      <div className=\"flex justify-between text-sm mb-1\">\n                        <span className=\"text-gray-400\">\n                          {inspector.currentWeekly} / {inspector.maxWeekly}\n                        </span>\n                        <span className={getUtilizationColor(inspector.utilizationPercent)}>\n                          {inspector.utilizationPercent}%\n                        </span>\n                      </div>\n                      <Progress \n                        value={inspector.utilizationPercent} \n                        className=\"h-2 bg-gray-800\"\n                      />\n                    </div>\n                    \n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"text-gray-400 hover:text-white\"\n                      data-testid={`button-settings-${inspector.inspectorId}`}\n                    >\n                      <Settings className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nfunction AddAssignmentForm({ onSubmit, isPending }: { onSubmit: (data: any) => void; isPending: boolean }) {\n  const [inspectorId, setInspectorId] = useState(\"\");\n  const [teamName, setTeamName] = useState(\"\");\n  const [region, setRegion] = useState(\"\");\n  const [maxDaily, setMaxDaily] = useState(\"4\");\n  const [maxWeekly, setMaxWeekly] = useState(\"20\");\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSubmit({\n      inspectorId: parseInt(inspectorId),\n      teamName,\n      region,\n      maxDailyInspections: parseInt(maxDaily),\n      maxWeeklyInspections: parseInt(maxWeekly),\n      isAvailable: true,\n      specializations: [],\n    });\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label className=\"text-gray-300\">Inspector ID</Label>\n        <Input\n          type=\"number\"\n          value={inspectorId}\n          onChange={(e) => setInspectorId(e.target.value)}\n          placeholder=\"Enter inspector user ID\"\n          className=\"bg-gray-900 border-gray-700 text-white\"\n          required\n          data-testid=\"input-inspector-id\"\n        />\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label className=\"text-gray-300\">Team Name</Label>\n          <Input\n            value={teamName}\n            onChange={(e) => setTeamName(e.target.value)}\n            placeholder=\"e.g., North Team\"\n            className=\"bg-gray-900 border-gray-700 text-white\"\n            data-testid=\"input-team-name\"\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label className=\"text-gray-300\">Region</Label>\n          <Input\n            value={region}\n            onChange={(e) => setRegion(e.target.value)}\n            placeholder=\"e.g., North Texas\"\n            className=\"bg-gray-900 border-gray-700 text-white\"\n            data-testid=\"input-region\"\n          />\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label className=\"text-gray-300\">Max Daily Inspections</Label>\n          <Input\n            type=\"number\"\n            value={maxDaily}\n            onChange={(e) => setMaxDaily(e.target.value)}\n            className=\"bg-gray-900 border-gray-700 text-white\"\n            data-testid=\"input-max-daily\"\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label className=\"text-gray-300\">Max Weekly Inspections</Label>\n          <Input\n            type=\"number\"\n            value={maxWeekly}\n            onChange={(e) => setMaxWeekly(e.target.value)}\n            className=\"bg-gray-900 border-gray-700 text-white\"\n            data-testid=\"input-max-weekly\"\n          />\n        </div>\n      </div>\n\n      <Button\n        type=\"submit\"\n        className=\"w-full bg-[#FF6B00] hover:bg-[#FF6B00]/90\"\n        disabled={isPending || !inspectorId}\n        data-testid=\"button-submit-assignment\"\n      >\n        {isPending ? \"Creating...\" : \"Create Assignment\"}\n      </Button>\n    </form>\n  );\n}\n","path":null,"size_bytes":16161,"size_tokens":null},"client/src/components/breadcrumb.tsx":{"content":"import { Link } from 'wouter';\nimport { ChevronRight, Home } from 'lucide-react';\nimport { breadcrumbSchema } from './seo';\n\nexport interface BreadcrumbItem {\n  name: string;\n  url: string;\n}\n\ninterface BreadcrumbProps {\n  items: BreadcrumbItem[];\n  className?: string;\n}\n\nexport function Breadcrumb({ items, className = '' }: BreadcrumbProps) {\n  const allItems = [{ name: 'Home', url: '/' }, ...items];\n  const schema = breadcrumbSchema(allItems);\n\n  return (\n    <>\n      <script\n        type=\"application/ld+json\"\n        dangerouslySetInnerHTML={{ __html: JSON.stringify(schema) }}\n      />\n      <nav \n        aria-label=\"Breadcrumb\" \n        className={`flex items-center text-sm text-muted-foreground ${className}`}\n        data-testid=\"breadcrumb-nav\"\n      >\n        <ol className=\"flex items-center flex-wrap gap-1\">\n          {allItems.map((item, index) => {\n            const isLast = index === allItems.length - 1;\n            \n            return (\n              <li key={item.url} className=\"flex items-center\">\n                {index > 0 && (\n                  <ChevronRight className=\"h-4 w-4 mx-1 text-muted-foreground/50\" />\n                )}\n                \n                {index === 0 ? (\n                  <Link href={item.url}>\n                    <span className=\"flex items-center hover:text-foreground transition-colors cursor-pointer\">\n                      <Home className=\"h-4 w-4\" />\n                      <span className=\"sr-only\">{item.name}</span>\n                    </span>\n                  </Link>\n                ) : isLast ? (\n                  <span \n                    className=\"font-medium text-foreground\" \n                    aria-current=\"page\"\n                    data-testid={`breadcrumb-current-${item.url.replace(/\\//g, '-')}`}\n                  >\n                    {item.name}\n                  </span>\n                ) : (\n                  <Link href={item.url}>\n                    <span \n                      className=\"hover:text-foreground transition-colors cursor-pointer\"\n                      data-testid={`breadcrumb-link-${item.url.replace(/\\//g, '-')}`}\n                    >\n                      {item.name}\n                    </span>\n                  </Link>\n                )}\n              </li>\n            );\n          })}\n        </ol>\n      </nav>\n    </>\n  );\n}\n\nexport default Breadcrumb;\n","path":null,"size_bytes":2373,"size_tokens":null},"client/src/pages/innovation-hub.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Helmet } from \"react-helmet-async\";\nimport { Link } from \"wouter\";\nimport { \n  Brain, \n  Mic, \n  Wifi, \n  Plane, \n  Building2, \n  Hammer, \n  MapPin, \n  Sparkles,\n  ChevronRight,\n  Lock,\n  Unlock,\n  Zap,\n  TrendingUp,\n  Eye,\n  Settings\n} from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface InnovationModule {\n  id: number;\n  moduleCode: string;\n  moduleName: string;\n  description: string;\n  category: string;\n  version: string;\n  status: string;\n  requiredSubscription: string;\n  isActive: boolean;\n}\n\nconst MODULE_ICONS: Record<string, any> = {\n  predictive_claims: Brain,\n  field_copilot: Mic,\n  iot_sensors: Wifi,\n  drone_integration: Plane,\n  carrier_console: Building2,\n  contractor_marketplace: Hammer,\n  risk_intelligence: MapPin,\n};\n\nconst CATEGORY_COLORS: Record<string, string> = {\n  ai_intelligence: \"bg-purple-500/20 text-purple-400 border-purple-500/30\",\n  field_operations: \"bg-blue-500/20 text-blue-400 border-blue-500/30\",\n  iot_hardware: \"bg-green-500/20 text-green-400 border-green-500/30\",\n  enterprise: \"bg-orange-500/20 text-orange-400 border-orange-500/30\",\n  marketplace: \"bg-pink-500/20 text-pink-400 border-pink-500/30\",\n  data_products: \"bg-cyan-500/20 text-cyan-400 border-cyan-500/30\",\n};\n\nconst STATUS_BADGES: Record<string, { label: string; variant: string }> = {\n  active: { label: \"Active\", variant: \"default\" },\n  preview: { label: \"Preview\", variant: \"secondary\" },\n  coming_soon: { label: \"Coming Soon\", variant: \"outline\" },\n  beta: { label: \"Beta\", variant: \"secondary\" },\n};\n\nexport default function InnovationHub() {\n  const { toast } = useToast();\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"all\");\n\n  const { data: modules = [], isLoading } = useQuery<InnovationModule[]>({\n    queryKey: [\"/api/innovation/modules\"],\n  });\n\n  const seedModulesMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"/api/innovation/modules/seed\", { method: \"POST\" });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/innovation/modules\"] });\n      toast({\n        title: \"Modules Initialized\",\n        description: \"All innovation modules have been configured.\",\n      });\n    },\n  });\n\n  const categories = [\n    { id: \"all\", label: \"All Modules\", icon: Sparkles },\n    { id: \"ai_intelligence\", label: \"AI Intelligence\", icon: Brain },\n    { id: \"field_operations\", label: \"Field Operations\", icon: Mic },\n    { id: \"iot_hardware\", label: \"IoT & Hardware\", icon: Wifi },\n    { id: \"enterprise\", label: \"Enterprise\", icon: Building2 },\n    { id: \"marketplace\", label: \"Marketplace\", icon: Hammer },\n    { id: \"data_products\", label: \"Data Products\", icon: MapPin },\n  ];\n\n  const filteredModules = selectedCategory === \"all\" \n    ? modules \n    : modules.filter(m => m.category === selectedCategory);\n\n  const moduleStats = {\n    total: modules.length,\n    active: modules.filter(m => m.status === 'active').length,\n    preview: modules.filter(m => m.status === 'preview').length,\n    comingSoon: modules.filter(m => m.status === 'coming_soon').length,\n  };\n\n  return (\n    <>\n      <Helmet>\n        <title>Innovation Hub | WinnStorm</title>\n        <meta name=\"description\" content=\"Explore cutting-edge features and enterprise capabilities for WinnStorm damage assessment platform.\" />\n      </Helmet>\n\n      <div className=\"min-h-screen bg-slate-900 text-white\">\n        <div className=\"container mx-auto px-4 py-8\">\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div>\n                <h1 className=\"text-3xl font-bold text-white flex items-center gap-3\">\n                  <Sparkles className=\"h-8 w-8 text-orange-500\" />\n                  Innovation Hub\n                </h1>\n                <p className=\"text-slate-400 mt-2\">\n                  Cutting-edge features and enterprise capabilities for world-class damage assessment\n                </p>\n              </div>\n              {modules.length === 0 && (\n                <Button \n                  onClick={() => seedModulesMutation.mutate()}\n                  disabled={seedModulesMutation.isPending}\n                  className=\"bg-orange-600 hover:bg-orange-700\"\n                  data-testid=\"button-initialize-modules\"\n                >\n                  <Zap className=\"h-4 w-4 mr-2\" />\n                  Initialize Modules\n                </Button>\n              )}\n            </div>\n\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8\">\n              <Card className=\"bg-slate-800 border-slate-700\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-slate-400 text-sm\">Total Modules</p>\n                      <p className=\"text-2xl font-bold text-white\" data-testid=\"text-total-modules\">{moduleStats.total}</p>\n                    </div>\n                    <div className=\"h-10 w-10 rounded-full bg-slate-700 flex items-center justify-center\">\n                      <Sparkles className=\"h-5 w-5 text-orange-500\" />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n              <Card className=\"bg-slate-800 border-slate-700\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-slate-400 text-sm\">Active</p>\n                      <p className=\"text-2xl font-bold text-green-400\" data-testid=\"text-active-modules\">{moduleStats.active}</p>\n                    </div>\n                    <div className=\"h-10 w-10 rounded-full bg-green-500/20 flex items-center justify-center\">\n                      <Unlock className=\"h-5 w-5 text-green-400\" />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n              <Card className=\"bg-slate-800 border-slate-700\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-slate-400 text-sm\">Preview</p>\n                      <p className=\"text-2xl font-bold text-blue-400\" data-testid=\"text-preview-modules\">{moduleStats.preview}</p>\n                    </div>\n                    <div className=\"h-10 w-10 rounded-full bg-blue-500/20 flex items-center justify-center\">\n                      <Eye className=\"h-5 w-5 text-blue-400\" />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n              <Card className=\"bg-slate-800 border-slate-700\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-slate-400 text-sm\">Coming Soon</p>\n                      <p className=\"text-2xl font-bold text-orange-400\" data-testid=\"text-coming-modules\">{moduleStats.comingSoon}</p>\n                    </div>\n                    <div className=\"h-10 w-10 rounded-full bg-orange-500/20 flex items-center justify-center\">\n                      <TrendingUp className=\"h-5 w-5 text-orange-400\" />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n\n          <div className=\"flex flex-wrap gap-2 mb-6\">\n            {categories.map((cat) => {\n              const Icon = cat.icon;\n              return (\n                <Button\n                  key={cat.id}\n                  variant={selectedCategory === cat.id ? \"default\" : \"outline\"}\n                  className={selectedCategory === cat.id \n                    ? \"bg-orange-600 hover:bg-orange-700\" \n                    : \"border-slate-600 hover:bg-slate-800\"\n                  }\n                  onClick={() => setSelectedCategory(cat.id)}\n                  data-testid={`button-category-${cat.id}`}\n                >\n                  <Icon className=\"h-4 w-4 mr-2\" />\n                  {cat.label}\n                </Button>\n              );\n            })}\n          </div>\n\n          {isLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {[1, 2, 3, 4, 5, 6].map((i) => (\n                <Card key={i} className=\"bg-slate-800 border-slate-700 animate-pulse\">\n                  <CardHeader>\n                    <div className=\"h-12 w-12 rounded-xl bg-slate-700\" />\n                    <div className=\"h-6 w-3/4 bg-slate-700 rounded mt-4\" />\n                    <div className=\"h-4 w-full bg-slate-700 rounded mt-2\" />\n                  </CardHeader>\n                </Card>\n              ))}\n            </div>\n          ) : filteredModules.length === 0 ? (\n            <Card className=\"bg-slate-800 border-slate-700\">\n              <CardContent className=\"p-12 text-center\">\n                <Sparkles className=\"h-16 w-16 text-slate-600 mx-auto mb-4\" />\n                <h3 className=\"text-xl font-semibold text-white mb-2\">No Modules Found</h3>\n                <p className=\"text-slate-400 mb-6\">\n                  {modules.length === 0 \n                    ? \"Initialize the innovation modules to get started with enterprise features.\"\n                    : \"No modules match the selected category.\"}\n                </p>\n                {modules.length === 0 && (\n                  <Button \n                    onClick={() => seedModulesMutation.mutate()}\n                    disabled={seedModulesMutation.isPending}\n                    className=\"bg-orange-600 hover:bg-orange-700\"\n                    data-testid=\"button-initialize-empty\"\n                  >\n                    <Zap className=\"h-4 w-4 mr-2\" />\n                    Initialize Modules\n                  </Button>\n                )}\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {filteredModules.map((module) => {\n                const Icon = MODULE_ICONS[module.moduleCode] || Sparkles;\n                const statusConfig = STATUS_BADGES[module.status] || STATUS_BADGES.preview;\n                const categoryColor = CATEGORY_COLORS[module.category] || CATEGORY_COLORS.ai_intelligence;\n                \n                return (\n                  <Card \n                    key={module.id} \n                    className=\"bg-slate-800 border-slate-700 hover:border-orange-500/50 transition-all duration-300 group\"\n                    data-testid={`card-module-${module.moduleCode}`}\n                  >\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div className={`h-12 w-12 rounded-xl flex items-center justify-center ${categoryColor}`}>\n                          <Icon className=\"h-6 w-6\" />\n                        </div>\n                        <Badge variant=\"outline\" className={\n                          module.status === 'active' ? 'border-green-500 text-green-400' :\n                          module.status === 'preview' ? 'border-blue-500 text-blue-400' :\n                          'border-slate-500 text-slate-400'\n                        }>\n                          {statusConfig.label}\n                        </Badge>\n                      </div>\n                      <CardTitle className=\"text-white mt-4 group-hover:text-orange-400 transition-colors\">\n                        {module.moduleName}\n                      </CardTitle>\n                      <CardDescription className=\"text-slate-400\">\n                        {module.description}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"flex items-center justify-between mb-4\">\n                        <Badge variant=\"outline\" className={categoryColor}>\n                          {module.category.replace('_', ' ')}\n                        </Badge>\n                        <span className=\"text-xs text-slate-500\">v{module.version}</span>\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between pt-4 border-t border-slate-700\">\n                        <div className=\"flex items-center gap-2\">\n                          {module.requiredSubscription === 'enterprise' ? (\n                            <Lock className=\"h-4 w-4 text-orange-400\" />\n                          ) : (\n                            <Unlock className=\"h-4 w-4 text-green-400\" />\n                          )}\n                          <span className=\"text-xs text-slate-400 capitalize\">\n                            {module.requiredSubscription}\n                          </span>\n                        </div>\n                        <Button \n                          size=\"sm\" \n                          variant=\"ghost\" \n                          className=\"text-orange-400 hover:text-orange-300 hover:bg-orange-500/10\"\n                          disabled={module.status === 'coming_soon'}\n                          data-testid={`button-explore-${module.moduleCode}`}\n                        >\n                          {module.status === 'coming_soon' ? 'Coming Soon' : 'Explore'}\n                          <ChevronRight className=\"h-4 w-4 ml-1\" />\n                        </Button>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          )}\n\n          <Card className=\"mt-12 bg-gradient-to-r from-orange-600/20 to-purple-600/20 border-orange-500/30\">\n            <CardContent className=\"p-8\">\n              <div className=\"flex flex-col md:flex-row items-center justify-between gap-6\">\n                <div>\n                  <h3 className=\"text-2xl font-bold text-white mb-2\">\n                    Ready for Enterprise Features?\n                  </h3>\n                  <p className=\"text-slate-300\">\n                    Unlock the full power of WinnStorm with our enterprise tier. \n                    Get access to predictive analytics, carrier integrations, and more.\n                  </p>\n                </div>\n                <Button size=\"lg\" className=\"bg-orange-600 hover:bg-orange-700 whitespace-nowrap\" data-testid=\"button-upgrade-enterprise\">\n                  Upgrade to Enterprise\n                  <ChevronRight className=\"h-5 w-5 ml-2\" />\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"mt-8 text-center text-slate-500 text-sm\">\n            <p>Innovation Hub is part of the WinnStorm Enterprise Platform</p>\n            <p className=\"mt-1\">\n              <Link href=\"/dashboard\" className=\"text-orange-400 hover:text-orange-300\">\n                Return to Dashboard\n              </Link>\n            </p>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n","path":null,"size_bytes":15597,"size_tokens":null},"client/src/pages/clients.tsx":{"content":"import { useState } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { \n  Users, \n  Plus, \n  Search, \n  Phone, \n  Mail, \n  MapPin, \n  Building2, \n  ArrowLeft,\n  MoreHorizontal,\n  Filter,\n  Download,\n  Upload\n} from 'lucide-react';\nimport { useLocation } from 'wouter';\nimport { Header, Footer } from '@/components/navbar';\nimport winnstormLogo from '@assets/logo-dark_1765042579232.png';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\n\ninterface Client {\n  id: number;\n  name: string;\n  email: string;\n  phone: string;\n  company?: string;\n  address: string;\n  city: string;\n  state: string;\n  status: 'active' | 'prospect' | 'inactive';\n  totalProperties: number;\n  totalInspections: number;\n  lastContact?: string;\n}\n\nconst mockClients: Client[] = [\n  {\n    id: 1,\n    name: \"John Smith\",\n    email: \"john.smith@example.com\",\n    phone: \"(555) 123-4567\",\n    company: \"Smith Roofing Co.\",\n    address: \"123 Main St\",\n    city: \"Dallas\",\n    state: \"TX\",\n    status: 'active',\n    totalProperties: 5,\n    totalInspections: 12,\n    lastContact: \"2025-01-25\"\n  },\n  {\n    id: 2,\n    name: \"Sarah Johnson\",\n    email: \"sarah.j@insurancepro.com\",\n    phone: \"(555) 234-5678\",\n    company: \"Insurance Pro Inc.\",\n    address: \"456 Oak Ave\",\n    city: \"Houston\",\n    state: \"TX\",\n    status: 'active',\n    totalProperties: 8,\n    totalInspections: 24,\n    lastContact: \"2025-01-27\"\n  },\n  {\n    id: 3,\n    name: \"Mike Williams\",\n    email: \"mike.w@propertygroup.com\",\n    phone: \"(555) 345-6789\",\n    company: \"Property Management Group\",\n    address: \"789 Elm Blvd\",\n    city: \"Kansas City\",\n    state: \"MO\",\n    status: 'prospect',\n    totalProperties: 0,\n    totalInspections: 0,\n    lastContact: \"2025-01-20\"\n  },\n  {\n    id: 4,\n    name: \"Emily Davis\",\n    email: \"emily.davis@publicadjuster.com\",\n    phone: \"(555) 456-7890\",\n    company: \"Davis Public Adjusting\",\n    address: \"321 Pine St\",\n    city: \"Fort Worth\",\n    state: \"TX\",\n    status: 'active',\n    totalProperties: 15,\n    totalInspections: 42,\n    lastContact: \"2025-01-26\"\n  },\n  {\n    id: 5,\n    name: \"Robert Chen\",\n    email: \"rchen@homeowners.net\",\n    phone: \"(555) 567-8901\",\n    address: \"555 Cedar Lane\",\n    city: \"Plano\",\n    state: \"TX\",\n    status: 'inactive',\n    totalProperties: 1,\n    totalInspections: 2,\n    lastContact: \"2024-12-15\"\n  }\n];\n\nexport default function ClientsPage() {\n  const [, navigate] = useLocation();\n  const [searchQuery, setSearchQuery] = useState('');\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n\n  const filteredClients = mockClients.filter(client => {\n    const matchesSearch = \n      client.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      client.email.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      client.company?.toLowerCase().includes(searchQuery.toLowerCase());\n    \n    const matchesStatus = statusFilter === 'all' || client.status === statusFilter;\n    \n    return matchesSearch && matchesStatus;\n  });\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'active':\n        return <Badge className=\"bg-green-500/10 text-green-500 border-green-500/20\">Active</Badge>;\n      case 'prospect':\n        return <Badge className=\"bg-blue-500/10 text-blue-500 border-blue-500/20\">Prospect</Badge>;\n      case 'inactive':\n        return <Badge className=\"bg-gray-500/10 text-gray-400 border-gray-500/20\">Inactive</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  const totalClients = mockClients.length;\n  const activeClients = mockClients.filter(c => c.status === 'active').length;\n  const totalProperties = mockClients.reduce((sum, c) => sum + c.totalProperties, 0);\n\n  return (\n    <div className=\"min-h-screen bg-slate-950 flex flex-col\">\n      <Header />\n      \n      <main className=\"flex-1 container mx-auto px-4 py-8\">\n        <div className=\"mb-6\">\n          <Button \n            variant=\"ghost\" \n            onClick={() => navigate('/dashboard')}\n            className=\"text-slate-400 hover:text-white mb-4\"\n            data-testid=\"button-back-dashboard\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to Dashboard\n          </Button>\n          \n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-white flex items-center gap-3\">\n                <Users className=\"h-8 w-8 text-orange-500\" />\n                Client Management\n              </h1>\n              <p className=\"text-slate-400 mt-1\">\n                Manage your clients, contacts, and relationships\n              </p>\n            </div>\n            \n            <div className=\"flex gap-3\">\n              <Button variant=\"outline\" className=\"border-slate-700\" data-testid=\"button-import-clients\">\n                <Upload className=\"h-4 w-4 mr-2\" />\n                Import\n              </Button>\n              <Button variant=\"outline\" className=\"border-slate-700\" data-testid=\"button-export-clients\">\n                <Download className=\"h-4 w-4 mr-2\" />\n                Export\n              </Button>\n              <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button className=\"bg-orange-500 hover:bg-orange-600\" data-testid=\"button-add-client\">\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Add Client\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"bg-slate-900 border-slate-700\">\n                  <DialogHeader>\n                    <DialogTitle className=\"text-white\">Add New Client</DialogTitle>\n                    <DialogDescription className=\"text-slate-400\">\n                      Enter the client's information below\n                    </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-4 py-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"name\" className=\"text-slate-300\">Full Name</Label>\n                        <Input id=\"name\" placeholder=\"John Smith\" className=\"bg-slate-800 border-slate-700\" data-testid=\"input-client-name\" />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"company\" className=\"text-slate-300\">Company</Label>\n                        <Input id=\"company\" placeholder=\"Company Name\" className=\"bg-slate-800 border-slate-700\" data-testid=\"input-client-company\" />\n                      </div>\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"email\" className=\"text-slate-300\">Email</Label>\n                        <Input id=\"email\" type=\"email\" placeholder=\"john@example.com\" className=\"bg-slate-800 border-slate-700\" data-testid=\"input-client-email\" />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"phone\" className=\"text-slate-300\">Phone</Label>\n                        <Input id=\"phone\" placeholder=\"(555) 123-4567\" className=\"bg-slate-800 border-slate-700\" data-testid=\"input-client-phone\" />\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"address\" className=\"text-slate-300\">Address</Label>\n                      <Input id=\"address\" placeholder=\"123 Main St\" className=\"bg-slate-800 border-slate-700\" data-testid=\"input-client-address\" />\n                    </div>\n                    <div className=\"grid grid-cols-3 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"city\" className=\"text-slate-300\">City</Label>\n                        <Input id=\"city\" placeholder=\"Dallas\" className=\"bg-slate-800 border-slate-700\" data-testid=\"input-client-city\" />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"state\" className=\"text-slate-300\">State</Label>\n                        <Input id=\"state\" placeholder=\"TX\" className=\"bg-slate-800 border-slate-700\" data-testid=\"input-client-state\" />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"status\" className=\"text-slate-300\">Status</Label>\n                        <Select>\n                          <SelectTrigger className=\"bg-slate-800 border-slate-700\" data-testid=\"select-client-status\">\n                            <SelectValue placeholder=\"Select\" />\n                          </SelectTrigger>\n                          <SelectContent className=\"bg-slate-800 border-slate-700\">\n                            <SelectItem value=\"active\">Active</SelectItem>\n                            <SelectItem value=\"prospect\">Prospect</SelectItem>\n                            <SelectItem value=\"inactive\">Inactive</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex justify-end gap-3\">\n                    <Button variant=\"outline\" onClick={() => setIsAddDialogOpen(false)} className=\"border-slate-700\">\n                      Cancel\n                    </Button>\n                    <Button className=\"bg-orange-500 hover:bg-orange-600\" data-testid=\"button-save-client\">\n                      Save Client\n                    </Button>\n                  </div>\n                </DialogContent>\n              </Dialog>\n            </div>\n          </div>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n          <Card className=\"bg-slate-900/50 border-slate-800\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-slate-400 text-sm\">Total Clients</p>\n                  <p className=\"text-3xl font-bold text-white\">{totalClients}</p>\n                </div>\n                <Users className=\"h-10 w-10 text-orange-500/50\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"bg-slate-900/50 border-slate-800\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-slate-400 text-sm\">Active Clients</p>\n                  <p className=\"text-3xl font-bold text-green-400\">{activeClients}</p>\n                </div>\n                <Badge className=\"bg-green-500/10 text-green-500 text-lg px-3 py-1\">\n                  {Math.round((activeClients / totalClients) * 100)}%\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"bg-slate-900/50 border-slate-800\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-slate-400 text-sm\">Total Properties</p>\n                  <p className=\"text-3xl font-bold text-blue-400\">{totalProperties}</p>\n                </div>\n                <Building2 className=\"h-10 w-10 text-blue-500/50\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Search and Filter */}\n        <div className=\"flex flex-col sm:flex-row gap-4 mb-6\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400\" />\n            <Input\n              placeholder=\"Search clients by name, email, or company...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10 bg-slate-900 border-slate-700 text-white\"\n              data-testid=\"input-search-clients\"\n            />\n          </div>\n          <Select value={statusFilter} onValueChange={setStatusFilter}>\n            <SelectTrigger className=\"w-[180px] bg-slate-900 border-slate-700\" data-testid=\"select-status-filter\">\n              <Filter className=\"h-4 w-4 mr-2\" />\n              <SelectValue placeholder=\"Filter by status\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-slate-900 border-slate-700\">\n              <SelectItem value=\"all\">All Clients</SelectItem>\n              <SelectItem value=\"active\">Active</SelectItem>\n              <SelectItem value=\"prospect\">Prospects</SelectItem>\n              <SelectItem value=\"inactive\">Inactive</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Clients List */}\n        <div className=\"space-y-4\">\n          {filteredClients.length === 0 ? (\n            <Card className=\"bg-slate-900/50 border-slate-800\">\n              <CardContent className=\"py-12 text-center\">\n                <Users className=\"h-12 w-12 text-slate-600 mx-auto mb-4\" />\n                <p className=\"text-slate-400\">No clients found matching your search</p>\n              </CardContent>\n            </Card>\n          ) : (\n            filteredClients.map((client) => (\n              <Card \n                key={client.id} \n                className=\"bg-slate-900/50 border-slate-800 hover:border-slate-700 transition-colors cursor-pointer\"\n                data-testid={`card-client-${client.id}`}\n              >\n                <CardContent className=\"py-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"h-12 w-12 rounded-full bg-orange-500/10 flex items-center justify-center\">\n                        <span className=\"text-orange-500 font-semibold text-lg\">\n                          {client.name.split(' ').map(n => n[0]).join('')}\n                        </span>\n                      </div>\n                      <div>\n                        <div className=\"flex items-center gap-2\">\n                          <h3 className=\"text-white font-semibold\">{client.name}</h3>\n                          {getStatusBadge(client.status)}\n                        </div>\n                        {client.company && (\n                          <p className=\"text-slate-400 text-sm flex items-center gap-1\">\n                            <Building2 className=\"h-3 w-3\" />\n                            {client.company}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n\n                    <div className=\"hidden md:flex items-center gap-8\">\n                      <div className=\"text-right\">\n                        <p className=\"text-slate-400 text-xs uppercase\">Contact</p>\n                        <p className=\"text-slate-300 text-sm flex items-center gap-1\">\n                          <Mail className=\"h-3 w-3\" />\n                          {client.email}\n                        </p>\n                        <p className=\"text-slate-300 text-sm flex items-center gap-1\">\n                          <Phone className=\"h-3 w-3\" />\n                          {client.phone}\n                        </p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"text-slate-400 text-xs uppercase\">Location</p>\n                        <p className=\"text-slate-300 text-sm flex items-center gap-1\">\n                          <MapPin className=\"h-3 w-3\" />\n                          {client.city}, {client.state}\n                        </p>\n                      </div>\n                      <div className=\"text-center\">\n                        <p className=\"text-slate-400 text-xs uppercase\">Properties</p>\n                        <p className=\"text-2xl font-bold text-blue-400\">{client.totalProperties}</p>\n                      </div>\n                      <div className=\"text-center\">\n                        <p className=\"text-slate-400 text-xs uppercase\">Inspections</p>\n                        <p className=\"text-2xl font-bold text-orange-400\">{client.totalInspections}</p>\n                      </div>\n                    </div>\n\n                    <DropdownMenu>\n                      <DropdownMenuTrigger asChild>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"text-slate-400\" data-testid={`button-client-menu-${client.id}`}>\n                          <MoreHorizontal className=\"h-5 w-5\" />\n                        </Button>\n                      </DropdownMenuTrigger>\n                      <DropdownMenuContent className=\"bg-slate-800 border-slate-700\">\n                        <DropdownMenuItem className=\"text-slate-300 focus:bg-slate-700\" data-testid={`menu-item-view-${client.id}`}>\n                          View Details\n                        </DropdownMenuItem>\n                        <DropdownMenuItem className=\"text-slate-300 focus:bg-slate-700\" data-testid={`menu-item-edit-${client.id}`}>\n                          Edit Client\n                        </DropdownMenuItem>\n                        <DropdownMenuItem className=\"text-slate-300 focus:bg-slate-700\" data-testid={`menu-item-properties-${client.id}`}>\n                          View Properties\n                        </DropdownMenuItem>\n                        <DropdownMenuItem className=\"text-slate-300 focus:bg-slate-700\" data-testid={`menu-item-schedule-${client.id}`}>\n                          Schedule Inspection\n                        </DropdownMenuItem>\n                        <DropdownMenuItem className=\"text-red-400 focus:bg-slate-700\" data-testid={`menu-item-delete-${client.id}`}>\n                          Delete Client\n                        </DropdownMenuItem>\n                      </DropdownMenuContent>\n                    </DropdownMenu>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":18823,"size_tokens":null},"server/property-import.ts":{"content":"import * as XLSX from 'xlsx';\nimport Papa from 'papaparse';\n\nexport interface PropertyImportRow {\n  name: string;\n  address: string;\n  city?: string;\n  state?: string;\n  zipCode?: string;\n  buildingType?: string;\n  squareFootage?: number;\n  yearBuilt?: number;\n  roofType?: string;\n  roofAge?: number;\n  overallCondition?: string;\n  contactName?: string;\n  contactPhone?: string;\n  contactEmail?: string;\n  notes?: string;\n}\n\nexport interface ImportValidationResult {\n  row: number;\n  data: PropertyImportRow;\n  isValid: boolean;\n  errors: string[];\n  warnings: string[];\n}\n\nexport interface ImportResult {\n  totalRows: number;\n  validRows: number;\n  invalidRows: number;\n  importedCount: number;\n  skippedCount: number;\n  errors: { row: number; message: string }[];\n}\n\nexport interface ColumnMapping {\n  name?: string;\n  address?: string;\n  city?: string;\n  state?: string;\n  zipCode?: string;\n  buildingType?: string;\n  squareFootage?: string;\n  yearBuilt?: string;\n  roofType?: string;\n  roofAge?: string;\n  overallCondition?: string;\n  contactName?: string;\n  contactPhone?: string;\n  contactEmail?: string;\n  notes?: string;\n}\n\nconst REQUIRED_FIELDS = ['name', 'address'];\n\nexport function parseExcelFile(buffer: Buffer): { headers: string[]; rows: Record<string, any>[] } {\n  const workbook = XLSX.read(buffer, { type: 'buffer' });\n  const sheetName = workbook.SheetNames[0];\n  const worksheet = workbook.Sheets[sheetName];\n  \n  const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 }) as any[][];\n  \n  if (jsonData.length === 0) {\n    return { headers: [], rows: [] };\n  }\n  \n  const headers = jsonData[0].map((h: any) => String(h || '').trim());\n  const rows = jsonData.slice(1).map(row => {\n    const obj: Record<string, any> = {};\n    headers.forEach((header, index) => {\n      obj[header] = row[index];\n    });\n    return obj;\n  }).filter(row => Object.values(row).some(v => v !== undefined && v !== ''));\n  \n  return { headers, rows };\n}\n\nexport function parseCSVFile(content: string): { headers: string[]; rows: Record<string, any>[] } {\n  const result = Papa.parse(content, {\n    header: true,\n    skipEmptyLines: true,\n    transformHeader: (header: string) => header.trim()\n  });\n  \n  const headers = result.meta.fields || [];\n  const rows = result.data as Record<string, any>[];\n  \n  return { headers, rows };\n}\n\nexport function autoDetectColumnMapping(headers: string[]): ColumnMapping {\n  const mapping: ColumnMapping = {};\n  \n  const patterns: Record<keyof ColumnMapping, RegExp[]> = {\n    name: [/^name$/i, /property.*name/i, /^property$/i, /^title$/i],\n    address: [/^address$/i, /street.*address/i, /^street$/i, /property.*address/i],\n    city: [/^city$/i, /^town$/i],\n    state: [/^state$/i, /^province$/i, /^st$/i],\n    zipCode: [/^zip/i, /postal.*code/i, /^zip.*code$/i],\n    buildingType: [/building.*type/i, /property.*type/i, /^type$/i],\n    squareFootage: [/sq.*ft/i, /square.*foot/i, /sqft/i, /^size$/i, /^area$/i],\n    yearBuilt: [/year.*built/i, /built.*year/i, /construction.*year/i],\n    roofType: [/roof.*type/i, /roofing/i],\n    roofAge: [/roof.*age/i, /age.*roof/i],\n    overallCondition: [/condition/i, /status/i],\n    contactName: [/contact.*name/i, /owner.*name/i, /client.*name/i, /^contact$/i, /^owner$/i],\n    contactPhone: [/phone/i, /telephone/i, /^tel$/i],\n    contactEmail: [/email/i, /e-mail/i],\n    notes: [/notes/i, /comments/i, /remarks/i, /description/i]\n  };\n  \n  for (const header of headers) {\n    for (const [field, regexList] of Object.entries(patterns)) {\n      if (regexList.some(regex => regex.test(header))) {\n        if (!mapping[field as keyof ColumnMapping]) {\n          mapping[field as keyof ColumnMapping] = header;\n        }\n        break;\n      }\n    }\n  }\n  \n  return mapping;\n}\n\nexport function applyColumnMapping(\n  rows: Record<string, any>[],\n  mapping: ColumnMapping\n): PropertyImportRow[] {\n  return rows.map(row => {\n    const mapped: PropertyImportRow = {\n      name: mapping.name ? String(row[mapping.name] || '').trim() : '',\n      address: mapping.address ? String(row[mapping.address] || '').trim() : ''\n    };\n    \n    if (mapping.city) mapped.city = String(row[mapping.city] || '').trim();\n    if (mapping.state) mapped.state = String(row[mapping.state] || '').trim();\n    if (mapping.zipCode) mapped.zipCode = String(row[mapping.zipCode] || '').trim();\n    if (mapping.buildingType) mapped.buildingType = String(row[mapping.buildingType] || '').trim();\n    if (mapping.squareFootage) {\n      const val = parseFloat(String(row[mapping.squareFootage]).replace(/[^0-9.]/g, ''));\n      if (!isNaN(val)) mapped.squareFootage = val;\n    }\n    if (mapping.yearBuilt) {\n      const val = parseInt(String(row[mapping.yearBuilt]).replace(/[^0-9]/g, ''));\n      if (!isNaN(val) && val > 1800 && val <= new Date().getFullYear()) mapped.yearBuilt = val;\n    }\n    if (mapping.roofType) mapped.roofType = String(row[mapping.roofType] || '').trim();\n    if (mapping.roofAge) {\n      const val = parseInt(String(row[mapping.roofAge]).replace(/[^0-9]/g, ''));\n      if (!isNaN(val) && val >= 0 && val <= 100) mapped.roofAge = val;\n    }\n    if (mapping.overallCondition) {\n      const condition = String(row[mapping.overallCondition] || '').toLowerCase().trim();\n      if (['excellent', 'good', 'fair', 'poor', 'critical'].includes(condition)) {\n        mapped.overallCondition = condition;\n      }\n    }\n    if (mapping.contactName) mapped.contactName = String(row[mapping.contactName] || '').trim();\n    if (mapping.contactPhone) mapped.contactPhone = String(row[mapping.contactPhone] || '').trim();\n    if (mapping.contactEmail) mapped.contactEmail = String(row[mapping.contactEmail] || '').trim();\n    if (mapping.notes) mapped.notes = String(row[mapping.notes] || '').trim();\n    \n    // Combine address components if individual fields are provided\n    if (mapped.city || mapped.state || mapped.zipCode) {\n      const addressParts = [mapped.address];\n      if (mapped.city) addressParts.push(mapped.city);\n      if (mapped.state) addressParts.push(mapped.state);\n      if (mapped.zipCode) addressParts.push(mapped.zipCode);\n      mapped.address = addressParts.filter(Boolean).join(', ');\n    }\n    \n    return mapped;\n  });\n}\n\nexport function validateImportRows(rows: PropertyImportRow[]): ImportValidationResult[] {\n  return rows.map((row, index) => {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n    \n    // Required field validation\n    if (!row.name || row.name.length === 0) {\n      errors.push('Property name is required');\n    }\n    if (!row.address || row.address.length === 0) {\n      errors.push('Property address is required');\n    }\n    \n    // Data quality warnings\n    if (row.name && row.name.length < 3) {\n      warnings.push('Property name is very short');\n    }\n    if (row.address && row.address.length < 10) {\n      warnings.push('Address may be incomplete');\n    }\n    if (row.squareFootage && (row.squareFootage < 100 || row.squareFootage > 10000000)) {\n      warnings.push('Square footage seems unusual');\n    }\n    if (row.yearBuilt && row.yearBuilt > new Date().getFullYear()) {\n      warnings.push('Year built is in the future');\n    }\n    if (row.contactEmail && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(row.contactEmail)) {\n      warnings.push('Email format may be invalid');\n    }\n    \n    return {\n      row: index + 1,\n      data: row,\n      isValid: errors.length === 0,\n      errors,\n      warnings\n    };\n  });\n}\n\nexport function convertToPropertyInsert(\n  row: PropertyImportRow,\n  userId: number,\n  projectId?: number\n) {\n  return {\n    name: row.name,\n    address: row.address,\n    overallCondition: row.overallCondition,\n    userId,\n    projectId: projectId || null,\n    buildingInfo: {\n      buildingType: row.buildingType,\n      squareFootage: row.squareFootage,\n      yearBuilt: row.yearBuilt,\n      contactName: row.contactName,\n      contactPhone: row.contactPhone,\n      contactEmail: row.contactEmail,\n      notes: row.notes\n    },\n    roofSystemDetails: {\n      roofType: row.roofType,\n      roofAge: row.roofAge\n    }\n  };\n}\n","path":null,"size_bytes":8074,"size_tokens":null},"server/stormy-ai-service.ts":{"content":"import OpenAI from \"openai\";\nimport { storage } from \"./storage\";\nimport type { AIConversation, AIMessage, AIMemory, InsertAIConversation, InsertAIMessage, InsertAIMemory, AIMessageAttachment, AIMemoryPreferences } from \"@shared/schema\";\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst STORMY_MODEL = \"gpt-5\";\nconst MAX_CONTEXT_MESSAGES = 30;\nconst MAX_CONTEXT_TOKENS = 8000;\n\nconst openai = new OpenAI({ \n  apiKey: process.env.OPENAI_API_KEY || process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL || \"https://api.openai.com/v1\"\n});\n\nconst STORMY_SYSTEM_PROMPT = `You are Stormy, the AI assistant for WinnStorm™ - a professional damage assessment platform. You are an expert in the Winn Methodology, which is an 8-step systematic approach to property damage inspection and documentation.\n\nYour expertise includes:\n- Thermal imaging analysis and interpretation\n- Hail, wind, and storm damage identification\n- Insurance claim documentation best practices\n- Property inspection techniques using the Winn Methodology\n- Reading and analyzing thermal images for moisture detection, heat loss, and structural issues\n\nThe 8 Steps of the Winn Methodology:\n1. Weather Verification - Confirm storm events affected the property\n2. Property Documentation - Gather building information and specifications\n3. Exterior Survey - Systematic exterior damage assessment\n4. Interior Survey - Check for interior damage and moisture intrusion\n5. Thermal Scanning - Use infrared imaging to detect hidden issues\n6. Test Square Analysis - Document damage density using 10x10 test squares\n7. Evidence Compilation - Organize all photos, measurements, and findings\n8. Report Generation - Create comprehensive damage assessment report\n\nWhen analyzing images:\n- For thermal images: Identify temperature anomalies, moisture patterns, insulation deficiencies\n- For damage photos: Identify damage type, severity, affected components, and recommended repairs\n- Always relate findings to insurance claim documentation requirements\n\nRemember previous conversations and user preferences. Adapt your communication style based on the user's expertise level. Be professional, thorough, and helpful.`;\n\ninterface StormyMessage {\n  role: \"system\" | \"user\" | \"assistant\";\n  content: string | Array<{ type: \"text\" | \"image_url\"; text?: string; image_url?: { url: string } }>;\n}\n\nexport interface SendMessageOptions {\n  conversationId?: number;\n  userId: string;\n  message: string;\n  attachments?: AIMessageAttachment[];\n  propertyId?: number;\n  inspectionId?: number;\n  contextType?: string;\n}\n\nexport interface StormyResponse {\n  conversationId: number;\n  message: AIMessage;\n  conversation: AIConversation;\n}\n\nexport async function getOrCreateConversation(\n  userId: string,\n  propertyId?: number,\n  inspectionId?: number,\n  contextType: string = 'general'\n): Promise<AIConversation> {\n  const existingConversations = await storage.getAIConversationsByUser(userId);\n  \n  if (inspectionId) {\n    const inspectionConvo = existingConversations.find(\n      c => c.relatedInspectionId === inspectionId && c.status === 'active'\n    );\n    if (inspectionConvo) return inspectionConvo;\n  }\n  \n  if (propertyId && !inspectionId) {\n    const propertyConvo = existingConversations.find(\n      c => c.relatedPropertyId === propertyId && !c.relatedInspectionId && c.status === 'active'\n    );\n    if (propertyConvo) return propertyConvo;\n  }\n  \n  const generalConvo = existingConversations.find(\n    c => c.contextType === 'general' && c.status === 'active' && !c.relatedPropertyId && !c.relatedInspectionId\n  );\n  if (generalConvo && !propertyId && !inspectionId) return generalConvo;\n\n  const newConversation: InsertAIConversation = {\n    userId,\n    title: inspectionId ? `Inspection #${inspectionId}` : propertyId ? `Property #${propertyId}` : 'General Chat',\n    relatedPropertyId: propertyId,\n    relatedInspectionId: inspectionId,\n    contextType,\n    status: 'active'\n  };\n\n  return await storage.createAIConversation(newConversation);\n}\n\nexport async function getUserMemory(userId: string): Promise<AIMemory | null> {\n  const memories = await storage.getAIMemoryByUser(userId);\n  const globalMemory = memories.find(m => m.scope === 'global');\n  return globalMemory || null;\n}\n\nexport async function updateUserMemory(\n  userId: string,\n  updates: Partial<AIMemoryPreferences>,\n  summary?: string\n): Promise<AIMemory> {\n  const existingMemory = await getUserMemory(userId);\n  \n  if (existingMemory) {\n    const updatedPreferences = {\n      ...existingMemory.preferences,\n      ...updates\n    };\n    return await storage.updateAIMemory(existingMemory.id, {\n      preferences: updatedPreferences,\n      summary: summary || existingMemory.summary,\n      lastRefreshedAt: new Date()\n    });\n  }\n\n  const newMemory: InsertAIMemory = {\n    userId,\n    scope: 'global',\n    summary,\n    preferences: updates,\n    keywords: []\n  };\n\n  return await storage.createAIMemory(newMemory);\n}\n\nasync function buildContextMessages(\n  conversationId: number,\n  userMemory: AIMemory | null\n): Promise<StormyMessage[]> {\n  const messages = await storage.getAIMessagesByConversation(conversationId);\n  const recentMessages = messages.slice(-MAX_CONTEXT_MESSAGES);\n\n  const contextMessages: StormyMessage[] = [];\n\n  let systemPrompt = STORMY_SYSTEM_PROMPT;\n\n  if (userMemory?.preferences) {\n    const prefs = userMemory.preferences;\n    systemPrompt += \"\\n\\n## User Context (Remember this about the user):\";\n    \n    if (prefs.communicationStyle) {\n      systemPrompt += `\\n- Preferred communication style: ${prefs.communicationStyle}`;\n    }\n    if (prefs.focusAreas?.length) {\n      systemPrompt += `\\n- Focus areas of interest: ${prefs.focusAreas.join(', ')}`;\n    }\n    if (prefs.inspectionHistory?.length) {\n      systemPrompt += `\\n- Recent inspections: ${prefs.inspectionHistory.slice(-3).map(i => i.summary).join('; ')}`;\n    }\n  }\n\n  if (userMemory?.summary) {\n    systemPrompt += `\\n\\n## Conversation Summary:\\n${userMemory.summary}`;\n  }\n\n  contextMessages.push({ role: \"system\", content: systemPrompt });\n\n  for (const msg of recentMessages) {\n    if (msg.attachments?.length) {\n      const content: Array<{ type: \"text\" | \"image_url\"; text?: string; image_url?: { url: string } }> = [\n        { type: \"text\", text: msg.content }\n      ];\n      \n      for (const attachment of msg.attachments) {\n        if (attachment.url && (attachment.type === 'image' || attachment.type === 'thermal')) {\n          content.push({\n            type: \"image_url\",\n            image_url: { url: attachment.url }\n          });\n        }\n      }\n      \n      contextMessages.push({\n        role: msg.role as \"user\" | \"assistant\",\n        content\n      });\n    } else {\n      contextMessages.push({\n        role: msg.role as \"user\" | \"assistant\",\n        content: msg.content\n      });\n    }\n  }\n\n  return contextMessages;\n}\n\nexport async function sendMessage(options: SendMessageOptions): Promise<StormyResponse> {\n  const { userId, message, attachments, propertyId, inspectionId, contextType } = options;\n  \n  const startTime = Date.now();\n\n  let conversationId = options.conversationId;\n  let conversation: AIConversation;\n\n  if (conversationId) {\n    const existing = await storage.getAIConversation(conversationId);\n    if (!existing) throw new Error(\"Conversation not found\");\n    conversation = existing;\n  } else {\n    conversation = await getOrCreateConversation(userId, propertyId, inspectionId, contextType);\n    conversationId = conversation.id;\n  }\n\n  const userMessage: InsertAIMessage = {\n    conversationId,\n    role: 'user',\n    content: message,\n    attachments,\n    model: null,\n    metadata: {}\n  };\n  const savedUserMessage = await storage.createAIMessage(userMessage);\n\n  const userMemory = await getUserMemory(userId);\n  const contextMessages = await buildContextMessages(conversationId, userMemory);\n\n  const newUserContent: Array<{ type: \"text\" | \"image_url\"; text?: string; image_url?: { url: string } }> = [\n    { type: \"text\", text: message }\n  ];\n\n  if (attachments?.length) {\n    for (const attachment of attachments) {\n      if (attachment.url && (attachment.type === 'image' || attachment.type === 'thermal')) {\n        const imagePrompt = attachment.type === 'thermal' \n          ? \"This is a thermal image. Analyze it for temperature anomalies, moisture patterns, insulation issues, and potential damage indicators.\"\n          : \"Analyze this property damage image. Identify the damage type, severity, affected components, and provide recommendations.\";\n        \n        newUserContent[0].text = `${imagePrompt}\\n\\n${message}`;\n        newUserContent.push({\n          type: \"image_url\",\n          image_url: { url: attachment.url }\n        });\n      }\n    }\n  }\n\n  const messagesForAPI = [\n    ...contextMessages,\n    { role: \"user\" as const, content: attachments?.length ? newUserContent : message }\n  ];\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: STORMY_MODEL,\n      messages: messagesForAPI as any,\n      max_completion_tokens: 2048,\n    });\n\n    const assistantContent = response.choices[0]?.message?.content || \"I apologize, I couldn't generate a response. Please try again.\";\n    const processingTime = Date.now() - startTime;\n\n    const assistantMessage: InsertAIMessage = {\n      conversationId,\n      role: 'assistant',\n      content: assistantContent,\n      model: STORMY_MODEL,\n      attachments: null,\n      metadata: {\n        promptTokens: response.usage?.prompt_tokens || 0,\n        completionTokens: response.usage?.completion_tokens || 0,\n        totalTokens: response.usage?.total_tokens || 0\n      }\n    };\n\n    const savedAssistantMessage = await storage.createAIMessage(assistantMessage);\n\n    await storage.updateAIConversation(conversationId, {\n      messageCount: (conversation.messageCount || 0) + 2,\n      lastMessageAt: new Date(),\n      updatedAt: new Date()\n    });\n\n    const updatedConversation = await storage.getAIConversation(conversationId);\n\n    return {\n      conversationId,\n      message: { ...savedAssistantMessage, processingTime },\n      conversation: updatedConversation!\n    };\n  } catch (error: any) {\n    console.error(\"Stormy AI error:\", error);\n    throw new Error(`Stormy couldn't respond: ${error.message}`);\n  }\n}\n\nexport async function analyzeImage(\n  userId: string,\n  imageUrl: string,\n  imageType: 'thermal' | 'damage' | 'general' = 'general',\n  additionalContext?: string\n): Promise<{ analysis: string; recommendations: string[] }> {\n  const prompts: Record<string, string> = {\n    thermal: `Analyze this thermal image for a property damage assessment. Identify:\n1. Temperature anomalies and their locations\n2. Potential moisture intrusion areas (cooler spots from evaporative cooling)\n3. Insulation deficiencies (hot/cold spots indicating missing insulation)\n4. Thermal bridging (heat transfer through building materials)\n5. Any electrical hotspots or HVAC issues\n\nProvide specific findings with severity ratings (Critical, Warning, Info) and recommended actions.`,\n    \n    damage: `Analyze this property damage photograph. Identify:\n1. Type of damage visible (hail, wind, water, impact, etc.)\n2. Affected building components (roof, siding, gutters, etc.)\n3. Severity assessment (minor, moderate, severe)\n4. Signs of pre-existing vs. storm-related damage\n5. Recommended repairs and documentation needs\n\nThis analysis will be used for insurance claim documentation using the Winn Methodology.`,\n    \n    general: `Analyze this property image and provide relevant observations for a damage assessment. Note any visible issues, damage, or conditions that would be relevant for insurance documentation.`\n  };\n\n  const prompt = additionalContext \n    ? `${prompts[imageType]}\\n\\nAdditional context: ${additionalContext}`\n    : prompts[imageType];\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: STORMY_MODEL,\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are Stormy, an expert property damage analyst. Provide detailed, professional analysis suitable for insurance documentation. Output your response as JSON with 'analysis' (detailed text) and 'recommendations' (array of actionable items).\"\n        },\n        {\n          role: \"user\",\n          content: [\n            { type: \"text\", text: prompt + \"\\n\\nRespond with JSON format: { \\\"analysis\\\": \\\"...\\\", \\\"recommendations\\\": [\\\"...\\\"] }\" },\n            { type: \"image_url\", image_url: { url: imageUrl } }\n          ]\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      max_completion_tokens: 2048,\n    });\n\n    const content = response.choices[0]?.message?.content || '{\"analysis\": \"Unable to analyze image\", \"recommendations\": []}';\n    const result = JSON.parse(content);\n    \n    return {\n      analysis: result.analysis || \"No analysis available\",\n      recommendations: result.recommendations || []\n    };\n  } catch (error: any) {\n    console.error(\"Image analysis error:\", error);\n    return {\n      analysis: `Analysis failed: ${error.message}`,\n      recommendations: [\"Please try uploading the image again\", \"Ensure the image is clear and well-lit\"]\n    };\n  }\n}\n\nexport async function getConversationHistory(\n  conversationId: number\n): Promise<AIMessage[]> {\n  return await storage.getAIMessagesByConversation(conversationId);\n}\n\nexport async function getUserConversations(\n  userId: string\n): Promise<AIConversation[]> {\n  return await storage.getAIConversationsByUser(userId);\n}\n","path":null,"size_bytes":13620,"size_tokens":null},"client/src/pages/blog.tsx":{"content":"import { Header, Footer } from '@/components/navbar';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { SEO, faqSchema, breadcrumbSchema } from '@/components/seo';\nimport { Breadcrumb } from '@/components/breadcrumb';\nimport { Link } from 'wouter';\nimport { \n  Calendar, Clock, ArrowRight, User, Tag,\n  Thermometer, CloudLightning, FileText, Shield,\n  CheckCircle, AlertTriangle\n} from 'lucide-react';\n\ninterface BlogPost {\n  slug: string;\n  title: string;\n  excerpt: string;\n  content: string;\n  author: string;\n  date: string;\n  readTime: string;\n  category: string;\n  tags: string[];\n  image?: string;\n  featured?: boolean;\n}\n\nconst blogPosts: BlogPost[] = [\n  {\n    slug: 'what-is-thermal-imaging-inspection',\n    title: 'What Is Thermal Imaging Inspection? A Complete Guide for Property Owners',\n    excerpt: 'Learn how thermal imaging technology detects hidden moisture, insulation problems, and structural damage that visual inspections miss. Discover why thermal inspections are essential for insurance claims.',\n    content: `\nThermal imaging inspection, also known as infrared thermography, is a non-invasive diagnostic technique that uses specialized cameras to detect temperature variations in building materials. These temperature differences can reveal hidden problems that are invisible to the naked eye.\n\n## How Thermal Imaging Works\n\nThermal cameras detect infrared radiation (heat) emitted by objects and convert it into a visual image. Different temperatures appear as different colors, typically ranging from cool blues and purples to warm reds and whites. This allows trained inspectors to identify:\n\n- **Moisture intrusion**: Wet areas appear cooler due to evaporative cooling\n- **Insulation deficiencies**: Missing or damaged insulation shows as hot or cold spots\n- **Air leaks**: Temperature differentials around windows, doors, and penetrations\n- **Electrical issues**: Overheating components show as hot spots\n- **Roof damage**: Trapped moisture under roofing materials\n\n## Why Thermal Imaging Matters for Insurance Claims\n\nWhen filing a property damage claim, documentation is everything. Thermal imaging provides objective, scientific evidence of damage that adjusters cannot dispute. Our Winn Reports include thermal analysis that helps property owners receive fair settlements.\n\n## Best Conditions for Thermal Inspection\n\nFor optimal results, thermal inspections should be performed when there's at least a 20°F temperature difference between interior and exterior. Early morning or after sunset typically provides the best conditions for detecting moisture and insulation issues.\n\n## The WinnStorm Advantage\n\nOur AI-powered Stormy assistant analyzes thermal images in real-time, automatically identifying anomalies and potential damage areas. This technology, combined with certified consultant expertise, ensures comprehensive documentation for your property assessment.\n    `,\n    author: 'Eric Winn',\n    date: '2025-12-08',\n    readTime: '8 min read',\n    category: 'Thermal Imaging',\n    tags: ['thermal imaging', 'property inspection', 'moisture detection', 'insurance claims'],\n    featured: true\n  },\n  {\n    slug: 'hail-damage-roof-signs',\n    title: '7 Signs of Hail Damage on Your Roof That Insurance Adjusters Look For',\n    excerpt: 'Discover the telltale signs of hail damage that determine whether your insurance claim gets approved. Learn what certified damage assessors look for during professional inspections.',\n    content: `\nHail damage can be subtle yet devastating to your roof's integrity. Knowing what to look for - and what insurance adjusters examine - can make the difference between a denied claim and full coverage.\n\n## 1. Granule Loss on Shingles\n\nHail impacts dislodge the protective granules from asphalt shingles. Check your gutters and downspouts for accumulated granules. Significant granule loss exposes the underlying asphalt to UV damage and accelerates deterioration.\n\n## 2. Soft Spots and Bruising\n\nPress gently on shingle surfaces. Hail-damaged areas feel softer than surrounding material due to compromised underlying structure. This \"bruising\" weakens the shingle even when no visible damage exists.\n\n## 3. Cracked or Split Shingles\n\nLarge hail can crack shingles immediately upon impact. Look for linear cracks running across multiple shingles, often following the hail's trajectory.\n\n## 4. Dented Soft Metals\n\nGutters, downspouts, vents, and flashing are often the first indicators of hail impact. These soft metals show damage more readily than roofing materials.\n\n## 5. Damaged Ridge Caps\n\nRidge caps take the brunt of hail impacts. Examine the peak of your roof for signs of damage to these critical protective components.\n\n## 6. Random Pattern Damage\n\nUnlike wear damage that follows patterns, hail damage appears randomly across the roof surface. Adjusters look for this random distribution as evidence of a weather event.\n\n## 7. Collateral Damage\n\nAC units, skylights, outdoor furniture, and vehicles often show hail damage. Documenting this collateral damage strengthens your roof damage claim.\n\n## The Professional Advantage\n\nThe Winn Methodology includes systematic test square analysis that quantifies damage density across your entire roof. This statistical approach provides the defensible documentation insurance companies require.\n    `,\n    author: 'Eric Winn',\n    date: '2025-12-07',\n    readTime: '6 min read',\n    category: 'Hail Damage',\n    tags: ['hail damage', 'roof inspection', 'insurance claim', 'storm damage']\n  },\n  {\n    slug: 'storm-damage-insurance-claim-timeline',\n    title: 'Storm Damage Insurance Claims: A Step-by-Step Timeline for Property Owners',\n    excerpt: 'Navigate the storm damage insurance claim process with confidence. This comprehensive timeline covers everything from initial documentation to final settlement.',\n    content: `\nFiling a storm damage insurance claim can feel overwhelming. This timeline breaks down the process into manageable steps, helping you maximize your chances of a fair settlement.\n\n## Immediately After the Storm (Day 1-3)\n\n**Document Everything**\n- Take photos and videos of all visible damage\n- Document the date and time of the storm\n- Note any emergency repairs needed for safety\n\n**File Your Claim**\n- Contact your insurance company promptly\n- Get a claim number and adjuster contact information\n- Request a copy of your policy\n\n## First Week\n\n**Prevent Further Damage**\n- Make temporary repairs to prevent additional damage\n- Keep all receipts for emergency repairs\n- Don't dispose of damaged materials\n\n**Schedule Professional Assessment**\n- Contact a certified damage assessment consultant\n- Get a comprehensive Winn Report prepared\n- Document all damage with thermal imaging\n\n## Adjuster Visit (Week 2-4)\n\n**Be Prepared**\n- Have your documentation ready\n- Point out all damage areas\n- Provide your professional assessment report\n- Ask questions about the scope of their review\n\n## After Initial Estimate\n\n**Review Carefully**\n- Compare adjuster's estimate to your assessment\n- Identify any missed damage\n- Request re-inspection if damage was overlooked\n\n## Settlement Negotiation\n\n**Advocate for Fair Value**\n- Present thermal imaging evidence for hidden damage\n- Use test square data to support damage extent\n- Consider hiring a public adjuster if needed\n\n## The Importance of Professional Documentation\n\nClaims with comprehensive Winn Reports see significantly higher approval rates. Our methodology provides the detailed, defensible evidence that moves claims through the process efficiently.\n    `,\n    author: 'WinnStorm Team',\n    date: '2025-12-06',\n    readTime: '10 min read',\n    category: 'Insurance Claims',\n    tags: ['insurance claims', 'storm damage', 'claim timeline', 'property damage']\n  },\n  {\n    slug: 'winn-methodology-explained',\n    title: 'The Winn Methodology Explained: 8 Steps to Defensible Damage Assessment',\n    excerpt: 'Understand the industry-leading Winn Methodology used by certified damage consultants worldwide. Learn how this 8-step process creates comprehensive, defensible property damage reports.',\n    content: `\nThe Winn Methodology represents decades of field experience distilled into a systematic, repeatable approach to property damage assessment. Developed by Eric Winn, this methodology has become the gold standard for professional damage consulting.\n\n## Step 1: Weather Verification\n\nEvery assessment begins with establishing the weather event. Using NOAA and NWS historical data, we document hail size, wind speeds, and storm timing to correlate with reported damage.\n\n## Step 2: Thermal Analysis\n\nAI-powered thermal imaging reveals hidden moisture intrusion, insulation damage, and structural issues invisible to standard inspection methods.\n\n## Step 3: Terrestrial Documentation\n\nComprehensive ground-level photo documentation captures all visible damage indicators, from soft metal impacts to siding damage.\n\n## Step 4: Roof Section Mapping\n\nUsing satellite imagery, we create detailed maps of distinct roof sections to organize and track damage systematically.\n\n## Step 5: Test Square Analysis\n\nIndustry-standard 10x10 foot test squares quantify damage density, providing statistical basis for extrapolating total roof damage.\n\n## Step 6: Core Sample Collection\n\nWhen applicable, physical samples verify material condition and age, supporting repair versus replacement determinations.\n\n## Step 7: Damage Quantification\n\nAll findings compile into quantified assessments with repair cost estimates, depreciation calculations, and line-item damage schedules.\n\n## Step 8: Winn Report Generation\n\nThe final comprehensive report assembles all evidence into a professional, defensible document formatted for insurance submission.\n\n## Why the Methodology Matters\n\nInsurance adjusters respect Winn Reports because they provide systematic, thorough documentation that withstands scrutiny. Our certified consultants follow this methodology on every inspection, ensuring consistent, professional results.\n    `,\n    author: 'Eric Winn',\n    date: '2025-12-05',\n    readTime: '7 min read',\n    category: 'Methodology',\n    tags: ['Winn Methodology', 'damage assessment', 'property inspection', 'certification'],\n    featured: true\n  }\n];\n\nconst categories = ['All', 'Thermal Imaging', 'Hail Damage', 'Insurance Claims', 'Methodology'];\n\nfunction BlogIndex() {\n  const featuredPost = blogPosts.find(post => post.featured);\n  const regularPosts = blogPosts.filter(post => post !== featuredPost);\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\" data-testid=\"blog-index\">\n      <SEO\n        title=\"Storm Damage Assessment Blog - Expert Insights & Guides\"\n        description=\"Expert articles on thermal imaging, hail damage assessment, storm damage insurance claims, and the Winn Methodology. Learn from certified damage assessment professionals.\"\n        canonical=\"/blog\"\n        keywords={[\n          'storm damage blog',\n          'thermal imaging guides',\n          'hail damage articles',\n          'insurance claim tips',\n          'Winn Methodology guide',\n          'property damage assessment'\n        ]}\n      />\n      \n      <Header />\n      \n      <main className=\"flex-grow\">\n        {/* Hero */}\n        <section className=\"py-16 px-6 bg-gradient-to-b from-primary/10 to-background\">\n          <div className=\"max-w-6xl mx-auto\">\n            <Breadcrumb items={[{ name: 'Blog', url: '/blog' }]} className=\"mb-6\" />\n            \n            <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">\n              WinnStorm <span className=\"text-primary\">Knowledge Hub</span>\n            </h1>\n            <p className=\"text-xl text-muted-foreground max-w-2xl\">\n              Expert insights on damage assessment, thermal imaging, insurance claims, and the Winn Methodology from certified professionals.\n            </p>\n          </div>\n        </section>\n\n        {/* Featured Post */}\n        {featuredPost && (\n          <section className=\"py-12 px-6 bg-background\">\n            <div className=\"max-w-6xl mx-auto\">\n              <h2 className=\"text-sm font-semibold text-primary uppercase tracking-wide mb-6\">Featured Article</h2>\n              \n              <Link href={`/blog/${featuredPost.slug}`}>\n                <Card className=\"border-primary/20 hover:shadow-lg transition-shadow cursor-pointer overflow-hidden\">\n                  <div className=\"grid md:grid-cols-2 gap-6\">\n                    <div className=\"bg-gradient-to-br from-primary/20 to-cyan-500/20 p-8 flex items-center justify-center\">\n                      <Thermometer className=\"h-24 w-24 text-primary/60\" />\n                    </div>\n                    <CardContent className=\"p-6 flex flex-col justify-center\">\n                      <div className=\"flex items-center gap-2 mb-3\">\n                        <Badge variant=\"secondary\">{featuredPost.category}</Badge>\n                        <span className=\"text-sm text-muted-foreground flex items-center\">\n                          <Clock className=\"h-3 w-3 mr-1\" />\n                          {featuredPost.readTime}\n                        </span>\n                      </div>\n                      <h3 className=\"text-2xl font-bold mb-3 hover:text-primary transition-colors\">\n                        {featuredPost.title}\n                      </h3>\n                      <p className=\"text-muted-foreground mb-4\">{featuredPost.excerpt}</p>\n                      <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                        <span className=\"flex items-center\">\n                          <User className=\"h-4 w-4 mr-1\" />\n                          {featuredPost.author}\n                        </span>\n                        <span className=\"flex items-center\">\n                          <Calendar className=\"h-4 w-4 mr-1\" />\n                          {new Date(featuredPost.date).toLocaleDateString('en-US', { \n                            month: 'long', \n                            day: 'numeric', \n                            year: 'numeric' \n                          })}\n                        </span>\n                      </div>\n                    </CardContent>\n                  </div>\n                </Card>\n              </Link>\n            </div>\n          </section>\n        )}\n\n        {/* Category Filter */}\n        <section className=\"py-6 px-6 bg-muted/30\">\n          <div className=\"max-w-6xl mx-auto\">\n            <div className=\"flex flex-wrap gap-2\">\n              {categories.map(category => (\n                <Button\n                  key={category}\n                  variant={category === 'All' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  className=\"rounded-full\"\n                  data-testid={`filter-${category.toLowerCase().replace(/\\s+/g, '-')}`}\n                >\n                  {category}\n                </Button>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Blog Posts Grid */}\n        <section className=\"py-12 px-6 bg-background\">\n          <div className=\"max-w-6xl mx-auto\">\n            <h2 className=\"text-2xl font-bold mb-8\">Latest Articles</h2>\n            \n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {regularPosts.map(post => (\n                <Link key={post.slug} href={`/blog/${post.slug}`}>\n                  <Card className=\"h-full hover:shadow-lg transition-shadow cursor-pointer\" data-testid={`blog-card-${post.slug}`}>\n                    <CardHeader>\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <Badge variant=\"outline\" className=\"text-xs\">{post.category}</Badge>\n                      </div>\n                      <CardTitle className=\"text-lg leading-tight hover:text-primary transition-colors\">\n                        {post.title}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-sm text-muted-foreground mb-4 line-clamp-3\">\n                        {post.excerpt}\n                      </p>\n                      <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                        <span className=\"flex items-center\">\n                          <Calendar className=\"h-3 w-3 mr-1\" />\n                          {new Date(post.date).toLocaleDateString('en-US', { \n                            month: 'short', \n                            day: 'numeric' \n                          })}\n                        </span>\n                        <span className=\"flex items-center\">\n                          <Clock className=\"h-3 w-3 mr-1\" />\n                          {post.readTime}\n                        </span>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </Link>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Newsletter CTA */}\n        <section className=\"py-16 px-6 bg-gradient-to-r from-primary to-cyan-500 text-white\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <h2 className=\"text-3xl font-bold mb-4\">Stay Updated on Damage Assessment Insights</h2>\n            <p className=\"text-lg opacity-90 mb-8\">\n              Get the latest articles, industry updates, and expert tips delivered to your inbox.\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto\">\n              <input\n                type=\"email\"\n                placeholder=\"Enter your email\"\n                className=\"flex-1 px-4 py-3 rounded-lg text-gray-900\"\n                data-testid=\"input-newsletter-email\"\n              />\n              <Button variant=\"secondary\" className=\"text-gray-900\" data-testid=\"button-subscribe\">\n                Subscribe\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </div>\n          </div>\n        </section>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}\n\nfunction BlogPost({ slug }: { slug: string }) {\n  const post = blogPosts.find(p => p.slug === slug);\n  \n  if (!post) {\n    return (\n      <div className=\"min-h-screen flex flex-col bg-background\">\n        <Header />\n        <main className=\"flex-grow flex items-center justify-center\">\n          <div className=\"text-center\">\n            <h1 className=\"text-2xl font-bold mb-4\">Article Not Found</h1>\n            <Link href=\"/blog\">\n              <Button>Back to Blog</Button>\n            </Link>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const articleSchema = {\n    \"@context\": \"https://schema.org\",\n    \"@type\": \"Article\",\n    \"headline\": post.title,\n    \"description\": post.excerpt,\n    \"author\": {\n      \"@type\": \"Person\",\n      \"name\": post.author\n    },\n    \"publisher\": {\n      \"@type\": \"Organization\",\n      \"name\": \"WinnStorm™\",\n      \"logo\": {\n        \"@type\": \"ImageObject\",\n        \"url\": \"https://winnstorm.com/logo.png\"\n      }\n    },\n    \"datePublished\": post.date,\n    \"dateModified\": post.date,\n    \"mainEntityOfPage\": {\n      \"@type\": \"WebPage\",\n      \"@id\": `https://winnstorm.com/blog/${post.slug}`\n    },\n    \"keywords\": post.tags.join(', ')\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\" data-testid={`blog-post-${slug}`}>\n      <SEO\n        title={post.title}\n        description={post.excerpt}\n        canonical={`/blog/${post.slug}`}\n        type=\"article\"\n        keywords={post.tags}\n        structuredData={articleSchema}\n      />\n      \n      <Header />\n      \n      <main className=\"flex-grow\">\n        {/* Article Header */}\n        <section className=\"py-12 px-6 bg-gradient-to-b from-primary/10 to-background\">\n          <div className=\"max-w-4xl mx-auto\">\n            <Breadcrumb \n              items={[\n                { name: 'Blog', url: '/blog' },\n                { name: post.category, url: `/blog?category=${encodeURIComponent(post.category)}` },\n                { name: post.title.substring(0, 30) + '...', url: `/blog/${post.slug}` }\n              ]} \n              className=\"mb-6\" \n            />\n            \n            <div className=\"flex items-center gap-2 mb-4\">\n              <Badge>{post.category}</Badge>\n              <span className=\"text-sm text-muted-foreground flex items-center\">\n                <Clock className=\"h-3 w-3 mr-1\" />\n                {post.readTime}\n              </span>\n            </div>\n            \n            <h1 className=\"text-3xl md:text-4xl font-bold mb-6\">\n              {post.title}\n            </h1>\n            \n            <div className=\"flex items-center gap-6 text-muted-foreground\">\n              <span className=\"flex items-center\">\n                <User className=\"h-4 w-4 mr-2\" />\n                {post.author}\n              </span>\n              <span className=\"flex items-center\">\n                <Calendar className=\"h-4 w-4 mr-2\" />\n                {new Date(post.date).toLocaleDateString('en-US', { \n                  month: 'long', \n                  day: 'numeric', \n                  year: 'numeric' \n                })}\n              </span>\n            </div>\n          </div>\n        </section>\n\n        {/* Article Content */}\n        <article className=\"py-12 px-6\">\n          <div className=\"max-w-4xl mx-auto prose prose-lg dark:prose-invert\">\n            {post.content.split('\\n\\n').map((paragraph, index) => {\n              if (paragraph.startsWith('## ')) {\n                return <h2 key={index} className=\"text-2xl font-bold mt-8 mb-4\">{paragraph.replace('## ', '')}</h2>;\n              }\n              if (paragraph.startsWith('**') && paragraph.endsWith('**')) {\n                return <p key={index} className=\"font-semibold\">{paragraph.replace(/\\*\\*/g, '')}</p>;\n              }\n              if (paragraph.startsWith('- ')) {\n                const items = paragraph.split('\\n').filter(line => line.startsWith('- '));\n                return (\n                  <ul key={index} className=\"list-disc pl-6 space-y-2\">\n                    {items.map((item, i) => (\n                      <li key={i}>{item.replace('- ', '').replace(/\\*\\*/g, '')}</li>\n                    ))}\n                  </ul>\n                );\n              }\n              if (paragraph.trim()) {\n                return <p key={index} className=\"mb-4\">{paragraph}</p>;\n              }\n              return null;\n            })}\n          </div>\n        </article>\n\n        {/* Tags */}\n        <section className=\"py-8 px-6 border-t\">\n          <div className=\"max-w-4xl mx-auto\">\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <Tag className=\"h-4 w-4 text-muted-foreground\" />\n              {post.tags.map(tag => (\n                <Badge key={tag} variant=\"secondary\" className=\"text-xs\">\n                  {tag}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Related Articles */}\n        <section className=\"py-12 px-6 bg-muted/30\">\n          <div className=\"max-w-6xl mx-auto\">\n            <h2 className=\"text-2xl font-bold mb-8\">Related Articles</h2>\n            <div className=\"grid md:grid-cols-3 gap-6\">\n              {blogPosts\n                .filter(p => p.slug !== post.slug)\n                .slice(0, 3)\n                .map(relatedPost => (\n                  <Link key={relatedPost.slug} href={`/blog/${relatedPost.slug}`}>\n                    <Card className=\"h-full hover:shadow-lg transition-shadow cursor-pointer\">\n                      <CardContent className=\"p-6\">\n                        <Badge variant=\"outline\" className=\"mb-3\">{relatedPost.category}</Badge>\n                        <h3 className=\"font-bold mb-2 hover:text-primary transition-colors line-clamp-2\">\n                          {relatedPost.title}\n                        </h3>\n                        <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                          {relatedPost.excerpt}\n                        </p>\n                      </CardContent>\n                    </Card>\n                  </Link>\n                ))}\n            </div>\n          </div>\n        </section>\n\n        {/* CTA */}\n        <section className=\"section-dark py-12 px-6\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <h2 className=\"text-2xl font-bold text-white mb-4\">\n              Need Professional Damage Assessment?\n            </h2>\n            <p className=\"text-white/70 mb-6\">\n              Our certified consultants use the Winn Methodology to create comprehensive, defensible reports.\n            </p>\n            <Link href=\"/auth\">\n              <Button className=\"btn-primary\" data-testid=\"button-cta\">\n                Get Free Assessment\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </Link>\n          </div>\n        </section>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}\n\nexport { BlogIndex, BlogPost, blogPosts };\nexport default BlogIndex;\n","path":null,"size_bytes":25174,"size_tokens":null},"client/src/components/property-import.tsx":{"content":"import { useState, useCallback } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useToast } from '@/hooks/use-toast';\nimport { Upload, FileSpreadsheet, CheckCircle, AlertCircle, XCircle, ArrowRight, Loader2 } from 'lucide-react';\nimport { auth } from '@/lib/firebase';\n\nasync function fetchWithAuth(url: string, options: RequestInit = {}): Promise<Response> {\n  const currentUser = auth.currentUser;\n  const headers = new Headers(options.headers);\n  \n  if (currentUser) {\n    try {\n      const idToken = await currentUser.getIdToken();\n      headers.set('Authorization', `Bearer ${idToken}`);\n    } catch (error) {\n      console.warn('Failed to get auth token:', error);\n    }\n  }\n  \n  return fetch(url, {\n    ...options,\n    headers,\n    credentials: 'include'\n  });\n}\n\ninterface ColumnMapping {\n  name?: string;\n  address?: string;\n  city?: string;\n  state?: string;\n  zipCode?: string;\n  buildingType?: string;\n  squareFootage?: string;\n  yearBuilt?: string;\n  roofType?: string;\n  roofAge?: string;\n  overallCondition?: string;\n  contactName?: string;\n  contactPhone?: string;\n  contactEmail?: string;\n  notes?: string;\n}\n\ninterface ValidationResult {\n  row: number;\n  data: Record<string, any>;\n  isValid: boolean;\n  errors: string[];\n  warnings: string[];\n}\n\ninterface ImportResult {\n  totalRows: number;\n  importedCount: number;\n  skippedCount: number;\n  errors: { row: number; message: string }[];\n}\n\nconst MAPPING_FIELDS = [\n  { key: 'name', label: 'Property Name', required: true },\n  { key: 'address', label: 'Address', required: true },\n  { key: 'city', label: 'City', required: false },\n  { key: 'state', label: 'State', required: false },\n  { key: 'zipCode', label: 'ZIP Code', required: false },\n  { key: 'buildingType', label: 'Building Type', required: false },\n  { key: 'squareFootage', label: 'Square Footage', required: false },\n  { key: 'yearBuilt', label: 'Year Built', required: false },\n  { key: 'roofType', label: 'Roof Type', required: false },\n  { key: 'roofAge', label: 'Roof Age', required: false },\n  { key: 'overallCondition', label: 'Condition', required: false },\n  { key: 'contactName', label: 'Contact Name', required: false },\n  { key: 'contactPhone', label: 'Contact Phone', required: false },\n  { key: 'contactEmail', label: 'Contact Email', required: false },\n  { key: 'notes', label: 'Notes', required: false },\n];\n\ntype ImportStep = 'upload' | 'mapping' | 'validation' | 'importing' | 'complete';\n\nexport function PropertyImport({ onComplete }: { onComplete?: () => void }) {\n  const [step, setStep] = useState<ImportStep>('upload');\n  const [file, setFile] = useState<File | null>(null);\n  const [headers, setHeaders] = useState<string[]>([]);\n  const [mapping, setMapping] = useState<ColumnMapping>({});\n  const [preview, setPreview] = useState<Record<string, any>[]>([]);\n  const [validationResults, setValidationResults] = useState<ValidationResult[]>([]);\n  const [importResult, setImportResult] = useState<ImportResult | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n\n  const handleFileUpload = useCallback(async (uploadedFile: File) => {\n    setFile(uploadedFile);\n    setIsLoading(true);\n\n    try {\n      const formData = new FormData();\n      formData.append('file', uploadedFile);\n\n      const response = await fetchWithAuth('/api/properties/import/parse', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to parse file');\n      }\n\n      const data = await response.json();\n      setHeaders(data.headers);\n      setMapping(data.suggestedMapping);\n      setPreview(data.preview);\n      setStep('mapping');\n\n      toast({\n        title: \"File Parsed Successfully\",\n        description: `Found ${data.rowCount} rows with ${data.headers.length} columns`,\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Failed to Parse File\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  }, [toast]);\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    const droppedFile = e.dataTransfer.files[0];\n    if (droppedFile && (droppedFile.name.endsWith('.csv') || droppedFile.name.endsWith('.xlsx') || droppedFile.name.endsWith('.xls'))) {\n      handleFileUpload(droppedFile);\n    } else {\n      toast({\n        title: \"Invalid File Type\",\n        description: \"Please upload a CSV or Excel file\",\n        variant: \"destructive\",\n      });\n    }\n  }, [handleFileUpload, toast]);\n\n  const handleValidate = async () => {\n    if (!file) return;\n    setIsLoading(true);\n\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n      formData.append('mapping', JSON.stringify(mapping));\n\n      const response = await fetchWithAuth('/api/properties/import/validate', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Validation failed');\n      }\n\n      const data = await response.json();\n      setValidationResults(data.results);\n      setStep('validation');\n\n      toast({\n        title: \"Validation Complete\",\n        description: `${data.validRows} valid, ${data.invalidRows} invalid rows`,\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Validation Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleImport = async () => {\n    if (!file) return;\n    setStep('importing');\n    setIsLoading(true);\n\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n      formData.append('mapping', JSON.stringify(mapping));\n\n      const response = await fetchWithAuth('/api/properties/import/execute', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Import failed');\n      }\n\n      const data = await response.json();\n      setImportResult(data);\n      setStep('complete');\n\n      toast({\n        title: \"Import Complete\",\n        description: `Successfully imported ${data.importedCount} properties`,\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Import Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      setStep('validation');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const updateMapping = (field: string, value: string) => {\n    setMapping(prev => ({\n      ...prev,\n      [field]: value === '__none__' ? undefined : value\n    }));\n  };\n\n  const resetImport = () => {\n    setStep('upload');\n    setFile(null);\n    setHeaders([]);\n    setMapping({});\n    setPreview([]);\n    setValidationResults([]);\n    setImportResult(null);\n  };\n\n  const validCount = validationResults.filter(r => r.isValid).length;\n  const invalidCount = validationResults.filter(r => !r.isValid).length;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center gap-2 mb-4\">\n        {['upload', 'mapping', 'validation', 'complete'].map((s, i) => (\n          <div key={s} className=\"flex items-center\">\n            <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${\n              step === s || ['upload', 'mapping', 'validation', 'complete'].indexOf(step) > i\n                ? 'bg-primary text-primary-foreground'\n                : 'bg-muted text-muted-foreground'\n            }`}>\n              {i + 1}\n            </div>\n            {i < 3 && (\n              <div className={`w-12 h-0.5 ${\n                ['upload', 'mapping', 'validation', 'complete'].indexOf(step) > i\n                  ? 'bg-primary'\n                  : 'bg-muted'\n              }`} />\n            )}\n          </div>\n        ))}\n      </div>\n\n      {step === 'upload' && (\n        <Card className=\"bg-card border-border\">\n          <CardHeader>\n            <CardTitle className=\"text-foreground\">Upload Property List</CardTitle>\n            <CardDescription className=\"text-muted-foreground\">\n              Upload a CSV or Excel file with your property data\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div\n              onDrop={handleDrop}\n              onDragOver={(e) => e.preventDefault()}\n              className=\"border-2 border-dashed border-border rounded-lg p-12 text-center hover:border-primary transition-colors cursor-pointer\"\n              onClick={() => document.getElementById('file-input')?.click()}\n              data-testid=\"file-dropzone\"\n            >\n              {isLoading ? (\n                <Loader2 className=\"w-12 h-12 mx-auto text-primary animate-spin\" />\n              ) : (\n                <FileSpreadsheet className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n              )}\n              <h3 className=\"text-lg font-medium text-foreground mb-2\">\n                {isLoading ? 'Processing...' : 'Drop your file here'}\n              </h3>\n              <p className=\"text-muted-foreground mb-4\">or click to browse</p>\n              <p className=\"text-sm text-muted-foreground\">Supports CSV, XLS, XLSX (max 10MB)</p>\n              <Input\n                id=\"file-input\"\n                type=\"file\"\n                accept=\".csv,.xls,.xlsx\"\n                className=\"hidden\"\n                onChange={(e) => {\n                  const f = e.target.files?.[0];\n                  if (f) handleFileUpload(f);\n                }}\n                data-testid=\"file-input\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {step === 'mapping' && (\n        <Card className=\"bg-card border-border\">\n          <CardHeader>\n            <CardTitle className=\"text-foreground\">Map Columns</CardTitle>\n            <CardDescription className=\"text-muted-foreground\">\n              Match your file columns to property fields\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {MAPPING_FIELDS.map(field => (\n                <div key={field.key} className=\"flex items-center gap-3\">\n                  <Label className=\"w-32 text-foreground flex items-center gap-1\">\n                    {field.label}\n                    {field.required && <span className=\"text-red-500\">*</span>}\n                  </Label>\n                  <Select\n                    value={mapping[field.key as keyof ColumnMapping] || '__none__'}\n                    onValueChange={(value) => updateMapping(field.key, value)}\n                  >\n                    <SelectTrigger className=\"flex-1 bg-muted border-input\" data-testid={`mapping-${field.key}`}>\n                      <SelectValue placeholder=\"Select column\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-muted border-input\">\n                      <SelectItem value=\"__none__\">-- Not mapped --</SelectItem>\n                      {headers.map(header => (\n                        <SelectItem key={header} value={header}>{header}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              ))}\n            </div>\n\n            {preview.length > 0 && (\n              <div className=\"mt-6\">\n                <h4 className=\"text-sm font-medium text-foreground mb-2\">Preview (first 5 rows)</h4>\n                <ScrollArea className=\"h-48 rounded border border-border\">\n                  <div className=\"p-2 space-y-2\">\n                    {preview.map((row, i) => (\n                      <div key={i} className=\"bg-muted p-2 rounded text-sm\">\n                        <span className=\"font-medium\">{row[mapping.name || ''] || 'No name'}</span>\n                        <span className=\"text-muted-foreground ml-2\">\n                          {row[mapping.address || ''] || 'No address'}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </div>\n            )}\n\n            <div className=\"flex justify-end gap-2 mt-6\">\n              <Button variant=\"outline\" onClick={resetImport} className=\"border-border\" data-testid=\"btn-reset\">\n                Start Over\n              </Button>\n              <Button\n                onClick={handleValidate}\n                disabled={!mapping.name || !mapping.address || isLoading}\n                className=\"bg-gradient-to-r from-primary to-cyan-500\"\n                data-testid=\"btn-validate\"\n              >\n                {isLoading ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : null}\n                Validate Data\n                <ArrowRight className=\"w-4 h-4 ml-2\" />\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {step === 'validation' && (\n        <Card className=\"bg-card border-border\">\n          <CardHeader>\n            <CardTitle className=\"text-foreground\">Validation Results</CardTitle>\n            <CardDescription className=\"text-muted-foreground\">\n              Review the data before importing\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex gap-4 mb-4\">\n              <Badge variant=\"default\" className=\"bg-green-600\" data-testid=\"valid-count\">\n                <CheckCircle className=\"w-4 h-4 mr-1\" />\n                {validCount} Valid\n              </Badge>\n              <Badge variant=\"destructive\" data-testid=\"invalid-count\">\n                <XCircle className=\"w-4 h-4 mr-1\" />\n                {invalidCount} Invalid\n              </Badge>\n            </div>\n\n            <ScrollArea className=\"h-64 rounded border border-border\">\n              <div className=\"p-2 space-y-2\">\n                {validationResults.map((result) => (\n                  <div\n                    key={result.row}\n                    className={`p-3 rounded ${result.isValid ? 'bg-green-900/20' : 'bg-red-900/20'}`}\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      {result.isValid ? (\n                        <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                      ) : (\n                        <XCircle className=\"w-4 h-4 text-red-500\" />\n                      )}\n                      <span className=\"font-medium text-foreground\">Row {result.row}</span>\n                      <span className=\"text-muted-foreground\">\n                        {result.data.name} - {result.data.address}\n                      </span>\n                    </div>\n                    {result.errors.length > 0 && (\n                      <div className=\"ml-6 mt-1 text-sm text-red-400\">\n                        {result.errors.join(', ')}\n                      </div>\n                    )}\n                    {result.warnings.length > 0 && (\n                      <div className=\"ml-6 mt-1 text-sm text-yellow-400 flex items-center gap-1\">\n                        <AlertCircle className=\"w-3 h-3\" />\n                        {result.warnings.join(', ')}\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </ScrollArea>\n\n            <div className=\"flex justify-end gap-2 mt-6\">\n              <Button variant=\"outline\" onClick={() => setStep('mapping')} className=\"border-border\" data-testid=\"btn-back\">\n                Back to Mapping\n              </Button>\n              <Button\n                onClick={handleImport}\n                disabled={validCount === 0 || isLoading}\n                className=\"bg-gradient-to-r from-primary to-cyan-500\"\n                data-testid=\"btn-import\"\n              >\n                {isLoading ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : null}\n                Import {validCount} Properties\n                <ArrowRight className=\"w-4 h-4 ml-2\" />\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {step === 'importing' && (\n        <Card className=\"bg-card border-border\">\n          <CardHeader>\n            <CardTitle className=\"text-foreground\">Importing Properties</CardTitle>\n            <CardDescription className=\"text-muted-foreground\">\n              Please wait while we import your properties...\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"py-12 text-center\">\n            <Loader2 className=\"w-16 h-16 mx-auto text-primary animate-spin mb-4\" />\n            <p className=\"text-muted-foreground\">Processing {validCount} properties...</p>\n          </CardContent>\n        </Card>\n      )}\n\n      {step === 'complete' && importResult && (\n        <Card className=\"bg-card border-border\">\n          <CardHeader>\n            <CardTitle className=\"text-foreground flex items-center gap-2\">\n              <CheckCircle className=\"w-6 h-6 text-green-500\" />\n              Import Complete\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"bg-green-900/20 p-4 rounded\">\n                <div className=\"text-3xl font-bold text-green-500\" data-testid=\"imported-count\">\n                  {importResult.importedCount}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">Properties Imported</div>\n              </div>\n              <div className=\"bg-red-900/20 p-4 rounded\">\n                <div className=\"text-3xl font-bold text-red-500\" data-testid=\"skipped-count\">\n                  {importResult.skippedCount}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">Skipped/Errors</div>\n              </div>\n            </div>\n\n            {importResult.errors.length > 0 && (\n              <div className=\"mt-4\">\n                <h4 className=\"text-sm font-medium text-foreground mb-2\">Errors</h4>\n                <ScrollArea className=\"h-32 rounded border border-border\">\n                  <div className=\"p-2 space-y-1\">\n                    {importResult.errors.map((err, i) => (\n                      <div key={i} className=\"text-sm text-red-400\">\n                        Row {err.row}: {err.message}\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </div>\n            )}\n\n            <div className=\"flex justify-end gap-2 mt-6\">\n              <Button variant=\"outline\" onClick={resetImport} className=\"border-border\" data-testid=\"btn-import-more\">\n                Import More\n              </Button>\n              <Button\n                onClick={() => onComplete?.()}\n                className=\"bg-gradient-to-r from-primary to-cyan-500\"\n                data-testid=\"btn-done\"\n              >\n                Done\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n\nexport default PropertyImport;\n","path":null,"size_bytes":19722,"size_tokens":null},"docs/MOBILE_APP_DEPLOYMENT.md":{"content":"# WinnStorm Mobile App Deployment Guide\n\nThis guide provides step-by-step instructions for deploying WinnStorm to the Apple App Store and Google Play Store using Capacitor.\n\n## Prerequisites\n\n### Development Environment\n- **macOS** (required for iOS builds)\n- **Xcode 15+** (for iOS)\n- **Android Studio** (for Android)\n- **Node.js 18+**\n- **CocoaPods** (for iOS dependencies)\n\n### Accounts Required\n- **Apple Developer Account** ($99/year) - https://developer.apple.com\n- **Google Play Developer Account** ($25 one-time) - https://play.google.com/console\n\n---\n\n## Part 1: Pre-Build Setup\n\n### 1.1 Build the Web Application\n\n```bash\n# Install dependencies\nnpm install\n\n# Build the production web app\nnpm run build\n\n# Sync Capacitor with the built web app\nnpx cap sync\n```\n\n### 1.2 Configure Production API URL\n\nEdit `capacitor.config.ts` and uncomment/set the production URL:\n\n```typescript\nserver: {\n  url: 'https://your-winnstorm-domain.replit.app',\n  cleartext: true,\n  androidScheme: 'https'\n},\n```\n\nAfter publishing your Replit app, replace `your-winnstorm-domain` with your actual domain.\n\n---\n\n## Part 2: iOS App Store Deployment\n\n### 2.1 Open iOS Project\n\n```bash\nnpx cap open ios\n```\n\nThis opens the project in Xcode.\n\n### 2.2 Configure Signing & Capabilities\n\n1. Select the **App** target in Xcode\n2. Go to **Signing & Capabilities** tab\n3. Select your **Team** (Apple Developer account)\n4. Set **Bundle Identifier**: `com.winnstorm.inspector`\n5. Enable **Automatically manage signing**\n\n### 2.3 Required Permissions (Already Configured)\n\nThe following permissions are already configured in `Info.plist`:\n\n| Permission | Purpose |\n|------------|---------|\n| Camera | Capture inspection photos and thermal images |\n| Photo Library | Save and retrieve inspection photos |\n| Microphone | Voice commands with Stormy AI and field notes |\n| Speech Recognition | Hands-free voice commands during assessments |\n| Location (When In Use) | GPS-tag photos and route optimization |\n\n**App Store Review Tips:**\n- When asked about encryption, WinnStorm uses standard HTTPS only (ITSAppUsesNonExemptEncryption is set to NO)\n- Be prepared to explain the microphone usage for voice AI assistant feature\n- Location is used only while the app is active for photo tagging\n\n### 2.4 Optional Capabilities\n\nClick **+ Capability** to add if needed:\n- **Push Notifications** (for future updates)\n- **Associated Domains** (for deep linking)\n\n### 2.5 Configure App Icons\n\nCreate app icons in these sizes and add to `ios/App/App/Assets.xcassets/AppIcon.appiconset/`:\n\n| Size | Usage |\n|------|-------|\n| 20x20 | iPad Notifications |\n| 29x29 | Settings |\n| 40x40 | Spotlight |\n| 60x60 | iPhone App |\n| 76x76 | iPad App |\n| 83.5x83.5 | iPad Pro App |\n| 1024x1024 | App Store |\n\n**Tip**: Use a tool like https://appicon.co to generate all sizes from a 1024x1024 source.\n\n### 2.6 Create Launch Screen\n\nThe launch screen is configured in `ios/App/App/Base.lproj/LaunchScreen.storyboard`. Customize with WinnStorm branding.\n\n### 2.7 Build for Release\n\n1. Select **Product > Archive**\n2. When complete, the **Organizer** window opens\n3. Click **Distribute App**\n4. Choose **App Store Connect**\n5. Follow the prompts to upload\n\n### 2.8 App Store Connect Setup\n\n1. Go to https://appstoreconnect.apple.com\n2. Create a new app with:\n   - **Bundle ID**: `com.winnstorm.inspector`\n   - **Name**: WinnStorm\n   - **Primary Language**: English\n   - **SKU**: `winnstorm-inspector-2024`\n\n3. Fill in required information:\n   - **Description**: See below\n   - **Keywords**: damage assessment, roof inspection, hail damage, storm damage, property inspection, insurance claims\n   - **Support URL**: Your support page\n   - **Privacy Policy URL**: Your privacy policy\n   \n4. Upload screenshots (required sizes):\n   - iPhone 6.7\" (1290 x 2796)\n   - iPhone 6.5\" (1284 x 2778)\n   - iPad 12.9\" (2048 x 2732)\n\n5. Select **Age Rating**: 4+\n6. Set **Price**: Free (with in-app subscription)\n7. Submit for Review\n\n---\n\n## Part 3: Google Play Store Deployment\n\n### 3.1 Open Android Project\n\n```bash\nnpx cap open android\n```\n\nThis opens the project in Android Studio.\n\n### 3.2 Required Permissions (Already Configured)\n\nThe following permissions are already configured in `AndroidManifest.xml`:\n\n| Permission | Purpose |\n|------------|---------|\n| INTERNET | API communication |\n| CAMERA | Capture inspection photos |\n| READ_MEDIA_IMAGES | Access saved photos (API 33+) |\n| READ/WRITE_EXTERNAL_STORAGE | Photo storage (API ≤32) |\n| RECORD_AUDIO | Voice commands with Stormy AI |\n| ACCESS_FINE_LOCATION | GPS-tag photos |\n| ACCESS_COARSE_LOCATION | Approximate location backup |\n\nAll hardware features (camera, microphone, location) are marked as `required=\"false\"` so the app can install on devices without these features.\n\n**Play Console Review Tips:**\n- In the Data Safety section, declare location and microphone as \"collected\"\n- Explain these are used for inspection documentation, not tracking\n- Audio is processed by OpenAI for voice commands only\n\n### 3.3 Update Version Information\n\nEdit `android/app/build.gradle`:\n\n```gradle\ndefaultConfig {\n    applicationId \"com.winnstorm.inspector\"\n    versionCode 1        // Increment for each release\n    versionName \"1.0.0\"  // User-visible version\n}\n```\n\n### 3.4 Configure App Icons\n\nAdd app icons to `android/app/src/main/res/`:\n\n| Folder | Size |\n|--------|------|\n| mipmap-mdpi | 48x48 |\n| mipmap-hdpi | 72x72 |\n| mipmap-xhdpi | 96x96 |\n| mipmap-xxhdpi | 144x144 |\n| mipmap-xxxhdpi | 192x192 |\n\nCreate both `ic_launcher.png` and `ic_launcher_round.png` for each size.\n\n### 3.5 Create Signing Key\n\n```bash\nkeytool -genkey -v -keystore winnstorm-release.keystore \\\n  -alias winnstorm -keyalg RSA -keysize 2048 -validity 10000\n```\n\n**IMPORTANT**: Store this keystore securely. You'll need it for all future updates.\n\n### 3.6 Configure Signing in build.gradle\n\nAdd to `android/app/build.gradle`:\n\n```gradle\nandroid {\n    signingConfigs {\n        release {\n            storeFile file('winnstorm-release.keystore')\n            storePassword 'YOUR_STORE_PASSWORD'\n            keyAlias 'winnstorm'\n            keyPassword 'YOUR_KEY_PASSWORD'\n        }\n    }\n    buildTypes {\n        release {\n            signingConfig signingConfigs.release\n            minifyEnabled true\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n```\n\n### 3.7 Build Release APK/AAB\n\n```bash\n# Build Android App Bundle (preferred for Play Store)\ncd android\n./gradlew bundleRelease\n\n# Output: android/app/build/outputs/bundle/release/app-release.aab\n```\n\n### 3.8 Google Play Console Setup\n\n1. Go to https://play.google.com/console\n2. Create a new app:\n   - **App name**: WinnStorm\n   - **Default language**: English\n   - **App or game**: App\n   - **Free or paid**: Free\n\n3. Complete Store Listing:\n   - **Short description** (80 chars max)\n   - **Full description** (4000 chars max)\n   - **App icon**: 512x512 PNG\n   - **Feature graphic**: 1024x500 PNG\n   - **Screenshots**: Phone (min 2), Tablet (optional)\n\n4. Complete Content Rating questionnaire\n\n5. Set up **App Content**:\n   - Privacy Policy URL\n   - Ads declaration\n   - Target audience\n\n6. Create a **Release**:\n   - Go to **Production > Create new release**\n   - Upload your `.aab` file\n   - Add release notes\n   - Review and roll out\n\n---\n\n## Part 4: App Store Descriptions\n\n### Short Description (80 chars)\n```\nAI-powered damage assessment for professional roof and property inspectors.\n```\n\n### Full Description\n```\nWinnStorm is the premier mobile platform for damage assessment consultants, featuring AI-guided inspections powered by the proven Winn Methodology.\n\nKEY FEATURES:\n\nSTORMY AI ASSISTANT\n- Hands-free voice commands for field inspections\n- Real-time photo analysis and damage detection\n- AI-powered thermal image interpretation\n- Automated report generation with professional summaries\n\nCOMPREHENSIVE INSPECTIONS\n- 8-step guided methodology ensures nothing is missed\n- GPS-tagged photo documentation\n- Voice memo recording for field notes\n- Support for thermal imaging cameras\n\nPROFESSIONAL REPORTS\n- Generate Winn Methodology reports instantly\n- Include weather verification data\n- Export to PDF for client delivery\n- CRM integration for seamless workflow\n\nTEAM MANAGEMENT\n- Multi-property scheduling and routing\n- Workload tracking and assignment\n- Bulk property import from CSV/Excel\n- Real-time sync across devices\n\nCERTIFICATION PROGRAM\n- Complete training courses in-app\n- Track certification progress\n- Access to advanced methodology modules\n\nPerfect for roofing contractors, public adjusters, insurance professionals, and independent damage consultants.\n\nDownload WinnStorm today and transform your damage assessment workflow.\n```\n\n### Keywords (Apple App Store)\n```\ndamage assessment, roof inspection, hail damage, storm damage, property inspection, insurance claims, thermal imaging, Winn Methodology, roofing, public adjuster\n```\n\n---\n\n## Part 5: Post-Launch Checklist\n\n### Monitoring & Analytics\n- [ ] Set up Firebase Analytics in the app\n- [ ] Configure crash reporting (Crashlytics)\n- [ ] Monitor user reviews and respond promptly\n\n### Updates\n- [ ] Plan regular update schedule\n- [ ] Increment version codes for each release\n- [ ] Test thoroughly before submitting updates\n\n### Marketing\n- [ ] Create promotional screenshots\n- [ ] Record app preview video (iOS)\n- [ ] Prepare press release for launch\n\n---\n\n## Troubleshooting\n\n### iOS Build Issues\n\n**\"No provisioning profile\"**\n- Ensure you're signed into your Apple Developer account in Xcode\n- Enable \"Automatically manage signing\"\n\n**\"Module not found\"**\n```bash\ncd ios/App\npod install --repo-update\n```\n\n### Android Build Issues\n\n**\"SDK location not found\"**\n- Create `android/local.properties` with:\n```\nsdk.dir=/Users/YOUR_USERNAME/Library/Android/sdk\n```\n\n**\"Keystore file not found\"**\n- Ensure keystore path is correct in build.gradle\n- Use absolute path if relative path fails\n\n---\n\n## Security Notes\n\n1. **Never commit keystores or signing credentials to git**\n2. Store all signing keys in a secure password manager\n3. Use environment variables for CI/CD pipelines\n4. Enable Play App Signing for additional security (Google Play)\n\n---\n\n## Support\n\nFor deployment assistance, contact support@winnstorm.com\n","path":null,"size_bytes":10287,"size_tokens":null}},"version":2}